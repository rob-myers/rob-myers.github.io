<!DOCTYPE html><html lang="en"><head><meta name="description" content="A Game AI focused roguelike, built blog by blog." /><link rel="icon" href="/favicon.ico" /><style id="_goober"> .go1654252976{padding:0;color:#aaa;}.go1654252976 h3{padding:20px 12px;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;font-size:1.8rem;font-weight:300;margin:0;border:0 solid #aaa;border-width:0 0 2px;}.go1654252976 h3 a{color:#ddd;}.go1654252976 ul{font-size:1.1rem;padding:6px 0;margin:0;border:0 solid #aaa;border-width:0 0 2px;}.go1654252976 ul li{list-style:none;list-style-position:inside;display:flex;}.go1654252976 ul li.current a{color:white;}.go1654252976 ul a{padding:10px 12px;width:100%;color:#888;}.go1654252976 ul a:hover{color:#ccc;}.go2520195640{position:fixed;z-index:11;height:calc(100% + 200px);width:256px;font-weight:300;font-family:sans-serif;background-color:#222;color:white;cursor:pointer;opacity:0.975;-webkit-tap-highlight-color:transparent;left:0;transition:transform 500ms ease;}.go2520195640.open{transform:translateX(0px);}.go2520195640.closed{transform:translateX(-256px);}.go2520195640 > .article-overlay{position:absolute;top:0;left:256px;width:100vw;height:0;background:rgba(0, 0, 0, .1);}@media(max-width: 1280px){.go2520195640.open > .article-overlay{height:100%;background:rgba(0, 0, 0, .25);}}.go2520195640 > .handle{position:absolute;top:-1px;right:-40px;width:40px;height:41px;display:flex;justify-content:center;align-items:center;user-select:none;animation:fadeInHandle ease-in 500ms forwards;}.go2520195640 > .handle .icon{display:flex;justify-content:center;align-items:center;background:#900;color:#fff;width:inherit;height:inherit;padding:0 0 2px 0;}@keyframes fadeInHandle{0%{opacity:0;}100%{opacity:1;}}.go1271493558{position:fixed;cursor:pointer;z-index:7;left:0;width:calc(100vw + 256px);height:40px;background:black;animation:fadeInTopBar ease-in 300ms forwards;}@keyframes fadeInTopBar{0%{opacity:0;}100%{opacity:1;}}.go4227718824{min-width:256px;transition:min-width 500ms ease;}.go4227718824.closed{min-width:0;}@media(max-width: 1280px){.go4227718824{display:none;}}.go3266399463{position:absolute;z-index:10;right:140px;top:-40px;font-size:1rem;}@media(max-width: 1024px){.go3266399463{top:-32px;}}@media(max-width: 600px){.go3266399463{top:0;}}.go3266399463 > ul{background:#000;position:fixed;width:140px;height:40px;display:flex;justify-content:center;align-items:stretch;padding:0;margin:0;}.go3266399463 > ul li{list-style:none;list-style-position:inside;padding:0 5px;}.go3266399463 > ul a{color:#ccc;height:100%;display:flex;align-items:center;}.go3266399463 > ul a.primary{color:#fff;}.go46133191{position:relative;}@media(max-width: 600px){.go46133191{padding-left:8px;border-bottom:1px solid #777;}}.go46133191 h1{margin:0;font-size:4.8rem;font-weight:300;letter-spacing:4px;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;cursor:pointer;color:#444;text-transform:uppercase;text-shadow:0 0 2px #888888bb;padding-top:40px;}@media(max-width: 800px){.go46133191 h1{font-size:3.5rem;}}@media(max-width: 600px){.go46133191 h1{padding-top:72px;font-size:2.2rem;color:#333;}}.go46133191 p{color:#424242;font-size:1rem;font-family:'Courier New', Courier, monospace;margin:0;padding:40px 0 48px;font-weight:300;text-transform:lowercase;}@media(max-width: 600px){.go46133191 p{padding:24px 0 28px 4px;}}.go1835525393{max-width:1024px;width:100%;padding:40px 64px;}@media(max-width: 1024px){.go1835525393{padding:32px 0 32px 40px;margin:0;}}@media(max-width: 600px){.go1835525393{padding:0;}}.go1763247448{margin:0;border-color:var(--focus-bg);}@media(min-width: 800px){.go1763247448{padding-bottom:80px;border:0;}}.go1937084646{font-family:Roboto, Arial, sans-serif;}.go1937084646 > .top-right{position:absolute;right:calc(-1 * var(--tabs-border-width));top:-38px;z-index:2;height:38px;background:#444;border-bottom-width:0;padding:0px 8px;display:flex;line-height:initial;align-items:center;cursor:pointer;}@media(max-width: 600px){.go1937084646 > .top-right{padding:0 8px 2px 8px;}}.go1937084646 > .top-right > *{padding:0 8px;height:100%;display:flex;align-items:center;}.go1937084646 > .top-right > div.disable-icon{position:relative;transform:translateY(0.25px) scale(0.88);}.go1937084646 > .top-right > div.disable-icon:not(.enabled){filter:brightness(70%);}.go1937084646 > .central{position:absolute;z-index:6;left:calc(50% - (128px / 2));top:calc(50% - 20px);cursor:pointer;color:#ddd;background:rgba(0, 0, 0, 0.9);padding:12px 32px;border-radius:4px;border:1px solid #ddd;font-size:1.2rem;letter-spacing:2px;}.go4001245135{position:absolute;z-index:4;width:100%;height:100%;background:#000;font-family:sans-serif;opacity:1;transition:opacity 1s ease-in;}.go4001245135:not(.faded){pointer-events:none;}.go4001245135.clear{opacity:0;transition:opacity 0.5s ease-in;}.go4001245135.faded{opacity:0.5;transition:opacity 0.5s ease-in;}.go310549455{margin:64px 0;background:var(--focus-bg);position:relative;}@media(max-width: 600px){.go310549455{margin:40px 0 32px 0;}}.go310549455 > span.anchor{position:absolute;top:-96px;}.go310549455 .modal-backdrop{position:fixed;z-index:19;left:0;top:0;width:100vw;height:100vh;background:rgba(0, 0, 0, 0.6);}.go310549455 .flexlayout__tabset,.go310549455  .flexlayout__tab{background:white;}.go310549455 .flexlayout__layout{background:#444;}.go310549455 .flexlayout__tab{border-top:4px solid #444;position:relative;overflow:hidden;}.go310549455 .flexlayout__tab > div.portal{width:100%;height:100%;}.go310549455 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go310549455 .flexlayout__tab_button--selected,.go310549455  .flexlayout__tab_button:hover{background:#444;}.go310549455 .flexlayout__tab_button_content{user-select:none;font-size:0.7rem;font-family:sans-serif;font-weight:300;color:#aaa;}.go310549455 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go310549455 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go310549455 .flexlayout__splitter_vert,.go310549455  .flexlayout__splitter_horz{background:#827575;}.go2879821974{position:fixed;z-index:20;top:80px;left:5%;width:90%;height:calc(100% - 160px);border:var(--tabs-border-width) solid #444;}@media(max-width: 600px){.go2879821974{left:0;top:80px;width:100%;height:calc(100% - 120px);}}.go3480204015{line-height:2.2;border:0 solid var(--border-bg);border-width:1px 0 0 1px;font-size:1rem;overflow-wrap:break-word;position:relative;padding:64px 164px 96px 164px;}@media(max-width: 1024px){.go3480204015{padding:64px 128px 64px 128px;}}@media(max-width: 600px){.go3480204015{padding:8px 12px;font-size:1.1rem;border:none;line-height:2;font-weight:300;background:white;}}.go3480204015 a{position:relative;}.go3480204015 a code{color:unset;}.go3480204015 a > span.anchor{position:absolute;top:-96px;}.go3480204015 aside{margin:24px 0;padding:36px 48px;font-size:0.9rem;font-weight:300;border:0 solid #ddd;background:#eee;position:relative;}.go3480204015 aside p{margin:12px 0;}.go3480204015 aside p + blockquote,.go3480204015 aside  blockquote + p{margin-top:0px;}@media(max-width: 600px){.go3480204015 aside{padding:8px 20px;font-size:0.9rem;border-radius:12px;border-width:0 2px 2px 0;line-height:1.9;}}.go3480204015 aside blockquote{margin:0;border-left:8px solid #ccc;}@media(min-width: 600px){.go3480204015 aside figure.tabs{margin:40px 0;}}.go3480204015 aside .anchor{position:absolute;top:-48px;}.go3480204015 blockquote{margin:32px 0;border-left:8px solid #ddd;padding-left:30px;font-weight:300;}@media(max-width: 600px){.go3480204015 blockquote{margin:20px 0;padding-left:20px;font-style:italic;}}.go3480204015 blockquote + p{margin-top:-12px;}@media(max-width: 600px){.go3480204015 blockquote + p{margin-top:0;}}.go3480204015 code{font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;letter-spacing:2px;color:#444;padding:0 2px;}.go3480204015 figcaption{text-align:center;}.go3480204015 h1,.go3480204015  h2,.go3480204015  h3,.go3480204015  h4{font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;font-weight:300;letter-spacing:2px;}.go3480204015 h1 a,.go3480204015  h2 a,.go3480204015  h3 a,.go3480204015  h4 a{color:#444;}.go3480204015 h2{font-size:2.8rem;}@media(max-width: 1024px){.go3480204015 h2{font-size:2.6rem;}}@media(max-width: 600px){.go3480204015 h2{margin:16px 0 16px;font-size:1.7rem;}}.go3480204015 h2 + time{display:block;margin-top:-24px;margin-bottom:32px;font-size:0.7rem;line-height:3;}.go3480204015 h2 + time > span{margin-right:16px;white-space:pre;}.go3480204015 h2 + time > span > span{padding:6px 10px;margin:0 1px;border:1px solid #aaa;border-radius:2px;color:#333;}@media(max-width: 600px){.go3480204015 h2 + time{margin-top:0;}.go3480204015 h2 + time > span{padding:4px 0px;margin-right:12px;}.go3480204015 h2 + time > span > span{padding:6px 8px;}}.go3480204015 h2 + time + div.tags{margin-top:-12px;display:flex;flex-wrap:wrap;font-size:0.7rem;font-family:sans-serif;letter-spacing:2px;}.go3480204015 h2 + time + div.tags span{padding:2px 8px;margin-right:4px;margin-bottom:4px;border-radius:3px;border:2px solid rgba(0, 0, 0, 0.1);background:#555;color:#fff;}@media(max-width: 600px){.go3480204015 h2 + time + div.tags{margin-top:-16px;margin-bottom:32px;}}.go3480204015 h3{font-size:1.7rem;position:relative;}@media(max-width: 600px){.go3480204015 h3{font-size:1.3rem;}}.go3480204015 h3 > span.anchor{position:absolute;top:-48px;}.go3480204015 h2 + p,.go3480204015  h3 + p{margin-top:0px;}.go3480204015 li blockquote{margin:0;}.go3480204015 li blockquote p{margin:16px 0;}.go3480204015 p{margin:40px 0;}@media(max-width: 600px){.go3480204015 p{margin:16px 0;}}.go3480204015 p code{font-size:1rem;}.go3480204015 p + blockquote{margin-top:-20px;}@media(max-width: 600px){.go3480204015 p + blockquote{margin-top:-4px;}}.go3480204015 span.cmd{color:#555;background:#eee;font-family:monospace;letter-spacing:1px;font-size:smaller;padding:2px 4px;}@media(max-width: 600px){.go3480204015 span.cmd{user-select:all;}}.go3480204015 > span.anchor{position:absolute;top:-48px;}.go3480204015 table{padding:8px;border:1px solid #bbb;width:100%;margin:40px 0;}@media(max-width: 600px){.go3480204015 table{margin:20px 0;}}.go3480204015 table th,.go3480204015 table  td{padding:6px;text-align:left;vertical-align:top;}@media(max-width: 600px){.go3480204015 table th,.go3480204015 table  td{padding:4px 2px;}}@media(max-width: 600px){.go3480204015 ul,.go3480204015  ol{padding-left:20px;}}.go3480204015 ul + p,.go3480204015  ol + p{padding-top:6px;}.go3480204015 ul li,.go3480204015  ol li{margin:4px 0;}.go2193861445{padding:0;margin:0;list-style:none;}.go25095430::after{display:inline-block;content:'';background-image:url('/icon/ext-link-icon.svg');background-size:13px 13px;height:13px;width:13px;margin:0 2px 0 4px;}.go3449231876{width:100%;height:580px;position:relative;border:var(--tabs-border-width) solid #444;}@media(max-width: 600px){.go3449231876{height:400px;}}.go1827927822::after{display:inline-block;content:'';background-image:url('/icon/anchor-icon-white.svg');background-size:13px 13px;height:13px;width:13px;margin:auto;}.go2297566067::after{display:inline-block;content:'';background-image:url('/icon/expand-solid.svg');background-size:13px 13px;height:13px;width:13px;margin:auto;}.go446433213::after{display:inline-block;content:'';background-image:url('/icon/circle-xmark.svg');background-size:16px 16px;height:16px;width:16px;margin:auto;}.go1986663766{width:100%;height:600px;position:relative;border:var(--tabs-border-width) solid #444;}@media(max-width: 600px){.go1986663766{height:500px;}}.go1203773263{width:100%;height:400px;position:relative;border:var(--tabs-border-width) solid #444;}@media(max-width: 600px){.go1203773263{height:400px;}}.go3328718589{width:100%;height:340px;position:relative;border:var(--tabs-border-width) solid #444;}@media(max-width: 600px){.go3328718589{height:340px;}}.go2265116853{width:100%;height:300px;position:relative;border:var(--tabs-border-width) solid #444;}@media(max-width: 600px){.go2265116853{height:300px;}}.go842686353::after{display:inline-block;content:'';background-image:url('/icon/anchor-icon.svg');background-size:13px 13px;height:13px;width:13px;margin:0 2px 0 4px;}</style><meta name="next-font-preconnect" /><meta name="viewport" content="width=device-width" /><meta charSet="utf-8" /><title>The Last Redoubt</title><meta name="next-head-count" content="3" /><link rel="preload" href="/_next/static/css/8ebb2d75d3f278648f95.css" as="style" /><link rel="stylesheet" href="/_next/static/css/8ebb2d75d3f278648f95.css" data-n-g /><noscript data-n-css></noscript><script defer noModule src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-577672cf6f8213471171.js" defer></script><script src="/_next/static/chunks/framework-b8b18fbfb58c06b30dab.js" defer></script><script src="/_next/static/chunks/main-008b6500064c6253863d.js" defer></script><script src="/_next/static/chunks/pages/_app-5540efee6772b0ae3b79.js" defer></script><script src="/_next/static/chunks/commons-bd9ffd6201e2fbf760a7.js" defer></script><script src="/_next/static/chunks/6758-f4257d3d639460daf092.js" defer></script><script src="/_next/static/chunks/3033-613c45667bb9705b9810.js" defer></script><script src="/_next/static/chunks/3359-c847ee3b1ab1582c01c8.js" defer></script><script src="/_next/static/chunks/pages/debug-e3ccaeea18160e9adf34.js" defer></script><script src="/_next/static/lG452dc04SYHQp-ghsH8n/_buildManifest.js" defer></script><script src="/_next/static/lG452dc04SYHQp-ghsH8n/_ssgManifest.js" defer></script></head><body><div id="__next"><section class="go1835525393"><header class="title go46133191"><h1>The Last Redoubt</h1>
<p>$( video game | web dev | game ai )</p></header><main><ol class="go2193861445"><li><article class="go3480204015"><span id="objective" class="anchor"></span><h2 level="2"><a href="#objective"><a>Objective</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"><span>game ai</span><span>traveller</span><span>npc</span><span>navmesh</span><span>geomorph</span></div>
<p>We are going to create a <strong>video game</strong>.
Unusually, we'll
(a) describe the process in detail,
(b) use everyday web development techniques,
(c) focus on Game AI.</p>
<p>What kind of game?</p>
<blockquote>
<p>A <a href="https://en.wikipedia.org/wiki/Video_game_graphics#Top-down_perspective"><span id="objective--link--top-down" class="anchor"></span>top-down</a> adventure game.</p>
</blockquote>
<p>Where does it take place?</p>
<blockquote>
<p><a href="https://en.wikipedia.org/wiki/The_Night_Land" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">The Night Land</a> - a futuristic Earth whose Sun has died.
Humanity resides in a gigantic pyramid called <em>The Last Redoubt</em>.</p>
</blockquote>
<aside><span class="anchor"></span>
<p><em>The Night Land</em> (1912) was written by <a href="https://en.wikipedia.org/wiki/William_Hope_Hodgson"><span id="objective--link--william-hope-hodgson" class="anchor"></span>William Hope Hodgson</a>.
His <em>Last Redoubt</em> had 1,320 cities and the same number of floors.
We assume these 1000 + 320 cities span 125 + 64 = 189 floors, and are built from ancient interconnected space vehicles.</p>
<p>Some concept art will clarify things.</p>
</aside>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="objective--tabs--redoubt-sketch" class="anchor"></span><div class="go3449231876"><div class="go1937084646"><div class="top-right"><a href="#objective--tabs--redoubt-sketch" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div title="disable" class="disable-icon go446433213 enabled"></div></div></div><div class="go4001245135"></div></div></figure>
<p>How will the game be made?</p>
<blockquote>
<p>We'll use everyday web dev techniques,
avoiding game-centric technology like WebGL and physics engines.
Our approach is relevant to a wide audience i.e. web developers.</p>
</blockquote>
<p>What distinguishes it?</p>
<blockquote>
<p>The world is awash with beautiful games.
Beautiful, yes, but also somewhat shallow.
Failing the former we'll overcome the latter via rich Game AI (NPC behaviour).
We'll implement it <strong>interactively</strong> using a browser-based terminal.</p>
</blockquote>

<p><strong>TODO</strong>
a meaningful example 🚧</p>

<figure tabIndex="0" class="tabs scrollable go310549455"><span id="objective--tabs--nav-tty-1" class="anchor"></span><div class="go1986663766"><div class="go1937084646"><div class="top-right"><a href="#objective--tabs--nav-tty-1" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>

























<table><thead><tr><th>Category</th><th>Examples</th></tr></thead><tbody><tr><td>Nav</td><td><span class="cmd">ls</span>, <span class="cmd">pwd</span>, <span class="cmd">cd /home/test</span>, <span class="cmd">cd ..</span></td></tr><tr><td><a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">CRUD</a></td><td><span class="cmd">echo foo &gt;/home/bar</span>, <span class="cmd">/home/bar</span>, <span class="cmd">cd; rm bar</span></td></tr><tr><td>Out</td><td><span class="cmd">seq 10</span>, <span class="cmd">echo foo{1..5}</span>, <span class="cmd">expr '2**10'</span></td></tr><tr><td>Meta</td><td><span class="cmd">history</span>, <span class="cmd"> declare</span>, <span class="cmd">help&lt;/span</span></td></tr></tbody></table>
<p>Let's spend some time providing the backdrop</p>
<p><strong>FROM HERE</strong> would like</p>
<ul>
<li><em>TODO</em> <strong>ideas about characters and storylines</strong> e.g. 64 floors, floor layout; protagonist; other characters; natural mental states are unskillful; watchers represent fetters e.g. worry, ill-will etc.</li>
<li><em>TODO</em> <strong>clearer ideas about gameplay</strong> e.g. exploration; procedural generation; time-limited navpath motion; mental weaponry related to mental training; travel within the Night Land; ultimate goal e.g. deathless</li>
</ul>
<p>We'll use <a href="https://en.wikipedia.org/wiki/Navigation_mesh"><span id="objective--link--navigation-meshes" class="anchor"></span>navigation meshes</a> to simulate starship inhabitants,
following the rules of <a href="https://en.wikipedia.org/wiki/Traveller_%28role-playing_game%29"><span id="objective--link--traveller" class="anchor"></span>Traveller</a>.
To makes things less abstract, here's a Traveller-based asset called a <em>geomorph</em>.</p>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="objective--tabs--geomorph-301-debug" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#objective--tabs--geomorph-301-debug" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>
<p>We've recreated <strong>Geomorph 301</strong> (a.k.a. <em>Bridge</em>) from Robert Pearce's <a href="http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html"><span id="objective--link--starship-geomorphs-2.0" class="anchor"></span>Starship Geomorphs 2.0</a>,
using 8 of his <a href="http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html"><span id="objective--link--starship-symbols" class="anchor"></span>Starship Symbols</a>.
Obstacles you can see over are shaded grey e.g. chairs and beds.
Walls and obstacles which cannot be seen over are darker grey and black. The underlying polygons of these obstacles, together with the white rectangular doors, induce the <em>white triangulated navigable polygon</em> shown above.</p>
<blockquote>
<p>Check out this <a href="/pics/g-301--bridge.debug.x2.png" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">larger version</a>.</p>
</blockquote>
<aside><span class="anchor"></span>
<p>A <em>Starship Geomorph</em> is a rectangular partial floorplan of a starship, designed to be cut out and possibly glued to others.
They were created by Robert Pearce, and distributed as a PDF on his <a href="http://travellerrpgblog.blogspot.com/"><span id="objective--link--blog" class="anchor"></span>blog</a>.
A 2nd version was released in 2020, along with another PDF containing many individual symbols e.g. offices, fuel tanks and bedrooms. Soon afterwards Eric B. Smith transformed them into <a href="http://gurpsland.no-ip.org/geomorphs/"><span id="objective--link--transparent-pngs" class="anchor"></span>transparent PNGs</a>.
The latter 2000+ symbols will form the underlying basis of <em>The Last Redoubt</em>.</p>
</aside>
<p><strong>TODO</strong> remove Visibility and Css3d demo, replacing with NPC demo combined with terminal in some way.</p>

<figure tabIndex="0" class="tabs scrollable go310549455"><span id="objective--tabs--light-demo" class="anchor"></span><div class="go3328718589"><div class="go1937084646"><div class="top-right"><a href="#objective--tabs--light-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure></article><hr class="go1763247448" /></li><li><article class="go3480204015"><span id="constraints" class="anchor"></span><h2 level="2"><a href="#constraints"><a>Constraints</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"><span>tech</span><span>mechanics</span><span>terminal</span><span>setting</span></div>
<p>This project needs a backbone.
We've chosen the underlying technology, low-level game mechanics, and where events take place.</p>
<h3 level="3"><span id="constraints--technology" class="anchor"></span><a href="#constraints--technology"><a>Technology</a></a></h3>
<p>Let us list our chosen tools.</p>
<ul>
<li>Use everyday web dev techniques (e.g. not <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API"><span id="constraints--link--webgl" class="anchor"></span>WebGL</a>).</li>
<li>Use <a href="https://boxy-svg.com/"><span id="constraints--link--boxy-svg" class="anchor"></span>Boxy SVG</a> to edit assets.</li>
<li>Use <a href="https://nextjs.org/"><span id="constraints--link--nextjs" class="anchor"></span>NextJS</a> as our dev env (we may switch to <a href="https://www.gatsbyjs.com/"><span id="constraints--link--gatsby" class="anchor"></span>Gatsby</a> though).</li>
<li>Use <a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components"><span id="constraints--link--react-function-components" class="anchor"></span>React function components</a> and CSS-in-JS.
<blockquote>
<p>In particular, <a href="https://www.npmjs.com/package/preact"><span id="constraints--link--preact" class="anchor"></span>Preact</a> (a <a href="https://reactjs.org/"><span id="constraints--link--react" class="anchor"></span>React</a> alternative) and <a href="https://www.npmjs.com/package/goober"><span id="constraints--link--goober" class="anchor"></span>Goober</a>.</p>
</blockquote>
</li>
<li>Use <a href="https://codesandbox.io"><span id="constraints--link--codesandbox" class="anchor"></span>CodeSandbox</a> to share editable code.</li>
</ul>
<p>In so far as <em>modern</em> web development goes,</p>
<blockquote>
<p>we must support both mobile and desktop devices.</p>
</blockquote>


<aside><span class="anchor"></span>
<p>Although WebGL permits rich 2D and 3D graphics,
it leads away from the <em>declarative nature</em> of everyday web dev.
Sticking to core web technologies makes our approach relevant to a far larger audience.
We also want to avoid obsessing over graphics, seeking superior Game AI instead.</p>
</aside>
<p>If you're unfamiliar with CodeSandbox (or similar), check <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">this example</a>.
Perusing the files, you'll find e.g. the rectangle class <em>Rect</em> and a Geomorph PNG.
Our CodeSandboxes use React, whereas this site uses <em>Preact</em>.</p>
<h3 level="3"><span id="constraints--game-mechanics" class="anchor"></span><a href="#constraints--game-mechanics"><a>Game mechanics</a></a></h3>
<p>Next, gameplay related constraints.</p>
<ul>
<li>Use <a href="http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html"><span id="constraints--link--starship-geomorphs-2.0" class="anchor"></span>Starship Geomorphs 2.0</a> for graphics.
<blockquote>
<p>We saw <a href="/pics/g-301--bridge.debug.x2.png" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">an example</a> previously;
here's <a href="/pics/g-302--xboat-repair-bay.debug.png" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">another</a>.</p>
</blockquote>
</li>
<li>Use a realtime birdseye camera.
<blockquote>
<p>Basically a pannable and zoomable SVG.</p>
</blockquote>
</li>
<li>Use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API/Using_the_Web_Animations_API"><span id="constraints--link--web-animations-api" class="anchor"></span>Web Animations API</a>.
<blockquote>
<p>This API provides access to the technology underlying CSS animations.</p>
</blockquote>
</li>
<li>Use navigation &amp; raycasting algorithms.
<blockquote>
<p>Involves a <a href="https://en.wikipedia.org/wiki/Navigation_mesh#:~:text=A%20navigation%20mesh%2C%20or%20navmesh,video%20game%20AI%20in%202000."><span id="constraints--link--navmesh" class="anchor"></span>navmesh</a> and computing ray/geometry collisions.</p>
</blockquote>
</li>
<li>Do not use a Physics engine.</li>
<li>Use an in-browser terminal.</li>
</ul>
<p>We'll develop complex Game AI with the aid of a terminal.
Try entering or copy-pasting the commands below. Mobile users may find copy-pasting easier.</p>

























<table><thead><tr><th>Category</th><th>Examples</th></tr></thead><tbody><tr><td>Nav</td><td><span class="cmd">ls</span>, <span class="cmd">pwd</span>, <span class="cmd">cd /home/test</span>, <span class="cmd">cd ..</span></td></tr><tr><td><a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">CRUD</a></td><td><span class="cmd">echo foo &gt;/home/bar</span>, <span class="cmd">/home/bar</span>, <span class="cmd">cd; rm bar</span></td></tr><tr><td>Out</td><td><span class="cmd">seq 10</span>, <span class="cmd">echo foo{1..5}</span>, <span class="cmd">expr '2**10'</span></td></tr><tr><td>Meta</td><td><span class="cmd">history</span>, <span class="cmd"> declare</span>, <span class="cmd">help</span>, <span class="cmd"> ps</span></td></tr></tbody></table>
  <figure tabIndex="0" class="tabs scrollable go310549455"><span id="constraints--tabs--terminal-demo" class="anchor"></span><div class="go2265116853"><div class="go1937084646"><div class="top-right"><a href="#constraints--tabs--terminal-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>
<p>As usual, <a href="#command" title="sigkill test">Ctrl+C</a> terminates the &quot;foreground process&quot; e.g. try terminating <span class="cmd">sleep 5; echo rise and shine</span>.
Pipelines and background processes are also supported.
We'll use terminals to monitor the current state of our Game AI, issue direct commands, and develop long-running behaviour.</p>
<h3 level="3"><span id="constraints--setting" class="anchor"></span><a href="#constraints--setting"><a>Setting</a></a></h3>
<p>Then it only remains to constrain the setting.</p>
<ul>
<li>Events take place in the <a href="https://travellermap.com/?p=-1.329!-23.768!3"><span id="constraints--link--traveller-universe" class="anchor"></span>Traveller Universe</a>, onboard star ships, space ships and space stations.</li>
<li><a href="https://en.wikipedia.org/wiki/Bardo_Thodol"><span id="constraints--link--bardo-thodol" class="anchor"></span>Bardo Thodol</a> provides a source of inspiration,
<blockquote>
<p>e.g. Ship AIs may recite it to dying <a href="https://wiki.travellerrpg.com/Low_Berth_Rack" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">Low Berth</a> travellers.</p>
</blockquote>
</li>
<li><a href="https://en.wikipedia.org/wiki/The_Night_Land"><span id="constraints--link--the-night-land" class="anchor"></span>The Night Land</a> provides a source of inspiration,
<blockquote>
<p>e.g. Earth is generally assumed to be lost after a Karmic Loop was created, letting in the Watchers and other manifestations from Buddhist hells.</p>
</blockquote>
</li>
</ul>
<p>Traveller is a Futuristic pen-and-paper Role-playing Game, created in the late 70s.
It permits faster than light travel bounded by 6 parsecs per week (but usually more like 2 parsecs per week).
Learn more on the <a href="https://wiki.travellerrpg.com/Jump_Drive"><span id="constraints--link--wiki" class="anchor"></span>wiki</a>, the <a href="https://www.farfuture.net/"><span id="constraints--link--official-site" class="anchor"></span>official site</a> or explore <a href="https://travellermap.com/"><span id="constraints--link--traveller-map" class="anchor"></span>Traveller Map</a>.
It directly motivated Robert Pearce's Starship Geomorphs, and provides considerable depth.</p>
<aside><span class="anchor"></span>
<p><em>The Traveller game in all forms is owned by <a href="https://www.farfuture.net/"><span id="constraints--link--far-future-enterprises" class="anchor"></span>Far Future Enterprises</a>. Copyright © 1977 – 2021 Far Future Enterprises.</em></p>
</aside>
<p>We'll leverage two additional sources of inspiration i.e. <em>Liberation Through Hearing in the Intermediate State</em> (Bardo Thodol) and a famous Science Fiction story from 1912 (The Night Land).</p></article><hr class="go1763247448" /></li><li><article class="go3480204015"><span id="finishing" class="anchor"></span><h2 level="2"><a href="#finishing"><a>Finishing</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"><span>finishing as a skill</span><span>better game ai</span><span>teleglitch</span></div>
<p>Over time we'll clarify the above constraints, but first we emphasise:</p>
<blockquote>
<p><em>creating a video game is really fucking hard</em>.</p>
</blockquote>
<p>Spelunky's creator suggested <a href="https://makegames.tumblr.com/post/1136623767/finishing-a-game"><span id="finishing--link--three-important-requirements" class="anchor"></span>three important requirements</a> for finishing a game.
We'll address them.</p>
<h3 level="3"><span id="finishing--1.-fun-to-develop" class="anchor"></span><a href="#finishing--1.-fun-to-develop"><a>1. Fun to develop</a></a></h3>
<p><em>Games I want to make</em>. My underlying motivation is the lack of Game AI resources available on the web.
It is hard to discuss the subject without actually building a game, so I chose a setting and game mechanics which felt fun for me.
I am particularly interested in navigation i.e. combining the movement of many characters in a flexible manner.</p>
<h3 level="3"><span id="finishing--2.-the-result" class="anchor"></span><a href="#finishing--2.-the-result"><a>2. The Result</a></a></h3>
<p><em>Games I want to have made</em>. As an end result I want a highly replayable tactical/action game sandbox.
Procedurally generated missions will involve going from A to B and doing C (ever was it so).
Monotony will be overcome via encountered NPC behaviours and e.g. ship building.
Functionally, think <a href="https://www.youtube.com/results?search_query=Teleglitch"><span id="finishing--link--teleglitch" class="anchor"></span>Teleglitch</a> with richer NPCs and the ability to <em>place</em> <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=175359117"><span id="finishing--link--room-modules" class="anchor"></span>room modules</a> when upgrading/docking.
Graphically, see Starship Geomorphs 2.0.</p>
<p><em>The Last Redoubt</em> will be easily extendable.
We'll provide compositional code, escape hatches to CodeSandbox, clear explanations, and <a href="https://github.com/"><span id="finishing--link--github" class="anchor"></span>GitHub</a> comments.</p>
<h3 level="3"><span id="finishing--3.-experience" class="anchor"></span><a href="#finishing--3.-experience"><a>3. Experience</a></a></h3>
<p><em>Games I’m good at making</em>. I work as a web developer, using React and CSS-in-JS on a daily basis.
I have a <a href="https://dblp.org/pid/81/8748.html"><span id="finishing--link--strong-background" class="anchor"></span>strong background</a> in Theoretical Computer Science,
so won't confuse Game AI with AI, nor fall prey to the Deep Learning hype.
I have also created similar game mechanics <em>many</em> times over the years.
Here's hoping my chain of unfinished projects is coming to a close!</p></article><hr class="go1763247448" /></li><li><article class="go3480204015"><span id="technology" class="anchor"></span><h2 level="2"><a href="#technology"><a>Constraints</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"><span>lego bricks</span><span>specific tech</span></div>
<p>This project needs a backbone.
We've chosen the underlying technology, low-level game mechanics, and where events take place.</p>
<h3 level="3"><span id="technology--technology" class="anchor"></span><a href="#technology--technology"><a>Technology</a></a></h3>
<p>Let us list our chosen tools.</p>
<ul>
<li>Use everyday web dev techniques (e.g. not <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API"><span id="technology--link--webgl" class="anchor"></span>WebGL</a>).</li>
<li>Use <a href="https://boxy-svg.com/"><span id="technology--link--boxy-svg" class="anchor"></span>Boxy SVG</a> to edit assets.</li>
<li>Use <a href="https://nextjs.org/"><span id="technology--link--nextjs" class="anchor"></span>NextJS</a> as our dev env (we may switch to <a href="https://www.gatsbyjs.com/"><span id="technology--link--gatsby" class="anchor"></span>Gatsby</a> though).</li>
<li>Use <a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components"><span id="technology--link--react-function-components" class="anchor"></span>React function components</a> and CSS-in-JS.
<blockquote>
<p>In particular, <a href="https://www.npmjs.com/package/preact"><span id="technology--link--preact" class="anchor"></span>Preact</a> (a <a href="https://reactjs.org/"><span id="technology--link--react" class="anchor"></span>React</a> alternative) and <a href="https://www.npmjs.com/package/goober"><span id="technology--link--goober" class="anchor"></span>Goober</a>.</p>
</blockquote>
</li>
<li>Use <a href="https://codesandbox.io"><span id="technology--link--codesandbox" class="anchor"></span>CodeSandbox</a> to share editable code.</li>
</ul>
<p>In so far as <em>modern</em> web development goes,</p>
<blockquote>
<p>we must support both mobile and desktop devices.</p>
</blockquote>


<aside><span class="anchor"></span>
<p>Although WebGL permits rich 2D and 3D graphics,
it leads away from the <em>declarative nature</em> of everyday web dev.
Sticking to core web technologies makes our approach relevant to a far larger audience.
We also want to avoid obsessing over graphics, seeking superior Game AI instead.</p>
</aside>
<p>If you're unfamiliar with CodeSandbox (or similar), check <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">this example</a>.
Perusing the files, you'll find e.g. the rectangle class <em>Rect</em> and a Geomorph PNG.
Our CodeSandboxes use React, whereas this site uses <em>Preact</em>.</p>
<h3 level="3"><span id="technology--game-mechanics" class="anchor"></span><a href="#technology--game-mechanics"><a>Game mechanics</a></a></h3>
<p>Next, gameplay related constraints.</p>
<ul>
<li>Use <a href="http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html"><span id="technology--link--starship-geomorphs-2.0" class="anchor"></span>Starship Geomorphs 2.0</a> for graphics.
<blockquote>
<p>We saw <a href="/pics/g-301--bridge.debug.x2.png" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">an example</a> previously;
here's <a href="/pics/g-302--xboat-repair-bay.debug.png" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">another</a>.</p>
</blockquote>
</li>
<li>Use a realtime birdseye camera.
<blockquote>
<p>Basically a pannable and zoomable SVG.</p>
</blockquote>
</li>
<li>Use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API/Using_the_Web_Animations_API"><span id="technology--link--web-animations-api" class="anchor"></span>Web Animations API</a>.
<blockquote>
<p>This API provides access to the technology underlying CSS animations.</p>
</blockquote>
</li>
<li>Use navigation &amp; raycasting algorithms.
<blockquote>
<p>Involves a <a href="https://en.wikipedia.org/wiki/Navigation_mesh#:~:text=A%20navigation%20mesh%2C%20or%20navmesh,video%20game%20AI%20in%202000."><span id="technology--link--navmesh" class="anchor"></span>navmesh</a> and computing ray/geometry collisions.</p>
</blockquote>
</li>
<li>Do not use a Physics engine.</li>
<li>Use an in-browser terminal.</li>
</ul>
<p>We'll develop complex Game AI with the aid of a terminal.
Try entering or copy-pasting the commands below. Mobile users may find copy-pasting easier.</p>

























<table><thead><tr><th>Category</th><th>Examples</th></tr></thead><tbody><tr><td>Nav</td><td><span class="cmd">ls</span>, <span class="cmd">pwd</span>, <span class="cmd">cd /home/test</span>, <span class="cmd">cd ..</span></td></tr><tr><td><a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">CRUD</a></td><td><span class="cmd">echo foo &gt;/home/bar</span>, <span class="cmd">/home/bar</span>, <span class="cmd">cd; rm bar</span></td></tr><tr><td>Out</td><td><span class="cmd">seq 10</span>, <span class="cmd">echo foo{1..5}</span>, <span class="cmd">expr '2**10'</span></td></tr><tr><td>Meta</td><td><span class="cmd">history</span>, <span class="cmd"> declare</span>, <span class="cmd">help</span>, <span class="cmd"> ps</span></td></tr></tbody></table>
  <figure tabIndex="0" class="tabs scrollable go310549455"><span id="technology--tabs--terminal-demo" class="anchor"></span><div class="go2265116853"><div class="go1937084646"><div class="top-right"><a href="#technology--tabs--terminal-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>
<p>As usual, <a href="#command" title="sigkill test">Ctrl+C</a> terminates the &quot;foreground process&quot; e.g. try terminating <span class="cmd">sleep 5; echo rise and shine</span>.
Pipelines and background processes are also supported.
We'll use terminals to monitor the current state of our Game AI, issue direct commands, and develop long-running behaviour.</p>
<h3 level="3"><span id="technology--setting" class="anchor"></span><a href="#technology--setting"><a>Setting</a></a></h3>
<p>Then it only remains to constrain the setting.</p>
<ul>
<li>Events take place in the <a href="https://travellermap.com/?p=-1.329!-23.768!3"><span id="technology--link--traveller-universe" class="anchor"></span>Traveller Universe</a>, onboard star ships, space ships and space stations.</li>
<li><a href="https://en.wikipedia.org/wiki/Bardo_Thodol"><span id="technology--link--bardo-thodol" class="anchor"></span>Bardo Thodol</a> provides a source of inspiration,
<blockquote>
<p>e.g. Ship AIs may recite it to dying <a href="https://wiki.travellerrpg.com/Low_Berth_Rack" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">Low Berth</a> travellers.</p>
</blockquote>
</li>
<li><a href="https://en.wikipedia.org/wiki/The_Night_Land"><span id="technology--link--the-night-land" class="anchor"></span>The Night Land</a> provides a source of inspiration,
<blockquote>
<p>e.g. Earth is generally assumed to be lost after a Karmic Loop was created, letting in the Watchers and other manifestations from Buddhist hells.</p>
</blockquote>
</li>
</ul>
<p>Traveller is a Futuristic pen-and-paper Role-playing Game, created in the late 70s.
It permits faster than light travel bounded by 6 parsecs per week (but usually more like 2 parsecs per week).
Learn more on the <a href="https://wiki.travellerrpg.com/Jump_Drive"><span id="technology--link--wiki" class="anchor"></span>wiki</a>, the <a href="https://www.farfuture.net/"><span id="technology--link--official-site" class="anchor"></span>official site</a> or explore <a href="https://travellermap.com/"><span id="technology--link--traveller-map" class="anchor"></span>Traveller Map</a>.
It directly motivated Robert Pearce's Starship Geomorphs, and provides considerable depth.</p>
<aside><span class="anchor"></span>
<p><em>The Traveller game in all forms is owned by <a href="https://www.farfuture.net/"><span id="technology--link--far-future-enterprises" class="anchor"></span>Far Future Enterprises</a>. Copyright © 1977 – 2021 Far Future Enterprises.</em></p>
</aside>
<p>We'll leverage two additional sources of inspiration i.e. <em>Liberation Through Hearing in the Intermediate State</em> (Bardo Thodol) and a famous Science Fiction story from 1912 (The Night Land).</p></article><hr class="go1763247448" /></li><li><article class="go3480204015"><span id="tech1" class="anchor"></span><h2 level="2"><a href="#tech1"><a>Tech (ai)</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"><span>javascript</span><span>react</span><span>preact</span><span>jsx</span><span>performance</span><span>hot reload</span></div>

<h3 level="3"><span id="tech1--overview" class="anchor"></span><a href="#tech1--overview"><a>Overview</a></a></h3>
<p><em>The Last Redoubt</em> will present a birdseye viewpoint of the interior of starships.
The <a href="https://wiki.travellerrpg.com/Crew" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">crew</a> will have tasks, such as manning the bridge, patrolling the decks, monitoring <a href="https://wiki.travellerrpg.com/Low_Passage" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">low berths</a>.
These behaviours will be constrained by e.g. sleep patterns, the behaviour of others, and hardware failures.</p>
<p>But how do video games implement these behaviours?
Well, there are three standard systems:</p>
<ul>
<li><strong>Navigation</strong>: <em>planning e.g. route from A to B.</em></li>
<li><strong>Animation</strong>: <em>realism (e.g. limbs) and visual cues.</em></li>
<li><strong>Physics</strong>: <em>collision detection, force-driven rigid bodies, raycasting</em>.</li>
</ul>
<p>Navigation is of central importance to us, and will be discussed shortly.
As for animation, we won't obsess over realism,
but we'll need visual cues to indicate NPC actions.
We also want a <em>sense of flow</em>, achieved via interdependent concurrent animations.
As for a physics engine, we <a href="1#constraints--game-mechanics" title="@anchor" class="anchor-link go842686353"><span id="tech1--link--mentioned" class="anchor"></span>mentioned</a> we won't be using one. In fact:</p>
<ul>
<li>Collision detection will be handled at the level of navigation.</li>
<li>Force-based motion will be simulated via the Web Animations API.</li>
</ul>
<p>In the rest of this article we'll discuss Navigation and Raycasting in detail.</p>
<h3 level="3"><span id="tech1--static-navigation" class="anchor"></span><a href="#tech1--static-navigation"><a>Static Navigation</a></a></h3>
<p>To move an NPC from <strong>A</strong> to <strong>B</strong>, we need a respective path.
This might simply be a straight line e.g. when an item is directly within grasp.
However, usually there are objects to be avoided: static ones like walls, dynamic ones like NPCs.</p>
<p>Sans dynamic objects, a canonical approach exists.</p>
<ul>
<li>The navigable area is represented by <em>polygons</em> (<a href="https://datatracker.ietf.org/doc/html/rfc7946#section-3.1.6"><span id="tech1--link--possibly-with-holes" class="anchor"></span>possibly with holes</a>),
with <strong>A</strong> and <strong>B</strong> inside them.</li>
<li>These polygons can be <em>triangulated</em> i.e. partitioned into triangles with disjoint interiors.
Thin or large triangles can be avoided via <em><a href="https://en.wikipedia.org/wiki/Steiner_point_(computational_geometry)"><span id="tech1--link--steiner-points" class="anchor"></span>Steiner points</a></em>.</li>
<li>The triangulation induces an undirected graph.
<blockquote>
<p>A <strong>Navgraph</strong> is an undirected graph whose
nodes are <em>the triangles of the provided triangulation</em>.
Two nodes are connected if and only if <em>their respective triangles share exactly one edge.</em></p>
</blockquote>
</li>
</ul>
<p>For example, the grey triangles below collectively induce the red navgraph.</p>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech1--tabs--nav-graph-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech1--tabs--nav-graph-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>
<p><strong>TODO</strong> Mention triangle-wasm CodeSandbox</p>
<p>Technically, an undirected graph is just a <em>symmetric binary relation</em>.
We have made it concrete by depicting each node as the centroid of its respective triangle.
This is a standard convention, although triangles have more than one <a href="https://en.wikipedia.org/wiki/Triangle_center"><span id="tech1--link--notion-of-center" class="anchor"></span>notion of center</a>.
It provides a weight for each edge i.e. the distance between the centroids.
Then the length of a path through the undirected graph may be defined as the sum of its edge's weights.</p>
<aside><span id="tech1--aside--why-we-abstract" class="anchor"></span>
<p>Searching for paths through the embedded undirected graph is much easier than searching the navigable polygons.
There are far fewer possibilities.
However, NPCs won't actually follow these embedded paths (for realism),
but an induced path instead (see below).</p>
</aside>
<aside><span class="anchor"></span>
<p>The length of each path in the undirected graph should approximate the respective <em>real</em> shortest path length.
Zig-zags between centroids can make a relatively short path <em>long</em>. This is often mitigated by pre-processing the navigable polygons, ensuring small triangles.</p>
</aside>
<p>So, how to find a path from A to B?</p>
<blockquote>
<p>Given A and B we have two triangles (maybe equal), so two nodes, hence may apply <a href="https://en.wikipedia.org/wiki/A*_search_algorithm"><span id="tech1--link--a*" class="anchor"></span>A*</a> using our chosen edge weights (distance between centroids).</p>
<p>This quickly provides a solution i.e. a path.
However it is insufficient because realistic NPCs would not follow centroid to centroid paths.
One can solve this by applying the <a href="http://digestingduck.blogspot.com/2010/03/simple-stupid-funnel-algorithm.html"><span id="tech1--link--string-pulling-algorithm" class="anchor"></span>string-pulling algorithm</a>.
It pulls the zig-zag path tight along the navigable polygons' extremal points.</p>
</blockquote>
<p>Drag the nodes below to see <em>string-pulling</em> in action.</p>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech1--tabs--nav-string-pull-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech1--tabs--nav-string-pull-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>

<h3 level="3"><span id="tech1--dynamic-navigation" class="anchor"></span><a href="#tech1--dynamic-navigation"><a>Dynamic Navigation</a></a></h3>

<p>Navigation around dynamic objects is harder.
What was once a collision-free path may no longer be.
Two officers on the bridge could be swapping shifts,
or perhaps the player needs to rush through a moving crowd.</p>
<p>One common approach is to combine static navigation (previous section) with <a href="https://www.researchgate.net/publication/2495826_Steering_Behaviors_For_Autonomous_Characters"><span id="tech1--link--steering-behaviours" class="anchor"></span>steering behaviours</a>.
They are usually implemented via a physics engine.
An NPC will be driven by its own force, plus other forces induced by the position and velocity of nearby NPCs.</p>
<aside><span class="anchor"></span>
<p>For example, <strong>obstacle avoidance</strong> works by driving close characters apart.
A suitable force is applied orthogonal to the NPC's direction of travel.</p>
</aside>
<p>However, one cannot expect the vector sum of forces to capture complex interactions between multiple characters.
Reynolds introduced Steering Behaviours as part of a pipeline:</p>
<blockquote>
<p><em>action selection</em> → <em>steering</em> → <em>animation</em>.</p>
</blockquote>
<p>In practice, one must rely <em>heavily</em> on action selection to avoid unrealistic behaviour such as oscillation and deadlock.</p>
<p>There is another well-known approach i.e. <a href="https://github.com/recastnavigation/recastnavigation#detour"><span id="tech1--link--detour" class="anchor"></span>Detour</a> and in particular <em>DetourCrowd</em>, providing a sophisticated solution to multiple character navigation.
It has been <a href="https://github.com/BabylonJS/Extensions/tree/master/recastjs"><span id="tech1--link--ported-to-js" class="anchor"></span>ported to JS</a> in BabylonJS,
and also <a href="https://docs.unrealengine.com/4.27/en-US/API/Runtime/Navmesh/DetourCrowd/dtCrowd/"><span id="tech1--link--integrated" class="anchor"></span>integrated</a> into the Unreal Engine.</p>
<p>In Detour, a collection of NPCs is conceptualised as a <em>Crowd</em>.
One requests the Crowd to move individual NPCs to particular targets.
An updater function must be executed each frame.
For each fixed NPC, its nearby neighbours are modelled as temporary geometry, influencing the NPC's velocity.
We'll have more to say about this impressive open source library.</p>
<h3 level="3"><span id="tech1--navigation:-our-approach" class="anchor"></span><a href="#tech1--navigation:-our-approach"><a>Navigation: Our Approach</a></a></h3>
<p>So how will we approach this difficult problem?
Well, we won't solve it generally.
That is,</p>
<blockquote>
<p><em>we don't seek a black box, magically producing collision-free concurrent navigation</em>.</p>
</blockquote>
<p>We're happy to take things slow.
Let's start with two colliding NPCs.
We'll detect their imminent collision, and then stop them both.</p>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech1--tabs--nav-collide-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech1--tabs--nav-collide-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>
<p><strong>TODO</strong></p>
<ul>
<li>DraggablePath component ✅</li>
<li>Circle moves along navpath ✅</li>
<li>Componentise and improve</li>
<li>Detect future collision for 2 paths</li>
<li>Combine with terminal?</li>
</ul>
<h3 level="3"><span id="tech1--raycasting" class="anchor"></span><a href="#tech1--raycasting"><a>Raycasting</a></a></h3>
<p><strong>TODO</strong></p>
<ul>
<li>illustrate line-seg vs line-seg intersection with initial space partitioning</li>
<li>navigation through auto-opening doors</li>
<li>combine with terminal?</li>
</ul>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech1--tabs--nav-doors-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech1--tabs--nav-doors-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure></article><hr class="go1763247448" /></li><li><article class="go3480204015"><span id="tech2" class="anchor"></span><h2 level="2"><a href="#tech2"><a>Tech (ai)</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"><span>navigation</span><span>navgraph</span><span>navmesh</span><span>string pull</span><span>steering</span><span>detour</span><span>raycast</span></div>

<h3 level="3"><span id="tech2--overview" class="anchor"></span><a href="#tech2--overview"><a>Overview</a></a></h3>
<p><em>The Last Redoubt</em> will present a birdseye viewpoint of the interior of starships.
The <a href="https://wiki.travellerrpg.com/Crew" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">crew</a> will have tasks, such as manning the bridge, patrolling the decks, monitoring <a href="https://wiki.travellerrpg.com/Low_Passage" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link go25095430">low berths</a>.
These behaviours will be constrained by e.g. sleep patterns, the behaviour of others, and hardware failures.</p>
<p>But how do video games implement these behaviours?
Well, there are three standard systems:</p>
<ul>
<li><strong>Navigation</strong>: <em>planning e.g. route from A to B.</em></li>
<li><strong>Animation</strong>: <em>realism (e.g. limbs) and visual cues.</em></li>
<li><strong>Physics</strong>: <em>collision detection, force-driven rigid bodies, raycasting</em>.</li>
</ul>
<p>Navigation is of central importance to us, and will be discussed shortly.
As for animation, we won't obsess over realism,
but we'll need visual cues to indicate NPC actions.
We also want a <em>sense of flow</em>, achieved via interdependent concurrent animations.
As for a physics engine, we <a href="1#constraints--game-mechanics" title="@anchor" class="anchor-link go842686353"><span id="tech2--link--mentioned" class="anchor"></span>mentioned</a> we won't be using one. In fact:</p>
<ul>
<li>Collision detection will be handled at the level of navigation.</li>
<li>Force-based motion will be simulated via the Web Animations API.</li>
</ul>
<p>In the rest of this article we'll discuss Navigation and Raycasting in detail.</p>
<h3 level="3"><span id="tech2--static-navigation" class="anchor"></span><a href="#tech2--static-navigation"><a>Static Navigation</a></a></h3>
<p>To move an NPC from <strong>A</strong> to <strong>B</strong>, we need a respective path.
This might simply be a straight line e.g. when an item is directly within grasp.
However, usually there are objects to be avoided: static ones like walls, dynamic ones like NPCs.</p>
<p>Sans dynamic objects, a canonical approach exists.</p>
<ul>
<li>The navigable area is represented by <em>polygons</em> (<a href="https://datatracker.ietf.org/doc/html/rfc7946#section-3.1.6"><span id="tech2--link--possibly-with-holes" class="anchor"></span>possibly with holes</a>),
with <strong>A</strong> and <strong>B</strong> inside them.</li>
<li>These polygons can be <em>triangulated</em> i.e. partitioned into triangles with disjoint interiors.
Thin or large triangles can be avoided via <em><a href="https://en.wikipedia.org/wiki/Steiner_point_(computational_geometry)"><span id="tech2--link--steiner-points" class="anchor"></span>Steiner points</a></em>.</li>
<li>The triangulation induces an undirected graph.
<blockquote>
<p>A <strong>Navgraph</strong> is an undirected graph whose
nodes are <em>the triangles of the provided triangulation</em>.
Two nodes are connected if and only if <em>their respective triangles share exactly one edge.</em></p>
</blockquote>
</li>
</ul>
<p>For example, the grey triangles below collectively induce the red navgraph.</p>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech2--tabs--nav-graph-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech2--tabs--nav-graph-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>
<p><strong>TODO</strong> Mention triangle-wasm CodeSandbox</p>
<p>Technically, an undirected graph is just a <em>symmetric binary relation</em>.
We have made it concrete by depicting each node as the centroid of its respective triangle.
This is a standard convention, although triangles have more than one <a href="https://en.wikipedia.org/wiki/Triangle_center"><span id="tech2--link--notion-of-center" class="anchor"></span>notion of center</a>.
It provides a weight for each edge i.e. the distance between the centroids.
Then the length of a path through the undirected graph may be defined as the sum of its edge's weights.</p>
<aside><span id="tech2--aside--why-we-abstract" class="anchor"></span>
<p>Searching for paths through the embedded undirected graph is much easier than searching the navigable polygons.
There are far fewer possibilities.
However, NPCs won't actually follow these embedded paths (for realism),
but an induced path instead (see below).</p>
</aside>
<aside><span class="anchor"></span>
<p>The length of each path in the undirected graph should approximate the respective <em>real</em> shortest path length.
Zig-zags between centroids can make a relatively short path <em>long</em>. This is often mitigated by pre-processing the navigable polygons, ensuring small triangles.</p>
</aside>
<p>So, how to find a path from A to B?</p>
<blockquote>
<p>Given A and B we have two triangles (maybe equal), so two nodes, hence may apply <a href="https://en.wikipedia.org/wiki/A*_search_algorithm"><span id="tech2--link--a*" class="anchor"></span>A*</a> using our chosen edge weights (distance between centroids).</p>
<p>This quickly provides a solution i.e. a path.
However it is insufficient because realistic NPCs would not follow centroid to centroid paths.
One can solve this by applying the <a href="http://digestingduck.blogspot.com/2010/03/simple-stupid-funnel-algorithm.html"><span id="tech2--link--string-pulling-algorithm" class="anchor"></span>string-pulling algorithm</a>.
It pulls the zig-zag path tight along the navigable polygons' extremal points.</p>
</blockquote>
<p>Drag the nodes below to see <em>string-pulling</em> in action.</p>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech2--tabs--nav-string-pull-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech2--tabs--nav-string-pull-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>

<h3 level="3"><span id="tech2--dynamic-navigation" class="anchor"></span><a href="#tech2--dynamic-navigation"><a>Dynamic Navigation</a></a></h3>

<p>Navigation around dynamic objects is harder.
What was once a collision-free path may no longer be.
Two officers on the bridge could be swapping shifts,
or perhaps the player needs to rush through a moving crowd.</p>
<p>One common approach is to combine static navigation (previous section) with <a href="https://www.researchgate.net/publication/2495826_Steering_Behaviors_For_Autonomous_Characters"><span id="tech2--link--steering-behaviours" class="anchor"></span>steering behaviours</a>.
They are usually implemented via a physics engine.
An NPC will be driven by its own force, plus other forces induced by the position and velocity of nearby NPCs.</p>
<aside><span class="anchor"></span>
<p>For example, <strong>obstacle avoidance</strong> works by driving close characters apart.
A suitable force is applied orthogonal to the NPC's direction of travel.</p>
</aside>
<p>However, one cannot expect the vector sum of forces to capture complex interactions between multiple characters.
Reynolds introduced Steering Behaviours as part of a pipeline:</p>
<blockquote>
<p><em>action selection</em> → <em>steering</em> → <em>animation</em>.</p>
</blockquote>
<p>In practice, one must rely <em>heavily</em> on action selection to avoid unrealistic behaviour such as oscillation and deadlock.</p>
<p>There is another well-known approach i.e. <a href="https://github.com/recastnavigation/recastnavigation#detour"><span id="tech2--link--detour" class="anchor"></span>Detour</a> and in particular <em>DetourCrowd</em>, providing a sophisticated solution to multiple character navigation.
It has been <a href="https://github.com/BabylonJS/Extensions/tree/master/recastjs"><span id="tech2--link--ported-to-js" class="anchor"></span>ported to JS</a> in BabylonJS,
and also <a href="https://docs.unrealengine.com/4.27/en-US/API/Runtime/Navmesh/DetourCrowd/dtCrowd/"><span id="tech2--link--integrated" class="anchor"></span>integrated</a> into the Unreal Engine.</p>
<p>In Detour, a collection of NPCs is conceptualised as a <em>Crowd</em>.
One requests the Crowd to move individual NPCs to particular targets.
An updater function must be executed each frame.
For each fixed NPC, its nearby neighbours are modelled as temporary geometry, influencing the NPC's velocity.
We'll have more to say about this impressive open source library.</p>
<h3 level="3"><span id="tech2--navigation:-our-approach" class="anchor"></span><a href="#tech2--navigation:-our-approach"><a>Navigation: Our Approach</a></a></h3>
<p>So how will we approach this difficult problem?
Well, we won't solve it generally.
That is,</p>
<blockquote>
<p><em>we don't seek a black box, magically producing collision-free concurrent navigation</em>.</p>
</blockquote>
<p>We're happy to take things slow.
Let's start with two colliding NPCs.
We'll detect their imminent collision, and then stop them both.</p>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech2--tabs--nav-collide-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech2--tabs--nav-collide-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure>
<p><strong>TODO</strong></p>
<ul>
<li>DraggablePath component ✅</li>
<li>Circle moves along navpath ✅</li>
<li>Componentise and improve</li>
<li>Detect future collision for 2 paths</li>
<li>Combine with terminal?</li>
</ul>
<h3 level="3"><span id="tech2--raycasting" class="anchor"></span><a href="#tech2--raycasting"><a>Raycasting</a></a></h3>
<p><strong>TODO</strong></p>
<ul>
<li>illustrate line-seg vs line-seg intersection with initial space partitioning</li>
<li>navigation through auto-opening doors</li>
<li>combine with terminal?</li>
</ul>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="tech2--tabs--nav-doors-demo" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#tech2--tabs--nav-doors-demo" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure></article><hr class="go1763247448" /></li><li><article class="go3480204015"><span id="tech3" class="anchor"></span><h2 level="2"><a href="#tech3"><a>Tech (dev)</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"></div>
<h3 level="3"><span id="tech3--static-analysis" class="anchor"></span><a href="#tech3--static-analysis"><a>Static Analysis</a></a></h3>
<ul>
<li>Typescript via JSDoc, referring to CodeSandbox.</li>
</ul>
<h3 level="3"><span id="tech3--runtime-analysis" class="anchor"></span><a href="#tech3--runtime-analysis"><a>Runtime Analysis</a></a></h3>
<ul>
<li>Terminal + Game AI</li>
</ul>
<h3 level="3"><span id="tech3--comments" class="anchor"></span><a href="#tech3--comments"><a>Comments</a></a></h3>
<ul>
<li>Display GitHub comments from Issue (build-time)</li>
<li>Can use anonymous credits to get recent</li>
</ul>
<br />
<br />
</article><hr class="go1763247448" /></li><li><article class="go3480204015"><span id="geomorphs" class="anchor"></span><h2 level="2"><a href="#geomorphs"><a>Geomorphs</a></a></h2><time dateTime="2022-02-22"><span><span>2</span><span>2</span><span>n</span><span>d</span></span><span><span>F</span><span>e</span><span>b</span></span><span><span>2</span><span>0</span><span>2</span><span>2</span></span></time><div title="tags" class="tags"></div>
<h3 level="3"><span id="geomorphs--filesystem-structure" class="anchor"></span><a href="#geomorphs--filesystem-structure"><a>Filesystem structure</a></a></h3>
<p>media</p>
<ul>
<li>Starship Geomorphs 2.0.pdf (Original source)</li>
<li>Starship Symbols.pdf (Original source)</li>
<li>Geomorphs.zip (Transparent PNGs obtained from Starship Geomorphs 2.0)</li>
<li>SymbolsHighRes.zip (Transparent PNGs obtained from Starship Symbols)</li>
</ul>
<p>media/Geomorph</p>
<ul>
<li>PNGs of lower quality (relatively).</li>
<li>Extracted from &quot;Starship Geomorphs 2.0.pdf&quot; by ...</li>
</ul>
<p>media/Symbols</p>
<ul>
<li>PNGs of higher quality.</li>
<li>Extracted from &quot;Starship Symbols.pdf&quot; by ...</li>
</ul>
<p>media/scripts</p>
<ul>
<li>ts-node scripts launched via npm scripts</li>
<li>Directories generated by scripts</li>
<li>media/geomorph-edge (Edge Geomorphs)</li>
<li>media/symbol-bridge</li>
<li>media/symbol-dock-small-craft</li>
<li>media/symbol-staterooms</li>
<li>media/symbol-lounge</li>
<li>media/symbol-root</li>
</ul>
<p>public/png</p>
<ul>
<li>PNGs from media/symbol-* with labels removed</li>
</ul>
<p>public/svg</p>
<ul>
<li>Enriched symbols</li>
<li>Geomorph hulls</li>
</ul>
<figure tabIndex="0" class="tabs scrollable go310549455"><span id="geomorphs--tabs--geomorph-101" class="anchor"></span><div class="go1203773263"><div class="go1937084646"><div class="top-right"><a href="#geomorphs--tabs--geomorph-101" title="anchor" class="go1827927822"></a><div title="maximise" class="go2297566067"></div><div class="disable-icon go446433213"></div></div><div class="central">interact</div></div><div class="go4001245135"></div></div></figure></article><hr class="go1763247448" /></li></ol><div style="height: 400px; background: red; position: fixed;">Hi</div></main></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/debug","query":{},"buildId":"lG452dc04SYHQp-ghsH8n","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>