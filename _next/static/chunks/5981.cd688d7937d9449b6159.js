"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5981],{85981:function(n,t,o){o.r(t),o.d(t,{default:function(){return h}});var e,r=o(52209),i=o(92809),s=(o(67294),o(88269)),c=o(35490),a=o(91441),u=o(83159),l=o(95814),d=o(85893);function p(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.push.apply(o,e)}return o}function f(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(Object(o),!0).forEach((function(t){(0,i.Z)(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))}))}return n}function h(n){var t=(0,l.Z)(n.layoutKey).data;return(0,d.jsx)(u.Z,{gridBounds:c.l,initViewBox:c.r,maxZoom:8,className:v,children:t&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("image",f(f({},t.pngRect),{},{className:"geomorph",href:(0,a.qX)(n.layoutKey)})),!n.disabled&&(0,d.jsx)(m,{gm:t})]})})}function m(n){var t=n.gm;return(0,d.jsx)("foreignObject",f(f({},t.pngRect),{},{xmlns:"http://www.w3.org/1999/xhtml",children:(0,d.jsx)("div",{onPointerUp:function(n){var o=n.target,e=[o.clientWidth,Number(o.getAttribute("data-index"))],r=e[1],i=e[0]<=10?t.doors[r].baseRect.width:10;o.style.width="".concat(i,"px")},children:t.doors.map((function(n,o){var e=n.baseRect,r=n.angle;return(0,d.jsx)("div",{className:"door","data-index":o,style:{left:e.x-t.pngRect.x,top:e.y-t.pngRect.y,width:e.width,height:e.height,transformOrigin:"top left",transform:"rotate(".concat(r,"rad)")}})}))})}))}var v=(0,s.iv)(e||(e=(0,r.Z)(["\n  foreignObject {\n    div.door {\n      position: absolute;\n      cursor: pointer;\n      background: white;\n      border: 1px solid black;\n\n      transition: width 500ms ease;\n      &.open {\n        width: 0;\n      }\n    }\n  }\n"])))},35490:function(n,t,o){o.d(t,{l:function(){return r},r:function(){return i}});var e=o(48103),r=new e.UL(-5e3,-5e3,10001,10001),i=new e.UL(0,0,1200,600)},95814:function(n,t,o){o.d(t,{Z:function(){return v}});var e=o(92809),r=o(97131),i=o(30266),s=o(809),c=o.n(s),a=o(88767),u=o(91441),l=o(48103),d=o(2026),p=o(39660),f=o(68451);function h(n,t){var o=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.push.apply(o,e)}return o}function m(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?h(Object(o),!0).forEach((function(t){(0,e.Z)(n,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))}))}return n}function v(n){return(0,a.useQuery)((0,u.tU)(n),(0,i.Z)(c().mark((function t(){var o,e,i,s,a,d,h;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=p.Vn,t.next=3,fetch((0,u.tU)(n)).then((function(n){return n.json()}));case 3:return t.t1=t.sent,o=(0,t.t0)(t.t1),e=o.roomGraph,i=e.nodesArray.filter((function(n){return"room"===n.type})).map((function(n,t){var i=e.getEdgesFrom(n).flatMap((function(n){var t=n.dst;return"door"===t.type?o.doors[t.doorId].poly:[]}));return l.LA.union([o.rooms[t]].concat((0,r.Z)(i)))[0]})),s=o.groups.singles.filter((function(n){return n.tags.includes("light")})).map((function(n){var t=n.poly,o=n.tags;return{center:t.center,poly:t,reverse:o.includes("reverse")}})),a=o.groups.singles.filter((function(n){return n.tags.includes("relate-connectors")})).reduce((function(n,t){var e=t.poly,i=o.doors.flatMap((function(n,t){return f.J.convexPolysIntersect(n.poly.outline,e.outline)?t:[]})),s=o.windows.flatMap((function(n,t){return f.J.convexPolysIntersect(n.poly.outline,e.outline)?t:[]}));return i.forEach((function(t){var o,e;n[t]=n[t]||{doorIds:[],windowIds:[]},(o=n[t].doorIds).push.apply(o,(0,r.Z)(i.filter((function(n){return n!==t})))),(e=n[t].windowIds).push.apply(e,(0,r.Z)(s))})),0===i.length&&console.warn("poly tagged 'relate-connectors' doesn't intersect any door: (windowIds ".concat(s,")")),i.length+s.length<=1&&console.warn("poly tagged 'relate-connectors' should intersect \u2265 2 doors/windows (doorIds ".concat(i,", windowIds ").concat(s,")")),n}),{}),d=o.rooms.map((function(n){return{default:n.center,labels:[],light:{},spawn:[]}})),s.forEach((function(n,t){var e=n.center,r=n.poly,i=n.reverse,s=o.rooms.findIndex((function(n){return n.contains(e)})),c=o.doors.findIndex((function(n){return f.J.convexPolysIntersect(r.outline,n.poly.outline)}));if(-1===s||-1===c)console.warn("useGeomorphData: light ".concat(t," has room/doorId ").concat(s,"/").concat(c));else if(i){var a=o.doors[c].roomIds.find((function(n){return n!==s}));"number"!==typeof a?console.warn("useGeomorphData: reverse light ".concat(t," lacks other roomId (room/doorId ").concat(s,"/").concat(c,")")):s=a}d[s].light[c]=e})),o.groups.singles.filter((function(n){return n.tags.includes("spawn")})).map((function(n){return n.poly.center})).forEach((function(n,t){var e=o.rooms.findIndex((function(t){return t.contains(n)}));e>=0?d[e].spawn.push(n):console.warn("spawn point ".concat(t," should be inside some room"))})),o.labels.forEach((function(n){var t=o.rooms.findIndex((function(t){return t.contains(n.center)}));t>=0?(d[t].labels.push(n),d[t].default=l.dl.from(d[t].labels[0].center)):console.warn("label ".concat(n.text," should be inside some room"))})),(h=m(m({},o),{},{hullDoors:o.doors.filter((function(n){return n.tags.includes("hull")})),hullOutline:o.hullPoly[0].removeHoles(),pngRect:l.UL.fromJson(o.items[0].pngRect),roomsWithDoors:i,relDoorId:a,point:d,lazy:null,getHullDoorId:function(n){var t="number"===typeof n?this.doors[n]:n;return this.hullDoors.findIndex((function(n){return n===t}))},getOtherRoomId:function(n,t){return("number"===typeof n?this.doors[n]:n).roomIds.find((function(n){return n!==t}))||-1},isHullDoor:function(n){return("number"===typeof n?this.doors[n]:n).roomIds.includes(null)}})).lazy=g(h),y(h),t.abrupt("return",h);case 17:case"end":return t.stop()}}),t)}))),{cacheTime:1/0,keepPreviousData:!0,staleTime:1/0})}function g(n){var t={roomNavPoly:{}},o=new Proxy({},{get:function(o,e){if("string"===typeof e){var r=Number(e);if(n.roomsWithDoors[r]&&!t.roomNavPoly[r]){var i=l.LA.intersect(n.navPoly,[n.roomsWithDoors[r]]);i.sort((function(n,t){return n.rect.area>t.rect.area?-1:1})),t.roomNavPoly[r]=i[0]}return t.roomNavPoly[r]}}});return new Proxy(t,{get:function(n,t){if("roomNavPoly"===t)return o}})}function y(n){n.navZone.doorNodeIds.forEach((function(t,o){var e=n.doors[o];if(n.hullDoors.includes(e)){var i,s=e.roomIds.find((function(n){return null!==n}));if(Number.isFinite(s))(i=n.navZone.roomNodeIds[s]).push.apply(i,(0,r.Z)(t));else(0,d.ZK)("extendRoomNodeIds: ".concat(n.key," (hull) door ").concat(o," has empty roomIds"))}}))}},83159:function(n,t,o){o.d(t,{Z:function(){return f}});var e,r=o(52209),i=o(79056),s=o(67294),c=o(88269),a=o(94184),u=o.n(a),l=o(48103),d=o(50269),p=o(85893);function f(n){var t=s.useState((function(){var t=n.initViewBox.clone(),i=n.minZoom||.5,s=n.maxZoom||2;return{viewBox:t,panFrom:null,zoom:n.initZoom||1,ptrs:[],ptrDiff:null,root:{},rootCss:(0,c.iv)(e||(e=(0,r.Z)(["\n        width: 100%;\n        height: 100%;\n\n        touch-action: pan-x pan-y pinch-zoom;\n        background-color: ",";\n\n        > g.content {\n          /** TODO justification? */\n          shape-rendering: ",";\n        }\n        > .grid {\n          pointer-events: none;\n        }\n      "])),n.dark?"#000":"none",(0,d.us)()?"optimizeSpeed":"auto"),onPointerDown:function(n){(0,d.af)(n)&&o.ptrs.length<2&&(o.panFrom=(new l.dl).copy((0,d.zk)((0,d.Xs)(n))),o.ptrs.push((0,d.Xs)(n)))},onPointerMove:function(e){if(o.ptrs=o.ptrs.map((function(n){return n.pointerId===e.pointerId?(0,d.Xs)(e):n})),2===o.ptrs.length){var r=Math.abs(o.ptrs[1].clientX-o.ptrs[0].clientX);if(null!==o.ptrDiff){var i,s=(0,d._Y)(o.ptrs);o.zoomTo(s,.02*(r-o.ptrDiff)),o.root.setAttribute("viewBox","".concat(o.viewBox)),null===(i=n.onUpdate)||void 0===i||i.call(n,o.root)}o.ptrDiff=r}else if(o.panFrom){var c,a=(0,d.zk)((0,d.Xs)(e));t.delta(o.panFrom.x-a.x,o.panFrom.y-a.y),o.root.setAttribute("viewBox","".concat(o.viewBox)),null===(c=n.onUpdate)||void 0===c||c.call(n,o.root)}},onPointerUp:function(n){o.panFrom=null,o.ptrs=o.ptrs.filter((function(t){return n.pointerId!==t.pointerId})),o.ptrs.length<2&&(o.ptrDiff=null),1===o.ptrs.length&&(o.panFrom=(new l.dl).copy((0,d.zk)(o.ptrs[0])))},onTouchStart:function(n){n.preventDefault()},onWheel:function(t){if(t.preventDefault(),(0,d.af)(t)){var e,r=(0,d.zk)((0,d.Xs)(t));o.zoomTo(r,-.003*t.deltaY),o.root.setAttribute("viewBox","".concat(o.viewBox)),null===(e=n.onUpdate)||void 0===e||e.call(n,o.root)}},rootRef:function(n){n&&(o.root=n,n.addEventListener("wheel",o.onWheel,{passive:!1}),n.addEventListener("pointerdown",o.onPointerDown,{passive:!0}),n.addEventListener("pointermove",o.onPointerMove,{passive:!0}),n.addEventListener("pointerup",o.onPointerUp,{passive:!0}),n.addEventListener("pointercancel",o.onPointerUp,{passive:!0}),n.addEventListener("pointerleave",o.onPointerUp,{passive:!0}),n.addEventListener("touchstart",o.onTouchStart,{passive:!1}))},zoomTo:function(e,r){var c=Math.min(Math.max(o.zoom+r,i),s);t.x=o.zoom/c*(t.x-e.x)+e.x,t.y=o.zoom/c*(t.y-e.y)+e.y,t.width=1/c*n.initViewBox.width,t.height=1/c*n.initViewBox.height,o.zoom=c}}})),o=(0,i.Z)(t,1)[0];return(0,p.jsxs)("svg",{ref:o.rootRef,className:o.rootCss,preserveAspectRatio:"xMinYMin slice",viewBox:"".concat(o.viewBox),children:[(0,p.jsx)("g",{className:u()("content",n.className),children:n.children}),(0,p.jsx)(h,{bounds:n.gridBounds,dark:n.dark})]})}function h(n){var t=s.useMemo((function(){return m++}),[]);return(0,p.jsx)(p.Fragment,{children:[10,60].flatMap((function(o,e){return[(0,p.jsx)("defs",{children:(0,p.jsx)("pattern",{id:"pattern-grid-".concat(o,"x").concat(o,"--").concat(t),width:o,height:o,patternUnits:"userSpaceOnUse",children:(0,p.jsx)("path",{d:"M ".concat(o," 0 L 0 0 0 ").concat(o),fill:"none",stroke:n.dark?"rgba(200,200,200,0.2)":"rgba(0,0,0,0.5)",strokeWidth:"0.3"})})},o+e),(0,p.jsx)("rect",{className:"grid",x:n.bounds.x,y:n.bounds.y,width:n.bounds.width,height:n.bounds.height,fill:"url(#pattern-grid-".concat(o,"x").concat(o,"--").concat(t,")")},o+e+1)]}))})}var m=0}}]);