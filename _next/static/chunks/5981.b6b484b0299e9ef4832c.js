"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5981],{85981:function(n,t,e){e.r(t),e.d(t,{default:function(){return h}});var o,r=e(52209),i=e(92809),a=(e(67294),e(88269)),s=e(35490),c=e(91441),u=e(83159),l=e(95814),p=e(85893);function d(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,o)}return e}function f(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?d(Object(e),!0).forEach((function(t){(0,i.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function h(n){var t=(0,l.Z)(n.layoutKey).data;return(0,p.jsx)(u.Z,{gridBounds:s.l,initViewBox:s.r,maxZoom:8,className:v,children:t&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("image",f(f({},t.pngRect),{},{className:"geomorph",href:(0,c.qX)(n.layoutKey)})),!n.disabled&&(0,p.jsx)(m,{gm:t})]})})}function m(n){var t=n.gm;return(0,p.jsx)("foreignObject",f(f({},t.pngRect),{},{xmlns:"http://www.w3.org/1999/xhtml",children:(0,p.jsx)("div",{onPointerUp:function(n){var e=n.target,o=[e.clientWidth,Number(e.getAttribute("data-index"))],r=o[1],i=o[0]<=10?t.doors[r].baseRect.width:10;e.style.width="".concat(i,"px")},children:t.doors.map((function(n,e){var o=n.baseRect,r=n.angle;return(0,p.jsx)("div",{className:"door","data-index":e,style:{left:o.x-t.pngRect.x,top:o.y-t.pngRect.y,width:o.width,height:o.height,transformOrigin:"top left",transform:"rotate(".concat(r,"rad)")}})}))})}))}var v=(0,a.iv)(o||(o=(0,r.Z)(["\n  foreignObject {\n    div.door {\n      position: absolute;\n      cursor: pointer;\n      background: white;\n      border: 1px solid black;\n\n      transition: width 500ms ease;\n      &.open {\n        width: 0;\n      }\n    }\n  }\n"])))},35490:function(n,t,e){e.d(t,{l:function(){return r},r:function(){return i}});var o=e(48103),r=new o.UL(-5e3,-5e3,10001,10001),i=new o.UL(0,0,1200,600)},95814:function(n,t,e){e.d(t,{Z:function(){return v}});var o=e(92809),r=e(97131),i=e(30266),a=e(809),s=e.n(a),c=e(88767),u=e(91441),l=e(48103),p=e(2026),d=e(39660),f=e(68451);function h(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,o)}return e}function m(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?h(Object(e),!0).forEach((function(t){(0,o.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function v(n){return(0,c.useQuery)((0,u.tU)(n),(0,i.Z)(s().mark((function t(){var e,o,i,a,c,p,h;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=d.Vn,t.next=3,fetch((0,u.tU)(n)).then((function(n){return n.json()}));case 3:return t.t1=t.sent,e=(0,t.t0)(t.t1),o=e.roomGraph,i=o.nodesArray.filter((function(n){return"room"===n.type})).map((function(n,t){var i=o.getEdgesFrom(n).flatMap((function(n){var t=n.dst;return"door"===t.type?e.doors[t.doorId].poly:[]}));return l.LA.union([e.rooms[t]].concat((0,r.Z)(i)))[0]})),a=e.groups.singles.filter((function(n){return n.tags.includes("light")})).map((function(n){var t=n.poly,e=n.tags;return{center:t.center,poly:t,reverse:e.includes("reverse")}})),c=e.groups.singles.filter((function(n){return n.tags.includes("relate-doors")})).reduce((function(n,t){var o=t.poly,i=e.doors.flatMap((function(n,t){return f.J.convexPolysIntersect(n.poly.outline,o.outline)?t:[]}));return i.forEach((function(t){var e;return(e=n[t]||(n[t]=[])).push.apply(e,(0,r.Z)(i.filter((function(n){return n!==t}))))})),i.length<=1&&console.warn("poly tagged 'relate-doors' intersects \u2264 1 doorIds: ".concat(i)),n}),{}),p=e.rooms.map((function(n){return{default:n.center,labels:[],light:{},spawn:[]}})),a.forEach((function(n,t){var o=n.center,r=n.poly,i=n.reverse,a=e.rooms.findIndex((function(n){return n.contains(o)})),s=e.doors.findIndex((function(n){return f.J.convexPolysIntersect(r.outline,n.poly.outline)}));if(-1===a||-1===s)console.warn("useGeomorphData: light ".concat(t," has room/doorId ").concat(a,"/").concat(s));else if(i){var c=e.doors[s].roomIds.find((function(n){return n!==a}));"number"!==typeof c?console.warn("useGeomorphData: reverse light ".concat(t," lacks other roomId (room/doorId ").concat(a,"/").concat(s,")")):a=c}p[a].light[s]=o})),e.groups.singles.filter((function(n){return n.tags.includes("spawn")})).map((function(n){return n.poly.center})).forEach((function(n,t){var o=e.rooms.findIndex((function(t){return t.contains(n)}));o>=0?p[o].spawn.push(n):console.warn("spawn point ".concat(t," should be inside some room"))})),e.labels.forEach((function(n){var t=e.rooms.findIndex((function(t){return t.contains(n.center)}));t>=0?(p[t].labels.push(n),p[t].default=l.dl.from(p[t].labels[0].center)):console.warn("label ".concat(n.text," should be inside some room"))})),(h=m(m({},e),{},{hullDoors:e.doors.filter((function(n){return n.tags.includes("hull")})),hullOutline:e.hullPoly[0].removeHoles(),pngRect:l.UL.fromJson(e.items[0].pngRect),roomsWithDoors:i,relDoorId:c,point:p,lazy:null})).lazy=g(h),y(h),t.abrupt("return",h);case 17:case"end":return t.stop()}}),t)}))),{cacheTime:1/0,keepPreviousData:!0,staleTime:1/0})}function g(n){var t={roomNavPoly:{}},e=new Proxy({},{get:function(e,o){if("string"===typeof o){var r=Number(o);if(n.roomsWithDoors[r]&&!t.roomNavPoly[r]){var i=l.LA.intersect(n.navPoly,[n.roomsWithDoors[r]]);i.sort((function(n,t){return n.rect.area>t.rect.area?-1:1})),t.roomNavPoly[r]=i[0]}return t.roomNavPoly[r]}}});return new Proxy(t,{get:function(n,t){if("roomNavPoly"===t)return e}})}function y(n){n.navZone.doorNodeIds.forEach((function(t,e){var o=n.doors[e];if(n.hullDoors.includes(o)){var i,a=o.roomIds.find((function(n){return null!==n}));if(Number.isFinite(a))(i=n.navZone.roomNodeIds[a]).push.apply(i,(0,r.Z)(t));else(0,p.ZK)("extendRoomNodeIds: ".concat(n.key," (hull) door ").concat(e," has empty roomIds"))}}))}},83159:function(n,t,e){e.d(t,{Z:function(){return f}});var o,r=e(52209),i=e(79056),a=e(67294),s=e(88269),c=e(94184),u=e.n(c),l=e(48103),p=e(50269),d=e(85893);function f(n){var t=a.useState((function(){var t=n.initViewBox.clone(),i=n.minZoom||.5,a=n.maxZoom||2;return{viewBox:t,panFrom:null,zoom:n.initZoom||1,ptrs:[],ptrDiff:null,root:{},rootCss:(0,s.iv)(o||(o=(0,r.Z)(["\n        width: 100%;\n        height: 100%;\n\n        touch-action: pan-x pan-y pinch-zoom;\n        background-color: ",";\n\n        > g.content {\n          /** TODO justification? */\n          shape-rendering: ",";\n        }\n        > .grid {\n          pointer-events: none;\n        }\n      "])),n.dark?"#000":"none",(0,p.us)()?"optimizeSpeed":"auto"),onPointerDown:function(n){(0,p.af)(n)&&e.ptrs.length<2&&(e.panFrom=(new l.dl).copy((0,p.zk)((0,p.Xs)(n))),e.ptrs.push((0,p.Xs)(n)))},onPointerMove:function(o){if(e.ptrs=e.ptrs.map((function(n){return n.pointerId===o.pointerId?(0,p.Xs)(o):n})),2===e.ptrs.length){var r=Math.abs(e.ptrs[1].clientX-e.ptrs[0].clientX);if(null!==e.ptrDiff){var i,a=(0,p._Y)(e.ptrs);e.zoomTo(a,.02*(r-e.ptrDiff)),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(i=n.onUpdate)||void 0===i||i.call(n,e.root)}e.ptrDiff=r}else if(e.panFrom){var s,c=(0,p.zk)((0,p.Xs)(o));t.delta(e.panFrom.x-c.x,e.panFrom.y-c.y),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(s=n.onUpdate)||void 0===s||s.call(n,e.root)}},onPointerUp:function(n){e.panFrom=null,e.ptrs=e.ptrs.filter((function(t){return n.pointerId!==t.pointerId})),e.ptrs.length<2&&(e.ptrDiff=null),1===e.ptrs.length&&(e.panFrom=(new l.dl).copy((0,p.zk)(e.ptrs[0])))},onTouchStart:function(n){n.preventDefault()},onWheel:function(t){if(t.preventDefault(),(0,p.af)(t)){var o,r=(0,p.zk)((0,p.Xs)(t));e.zoomTo(r,-.003*t.deltaY),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(o=n.onUpdate)||void 0===o||o.call(n,e.root)}},rootRef:function(n){n&&(e.root=n,n.addEventListener("wheel",e.onWheel,{passive:!1}),n.addEventListener("pointerdown",e.onPointerDown,{passive:!0}),n.addEventListener("pointermove",e.onPointerMove,{passive:!0}),n.addEventListener("pointerup",e.onPointerUp,{passive:!0}),n.addEventListener("pointercancel",e.onPointerUp,{passive:!0}),n.addEventListener("pointerleave",e.onPointerUp,{passive:!0}),n.addEventListener("touchstart",e.onTouchStart,{passive:!1}))},zoomTo:function(o,r){var s=Math.min(Math.max(e.zoom+r,i),a);t.x=e.zoom/s*(t.x-o.x)+o.x,t.y=e.zoom/s*(t.y-o.y)+o.y,t.width=1/s*n.initViewBox.width,t.height=1/s*n.initViewBox.height,e.zoom=s}}})),e=(0,i.Z)(t,1)[0];return(0,d.jsxs)("svg",{ref:e.rootRef,className:e.rootCss,preserveAspectRatio:"xMinYMin slice",viewBox:"".concat(e.viewBox),children:[(0,d.jsx)("g",{className:u()("content",n.className),children:n.children}),(0,d.jsx)(h,{bounds:n.gridBounds,dark:n.dark})]})}function h(n){var t=a.useMemo((function(){return m++}),[]);return(0,d.jsx)(d.Fragment,{children:[10,60].flatMap((function(e,o){return[(0,d.jsx)("defs",{children:(0,d.jsx)("pattern",{id:"pattern-grid-".concat(e,"x").concat(e,"--").concat(t),width:e,height:e,patternUnits:"userSpaceOnUse",children:(0,d.jsx)("path",{d:"M ".concat(e," 0 L 0 0 0 ").concat(e),fill:"none",stroke:n.dark?"rgba(200,200,200,0.2)":"rgba(0,0,0,0.5)",strokeWidth:"0.3"})})},e+o),(0,d.jsx)("rect",{className:"grid",x:n.bounds.x,y:n.bounds.y,width:n.bounds.width,height:n.bounds.height,fill:"url(#pattern-grid-".concat(e,"x").concat(e,"--").concat(t,")")},e+o+1)]}))})}var m=0}}]);