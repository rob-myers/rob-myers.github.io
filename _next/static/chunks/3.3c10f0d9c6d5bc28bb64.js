"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{80003:function(t,n,e){e.r(n);var o,r,a=e(52209),i=e(92809),s=e(79056),c=e(67294),l=e(88269),u=e(94184),p=e.n(u),d=e(8935),f=e(35490),h=e(48103),g=e(50269),m=e(83159),v=e(91441),y=e(95814),x=e(85893);function b(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"===typeof t)return w(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return w(t,n)}(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw a}}}}function w(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}function j(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,o)}return e}function O(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?j(Object(e),!0).forEach((function(n){(0,i.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):j(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}n.default=(0,d.withSize)({refreshMode:"debounce"})((function(t){var n=(0,y.Z)(t.layoutKey).data,e=c.useState((function(){return{root3d:{},eye:{},svg:{},onUpdate:function(t){var n=t.viewBox.baseVal.height,e=f.r.height/n,r=o.root3d,a=o.eye;if(r){r.style.perspective="".concat(100+500/e,"px");var i=a.getBoundingClientRect(),s=(0,g.zk)({clientX:i.x,clientY:i.y,ownerSvg:t,pointerId:null});r.style.perspectiveOrigin="".concat(s.x,"px ").concat(s.y,"px")}}}})),o=(0,s.Z)(e,1)[0];return(0,x.jsxs)(D,{children:[(0,x.jsx)(m.Z,{gridBounds:f.l,initViewBox:f.r,maxZoom:6,onUpdate:o.onUpdate,dark:!0,children:n&&!t.disabled&&(0,x.jsxs)("g",{ref:function(t){t&&(o.root3d=t.querySelector(".root-3d"),o.svg=t.ownerSVGElement,setTimeout((function(){return o.onUpdate(t.ownerSVGElement)})))},children:[(0,x.jsx)("image",O(O({},n.pngRect),{},{href:(0,v.qX)(t.layoutKey)})),(0,x.jsx)(I,{gm:n})]})}),(0,x.jsx)("div",{className:"eye",ref:function(t){return t&&(o.eye=t)}})]})}));var D=(0,l.zo)("div")(o||(o=(0,a.Z)(["\n  height: 100%;\n  > .eye {\n    position: absolute;\n    width: 2px;\n    height: 2px;\n    top: calc(50% - 1px);\n    left: calc(50% - 1px);\n    background: red;\n    pointer-events: none;\n  }\n"])));function I(t){var n=t.gm,e=function(t){return c.useMemo((function(){var n=document.createElement("canvas"),e=n.getContext("2d"),o=[t.pngRect.width,t.pngRect.height];n.width=o[0],n.height=o[1],e.translate(-t.pngRect.x,-t.pngRect.y);var r=t.groups.walls;e.fillStyle=k,(0,g.Fx)(e,r);var a=n.toDataURL();e.clearRect(0,0,n.width,n.height);var i=t.groups.obstacles;e.fillStyle=S,(0,g.Fx)(e,i);var s=n.toDataURL();e.clearRect(0,0,n.width,n.height),e.font=v.Dv.font,e.textBaseline="top";var c,l=b(t.labels);try{for(l.s();!(c=l.n()).done;){var u=c.value,p=u.text,d=u.rect,f=u.padded;e.fillStyle="#000",e.fillRect(f.x,f.y,f.width,f.height),e.fillStyle="#fff",e.fillText(p,d.x,d.y)}}catch(h){l.e(h)}finally{l.f()}return{wallsDataUrl:a,obstaclesDataUrl:s,labelsDataUrl:n.toDataURL()}}),[t.groups.walls])}(n),o=e.wallsDataUrl,r=e.obstaclesDataUrl,a=e.labelsDataUrl,i=c.useMemo((function(){return{wallSegs:n.groups.walls.flatMap((function(t){return t.translate(-n.pngRect.x,-n.pngRect.y).lineSegs})),doorSegs:n.doors.map((function(t){var e=(0,s.Z)(t.seg,2);return[e[0],e[1]].map((function(t){return h.dl.from(t).translate(-n.pngRect.x,-n.pngRect.y)}))})),obstacleSegs:n.groups.obstacles.flatMap((function(t){return t.translate(-n.pngRect.x,-n.pngRect.y).lineSegs}))}}),[n.groups.walls]),l=i.wallSegs,u=i.doorSegs,d=i.obstacleSegs;return(0,x.jsx)("foreignObject",O(O({xmlns:"http://www.w3.org/1999/xhtml"},n.pngRect),{},{children:(0,x.jsxs)("div",{className:p()("root-3d",N),children:[l.map((function(t,n){var e=(0,s.Z)(t,2),o=e[0],r=e[1];return P.copy(r).sub(o),(0,x.jsx)("div",{className:"wall",style:{transform:"translate3d(".concat(o.x,"px, ").concat(o.y,"px, 0px) rotateZ(").concat(P.angle,"rad) rotateX(90deg)"),width:P.length}},"wall-".concat(n))})),d.map((function(t,n){var e=(0,s.Z)(t,2),o=e[0],r=e[1];return P.copy(r).sub(o),(0,x.jsx)("div",{className:"obstacle",style:{transform:"translate3d(".concat(o.x,"px, ").concat(o.y,"px, 0px) rotateZ(").concat(P.angle,"rad) rotateX(90deg)"),width:P.length}},"obstacle-".concat(n))})),u.map((function(t,n){var e=(0,s.Z)(t,2),o=e[0],r=e[1];return P.copy(o).sub(r),(0,x.jsx)("div",{className:"door",style:{transform:"translate3d(".concat(r.x,"px, ").concat(r.y,"px, 0px) rotateZ(").concat(P.angle,"rad) rotateX(90deg)"),width:P.length}},"door-".concat(n))})),(0,x.jsx)("img",{src:o,className:"wall-tops"}),(0,x.jsx)("img",{src:r,className:"obstacle-tops"}),(0,x.jsx)("img",{src:a,className:"labels"})]})}))}var P=h.dl.zero,S="#666",Z="#444",k="#222",U="#000",R="#444",N=(0,l.iv)(r||(r=(0,a.Z)(["\n  pointer-events: none;\n  transform-style: preserve-3d;\n  \n  .door {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n  }\n  .obstacle {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n    backface-visibility: hidden;\n  }\n  .wall {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n    backface-visibility: hidden;\n  }\n  .obstacle-tops {\n    position: absolute;\n    transform-origin: top left;\n    transform: translateZ(","px);\n  }\n  .labels, .wall-tops {\n    position: absolute;\n    transform-origin: top left;\n    transform: translateZ(","px);\n  }\n"])),150,R,75,Z,150,U,75,150)},35490:function(t,n,e){e.d(n,{l:function(){return r},r:function(){return a}});var o=e(48103),r=new o.UL(-5e3,-5e3,10001,10001),a=new o.UL(0,0,1200,600)},95814:function(t,n,e){e.d(n,{Z:function(){return m}});var o=e(92809),r=e(97131),a=e(30266),i=e(809),s=e.n(i),c=e(88767),l=e(91441),u=e(48103),p=e(2026),d=e(39660),f=e(68451);function h(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,o)}return e}function g(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?h(Object(e),!0).forEach((function(n){(0,o.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t){return(0,c.useQuery)((0,l.tU)(t),(0,a.Z)(s().mark((function n(){var e,o,a,i,c,p,h;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=d.Vn,n.next=3,fetch((0,l.tU)(t)).then((function(t){return t.json()}));case 3:return n.t1=n.sent,e=(0,n.t0)(n.t1),o=e.roomGraph,a=o.nodesArray.filter((function(t){return"room"===t.type})).map((function(t,n){var a=o.getEdgesFrom(t).flatMap((function(t){var n=t.dst;return"door"===n.type?e.doors[n.doorId].poly:[]}));return u.LA.union([e.rooms[n]].concat((0,r.Z)(a)))[0]})),i=e.groups.singles.filter((function(t){return t.tags.includes("light")})).map((function(t){var n=t.poly,e=t.tags;return{center:n.center,poly:n,reverse:e.includes("reverse")}})),c=e.groups.singles.filter((function(t){return t.tags.includes("relate-connectors")})).reduce((function(t,n){var o=n.poly,a=e.doors.flatMap((function(t,n){return f.J.convexPolysIntersect(t.poly.outline,o.outline)?n:[]})),i=e.windows.flatMap((function(t,n){return f.J.convexPolysIntersect(t.poly.outline,o.outline)?n:[]}));return a.forEach((function(n){var e,o;t[n]=t[n]||{doorIds:[],windowIds:[]},(e=t[n].doorIds).push.apply(e,(0,r.Z)(a.filter((function(t){return t!==n})))),(o=t[n].windowIds).push.apply(o,(0,r.Z)(i))})),0===a.length&&console.warn("poly tagged 'relate-connectors' doesn't intersect any door: (windowIds ".concat(i,")")),a.length+i.length<=1&&console.warn("poly tagged 'relate-connectors' should intersect \u2265 2 doors/windows (doorIds ".concat(a,", windowIds ").concat(i,")")),t}),{}),p=e.rooms.map((function(t){return{default:t.center,labels:[],light:{},spawn:[]}})),i.forEach((function(t,n){var o=t.center,r=t.poly,a=t.reverse,i=e.rooms.findIndex((function(t){return t.contains(o)})),s=e.doors.findIndex((function(t){return f.J.convexPolysIntersect(r.outline,t.poly.outline)}));if(-1===i||-1===s)console.warn("useGeomorphData: light ".concat(n," has room/doorId ").concat(i,"/").concat(s));else if(a){var c=e.doors[s].roomIds.find((function(t){return t!==i}));"number"!==typeof c?console.warn("useGeomorphData: reverse light ".concat(n," lacks other roomId (room/doorId ").concat(i,"/").concat(s,")")):i=c}p[i].light[s]=o})),e.groups.singles.filter((function(t){return t.tags.includes("spawn")})).map((function(t){return t.poly.center})).forEach((function(t,n){var o=e.rooms.findIndex((function(n){return n.contains(t)}));o>=0?p[o].spawn.push(t):console.warn("spawn point ".concat(n," should be inside some room"))})),e.labels.forEach((function(t){var n=e.rooms.findIndex((function(n){return n.contains(t.center)}));n>=0?(p[n].labels.push(t),p[n].default=u.dl.from(p[n].labels[0].center)):console.warn("label ".concat(t.text," should be inside some room"))})),(h=g(g({},e),{},{hullDoors:e.doors.filter((function(t){return t.tags.includes("hull")})),hullOutline:e.hullPoly[0].removeHoles(),pngRect:u.UL.fromJson(e.items[0].pngRect),roomsWithDoors:a,relDoorId:c,point:p,lazy:null,getHullDoorId:function(t){var n="number"===typeof t?this.doors[t]:t;return this.hullDoors.findIndex((function(t){return t===n}))},getOtherRoomId:function(t,n){return("number"===typeof t?this.doors[t]:t).roomIds.find((function(t){return t!==n}))||-1},isHullDoor:function(t){return("number"===typeof t?this.doors[t]:t).roomIds.includes(null)}})).lazy=v(h),y(h),n.abrupt("return",h);case 17:case"end":return n.stop()}}),n)}))),{cacheTime:1/0,keepPreviousData:!0,staleTime:1/0})}function v(t){var n={roomNavPoly:{}},e=new Proxy({},{get:function(e,o){if("string"===typeof o){var r=Number(o);if(t.roomsWithDoors[r]&&!n.roomNavPoly[r]){var a=u.LA.intersect(t.navPoly,[t.roomsWithDoors[r]]);a.sort((function(t,n){return t.rect.area>n.rect.area?-1:1})),n.roomNavPoly[r]=a[0]}return n.roomNavPoly[r]}}});return new Proxy(n,{get:function(t,n){if("roomNavPoly"===n)return e}})}function y(t){t.navZone.doorNodeIds.forEach((function(n,e){var o=t.doors[e];if(t.hullDoors.includes(o)){var a,i=o.roomIds.find((function(t){return null!==t}));if(Number.isFinite(i))(a=t.navZone.roomNodeIds[i]).push.apply(a,(0,r.Z)(n));else(0,p.ZK)("extendRoomNodeIds: ".concat(t.key," (hull) door ").concat(e," has empty roomIds"))}}))}},83159:function(t,n,e){e.d(n,{Z:function(){return f}});var o,r=e(52209),a=e(79056),i=e(67294),s=e(88269),c=e(94184),l=e.n(c),u=e(48103),p=e(50269),d=e(85893);function f(t){var n=i.useState((function(){var n=t.initViewBox.clone(),a=t.minZoom||.5,i=t.maxZoom||2;return{viewBox:n,panFrom:null,zoom:t.initZoom||1,ptrs:[],ptrDiff:null,root:{},rootCss:(0,s.iv)(o||(o=(0,r.Z)(["\n        width: 100%;\n        height: 100%;\n\n        touch-action: pan-x pan-y pinch-zoom;\n        background-color: ",";\n\n        > g.content {\n          /** TODO justification? */\n          shape-rendering: ",";\n        }\n        > .grid {\n          pointer-events: none;\n        }\n      "])),t.dark?"#000":"none",(0,p.us)()?"optimizeSpeed":"auto"),onPointerDown:function(t){(0,p.af)(t)&&e.ptrs.length<2&&(e.panFrom=(new u.dl).copy((0,p.zk)((0,p.Xs)(t))),e.ptrs.push((0,p.Xs)(t)))},onPointerMove:function(o){if(e.ptrs=e.ptrs.map((function(t){return t.pointerId===o.pointerId?(0,p.Xs)(o):t})),2===e.ptrs.length){var r=Math.abs(e.ptrs[1].clientX-e.ptrs[0].clientX);if(null!==e.ptrDiff){var a,i=(0,p._Y)(e.ptrs);e.zoomTo(i,.02*(r-e.ptrDiff)),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(a=t.onUpdate)||void 0===a||a.call(t,e.root)}e.ptrDiff=r}else if(e.panFrom){var s,c=(0,p.zk)((0,p.Xs)(o));n.delta(e.panFrom.x-c.x,e.panFrom.y-c.y),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(s=t.onUpdate)||void 0===s||s.call(t,e.root)}},onPointerUp:function(t){e.panFrom=null,e.ptrs=e.ptrs.filter((function(n){return t.pointerId!==n.pointerId})),e.ptrs.length<2&&(e.ptrDiff=null),1===e.ptrs.length&&(e.panFrom=(new u.dl).copy((0,p.zk)(e.ptrs[0])))},onTouchStart:function(t){t.preventDefault()},onWheel:function(n){if(n.preventDefault(),(0,p.af)(n)){var o,r=(0,p.zk)((0,p.Xs)(n));e.zoomTo(r,-.003*n.deltaY),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(o=t.onUpdate)||void 0===o||o.call(t,e.root)}},rootRef:function(t){t&&(e.root=t,t.addEventListener("wheel",e.onWheel,{passive:!1}),t.addEventListener("pointerdown",e.onPointerDown,{passive:!0}),t.addEventListener("pointermove",e.onPointerMove,{passive:!0}),t.addEventListener("pointerup",e.onPointerUp,{passive:!0}),t.addEventListener("pointercancel",e.onPointerUp,{passive:!0}),t.addEventListener("pointerleave",e.onPointerUp,{passive:!0}),t.addEventListener("touchstart",e.onTouchStart,{passive:!1}))},zoomTo:function(o,r){var s=Math.min(Math.max(e.zoom+r,a),i);n.x=e.zoom/s*(n.x-o.x)+o.x,n.y=e.zoom/s*(n.y-o.y)+o.y,n.width=1/s*t.initViewBox.width,n.height=1/s*t.initViewBox.height,e.zoom=s}}})),e=(0,a.Z)(n,1)[0];return(0,d.jsxs)("svg",{ref:e.rootRef,className:e.rootCss,preserveAspectRatio:"xMinYMin slice",viewBox:"".concat(e.viewBox),children:[(0,d.jsx)("g",{className:l()("content",t.className),children:t.children}),(0,d.jsx)(h,{bounds:t.gridBounds,dark:t.dark})]})}function h(t){var n=i.useMemo((function(){return g++}),[]);return(0,d.jsx)(d.Fragment,{children:[10,60].flatMap((function(e,o){return[(0,d.jsx)("defs",{children:(0,d.jsx)("pattern",{id:"pattern-grid-".concat(e,"x").concat(e,"--").concat(n),width:e,height:e,patternUnits:"userSpaceOnUse",children:(0,d.jsx)("path",{d:"M ".concat(e," 0 L 0 0 0 ").concat(e),fill:"none",stroke:t.dark?"rgba(200,200,200,0.2)":"rgba(0,0,0,0.5)",strokeWidth:"0.3"})})},e+o),(0,d.jsx)("rect",{className:"grid",x:t.bounds.x,y:t.bounds.y,width:t.bounds.width,height:t.bounds.height,fill:"url(#pattern-grid-".concat(e,"x").concat(e,"--").concat(n,")")},e+o+1)]}))})}var g=0}}]);