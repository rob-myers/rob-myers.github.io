"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2690],{92690:function(t,e,r){r.r(e),r.d(e,{default:function(){return _}});var n,o=r(52209),i=r(92809),c=r(88269),a=r(24790),s=r(35490),u=r(91441),p=r(49345),l=r(35650),f=r(21225),d=r(83159),g=r(59748),h=r(8311);function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function y(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){(0,i.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function O(t){var e=t.json,r=(0,l.Z)((function(){return{api:{evt:new a.x},onClick:function(e){var r=e.target,n=r.classList.toggle("open");t.wire.next({key:n?"opened-door":"closed-door",index:Number(r.getAttribute("data-index"))})}}}));return(0,h.tZ)("foreignObject",y(y({},e.pngRect),{},{xmlns:"http://www.w3.org/1999/xhtml",className:m,children:(0,h.tZ)("div",{onPointerUp:r.onClick,children:e.doors.map((function(t,r){var n=t.rect,o=t.angle;return(0,h.tZ)("div",{className:"door","data-index":r,style:{left:n.x-e.pngRect.x,top:n.y-e.pngRect.y,width:n.width,height:n.height,transformOrigin:"top left",transform:"rotate(".concat(o,"rad)")}})}))})}))}var v,m=(0,c.iv)(n||(n=(0,o.Z)(["\n  div.door {\n    cursor: pointer;\n    position: absolute;\n    background: #000; /** ? */\n    border: 1px solid black;\n    opacity: 1;\n    transition: opacity 100ms linear;\n    &.open {\n      opacity: 0;\n    }\n  }\n"]))),j=r(48103),w=r(68451),P=r(27375);function Z(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(r),!0).forEach((function(e){(0,i.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function k(t){var e=(0,P.Z)(),r=(0,l.Z)((function(){var e=t.json;return{lights:[],doors:{},computeLights:function(){var n=t.lights,o=j.LA.from(e.hull.poly[0]).removeHoles(),i=e.walls.concat(e.doors.filter((function(t,e){return"open"!==r.doors[e]})).map((function(t){return t.poly}))).map((function(t){return j.LA.from(t)})).flatMap((function(t){return w.J.triangulationToPolys(t.fastTriangulate())})),c=n.filter((function(t){return o.contains(t.p)}));r.lights=c.map((function(t){var e=t.p.clone(),r=w.J.lightPolygon(e,t.d,i),n=r.rect;return{position:e,poly:r,ratio:new j.dl((e.x-n.x)/n.width,(e.y-n.y)/n.height)}}))}}}));return g.default.useLayoutEffect((function(){r.computeLights()}),[t.lights]),g.default.useEffect((function(){var n=t.wire.subscribe((function(t){switch(t.key){case"opened-door":r.doors[t.index]="open",r.computeLights(),e();break;case"closed-door":r.doors[t.index]="closed",r.computeLights(),e()}}));return function(){return n.unsubscribe()}}),[]),(0,h.BX)(h.HY,{children:[(0,h.BX)("defs",{children:[r.lights.map((function(t,e){return(0,h.BX)("radialGradient",{id:"my-radial-".concat(e),fx:t.ratio.x,fy:t.ratio.y,r:"100%",children:[(0,h.tZ)("stop",{offset:"0%","stop-color":"#bbb"}),(0,h.tZ)("stop",{offset:"60%","stop-color":"#000"}),(0,h.tZ)("stop",{offset:"100%","stop-color":"#000"})]})})),(0,h.BX)("mask",{id:"lights-mask",children:[(0,h.tZ)("rect",x(x({},t.json.pngRect),{},{fill:"#000"})),r.lights.map((function(t,e){var r=t.poly;return(0,h.tZ)("path",{d:r.svgPath,fill:"url(#my-radial-".concat(e,")")})})),(0,h.tZ)("circle",{cx:"50",cy:"50",r:"50",fill:"url(#my-radial)"})]})]}),(0,h.tZ)("image",x(x({},t.json.pngRect),{},{className:"geomorph-light",href:(0,u.qX)(t.json.key),mask:"url(#lights-mask)"})),r.lights.map((function(t){var e=t.position;t.poly;return(0,h.tZ)(h.HY,{children:(0,h.tZ)("image",{href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:e.x-10,y:e.y-10})})}))]})}function D(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function E(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?D(Object(r),!0).forEach((function(e){(0,i.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _(t){var e=(0,f.Z)(S).data,r=(0,l.Z)((function(){return{lights:[{p:new p.d(205,385),d:150},{p:new p.d(620,315),d:250}],wire:new a.x}}),{lights:function(t,e){return t.every((function(t,r){var n=t.p,o=t.d;return n.equals(e[r].p)&&o===e[r].d}))}});return(0,h.tZ)(d.Z,{dark:!0,gridBounds:s.l,initViewBox:s.r,maxZoom:6,className:L,children:e&&(0,h.BX)(h.HY,{children:[(0,h.tZ)("image",E(E({},e.pngRect),{},{className:"geomorph",href:(0,u.qX)(S)})),(0,h.tZ)(k,{json:e,lights:r.lights,wire:r.wire}),(0,h.tZ)(O,{json:e,wire:r.wire})]})})}var S="g-301--bridge",L=(0,c.iv)(v||(v=(0,o.Z)(["\n  image.geomorph {\n    filter: brightness(20%) contrast(100%);\n  }\n  path.shadow {\n    fill: #00000066;\n    pointer-events: none;\n  }\n"])))},21225:function(t,e,r){r.d(e,{Z:function(){return f}});var n=r(92809),o=r(30266),i=r(809),c=r.n(i),a=r(88767),s=r(18264),u=r(91441);function p(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?p(Object(r),!0).forEach((function(e){(0,n.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function f(t){return(0,a.useQuery)((0,u.tU)(t),(0,o.Z)(c().mark((function e(){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch((0,u.tU)(t)).then((function(t){return t.json()}));case 2:return r=e.sent,e.abrupt("return",l(l({},r),{},{d:{navPoly:r.navPoly.map(s.L.from)}}));case 4:case"end":return e.stop()}}),e)}))),{keepPreviousData:!0,cacheTime:1/0})}},35650:function(t,e,r){r.d(e,{Z:function(){return i}});var n=r(79056),o=r(59748);function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=o.default.useState(t),i=(0,n.Z)(r,1),c=i[0];return o.default.useEffect((function(){var r=t.toString()!==c._prevFn;if(c._prevFn){if(r){for(var o=t(),i=0,a=Object.entries(o);i<a.length;i++){var s,u=(0,n.Z)(a[i],2),p=u[0],l=u[1];"function"===typeof l?c[p]=l:p in c?c._prevInit&&!1===(null===(s=e[p])||void 0===s?void 0:s.call(e,c._prevInit[p],o[p]))&&(c[p]=o[p]):c[p]=l}for(var f=0,d=Object.entries(c);f<d.length;f++){var g=(0,n.Z)(d[f],2),h=g[0];g[1];h in o||delete c[h]}c._prevFn=t.toString(),c._prevInit=o}}else c._prevFn=t.toString(),c._prevInit=t()}),[]),c}}}]);