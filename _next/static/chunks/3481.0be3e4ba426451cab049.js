"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3481],{73481:function(n,t,e){e.r(t),e.d(t,{default:function(){return k}});var o,r=e(52209),i=e(59748),a=e(88269),s=e(95090),l=e(36694),u=e(48103),c=e(91441),d=e(84175),p=e(68451),g=e(49082),h=e(95814),f=e(35650),m=e(27375),b=e(87079),v=e(30245),w=e(8311);function k(n){var t=(0,h.Z)(y).data,e=(0,m.Z)(),o=(0,f.Z)((function(){return{clipPath:"none",doorsApi:{},isHoleShown:{},wire:new s.x,onToggleLight:function(n){var t=n.target,e=Number(t.getAttribute("data-index"));e in o.isHoleShown?delete o.isHoleShown[e]:o.isHoleShown[e]=!0,o.updateMask()},updateMask:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=(0,d.Nh)(t),i=r.d,a=i.pngRect,s=i.hullOutline,l=i.holesWithDoors,c=i.roomGraph,g=r.doors,h=r.groups.walls,f=Object.keys(o.isHoleShown).map(Number),m=o.doorsApi.getOpen(),b=f.flatMap((function(n){var t=c.nodesArray[n],e=c.getAdjacentDoors([t]).map((function(n){return n.doorIndex})).filter((function(n){return m.includes(n)})),o=g.map((function(n,t){return t})).filter((function(n){return!e.includes(n)})).map((function(n){return g[n]})).map((function(n){return n.poly}));return e.map((function(t){var e=g[t],r=c.getRoomSign(n,t);null===r&&console.warn("hole ".concat(n,": door ").concat(t,": unexpected roomSign"));var i=e.poly.center.addScaledVector(e.normal,20*(r||0)),a=h.concat(o).flatMap((function(n){return p.J.triangulationToPolys(n.fastTriangulate())}));return p.J.lightPolygon(i,1e3,a)}))})),v=f.map((function(n){return l[n]})).concat(b),w=c.getAdjacentDoors(f.map((function(n){return c.nodesArray[n]})));this.doorsApi.setObservableDoors(w.map((function(n){return n.doorIndex})));var k=u.LA.cutOut(v,[s]).map((function(n){return n.translate(-a.x,-a.y)})),y=k.map((function(n){return"".concat(n.svgPath)})).join(" ");e(),setTimeout((function(){o.clipPath="path('".concat(y,"')"),e()}),n)}}}),[t]);return i.default.useEffect((function(){if(t){o.updateMask();var n=o.wire.pipe((0,l.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){return o.updateMask("closed-door"===n.key?300:0)}));return function(){return n.unsubscribe()}}}),[t]),(0,w.tZ)(b.Z,{dark:!0,className:x,children:t&&(0,w.BX)(w.HY,{children:[(0,w.tZ)("img",{className:"geomorph",src:(0,c.qX)(y),draggable:!1,style:{left:t.d.pngRect.x,top:t.d.pngRect.y,width:t.d.pngRect.width,height:t.d.pngRect.height}}),(0,w.tZ)("img",{className:"geomorph-dark",src:(0,c.qX)(y),draggable:!1,style:{left:t.d.pngRect.x,top:t.d.pngRect.y,width:t.d.pngRect.width,height:t.d.pngRect.height,clipPath:o.clipPath,WebkitClipPath:o.clipPath}}),(0,w.tZ)("div",{className:"light-toggles",onClick:o.onToggleLight,children:t.d.holeSwitches.map((function(n,t){return(0,w.tZ)("div",{"data-index":t,className:"toggle",style:{left:n.x-5,top:n.y-5,borderColor:o.isHoleShown[t]?"#5f5":"rgba(200, 0, 0, 0.3)",outline:o.isHoleShown[t]?"1px solid black":"1px solid rgba(255, 255, 255, 0.5)"}},t)}))}),(0,w.tZ)(v.Z,{gm:(0,g.mI)(t,[1,0,0,1,0,0]),wire:o.wire,onLoad:function(n){return o.doorsApi=n}})]})})}var y="g-302--xboat-repair-bay",x=(0,a.iv)(o||(o=(0,r.Z)(["\n  img.geomorph-dark {\n    position: absolute;\n    filter: invert(100%) brightness(45%) contrast(200%) sepia(0%) hue-rotate(0deg) blur(0px);\n  }\n  img.geomorph {\n    position: absolute;\n    filter: brightness(65%) sepia(50%) hue-rotate(180deg);\n  }\n  div.light-toggles {\n    position: absolute;\n\n    div.toggle {\n      border-radius: 5px;\n      border: 5px solid white;\n      position: absolute;\n      cursor: pointer;\n    }\n  }\n  svg.room-graph {\n    position: absolute;\n    pointer-events: none;\n    circle, line {\n      pointer-events: none;\n    }\n  }\n"])))}}]);