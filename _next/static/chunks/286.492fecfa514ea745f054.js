"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[286],{40286:function(n,t,e){e.r(t),e.d(t,{default:function(){return D}});var r=e(52209),i=e(92809),o=e(30266),a=e(79056),l=e(809),c=e.n(l),s=e(59748),u=e(88269),p=e(88767),d=e(35490),f=e(48103),g=e(68451),h=e(96005),v=e(91441),y=e(83159),b=e(12891),m=e(8311);function E(n){var t=s.default.useState((function(){var t=n.pathfinding.zones[n.zoneKey],r=t.groups.flatMap((function(n){return n})).map((function(n){return n.vertexIds.map((function(n){return t.vertices[n]}))}));return{pathEl:{},path:[],src:f.dl.from(n.initial.src),dst:f.dl.from(n.initial.dst),setPath:function(n){e.path=n,e.pathEl.setAttribute("points","".concat(e.path))},updatePath:function(){var t,r=n.pathfinding.getGroup(n.zoneKey,e.src);null!==r&&(e.path=[e.src.clone()].concat(n.pathfinding.findPath(e.src,e.dst,n.zoneKey,r)||[]),e.setPath(e.path),null===(t=n.onChange)||void 0===t||t.call(n,e.path))},pointInZone:function(n){return r.some((function(t){var e=(0,a.Z)(t,3),r=e[0],i=e[1],o=e[2];return f.LA.pointInTriangle(n,r,i,o)}))}}})),e=(0,a.Z)(t,1)[0];return s.default.useEffect((function(){return e.updatePath()}),[]),(0,m.BX)("g",{ref:function(n){n&&(e.pathEl=n.querySelector("polyline.navpath"))},children:[(0,m.tZ)("polyline",{className:"navpath"}),(0,m.tZ)(b.Z,{initial:n.initial.src,radius:n.radius,icon:n.srcIcon,onStart:function(){var t;return null===(t=n.onStart)||void 0===t?void 0:t.call(n,"src")},onStop:function(n){if(!e.pointInZone(n))return"cancel";e.src.copy(n),e.updatePath()}}),(0,m.tZ)(b.Z,{initial:n.initial.dst,radius:n.radius,icon:n.dstIcon,onStart:function(){var t;return null===(t=n.onStart)||void 0===t?void 0:t.call(n,"dst")},onStop:function(n){if(!e.pointInZone(n))return"cancel";e.dst.copy(n),e.updatePath()}})]})}var w,Z,x=e(94184),O=e.n(x);function S(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function k(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?S(Object(e),!0).forEach((function(t){(0,i.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):S(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function D(n){var t=s.default.useState((function(){return{pathA:{initSrc:new f.dl(300,300),initDst:new f.dl(600,300)},pathB:{initSrc:new f.dl(200,200),initDst:new f.dl(680,200)},botA:{el:{},anim:{}},disabled:n.disabled}})),e=(0,a.Z)(t,1)[0],r=s.default.useMemo((function(){return new h.B}),[]),i=(0,p.useQuery)("nav-collide-demo",(0,o.Z)(c().mark((function n(){var t,e,i,o;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch((0,v.tU)("g-301--bridge")).then((function(n){return n.json()}));case 2:return t=n.sent,e=t.navPoly.map((function(n){return f.LA.from(n)})),i=g.J.polysToTriangulation(e),o=h.B.createZone(i),r.setZoneData(A,o),n.abrupt("return",{pngRect:t.pngRect,navPoly:e,zone:o});case 8:case"end":return n.stop()}}),n)})))).data;return s.default.useEffect((function(){var t,r,i,o;n.disabled?null===(t=(r=e.botA.anim).pause)||void 0===t||t.call(r):null===(i=(o=e.botA.anim).play)||void 0===i||i.call(o);e.disabled=n.disabled}),[n.disabled]),(0,m.tZ)(y.Z,{gridBounds:d.l,initViewBox:L,maxZoom:6,children:(0,m.tZ)("g",{className:O()(P,!n.disabled&&j),ref:function(n){n&&(e.botA.el=n.querySelector("g.bot-a"))},children:i&&(0,m.BX)(m.HY,{children:[(0,m.tZ)("image",k(k({},i.pngRect),{},{className:"geomorph",href:(0,v.qX)("g-301--bridge")})),i.zone.groups.map((function(n){return n.map((function(n){var t=n.vertexIds;return(0,m.tZ)("polygon",{className:"navtri",points:"".concat(t.map((function(n){return i.zone.vertices[n]})))})}))})),(0,m.tZ)(E,{initial:{src:e.pathA.initSrc,dst:e.pathA.initDst},pathfinding:r,zoneKey:A,radius:4,onChange:function(n){var t=e.botA;if(t.el&&n.length){var r=n.map((function(t,e){return{p:t,q:n[e+1]}})).slice(0,-1).map((function(n){var t=n.p,e=n.q;return t.distanceTo(e)})).reduce((function(n,t){return n.total+=t,n.sofars.push(n.sofars[n.sofars.length-1]+t),n}),{sofars:[0],total:0}),i=r.sofars,o=r.total;t.anim=t.el.animate(n.map((function(n,t){return{offset:i[t]/o,transform:"translate(".concat(n.x,"px, ").concat(n.y,"px)")}})),{duration:5e3,iterations:1/0,direction:"alternate"}),e.disabled&&t.anim.pause()}}}),(0,m.tZ)(E,{initial:{src:e.pathB.initSrc,dst:e.pathB.initDst},pathfinding:r,zoneKey:A,radius:4,onChange:function(n){console.log("path B",n)}}),(0,m.BX)("g",{className:"bot-a",children:[(0,m.tZ)("circle",{fill:"red",stroke:"black",strokeWidth:2,r:"10"}),(0,m.tZ)("line",{stroke:"black",strokeWidth:2,x2:"10"})]})]})})})}var P=(0,u.iv)(w||(w=(0,r.Z)(["\n  border: 1px solid #555555;\n  height: inherit;\n\n  polyline.navpath {\n    fill: none;\n    stroke: #777;\n    stroke-width: 2;\n    stroke-dasharray: 8px;\n    stroke-dashoffset: 16px;\n  }\n\n  @keyframes flash {\n    0% { stroke-dashoffset: 16px; }\n    100% { stroke-dashoffset: 0px; }\n  }\n\n  polygon.navtri {\n    fill: transparent;\n    &:hover {\n      stroke: #900;\n    }\n  }\n\n  g.bot-a {\n    pointer-events: none;\n  }\n"]))),j=(0,u.iv)(Z||(Z=(0,r.Z)(["\n  polyline.navpath {\n    animation: 600ms flash infinite linear;\n  }\n"]))),A="NavCollideZone",L=new f.UL(200,0,600,600)},12891:function(n,t,e){e.d(t,{Z:function(){return f}});var r,i=e(52209),o=e(92809),a=e(79056),l=e(88269),c=e(59748),s=e(48103),u=e(50269),p=e(8311);function d(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function f(n){var t=c.default.useState((function(){return{position:s.dl.from(n.initial),target:s.dl.from(n.initial),dragging:!1,rootEl:{},lineEl:{},circleEl:{},startDrag:function(t){var e;t.stopPropagation(),r.dragging=!0,r.lineEl.style.display="inline",r.target.copy(r.position),["x1","x2"].forEach((function(n){return r.lineEl.setAttribute(n,String(r.position.x))})),["y1","y2"].forEach((function(n){return r.lineEl.setAttribute(n,String(r.position.y))}));var i=r.lineEl.ownerSVGElement;i.addEventListener("pointermove",r.onMove),i.addEventListener("pointerleave",r.endDrag),i.addEventListener("pointerup",r.applyDrag),window.addEventListener("keydown",r.endDragOnEscape),i.style.cursor="grabbing",null===(e=n.onStart)||void 0===e||e.call(n)},onMove:function(n){if(n.stopPropagation(),r.dragging){var t=(0,u.zk)({clientX:n.clientX,clientY:n.clientY,ownerSvg:r.lineEl.ownerSVGElement,pointerId:null}),e=t.x,i=t.y;r.target.set(e,i),r.lineEl.setAttribute("x2",String(e)),r.lineEl.setAttribute("y2",String(i))}},endDrag:function(){r.dragging=!1,r.lineEl.style.display="none",r.lineEl.setAttribute("x2",r.lineEl.getAttribute("x1")),r.lineEl.setAttribute("y2",r.lineEl.getAttribute("y1"));var n=r.lineEl.ownerSVGElement;n.removeEventListener("pointermove",r.onMove),n.removeEventListener("pointerleave",r.endDrag),n.removeEventListener("pointerup",r.applyDrag),window.removeEventListener("keydown",r.endDragOnEscape),n.style.cursor="auto"},applyDrag:function(){var t;r.endDrag(),"cancel"===(null===(t=n.onStop)||void 0===t?void 0:t.call(n,s.dl.from(r.target)))||(r.position.copy(r.target),r.lineEl.setAttribute("x1",String(r.target.x)),r.lineEl.setAttribute("y1",String(r.target.y)),i(function(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?d(Object(e),!0).forEach((function(t){(0,o.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}({},r)))},endDragOnEscape:function(n){"Escape"===n.key&&r.endDrag()}}})),e=(0,a.Z)(t,2),r=e[0],i=e[1],l=n.radius||8;return(0,p.BX)("g",{className:g,ref:function(n){n&&(r.rootEl=n,r.lineEl=n.querySelector("line.drag-indicator"),r.circleEl=n.querySelector("circle.node"),r.circleEl.addEventListener("pointerdown",r.startDrag),r.circleEl.addEventListener("pointerup",r.applyDrag))},children:[n.icon&&{eye:(0,p.tZ)("image",{href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),down:(0,p.tZ)("image",{href:"/icon/solid_arrow-circle-down.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),right:(0,p.tZ)("image",{href:"/icon/solid_arrow-circle-right.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),run:(0,p.tZ)("image",{href:"/icon/person-running-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),finish:(0,p.tZ)("image",{href:"/icon/flag-checkered-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10})}[n.icon]||(0,p.tZ)("circle",{className:"inner-node",cx:r.position.x,cy:r.position.y,r:l}),(0,p.tZ)("circle",{className:"node",cx:r.position.x,cy:r.position.y,r:l+20}),(0,p.tZ)("line",{className:"drag-indicator",stroke:n.stroke||"blue"})]})}var g=(0,l.iv)(r||(r=(0,i.Z)(["\n  circle.node {\n    fill: rgba(0, 0, 0, 0.2);\n    cursor: pointer;\n  }\n  circle.inner-node {\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  line.drag-indicator {\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n    pointer-events: none;\n  }\n"])))}}]);