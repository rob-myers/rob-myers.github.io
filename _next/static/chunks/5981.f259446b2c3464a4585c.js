"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5981],{85981:function(t,n,e){e.r(n),e.d(n,{default:function(){return h}});var r,o=e(52209),i=e(92809),a=(e(59748),e(88269)),c=e(35490),s=e(91441),u=e(83159),p=e(95814),l=e(8311);function d(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function f(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?d(Object(e),!0).forEach((function(n){(0,i.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function h(t){var n=(0,p.Z)(t.layoutKey).data;return(0,l.tZ)(u.Z,{gridBounds:c.l,initViewBox:c.r,maxZoom:8,className:m,children:n&&(0,l.BX)(l.HY,{children:[(0,l.tZ)("image",f(f({},n.pngRect),{},{className:"geomorph",href:(0,s.qX)(t.layoutKey)})),!t.disabled&&(0,l.tZ)(v,{gm:n})]})})}function v(t){var n=t.gm;return(0,l.tZ)("foreignObject",f(f({},n.pngRect),{},{xmlns:"http://www.w3.org/1999/xhtml",children:(0,l.tZ)("div",{onPointerUp:function(t){var e=t.target,r=[e.clientWidth,Number(e.getAttribute("data-index"))],o=r[1],i=r[0]<=10?n.doors[o].rect.width:10;e.style.width="".concat(i,"px")},children:n.doors.map((function(t,e){var r=t.rect,o=t.angle;return(0,l.tZ)("div",{className:"door","data-index":e,style:{left:r.x-n.pngRect.x,top:r.y-n.pngRect.y,width:r.width,height:r.height,transformOrigin:"top left",transform:"rotate(".concat(o,"rad)")}})}))})}))}var m=(0,a.iv)(r||(r=(0,o.Z)(["\n  foreignObject {\n    div.door {\n      position: absolute;\n      cursor: pointer;\n      background: white;\n      border: 1px solid black;\n\n      transition: width 500ms ease;\n      &.open {\n        width: 0;\n      }\n    }\n  }\n"])))},35490:function(t,n,e){e.d(n,{l:function(){return o},r:function(){return i}});var r=e(48103),o=new r.UL(-5e3,-5e3,10001,10001),i=new r.UL(0,0,1200,600)},95814:function(t,n,e){e.d(n,{Z:function(){return v}});var r=e(92809),o=e(97131),i=e(30266),a=e(809),c=e.n(a),s=e(88767),u=e(91441),p=e(48103),l=e(2026),d=e(39660);function f(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?f(Object(e),!0).forEach((function(n){(0,r.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):f(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function v(t,n){return(0,s.useQuery)((0,u.tU)(t),(0,i.Z)(c().mark((function n(){var e,r,i,a,s,l;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch((0,u.tU)(t)).then((function(t){return t.json()})).then(d.Vn);case 2:return e=n.sent,r=e.roomGraph,i=r.nodesArray.filter((function(t){return"room"===t.type})).map((function(t,n){var i=r.getEdgesFrom(t).flatMap((function(t){var n=t.dst;return"door"===n.type?e.doors[n.doorId].poly:[]}));return p.LA.union([e.rooms[n]].concat((0,o.Z)(i)))[0]})),a=e.groups.singles.filter((function(t){return t.tags.includes("switch")})).map((function(t){return t.poly.center})),s=e.groups.singles.filter((function(t){return t.tags.includes("spawn")})).map((function(t){return t.poly.center})),(l=h(h({},e),{},{roomsWithDoors:i,roomsSwitch:e.rooms.map((function(t){return a.find((function(n){return t.contains(n)}))||t.rect.center})),hullDoors:e.doors.filter((function(t){return t.tags.includes("hull")})),hullOutline:e.hullPoly[0].removeHoles(),pngRect:p.UL.fromJson(e.items[0].pngRect),spawnPoints:s,lazy:null})).lazy=m(l),g(l),n.abrupt("return",l);case 11:case"end":return n.stop()}}),n)}))),h({cacheTime:1/0},n))}function m(t){var n={roomNavPoly:{}},e=new Proxy({},{get:function(e,r){if("string"===typeof r){var o=Number(r);if(t.roomsWithDoors[o]&&!n.roomNavPoly[o]){var i=p.LA.intersect(t.navPoly,[t.roomsWithDoors[o]]);i.sort((function(t,n){return t.rect.area>n.rect.area?-1:1})),n.roomNavPoly[o]=i[0]}return n.roomNavPoly[o]}}});return new Proxy(n,{get:function(t,n){if("roomNavPoly"===n)return e}})}function g(t){t.navZone.doorNodeIds.forEach((function(n,e){var r=t.doors[e];if(t.hullDoors.includes(r)){var i,a=r.roomIds.find(Boolean);if(Number.isFinite(a))(i=t.navZone.roomNodeIds[a]).push.apply(i,(0,o.Z)(n));else(0,l.ZK)("extendRoomNodeIds: ".concat(t.key," (hull) door ").concat(e," has empty roomIds"))}}))}},83159:function(t,n,e){e.d(n,{Z:function(){return f}});var r,o=e(52209),i=e(79056),a=e(59748),c=e(88269),s=e(94184),u=e.n(s),p=e(48103),l=e(50269),d=e(8311);function f(t){var n=a.useState((function(){var n=t.initViewBox.clone(),i=t.minZoom||.5,a=t.maxZoom||2;return{viewBox:n,panFrom:null,zoom:t.initZoom||1,ptrs:[],ptrDiff:null,root:{},rootCss:(0,c.iv)(r||(r=(0,o.Z)(["\n        width: 100%;\n        height: 100%;\n\n        touch-action: pan-x pan-y pinch-zoom;\n        background-color: ",";\n\n        > g.content {\n          /** TODO justification? */\n          shape-rendering: ",";\n        }\n        > .grid {\n          pointer-events: none;\n        }\n      "])),t.dark?"#000":"none",(0,l.us)()?"optimizeSpeed":"auto"),onPointerDown:function(t){(0,l.af)(t)&&e.ptrs.length<2&&(e.panFrom=(new p.dl).copy((0,l.zk)((0,l.Xs)(t))),e.ptrs.push((0,l.Xs)(t)))},onPointerMove:function(r){if(e.ptrs=e.ptrs.map((function(t){return t.pointerId===r.pointerId?(0,l.Xs)(r):t})),2===e.ptrs.length){var o=Math.abs(e.ptrs[1].clientX-e.ptrs[0].clientX);if(null!==e.ptrDiff){var i,a=(0,l._Y)(e.ptrs);e.zoomTo(a,.02*(o-e.ptrDiff)),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(i=t.onUpdate)||void 0===i||i.call(t,e.root)}e.ptrDiff=o}else if(e.panFrom){var c,s=(0,l.zk)((0,l.Xs)(r));n.delta(e.panFrom.x-s.x,e.panFrom.y-s.y),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(c=t.onUpdate)||void 0===c||c.call(t,e.root)}},onPointerUp:function(t){e.panFrom=null,e.ptrs=e.ptrs.filter((function(n){return t.pointerId!==n.pointerId})),e.ptrs.length<2&&(e.ptrDiff=null),1===e.ptrs.length&&(e.panFrom=(new p.dl).copy((0,l.zk)(e.ptrs[0])))},onTouchStart:function(t){t.preventDefault()},onWheel:function(n){if(n.preventDefault(),(0,l.af)(n)){var r,o=(0,l.zk)((0,l.Xs)(n));e.zoomTo(o,-.003*n.deltaY),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(r=t.onUpdate)||void 0===r||r.call(t,e.root)}},rootRef:function(t){t&&(e.root=t,t.addEventListener("wheel",e.onWheel,{passive:!1}),t.addEventListener("pointerdown",e.onPointerDown,{passive:!0}),t.addEventListener("pointermove",e.onPointerMove,{passive:!0}),t.addEventListener("pointerup",e.onPointerUp,{passive:!0}),t.addEventListener("pointercancel",e.onPointerUp,{passive:!0}),t.addEventListener("pointerleave",e.onPointerUp,{passive:!0}),t.addEventListener("touchstart",e.onTouchStart,{passive:!1}))},zoomTo:function(r,o){var c=Math.min(Math.max(e.zoom+o,i),a);n.x=e.zoom/c*(n.x-r.x)+r.x,n.y=e.zoom/c*(n.y-r.y)+r.y,n.width=1/c*t.initViewBox.width,n.height=1/c*t.initViewBox.height,e.zoom=c}}})),e=(0,i.Z)(n,1)[0];return(0,d.BX)("svg",{ref:e.rootRef,className:e.rootCss,preserveAspectRatio:"xMinYMin slice",viewBox:"".concat(e.viewBox),children:[(0,d.tZ)("g",{className:u()("content",t.className),children:t.children}),(0,d.tZ)(h,{bounds:t.gridBounds,dark:t.dark})]})}function h(t){var n=a.useMemo((function(){return v++}),[]);return(0,d.tZ)(d.HY,{children:[10,60].flatMap((function(e){return[(0,d.tZ)("defs",{children:(0,d.tZ)("pattern",{id:"pattern-grid-".concat(e,"x").concat(e,"--").concat(n),width:e,height:e,patternUnits:"userSpaceOnUse",children:(0,d.tZ)("path",{d:"M ".concat(e," 0 L 0 0 0 ").concat(e),fill:"none",stroke:t.dark?"rgba(200,200,200,0.2)":"rgba(0,0,0,0.5)",strokeWidth:"0.3"})})}),(0,d.tZ)("rect",{className:"grid",x:t.bounds.x,y:t.bounds.y,width:t.bounds.width,height:t.bounds.height,fill:"url(#pattern-grid-".concat(e,"x").concat(e,"--").concat(n,")")})]}))})}var v=0}}]);