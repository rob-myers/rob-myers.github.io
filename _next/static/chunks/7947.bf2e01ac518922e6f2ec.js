"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{87947:function(n,e,t){t.r(e),t.d(e,{default:function(){return k}});var r,o=t(52209),a=(t(59748),t(88269)),i=t(95090),c=t(36694),s=t(84175),u=t(91441),d=t(48103),p=t(27375),l=t(2074),g=t(35650),h=t(87079),f=t(30245),m=t(8311);function v(n){var e=(0,g.Z)((function(){var t={apis:[],background:{},root:{},rootRef:function(t){if(t){e.root=t;var r=t.querySelector("canvas.background");r.width=n.gm.d.pngRect.width,r.height=n.gm.d.pngRect.height,e.background=r}},spawn:function(n){console.log("spawning",n)}};return n.onLoad(t),t}));return(0,m.BX)("div",{className:y,ref:e.rootRef,children:[(0,m.tZ)("canvas",{className:"background"}),(0,m.tZ)("div",{className:"npcs",children:e.apis.map((function(n){return(0,m.tZ)("div",{className:"npc ".concat(n.key),children:(0,m.tZ)("div",{className:"body"})},n.key)}))})]})}var b,y=(0,a.iv)(r||(r=(0,o.Z)(["\n  position: absolute;\n  .navpaths {\n\n  }\n"])));function k(n){var e=(0,p.Z)(),t=(0,l.Z)(n.layoutKey,{staleTime:1/0}).data,r=(0,g.Z)((function(){return{clipPath:"none",currentHoleId:0,doorsApi:{},get gm(){return(0,s.Nh)(t)},npcsApi:{},wire:new i.x,getAdjacentHoleIds:function(){var n=r.gm.d.roomGraph,e=r.doorsApi.getOpen();return n.getEnterableRooms(n.nodesArray[r.currentHoleId],e).map((function(n){return n.holeIndex}))},onChangeDeps:function(){if(t){r.updateClipPath(),r.updateObservableDoors(),e(),r.npcsApi.spawn([{key:"andros"}]);var n=r.wire.pipe((0,c.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){r.updateClipPath(),e()}));return function(){return n.unsubscribe()}}},updateClipPath:function(){var n=r.gm.d,e=n.holesWithDoors,t=n.hullOutline,o=n.pngRect,a=[r.currentHoleId].concat(r.getAdjacentHoleIds()).map((function(n){return e[n]})),i=d.LA.cutOut(a,[t]).map((function(n){return n.translate(-o.x,-o.y)})).map((function(n){return"".concat(n.svgPath)})).join(" ");r.clipPath="path('".concat(i,"')")},updateObservableDoors:function(){var n=r.gm.d.roomGraph,e=n.nodesArray[r.currentHoleId],t=n.getAdjacentDoors([e]);this.doorsApi.setObservableDoors(t.map((function(n){return n.doorIndex})))}}}),[t],{equality:{currentHoleId:!0}});return t?(0,m.BX)(h.Z,{dark:!0,className:w(t),children:[(0,m.tZ)("img",{className:"geomorph",src:(0,u.qX)(n.layoutKey),draggable:!1,width:t.d.pngRect.width,height:t.d.pngRect.height}),(0,m.tZ)(v,{gm:t,onLoad:function(n){return r.npcsApi=n}}),(0,m.tZ)("img",{className:"geomorph-dark",src:(0,u.qX)(n.layoutKey),draggable:!1,width:t.d.pngRect.width,height:t.d.pngRect.height,style:{clipPath:r.clipPath}}),(0,m.tZ)(f.Z,{gm:t,wire:r.wire,onLoad:function(n){return r.doorsApi=n}})]}):null}var w=function(n){return(0,a.iv)(b||(b=(0,o.Z)(["\n  img {\n    position: absolute;\n    left: ","px;\n    top: ","px;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])),n.d.pngRect.x,n.d.pngRect.y)}}}]);