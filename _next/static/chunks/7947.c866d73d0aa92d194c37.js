"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{87947:function(n,t,e){e.r(t),e.d(t,{default:function(){return N}});var r,o,a=e(79056),i=e(52209),s=(e(59748),e(88269)),l=e(95090),d=e(36694),c=e(91441),u=e(48103),p=e(27375),f=e(35650),g=e(97301),m=e(87079),h=e(30245),y=e(94184),b=e.n(y),v=e(84175),I=e(77277),x=e(8311);function k(n,t){var e="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=function(n,t){if(!n)return;if("string"===typeof n)return w(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);"Object"===e&&n.constructor&&(e=n.constructor.name);if("Map"===e||"Set"===e)return Array.from(n);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return w(n,t)}(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return i=n.done,n},e:function(n){s=!0,a=n},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw a}}}}function w(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function A(n){var t=(0,p.Z)(),e=(0,f.Z)((function(){var r={apis:[],root:{},npcRef:function(n){if(n){var t=e.apis.find((function(t){return n.classList.contains(t.key)}));t?(t.el={root:n},n.style.left="".concat(t.def.position.x,"px"),n.style.top="".concat(t.def.position.y,"px")):console.error("".concat(A.name,": npc not found for div.").concat(Array.from(n.classList.values()).join(".")))}},rootRef:function(n){n&&(e.root=n)},spawn:function(r){if((0,I.l)(n.stageKey)){console.log("spawning...",r),e.apis=e.apis.filter((function(n){return!r.some((function(t){return n.key===t.key}))}));var o,a=k(r);try{for(a.s();!(o=a.n()).done;){var i=o.value;e.apis.push({key:i.key,def:i,animState:"idle",el:{}})}}catch(s){a.e(s)}finally{a.f()}}else console.error("".concat(A.name,': cannot spawn into non-existent stage "').concat(n.stageKey,'"'));t()}};return n.onLoad(r),r}));return(0,x.tZ)("div",{className:R,ref:e.rootRef,children:(0,x.tZ)("div",{className:b()("npcs",{disabled:n.disabled}),onPointerDown:function(n){var r=n.target;(0,v.Nh)(e.apis.find((function(n){return r.classList.contains(n.key)}))).animState="walk",t()},onPointerUp:function(n){var r=n.target;(0,v.Nh)(e.apis.find((function(n){return r.classList.contains(n.key)}))).animState="idle",t()},children:e.apis.map((function(n){return(0,x.tZ)("div",{className:b()("npc",n.key,n.animState,D),ref:e.npcRef,children:(0,x.tZ)("div",{className:b()("body","no-select",n.key)})},n.key)}))})})}var Z,R=(0,s.iv)(r||(r=(0,i.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"]))),j=new u.dl(51,26).scale(2),O=new u.dl(49,37).scale(2),D=(0,s.iv)(o||(o=(0,i.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    transform: scale(0.18);\n    pointer-events: all;\n    filter: grayscale(100%);\n  }\n  \n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 300ms steps(",") infinite;\n    background: url('/npc/first-npc--walk.png');\n  }\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: idle 2s steps(",") infinite;\n    background: url('/npc/first-npc--idle.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n"])),O.x,O.y,-O.x/2,-O.y/2,3,j.x,j.y,-j.x/2,-j.y/2,1,-3*O.x,-1*j.x);function N(n){var t=(0,p.Z)(),e=(0,g.Z)([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]},{layoutKey:"g-302--xboat-repair-bay",transform:[1,0,0,1,-1200,600]},{layoutKey:"g-303--passenger-deck",transform:[1,0,0,-1,-1200,1800]},{layoutKey:"g-302--xboat-repair-bay",transform:[-1,0,0,1,2400,600]},{layoutKey:"g-301--bridge",transform:[1,0,0,-1,0,2400]}]),r=e.gms,o=e.gmGraph,a=(0,f.Z)((function(){return{gmId:0,holeId:2,clipPath:r.map((function(n){return"none"})),doorsApi:{ready:!1},npcsApi:{},wire:new l.x,getEnterableHoleIds:function(){var n=a.gmId,t=r[n].roomGraph,e=a.doorsApi.getOpen(n),o=t.nodesArray[a.holeId];return t.getEnterableRooms(o,e).map((function(n){return n.holeIndex}))},onChangeDeps:function(){if(r.length){a.update();var n=a.wire.pipe((0,d.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){a.update()}));return function(){return n.unsubscribe()}}},update:function(){a.updateClipPath(),a.updateObservableDoors(),t()},updateClipPath:function(){var n=r[a.gmId],t=n.hullOutline,e=n.holesWithDoors,i=r.map((function(n){return[]})),s=a.doorsApi.getOpen(a.gmId),l=[e[a.holeId]].concat(o.computeLightPolygons(a.gmId,a.holeId,s)).map((function(n){return n.precision(3)}));i[a.gmId]=u.LA.cutOut(l,[t]);var d=n.roomGraph.nodesArray[a.holeId],c=n.roomGraph.getAdjacentHullDoorIds(n,d).filter((function(n){return s.includes(n.doorIndex)})).flatMap((function(n){var t=n.hullDoorIndex;return o.getAdjacentHoleCtxt(a.gmId,t)||[]}));r.forEach((function(t,e){return n!==t&&(i[e]=u.LA.cutOut(c.filter((function(n){return n.adjGmId===e})).map((function(n){return t.holesWithDoors[n.adjHoleId]})),[t.hullOutline]))})),i.forEach((function(n,t){n.forEach((function(n){return n.translate(-r[t].pngRect.x,-r[t].pngRect.y)}));var e=n.map((function(n){return"".concat(n.svgPath)})).join(" ");a.clipPath[t]=e.length?"path('".concat(e,"')"):"none"}))},updateObservableDoors:function(){var n=this,t=r[a.gmId],e=t.roomGraph.nodesArray[a.holeId],i=r.map((function(n){return[]}));i[a.gmId]=t.roomGraph.getAdjacentDoors(e).map((function(n){return n.doorIndex})),t.roomGraph.getAdjacentHullDoorIds(t,e).flatMap((function(n){var t=n.hullDoorIndex;return o.getAdjacentHoleCtxt(a.gmId,t)||[]})).forEach((function(n){var t=n.adjGmId,e=n.adjDoorId;return i[t]=[e]})),r.forEach((function(t,e){return n.doorsApi.setObservableDoors(e,i[e])}))}}}),[r],{equality:{gmId:!0,holeId:!0}});return r.length?(0,x.BX)(m.Z,{stageKey:"stage-nav-demo-1",dark:!0,className:S,zoom:.4,children:[r.map((function(n){return(0,x.tZ)("img",{className:"geomorph",src:(0,c.qX)(n.key),draggable:!1,width:n.pngRect.width,height:n.pngRect.height,style:{left:n.pngRect.x,top:n.pngRect.y,transform:n.transformStyle,transformOrigin:n.transformOrigin}})})),(0,x.tZ)(A,{onLoad:function(n){a.npcsApi=n,t()},disabled:n.disabled,stageKey:"stage-nav-demo-1"}),r.map((function(n,t){return(0,x.tZ)("img",{className:"geomorph-dark",src:(0,c.qX)(n.key),draggable:!1,width:n.pngRect.width,height:n.pngRect.height,style:{clipPath:a.clipPath[t],WebkitClipPath:a.clipPath[t],left:n.pngRect.x,top:n.pngRect.y,transform:n.transformStyle,transformOrigin:n.transformOrigin}},t)})),a.doorsApi.ready&&(0,x.tZ)(G,{gms:r,gmGraph:o,doorsApi:a.doorsApi,gmId:a.gmId,holeId:a.holeId,setHole:function(n,t){var e=[n,t];a.gmId=e[0],a.holeId=e[1],a.update()}}),(0,x.tZ)(h.Z,{gms:r,wire:a.wire,onLoad:function(n){return a.doorsApi=n}})]}):null}var S=(0,s.iv)(Z||(Z=(0,i.Z)(["\n  img {\n    position: absolute;\n    transform-origin: top left;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])));function G(n){var t=n.doorsApi.getObservable(n.gmId),e=n.gms[n.gmId];return(0,x.BX)("div",{onClick:function(t){var e=t.target,r=Number(e.getAttribute("data-door-index")),o=n.gms[n.gmId],i=o.doors[r],s=i.holeIds.filter((function(t){return t!==n.holeId})),l=(0,a.Z)(s,1)[0];if(null!==l)return n.setHole(n.gmId,l);var d=o.hullDoors.indexOf(i),c=n.gmGraph.getAdjacentHoleCtxt(n.gmId,d);c?n.setHole(c.adjGmId,c.adjHoleId):console.info("hull door is isolated",n.gmId,d)},children:[n.outlines&&n.gms.map((function(n,t){return(0,x.tZ)("div",{style:{position:"absolute",left:n.gridRect.x,top:n.gridRect.y,width:n.gridRect.width,height:n.gridRect.height,border:"2px red solid"}},t)})),(0,x.tZ)("div",{className:"debug",style:{transform:e.transformStyle,position:"absolute"},children:e.doors.map((function(e,r){var o=e.poly,a=e.normal,i=e.holeIds;if(t.includes(r)){var s=i[0]===n.holeId?1:-1,l=u.dl.from(a).scale(-s).angle,d=o.center.addScaledVector(a,15*s);return(0,x.tZ)("div",{"data-door-index":r,style:{width:2*P,height:2*P,borderRadius:P,position:"absolute",left:d.x-P,top:d.y-P,transform:"rotate(".concat(l,"rad)"),backgroundImage:"url('/icon/solid_arrow-circle-right.svg')",cursor:"pointer"}},r)}return null}))},e.itemKey)]})}var P=4}}]);