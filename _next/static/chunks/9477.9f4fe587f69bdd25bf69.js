"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9477],{89477:function(n,t,e){e.r(t),e.d(t,{default:function(){return O}});var i,r=e(52209),o=e(92809),a=e(79056),c=e(59748),l=e(88269),s=e(35490),u=e(48103),p=e(91441),d=e(83159),f=e(21225),g=e(21416),v=(e(50269),e(96005)),y=e(12891),h=e(8311);function m(n){var t=c.default.useState((function(){return{pathEl:{},path:[],src:u.dl.from(n.initSrc),dst:u.dl.from(n.initDst),tris:[],setPath:function(n){e.path=n,e.pathEl.setAttribute("points","".concat(e.path))},updatePath:function(){var t,i=v.k.getGroup(n.zoneKey,e.src);if(null===i)return console.warn("pathfinding.getGroup: ".concat(e.src.x,",").concat(e.src.y,": no group found"));if(n.npcApi){var r,o,a=n.npcApi.getPosition(),c=(null===(r=v.k.findPath(e.src,a,n.zoneKey,i))||void 0===r?void 0:r.path)||[],l=(null===(o=v.k.findPath(a,e.dst,n.zoneKey,i))||void 0===o?void 0:o.path)||[];e.path=[e.src.clone()].concat(c,l)}else{var s;e.path=[e.src.clone()].concat((null===(s=v.k.findPath(e.src,e.dst,n.zoneKey,i))||void 0===s?void 0:s.path)||[])}e.setPath(e.path),null===(t=n.onChange)||void 0===t||t.call(n,e.path)},pointInZone:function(n){return e.tris.some((function(t){var e=(0,a.Z)(t,3),i=e[0],r=e[1],o=e[2];return u.LA.pointInTriangle(n,i,r,o)}))}}})),e=(0,a.Z)(t,1)[0];return c.default.useEffect((function(){if(n.zoneKey in v.k.zones){var t,i=v.k.zones[n.zoneKey],r=null!==(t=null===i||void 0===i?void 0:i.groups.flatMap((function(n){return n})))&&void 0!==t?t:[];e.tris=r.map((function(n){return n.vertexIds.map((function(n){return i.vertices[n]}))})),e.updatePath()}}),[n.zoneKey in v.k.zones]),(0,h.BX)("g",{ref:function(n){n&&(e.pathEl=n.querySelector("polyline.navpath"))},children:[(0,h.tZ)("polyline",{className:"navpath"}),(0,h.tZ)(y.Z,{initial:n.initSrc,radius:n.radius,icon:n.srcIcon,onStart:function(){var t;return null===(t=n.onStart)||void 0===t?void 0:t.call(n,"src")},onStop:function(n){if(!e.pointInZone(n))return"cancel";e.src.copy(n),e.updatePath()}}),(0,h.tZ)(y.Z,{initial:n.initDst,radius:n.radius,icon:n.dstIcon,onStart:function(){var t;return null===(t=n.onStart)||void 0===t?void 0:t.call(n,"dst")},onStop:function(n){if(!e.pointInZone(n))return"cancel";e.dst.copy(n),e.updatePath()}})]})}function b(n){var t=c.default.useState((function(){var t={bot:{},api:{key:"solo",anim:{},initPaused:!1,getPosition:function(){var n=new DOMMatrixReadOnly(window.getComputedStyle(e.bot).transform);return{x:n.m41,y:n.m42}},isEnabled:function(){return"paused"!==e.api.anim.playState}}};return n.onLoad(t.api),t})),e=(0,a.Z)(t,1)[0];return(0,h.BX)("g",{className:w,children:[(0,h.tZ)(m,{initSrc:n.initSrc,initDst:n.initDst,zoneKey:n.zoneKey,npcApi:e.api,radius:4,onChange:function(n){var t,i,r=e.bot,o=e.api;if(r&&n.length){var a=e.api.getPosition(),c=n.findIndex((function(n){return n.equals(a)})),l=-1!==c?n.slice(c):n;if(1!==l.length){var s=l.map((function(n,t){return{p:n,q:l[t+1]}})).slice(0,-1).map((function(n){var t=n.p,e=n.q;return t.distanceTo(e)})).reduce((function(n,t){return n.total+=t,n.sofars.push(n.sofars[n.sofars.length-1]+t),n}),{sofars:[0],total:0}),u=s.sofars,p=s.total;null===(t=(i=o.anim).cancel)||void 0===t||t.call(i),o.anim=r.animate(l.map((function(n,t){return{offset:p?u[t]/p:0,transform:"translate(".concat(n.x,"px, ").concat(n.y,"px)")}})),{duration:10*p,direction:"normal",fill:"forwards"}),o.initPaused&&o.anim.pause()}}}}),(0,h.BX)("g",{className:"bot",ref:function(t){t&&e.bot!==t&&(e.bot=t,e.bot.animate([{transform:"translate(".concat(n.initSrc.x,"px, ").concat(n.initSrc.y,"px)")}],{fill:"forwards"}))},children:[(0,h.tZ)("circle",{fill:"red",stroke:"black",strokeWidth:2,r:10}),(0,h.tZ)("line",{stroke:"black",strokeWidth:2,x2:10})]})]})}var E,w=(0,l.iv)(i||(i=(0,r.Z)(["\n  polyline.navpath {\n    fill: none;\n    stroke: #777;\n    stroke-width: 2;\n    stroke-dasharray: 8px;\n    stroke-dashoffset: 16px;\n  }\n\n  g.bot {\n    pointer-events: none;\n  }\n"])));function x(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,i)}return e}function S(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?x(Object(e),!0).forEach((function(t){(0,o.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):x(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function O(n){var t="g-301--bridge",e=c.default.useState((function(){return{initSrc:new u.dl(300,300),initDst:new u.dl(600,300),npcApi:{}}})),i=(0,a.Z)(e,1)[0],r=(0,f.Z)(t).data,o=(0,g.Z)(t,null===r||void 0===r?void 0:r.navDecomp,n.disabled).data;return c.default.useEffect((function(){var t,e,r,o,a,c;n.disabled?null===(t=i.npcApi)||void 0===t||null===(e=(r=t.anim).pause)||void 0===e||e.call(r):null===(o=i.npcApi)||void 0===o||null===(a=(c=o.anim).play)||void 0===a||a.call(c)}),[n.disabled]),(0,h.tZ)(d.Z,{gridBounds:s.l,initViewBox:k,maxZoom:6,children:(0,h.BX)("g",{className:Z,children:[r&&(0,h.tZ)("image",S(S({},r.pngRect),{},{className:"geomorph",href:(0,p.qX)(t)})),null===o||void 0===o?void 0:o.zone.groups.map((function(n){return n.map((function(n){var t=n.vertexIds;return(0,h.tZ)("polygon",{className:"navtri",points:"".concat(t.map((function(n){return o.zone.vertices[n]})))})}))})),(0,h.tZ)(b,{enabled:!!o,initSrc:i.initSrc,initDst:i.initDst,zoneKey:t,onLoad:function(n){return i.npcApi=n}})]})})}var Z=(0,l.iv)(E||(E=(0,r.Z)(["\n  border: 1px solid #555555;\n  height: inherit;\n\n  polygon.navtri {\n    fill: transparent;\n    &:hover {\n      stroke: #900;\n    }\n  }\n"]))),k=new u.UL(200,0,600,600)},12891:function(n,t,e){e.d(t,{Z:function(){return f}});var i,r=e(52209),o=e(92809),a=e(79056),c=e(88269),l=e(59748),s=e(48103),u=e(50269),p=e(8311);function d(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,i)}return e}function f(n){var t=l.default.useState((function(){return{position:s.dl.from(n.initial),target:s.dl.from(n.initial),dragging:!1,rootEl:{},lineEl:{},circleEl:{},startDrag:function(t){var e;t.stopPropagation(),i.dragging=!0,i.lineEl.style.display="inline",i.target.copy(i.position),["x1","x2"].forEach((function(n){return i.lineEl.setAttribute(n,String(i.position.x))})),["y1","y2"].forEach((function(n){return i.lineEl.setAttribute(n,String(i.position.y))}));var r=i.lineEl.ownerSVGElement;r.addEventListener("pointermove",i.onMove),r.addEventListener("pointerleave",i.endDrag),r.addEventListener("pointerup",i.applyDrag),window.addEventListener("keydown",i.endDragOnEscape),r.style.cursor="grabbing",null===(e=n.onStart)||void 0===e||e.call(n)},onMove:function(n){if(n.stopPropagation(),i.dragging){var t=(0,u.zk)({clientX:n.clientX,clientY:n.clientY,ownerSvg:i.lineEl.ownerSVGElement,pointerId:null}),e=t.x,r=t.y;i.target.set(e,r),i.lineEl.setAttribute("x2",String(e)),i.lineEl.setAttribute("y2",String(r))}},endDrag:function(){i.dragging=!1,i.lineEl.style.display="none",i.lineEl.setAttribute("x2",i.lineEl.getAttribute("x1")),i.lineEl.setAttribute("y2",i.lineEl.getAttribute("y1"));var n=i.lineEl.ownerSVGElement;n.removeEventListener("pointermove",i.onMove),n.removeEventListener("pointerleave",i.endDrag),n.removeEventListener("pointerup",i.applyDrag),window.removeEventListener("keydown",i.endDragOnEscape),n.style.cursor="auto"},applyDrag:function(){var t;i.endDrag(),"cancel"===(null===(t=n.onStop)||void 0===t?void 0:t.call(n,s.dl.from(i.target)))||(i.position.copy(i.target),i.lineEl.setAttribute("x1",String(i.target.x)),i.lineEl.setAttribute("y1",String(i.target.y)),r(function(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?d(Object(e),!0).forEach((function(t){(0,o.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}({},i)))},endDragOnEscape:function(n){"Escape"===n.key&&i.endDrag()}}})),e=(0,a.Z)(t,2),i=e[0],r=e[1],c=n.radius||8;return(0,p.BX)("g",{className:g,ref:function(n){n&&(i.rootEl=n,i.lineEl=n.querySelector("line.drag-indicator"),i.circleEl=n.querySelector("circle.node"),i.circleEl.addEventListener("pointerdown",i.startDrag),i.circleEl.addEventListener("pointerup",i.applyDrag))},children:[n.icon&&{eye:(0,p.tZ)("image",{href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),down:(0,p.tZ)("image",{href:"/icon/solid_arrow-circle-down.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),right:(0,p.tZ)("image",{href:"/icon/solid_arrow-circle-right.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),run:(0,p.tZ)("image",{href:"/icon/person-running-fa6.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),finish:(0,p.tZ)("image",{href:"/icon/flag-checkered-fa6.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10})}[n.icon]||(0,p.tZ)("circle",{className:"inner-node",cx:i.position.x,cy:i.position.y,r:c}),(0,p.tZ)("circle",{className:"node",cx:i.position.x,cy:i.position.y,r:c+20}),(0,p.tZ)("line",{className:"drag-indicator",stroke:n.stroke||"blue"})]})}var g=(0,c.iv)(i||(i=(0,r.Z)(["\n  circle.node {\n    fill: rgba(0, 0, 0, 0.2);\n    cursor: pointer;\n  }\n  circle.inner-node {\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  line.drag-indicator {\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n    pointer-events: none;\n  }\n"])))}}]);