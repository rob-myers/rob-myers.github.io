"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5780],{95814:function(t,n,e){e.d(n,{Z:function(){return m}});var o=e(79056),r=e(92809),i=e(97131),s=e(30266),u=e(809),c=e.n(u),a=e(88767),l=e(91441),f=e(48103),d=e(2026),h=e(39660);function p(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,o)}return e}function v(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?p(Object(e),!0).forEach((function(n){(0,r.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):p(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t,n){return(0,a.useQuery)((0,l.tU)(t),(0,s.Z)(c().mark((function n(){var e,r,s,u,a,d,p;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch((0,l.tU)(t)).then((function(t){return t.json()})).then(h.Vn);case 2:return e=n.sent,r=e.roomGraph,s=r.nodesArray.filter((function(t){return"room"===t.type})).map((function(t,n){var o=r.getEdgesFrom(t).flatMap((function(t){var n=t.dst;return"door"===n.type?e.doors[n.doorId].poly:[]}));return f.LA.union([e.rooms[n]].concat((0,i.Z)(o)))[0]})),u=e.groups.singles.filter((function(t){return t.tags.includes("spawn")})).map((function(t){return t.poly.center})),a=e.groups.singles.filter((function(t){return t.tags.includes("switch")})).map((function(t){return t.poly.center})),d=e.groups.singles.filter((function(t){return t.tags.includes("light")})).map((function(t){var n=t.poly.rect;return[n.center,n]})),(p=v(v({},e),{},{hullDoors:e.doors.filter((function(t){return t.tags.includes("hull")})),hullOutline:e.hullPoly[0].removeHoles(),pngRect:f.UL.fromJson(e.items[0].pngRect),roomsWithDoors:s,point:{all:[].concat(d.map((function(t){return t[0]})),u,a),light:d.reduce((function(t,n,r){var i=(0,o.Z)(n,2),s=i[0],u=i[1],c=e.rooms.findIndex((function(t){return t.contains(s)})),a=e.doors.findIndex((function(t){return t.rect.intersects(u)}));return c>=0&&a>=0?(t[c]=t[c]||{})[a]=s:console.warn("useGeomorphData: light ".concat(r," roomId/doorId ").concat(c,"/").concat(a)),t}),{}),spawn:e.rooms.map((function(t){return u.filter((function(n){return t.contains(n)}))})),switch:e.rooms.map((function(t){return a.find((function(n){return t.contains(n)}))||t.rect.center}))},lazy:null})).lazy=g(p),y(p),n.abrupt("return",p);case 12:case"end":return n.stop()}}),n)}))),v({cacheTime:1/0},n))}function g(t){var n={roomNavPoly:{}},e=new Proxy({},{get:function(e,o){if("string"===typeof o){var r=Number(o);if(t.roomsWithDoors[r]&&!n.roomNavPoly[r]){var i=f.LA.intersect(t.navPoly,[t.roomsWithDoors[r]]);i.sort((function(t,n){return t.rect.area>n.rect.area?-1:1})),n.roomNavPoly[r]=i[0]}return n.roomNavPoly[r]}}});return new Proxy(n,{get:function(t,n){if("roomNavPoly"===n)return e}})}function y(t){t.navZone.doorNodeIds.forEach((function(n,e){var o=t.doors[e];if(t.hullDoors.includes(o)){var r,s=o.roomIds.find(Boolean);if(Number.isFinite(s))(r=t.navZone.roomNodeIds[s]).push.apply(r,(0,i.Z)(n));else(0,d.ZK)("extendRoomNodeIds: ".concat(t.key," (hull) door ").concat(e," has empty roomIds"))}}))}},19964:function(t,n,e){e.d(n,{Z:function(){return w}});var o=e(79056),r=e(68216),i=e(25997),s=e(14695),u=e(91077),c=e(30268),a=e(92953),l=e(92809),f=e(48103),d=e(82405),h=e(81033),p=function(){function t(n){(0,r.Z)(this,t),this.content=[],this.scoreFunction=n}return(0,i.Z)(t,[{key:"push",value:function(t){this.content.push(t),this.sinkDown(this.content.length-1)}},{key:"pop",value:function(){var t=this.content[0],n=this.content.pop();return this.content.length>0&&(this.content[0]=n,this.bubbleUp(0)),t}},{key:"remove",value:function(t){var n=this.content.indexOf(t),e=this.content.pop();n!==this.content.length-1&&(this.content[n]=e,this.scoreFunction(e)<this.scoreFunction(t)?this.sinkDown(n):this.bubbleUp(n))}},{key:"size",value:function(){return this.content.length}},{key:"rescoreElement",value:function(t){this.sinkDown(this.content.indexOf(t))}},{key:"sinkDown",value:function(t){for(var n=this.content[t];t>0;){var e=(t+1>>1)-1,o=this.content[e];if(!(this.scoreFunction(n)<this.scoreFunction(o)))break;this.content[e]=n,this.content[t]=o,t=e}}},{key:"bubbleUp",value:function(t){for(var n=this.content.length,e=this.content[t],o=this.scoreFunction(e);;){var r=t+1<<1,i=r-1,s=null,u=-1/0;if(i<n){var c=this.content[i];(u=this.scoreFunction(c))<o&&(s=i)}if(r<n){var a=this.content[r];this.scoreFunction(a)<(null===s?o:u)&&(s=r)}if(null===s)break;this.content[t]=this.content[s],this.content[s]=e,t=s}}}]),t}(),v=function(){function t(){(0,r.Z)(this,t)}return(0,i.Z)(t,null,[{key:"init",value:function(t){for(var n=t.nodesArray,e=0;e<n.length;e++){var o=n[e];o.f=0,o.g=0,o.h=0,o.cost=1,o.visited=!1,o.closed=!1,o.parent=null}}},{key:"cleanUp",value:function(t){for(var n=0;n<t.length;n++){var e=t[n];delete e.f,delete e.g,delete e.h,delete e.cost,delete e.visited,delete e.closed,delete e.parent}}},{key:"heap",value:function(){return new p((function(t){return t.f}))}},{key:"search",value:function(t,n,e){this.init(t);var o=t.nodesArray,r=this.heap();for(r.push(n);r.size()>0;){var i=r.pop();if(i===e){for(var s=i,u=[];s.parent;)u.push(s),s=s.parent;return this.cleanUp(u),u.reverse()}i.closed=!0;for(var c=this.neighbours(o,i),a=0,l=c.length;a<l;a++){var f=c[a];if(!f.closed){var d=i.g+f.cost,h=f.visited;if(!h||d<f.g){if(f.visited=!0,f.parent=i,!f.centroid||!e.centroid)throw new Error("Unexpected state");f.h=f.h||this.heuristic(f.centroid,e.centroid),f.g=d,f.f=f.g+f.h,h?r.rescoreElement(f):r.push(f)}}}}return[]}},{key:"heuristic",value:function(t,n){return h.c.distanceToSquared(t,n)}},{key:"neighbours",value:function(t,n){for(var e=[],o=0;o<n.neighbours.length;o++)e.push(t[n.neighbours[o]]);return e}}]),t}(),m=function(){function t(){(0,r.Z)(this,t),this.portals=[]}return(0,i.Z)(t,[{key:"push",value:function(t,n){void 0===n&&(n=t),this.portals.push({left:t,right:n})}},{key:"stringPull",value:function(){var t,n,e,o=this.portals,r=[],i=0,s=0,u=0;t=o[0].left,n=o[0].left,e=o[0].right,r.push(t);for(var c=1;c<o.length;c++){var a=o[c].left,l=o[c].right;if(h.c.triarea2(t,e,l)<=0){if(!(h.c.vequal(t,e)||h.c.triarea2(t,n,l)>0)){r.push(n),n=t=n,e=t,s=i=s,u=i,c=i;continue}e=l,u=c}if(h.c.triarea2(t,n,a)>=0){if(!(h.c.vequal(t,n)||h.c.triarea2(t,e,a)<0)){r.push(e),n=t=e,e=t,s=i=u,u=i,c=i;continue}n=a,s=c}}return 0!==r.length&&h.c.vequal(r[r.length-1],o[o.length-1].left)||r.push(o[o.length-1].left),this.path=r,r}}]),t}(),g=e(84175),y=e(2026),I=e(68451);function b(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"===typeof t)return k(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return k(t,n)}(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return s=t.done,t},e:function(t){u=!0,i=t},f:function(){try{s||null==e.return||e.return()}finally{if(u)throw i}}}}function k(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,o=new Array(n);e<n;e++)o[e]=t[e];return o}function Z(t){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,o=(0,a.Z)(t);if(n){var r=(0,a.Z)(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return(0,c.Z)(this,e)}}var P=function(t){(0,u.Z)(e,t);var n=Z(e);function e(t){var o;(0,r.Z)(this,e),o=n.call(this),(0,l.Z)((0,s.Z)(o),"gm",void 0),(0,l.Z)((0,s.Z)(o),"vectors",void 0),(0,l.Z)((0,s.Z)(o),"nodeToMeta",void 0),o.gm=t,o.vectors=t.navZone.vertices.map(f.dl.from);var i=t.navZone.groups[0];return o.nodeToMeta=i.map((function(t){return{doorId:-1,roomId:-1}})),t.navZone.doorNodeIds.forEach((function(t,n){t.forEach((function(t){return o.nodeToMeta[t].doorId=n}))})),t.navZone.roomNodeIds.forEach((function(t,n){t.forEach((function(t){return o.nodeToMeta[t].roomId=n}))})),o}return(0,i.Z)(e,[{key:"cleanStringPull",value:function(t){var n,e=b(t.entries());try{for(e.s();!(n=e.n()).done;){var r=n.value;if(Array.isArray(r[1]))if(r[1].length<=1)(0,y.ZK)("cleanStringPull: short pulledPath ".concat(JSON.stringify(r[1])));else{var i=(0,o.Z)(r,2),s=i[0],u=i[1],c=t[s-1];if(c)this.gm.doors[c.doorId].rect.contains(u[1])&&u.splice(1,1);if(c=t[s+1])this.gm.doors[c.doorId].rect.contains(u[u.length-2])&&u.splice(u.length-2,1);t[s]=I.J.removePathReps(u)}}}catch(a){e.e(a)}finally{e.f()}}},{key:"createRoomEdge",value:function(t,n){var e=this.gm.doors[t.doorId],o=e.entries;return{key:"room-edge",doorId:t.doorId,srcRoomId:n,dstRoomId:t.roomId,start:e.roomIds[0]===t.roomId?o[1]:o[0],stop:e.roomIds[0]===t.roomId?o[0]:o[1]}}},{key:"findPath",value:function(t,n){var e=this,o=this.getClosestNode(t),r=this.getClosestNode(n);if(!o||!r)return null;var i=v.search(this,o,r);i[0]!==o&&i.unshift(o);var s=[],u=[],c=this.nodeToMeta[i[0].index];i.forEach((function(t){var n=e.nodeToMeta[t.index];0===s.length?s.push([t]):-1===n.roomId||n.roomId===c.roomId?s[s.length-1].push(t):(s.push([t]),u.push(e.createRoomEdge(n,c.roomId)),c=n)})),s.length>=2&&1===(0,g.eK)(s).length?(s.pop(),u.pop()):s.length>=2&&1===s[0].length&&null===u[0].start&&(s.shift(),u.shift());var a=[null,null],l=this.nodeToMeta[s[0][0].index].doorId,d=this.nodeToMeta[(0,g.eK)((0,g.eK)(s)).index].doorId,h=l>=0&&this.gm.doors[l].poly.contains(t),p=d>=0&&this.gm.doors[d].poly.contains(n);if(h&&p&&l===d)return console.log("WILL START/END IN SAME DOORWAY",l),{seq:[{key:"room-edge",doorId:l,srcRoomId:null,dstRoomId:null,start:t,stop:n}]};if(h){console.log("WILL START IN DOORWAY",l);var m=this.gm.doors[l],b=s.slice(0,2).flatMap((function(t){return t})).map((function(t){return e.nodeToMeta[t.index]})),k=(0,g.Nh)(b.find((function(t){return t.doorId===l&&t.roomId>=0}))).roomId,Z=(0,g.Cq)(m.entries[m.roomIds.findIndex((function(t){return t===k}))]);a[0]={key:"room-edge",doorId:l,srcRoomId:null,dstRoomId:k,start:t,stop:Z}}if(p){console.log("WILL STOP IN DOORWAY",d);var P=this.gm.doors[d],O=(0,g.eK)(s).map((function(t){return e.nodeToMeta[t.index]})),w=(0,g.Nh)(O.find((function(t){return t.doorId===d&&t.roomId>=0}))).roomId,x=(0,g.Cq)(P.entries[P.roomIds.findIndex((function(t){return t===w}))]);a[1]={key:"room-edge",doorId:d,srcRoomId:w,dstRoomId:null,start:x,stop:n}}var N=s.map((function(r,i){var c=0===i?a[0]?a[0].stop:t:u[i-1].stop,l=i===s.length-1?a[1]?a[1].start:n:u[i].start,d=0===i?a[0]?a[0].dstRoomId:e.nodeToMeta[o.index].roomId:u[i-1].dstRoomId;-1===d&&(d=e.gm.roomsWithDoors.findIndex((function(t){return t.outlineContains(c)})),(0,y.ZK)("floorGraphClass ".concat(e.gm.key,": navNode ").concat(o.index," lacks associated roomId (using ").concat(d,")")));var h=e.gm.lazy.roomNavPoly[d];return!I.J.lineSegCrossesPolygon(c,l,h)?[f.dl.from(c),f.dl.from(l)]:e.computeStringPull(c,l,r).path.map(f.dl.from)})),R=[];return a[0]&&R.push(a[0]),N.forEach((function(t,n){R.push(t),u[n]&&R.push(u[n])})),a[1]&&R.push(a[1]),console.log({seq:R,nodePaths:s,pulledPaths:N,roomEdges:u,nodePath:i,nodeMetas:i.map((function(t){return e.nodeToMeta[t.index]}))}),this.cleanStringPull(R),{seq:R}}},{key:"getClosestNode",value:function(t){var n=this.nodesArray,e=this.vectors,o=null,r=1/0;return n.forEach((function(n){var i=n.centroid.distanceToSquared(t);i<r&&h.c.isVectorInPolygon(t,n,e)&&(o=n,r=i)})),o||n.forEach((function(n){var e=h.c.distanceToSquared(n.centroid,t);e<r&&(o=n,r=e)})),o}},{key:"getPortalFromTo",value:function(t,n){for(var e=0;e<t.neighbours.length;e++)if(t.neighbours[e]===n.index)return t.portals[e]}},{key:"computeStringPull",value:function(t,n,e){var o=new m;o.push(t);for(var r=0;r<e.length;r++){var i=e[r],s=e[r+1];if(s){var u=this.getPortalFromTo(i,s);o.push(this.vectors[u[0]],this.vectors[u[1]])}}return o.push(n),o.stringPull(),o}}],[{key:"fromZone",value:function(t){for(var n=t.navZone,r=(0,o.Z)(n.groups,1)[0],i=(n.vertices,new e(t)),s=0,u=Object.entries(r);s<u.length;s++){var c=(0,o.Z)(u[s],2),a=c[0],l=c[1];i.registerNode({type:"tri",id:"tri-".concat(a),index:Number(a),vertexIds:l.vertexIds.slice(),portals:l.portals.map((function(t){return t.slice()})),cost:1,visited:!1,closed:!1,parent:null,centroid:f.dl.from(l.centroid),neighbours:l.neighbours.slice()})}for(var d=function(){var t=(0,o.Z)(p[h],2),n=t[0],e=t[1],r="tri-".concat(n);e.neighbours.map((function(t){return"tri-".concat(t)})).forEach((function(t){return i.registerEdge({src:r,dst:t})}))},h=0,p=Object.entries(r);h<p.length;h++)d();return i}}]),e}(d.b),O=e(88767);function w(t,n,e){return(0,O.useQuery)(function(t){return"pathfinding-".concat(t)}(t),(function(){return{graph:P.fromZone(n)}}),{enabled:!!n&&!e,keepPreviousData:!0,staleTime:1/0})}}}]);