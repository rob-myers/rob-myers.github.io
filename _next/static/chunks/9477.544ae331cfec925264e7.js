"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9477],{89477:function(n,t,e){e.r(t),e.d(t,{default:function(){return k}});var i,o=e(52209),r=e(92809),a=e(21844),l=e(97131),c=e(79056),s=e(59748),u=e(88269),p=e(35490),d=e(48103),f=e(91441),g=e(83159),v=e(21225),h=e(21416),y=e(96005),m=e(12891),b=e(8311);function E(n){var t=s.default.useState((function(){return{pathEl:{},path:[],srcApi:{},dstApi:{},tris:[],lastGroupId:null,moveNpcTo:function(t){if(n.npcApi&&null!==e.lastGroupId){var i,o=n.npcApi.getPosition(),r=(null===(i=y.k.findPath(o,t,n.zoneKey,e.lastGroupId))||void 0===i?void 0:i.path)||[];e.path=[d.dl.from(o)].concat(r),setTimeout((function(){e.srcApi.moveTo(o),e.dstApi.moveTo(t)}))}},setPath:function(n){e.path=n,e.pathEl.setAttribute("points","".concat(e.path))},updatePath:function(t){var i,o="dst"===(t||"dst")?e.dstApi.getPosition():e.srcApi.getPosition(),r=y.k.getGroup(n.zoneKey,o);if(null===r)return console.warn("pathfinding: ".concat(o.x,", ").concat(o.y,": no group found"));e.lastGroupId=r,e.moveNpcTo(o),e.setPath(e.path),null===(i=n.onChange)||void 0===i||i.call(n,e.path)},pointInZone:function(n){return e.tris.some((function(t){var e=(0,c.Z)(t,3),i=e[0],o=e[1],r=e[2];return d.LA.pointInTriangle(n,i,o,r)}))},shouldCancel:function(t,i,o){if(e.pointInZone(i)){var r=t.distanceTo(i)>=1,a=n.npcApi.getPosition();return r&&(i.distanceTo(a)<=2*n.radius||i.distanceTo(o)<=2*n.radius)}}}})),e=(0,c.Z)(t,1)[0];return s.default.useEffect((function(){if(n.zoneKey in y.k.zones){var t,i=y.k.zones[n.zoneKey],o=null!==(t=null===i||void 0===i?void 0:i.groups.flatMap((function(n){return n})))&&void 0!==t?t:[];e.tris=o.map((function(n){return n.vertexIds.map((function(n){return i.vertices[n]}))})),e.updatePath()}}),[n.zoneKey in y.k.zones]),(0,b.BX)("g",{ref:function(n){n&&(e.pathEl=n.querySelector("polyline.navpath"))},children:[(0,b.tZ)("polyline",{className:"navpath"}),(0,b.tZ)(m.Z,{initial:n.initSrc,radius:n.radius,icon:n.srcIcon,onStart:function(){var t;return null===(t=n.onStart)||void 0===t?void 0:t.call(n,"src")},onStop:function(){e.updatePath("src")},onLoad:function(t){e.srcApi=t,t.moveTo(n.initSrc)},onClick:function(){var t;if(n.npcApi.isFinished())e.path.reverse(),e.srcApi.moveTo(e.path[0]),e.moveNpcTo(e.path[e.path.length-1]),null===(t=n.onChange)||void 0===t||t.call(n,e.path);else if(n.npcApi.isPaused()&&e.path.length){var i;e.moveNpcTo(e.path[0].clone()),e.setPath(e.path),null===(i=n.onChange)||void 0===i||i.call(n,e.path)}else n.npcApi.togglePaused()},shouldCancel:function(n,t){return e.shouldCancel(n,t,e.dstApi.getPosition())}}),(0,b.tZ)(m.Z,{initial:n.initDst,radius:n.radius,icon:n.dstIcon,onStart:function(){var t;return null===(t=n.onStart)||void 0===t?void 0:t.call(n,"dst")},onStop:function(){e.updatePath("dst")},onLoad:function(t){e.dstApi=t,t.moveTo(n.initDst)},onClick:function(){var t;null===(t=n.npcApi)||void 0===t||t.togglePaused()},shouldCancel:function(n,t){return e.shouldCancel(n,t,e.srcApi.getPosition())}})]})}function x(n){var t=s.default.useState((function(){var t={bot:{},api:{key:"solo",anim:{},animCount:0,initPaused:!1,getPosition:function(){var n=new DOMMatrixReadOnly(window.getComputedStyle(e.bot).transform);return{x:n.m41,y:n.m42}},isPaused:function(){return"paused"===e.api.anim.playState},isPlaying:function(){return"running"===e.api.anim.playState},isFinished:function(){return"finished"===e.api.anim.playState},togglePaused:function(){e.api.isFinished()||(e.api.isPaused()?e.api.anim.play():e.api.anim.pause())}}};return n.onLoad(t.api),t})),e=(0,c.Z)(t,1)[0];return(0,b.BX)("g",{className:w,children:[(0,b.tZ)(E,{initSrc:n.initSrc,initDst:n.initDst,zoneKey:n.zoneKey,npcApi:e.api,radius:24,onChange:function(n){var t,i,o=e.bot,r=e.api;if(o&&n.length){var a=e.api.getPosition(),l=n.findIndex((function(n){return n.equals(a)})),c=-1!==l?n.slice(l):n;if(1!==c.length){var s=c.map((function(n,t){return{p:n,q:c[t+1]}})).slice(0,-1),u=s.map((function(n){var t=n.p,e=n.q;return t.distanceTo(e)})).reduce((function(n,t){return n.total+=t,n.sofars.push(n.sofars[n.sofars.length-1]+t),n}),{sofars:[0],total:0}),p=u.sofars,d=u.total,f=s.map((function(n){return Math.atan2(n.q.y-n.p.y,n.q.x-n.p.x).toFixed(2)})),g="paused"===r.anim.playState;null===(t=(i=r.anim).cancel)||void 0===t||t.call(i),r.anim=o.animate(c.flatMap((function(n,t){return[{offset:d?p[t]/d:0,transform:"translate(".concat(n.x,"px, ").concat(n.y,"px) rotateZ(").concat(f[t-1]||0,"rad)")},{offset:d?p[t]/d:0,transform:"translate(".concat(n.x,"px, ").concat(n.y,"px) rotateZ(").concat(f[t]||0,"rad)")}]})),{duration:15*d,direction:"normal",fill:"forwards"}),(g||0===r.animCount&&r.initPaused)&&r.anim.pause(),r.animCount++}}}}),(0,b.BX)("g",{className:"bot",ref:function(t){t&&e.bot!==t&&(e.bot=t,e.bot.animate([{transform:"translate(0px, 0px)"},{transform:"translate(".concat(n.initSrc.x,"px, ").concat(n.initSrc.y,"px)")}],{fill:"forwards"}))},children:[(0,b.tZ)("circle",{fill:"red",stroke:"black",strokeWidth:2,r:10}),(0,b.tZ)("line",{stroke:"black",strokeWidth:2,x2:10})]})]})}var Z,w=(0,u.iv)(i||(i=(0,o.Z)(["\n  polyline.navpath {\n    fill: none;\n    stroke: #777;\n    stroke-width: 2;\n    stroke-dasharray: 8px;\n    stroke-dashoffset: 16px;\n  }\n\n  g.bot {\n    pointer-events: none;\n  }\n"])));function P(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,i)}return e}function S(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?P(Object(e),!0).forEach((function(t){(0,r.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):P(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function k(n){var t="g-301--bridge",e=s.default.useState((function(){return{bots:[0,1].map((function(n){return{src:(0,a.Z)(d.dl,(0,l.Z)([[250,100],[260,200]][n])),dst:(0,a.Z)(d.dl,(0,l.Z)([[600,500],[600,340]][n])),api:{},wasPlaying:!1}}))}})),i=(0,c.Z)(e,1)[0],o=(0,v.Z)(t).data,r=(0,h.Z)(t,null===o||void 0===o?void 0:o.navDecomp,n.disabled).data;return s.default.useEffect((function(){n.disabled?i.bots.forEach((function(n){var t,e,i;n.api.anim&&(n.wasPlaying=n.api.isPlaying(),null===(t=n.api)||void 0===t||null===(e=(i=t.anim).pause)||void 0===e||e.call(i))})):i.bots.forEach((function(n){var t,e,i;n.wasPlaying&&(null===(t=n.api)||void 0===t||null===(e=(i=t.anim).play)||void 0===e||e.call(i))}))}),[n.disabled]),(0,b.tZ)(g.Z,{dark:!0,gridBounds:p.l,initViewBox:D,maxZoom:6,children:(0,b.BX)("g",{className:A,children:[o&&(0,b.tZ)("image",S(S({},o.pngRect),{},{className:"geomorph",href:(0,f.qX)(t)})),null===r||void 0===r?void 0:r.zone.groups.map((function(n){return n.map((function(n){var t=n.vertexIds;return(0,b.tZ)("polygon",{className:"navtri",points:"".concat(t.map((function(n){return r.zone.vertices[n]})))})}))})),i.bots.map((function(n){return(0,b.tZ)(x,{enabled:!!r,initSrc:n.src,initDst:n.dst,zoneKey:t,onLoad:function(t){return n.api=t}})}))]})})}var A=(0,u.iv)(Z||(Z=(0,o.Z)(["\n  border: 1px solid #555555;\n  height: inherit;\n\n  /* image {\n    filter: invert(100%) sepia(50%);\n  } */\n\n  polygon.navtri {\n    fill: transparent;\n    &:hover {\n      fill: rgba(0, 0, 0, 0.03);\n      stroke: black;\n    }\n  }\n"]))),D=new d.UL(200,0,800,800)},12891:function(n,t,e){e.d(t,{Z:function(){return d}});var i,o=e(52209),r=e(79056),a=e(88269),l=e(59748),c=e(48103),s=e(50269),u=e(27375),p=e(8311);function d(n){var t=(0,u.Z)(),e=l.default.useState((function(){return{position:c.dl.from(n.initial),target:c.dl.from(n.initial),dragging:!1,rootEl:{},lineEl:{},circleEl:{},startDrag:function(t){var e;t.stopPropagation(),i.dragging=!0,i.lineEl.style.display="inline",i.target.copy(i.position),["x1","x2"].forEach((function(n){return i.lineEl.setAttribute(n,String(i.position.x))})),["y1","y2"].forEach((function(n){return i.lineEl.setAttribute(n,String(i.position.y))}));var o=i.lineEl.ownerSVGElement;o.addEventListener("pointermove",i.onMove),o.addEventListener("pointerleave",i.endDrag),o.addEventListener("pointerup",i.applyDrag),window.addEventListener("keydown",i.endDragOnEscape),o.style.cursor="grabbing",null===(e=n.onStart)||void 0===e||e.call(n)},onMove:function(n){if(n.stopPropagation(),i.dragging){var t=(0,s.zk)({clientX:n.clientX,clientY:n.clientY,ownerSvg:i.lineEl.ownerSVGElement,pointerId:null}),e=t.x,o=t.y,r=new c.dl(e,o);i.position.distanceTo(r)>=20&&(i.target.set(e,o),i.lineEl.setAttribute("x2",String(e)),i.lineEl.setAttribute("y2",String(o)))}},endDrag:function(){if(i.dragging){i.dragging=!1,i.lineEl.style.display="none",i.lineEl.setAttribute("x2",i.lineEl.getAttribute("x1")),i.lineEl.setAttribute("y2",i.lineEl.getAttribute("y1"));var n=i.lineEl.ownerSVGElement;n.removeEventListener("pointermove",i.onMove),n.removeEventListener("pointerleave",i.endDrag),n.removeEventListener("pointerup",i.applyDrag),window.removeEventListener("keydown",i.endDragOnEscape),n.style.cursor="auto"}},applyDrag:function(){var t,e,o;i.dragging&&(i.endDrag(),null!==(t=n.shouldCancel)&&void 0!==t&&t.call(n,i.position.clone(),i.target.clone())||(i.target.distanceTo(i.position)<20?null===(e=n.onClick)||void 0===e||e.call(n,i.position.clone()):(i.moveTo(i.target),null===(o=n.onStop)||void 0===o||o.call(n,i.target.clone()))))},endDragOnEscape:function(n){"Escape"===n.key&&i.endDrag()},moveTo:function(n){i.position.copy(n),i.lineEl.setAttribute("x1",String(i.target.x)),i.lineEl.setAttribute("y1",String(i.target.y)),t()}}})),i=(0,r.Z)(e,1)[0];l.default.useEffect((function(){var t;null===(t=n.onLoad)||void 0===t||t.call(n,{moveTo:i.moveTo,getPosition:function(){return i.position.clone()}})}),[]);var o=n.radius||8;return(0,p.BX)("g",{className:f,ref:function(n){n&&(i.rootEl=n,i.lineEl=n.querySelector("line.drag-indicator"),i.circleEl=n.querySelector("circle.node"),i.circleEl.addEventListener("pointerdown",i.startDrag),i.circleEl.addEventListener("pointerup",i.applyDrag))},children:[n.icon&&{eye:(0,p.tZ)("image",{href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),down:(0,p.tZ)("image",{href:"/icon/solid_arrow-circle-down.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),right:(0,p.tZ)("image",{href:"/icon/solid_arrow-circle-right.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),run:(0,p.tZ)("image",{href:"/icon/person-running-fa6.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10}),finish:(0,p.tZ)("image",{href:"/icon/flag-checkered-fa6.svg",width:"20",height:"20",x:i.position.x-10,y:i.position.y-10})}[n.icon]||(0,p.tZ)("circle",{className:"inner-node",cx:i.position.x,cy:i.position.y,r:4}),(0,p.tZ)("circle",{className:"node",cx:i.position.x,cy:i.position.y,r:o}),(0,p.tZ)("line",{className:"drag-indicator",stroke:n.stroke||"blue"})]})}var f=(0,a.iv)(i||(i=(0,o.Z)(["\n  circle.node {\n    fill: rgba(0, 0, 100, 0.1);\n    stroke: rgba(0, 0, 100, 0.2);\n    cursor: pointer;\n  }\n  circle.inner-node {\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  line.drag-indicator {\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n    pointer-events: none;\n  }\n"])))},21844:function(n,t,e){e.d(t,{Z:function(){return r}});var i=e(36129);function o(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}function r(n,t,e){return(r=o()?Reflect.construct:function(n,t,e){var o=[null];o.push.apply(o,t);var r=new(Function.bind.apply(n,o));return e&&(0,i.Z)(r,e.prototype),r}).apply(null,arguments)}},36129:function(n,t,e){function i(n,t){return(i=Object.setPrototypeOf||function(n,t){return n.__proto__=t,n})(n,t)}e.d(t,{Z:function(){return i}})}}]);