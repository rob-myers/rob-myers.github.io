"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{87947:function(n,t,e){e.r(t),e.d(t,{default:function(){return k}});var r,o=e(52209),a=(e(59748),e(88269)),i=e(95090),c=e(36694),u=e(84175),s=e(91441),l=e(48103),d=e(27375),p=e(2074),f=e(35650),h=e(87079),g=e(30245),m=e(8311);function y(n,t){var e="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=function(n,t){if(!n)return;if("string"===typeof n)return b(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);"Object"===e&&n.constructor&&(e=n.constructor.name);if("Map"===e||"Set"===e)return Array.from(n);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return b(n,t)}(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return i=n.done,n},e:function(n){c=!0,a=n},f:function(){try{i||null==e.return||e.return()}finally{if(c)throw a}}}}function b(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function v(n){var t=(0,d.Z)(),e=(0,f.Z)((function(){var r={apis:[],background:{},root:{},rootRef:function(t){if(t){e.root=t;var r=t.querySelector("canvas.background");r.width=n.gm.d.pngRect.width,r.height=n.gm.d.pngRect.height,e.background=r}},spawn:function(n){console.log("spawning",n);var r,o=y(n);try{for(o.s();!(r=o.n()).done;){var a=r.value;e.apis.push({key:a.key,def:a,el:{}})}}catch(i){o.e(i)}finally{o.f()}t()}};return n.onLoad(r),r}));return(0,m.BX)("div",{className:A,ref:e.rootRef,children:[(0,m.tZ)("canvas",{className:"background"}),(0,m.tZ)("div",{className:"npcs",children:e.apis.map((function(n){return(0,m.tZ)("div",{className:"npc ".concat(n.key),children:(0,m.tZ)("div",{className:"body"})},n.key)}))})]})}var w,A=(0,a.iv)(r||(r=(0,o.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n  }\n  .npc {\n    position: absolute;\n    left: -10px;\n    top: -10px;\n  }\n  .npc .body {\n    border-radius: 10px;\n    border: 10px solid red;\n  }\n"])));function k(n){var t=(0,d.Z)(),e=(0,p.Z)(n.layoutKey,{staleTime:1/0}).data,r=(0,f.Z)((function(){return{clipPath:"none",currentHoleId:0,doorsApi:{},get gm(){return(0,u.Nh)(e)},npcsApi:{},wire:new i.x,getAdjacentHoleIds:function(){var n=r.gm.d.roomGraph,t=r.doorsApi.getOpen();return n.getEnterableRooms(n.nodesArray[r.currentHoleId],t).map((function(n){return n.holeIndex}))},onChangeDeps:function(){if(e){r.updateClipPath(),r.updateObservableDoors(),t(),r.npcsApi.spawn([{key:"andros"}]);var n=r.wire.pipe((0,c.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){r.updateClipPath(),t()}));return function(){return n.unsubscribe()}}},updateClipPath:function(){var n=r.gm.d,t=n.holesWithDoors,e=n.hullOutline,o=n.pngRect,a=[r.currentHoleId].concat(r.getAdjacentHoleIds()).map((function(n){return t[n]})),i=l.LA.cutOut(a,[e]).map((function(n){return n.translate(-o.x,-o.y)})).map((function(n){return"".concat(n.svgPath)})).join(" ");r.clipPath="path('".concat(i,"')")},updateObservableDoors:function(){var n=r.gm.d.roomGraph,t=n.nodesArray[r.currentHoleId],e=n.getAdjacentDoors([t]);this.doorsApi.setObservableDoors(e.map((function(n){return n.doorIndex})))}}}),[e],{equality:{currentHoleId:!0}});return e?(0,m.BX)(h.Z,{dark:!0,className:Z(e),children:[(0,m.tZ)("img",{className:"geomorph",src:(0,s.qX)(n.layoutKey),draggable:!1,width:e.d.pngRect.width,height:e.d.pngRect.height}),(0,m.tZ)(v,{gm:e,onLoad:function(n){return r.npcsApi=n}}),(0,m.tZ)("img",{className:"geomorph-dark",src:(0,s.qX)(n.layoutKey),draggable:!1,width:e.d.pngRect.width,height:e.d.pngRect.height,style:{clipPath:r.clipPath}}),(0,m.tZ)(g.Z,{gm:e,wire:r.wire,onLoad:function(n){return r.doorsApi=n}})]}):null}var Z=function(n){return(0,a.iv)(w||(w=(0,o.Z)(["\n  img {\n    position: absolute;\n    left: ","px;\n    top: ","px;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])),n.d.pngRect.x,n.d.pngRect.y)}}}]);