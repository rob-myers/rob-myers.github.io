"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{87947:function(t,e,r){r.r(e),r.d(e,{default:function(){return b}});var o=r(79056),n=r(52209),a=r(59748),i=r(88269),d=r(95090),s=r(36694),l=r(91441),u=r(48103),c=r(27375),g=r(44275),p=r(43314),m=r(71583),h=r(30245);function f(t){return null}r(77102);var y,I=r(8311);function b(t){var e=(0,c.Z)(),r=(0,p.Z)([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]},{layoutKey:"g-302--xboat-repair-bay",transform:[1,0,0,1,-1200,600]},{layoutKey:"g-303--passenger-deck",transform:[1,0,0,-1,-1200,1800]},{layoutKey:"g-302--xboat-repair-bay",transform:[-1,0,0,1,2400,600]},{layoutKey:"g-301--bridge",transform:[1,0,0,-1,0,2400]}]),o=r.gms,n=r.gmGraph,i=(0,g.Z)((function(){return{gmId:0,holeId:2,clipPath:o.map((function(t){return"none"})),doorsApi:{ready:!1},npcsApi:{},wire:new d.x,getEnterableHoleIds:function(){var t=i.gmId,e=o[t].roomGraph,r=i.doorsApi.getOpen(t),n=e.nodesArray[i.holeId];return e.getEnterableRooms(n,r).map((function(t){return t.holeIndex}))},update:function(){i.updateClipPath(),i.updateObservableDoors(),e()},updateClipPath:function(){var t=o[i.gmId],e=o.map((function(t){return[]})),r=i.doorsApi.getOpen(i.gmId),a=n.computeLightPolygons(i.gmId,i.holeId,r);o.forEach((function(r,o){var n=a.filter((function(t){return o===t.gmIndex})).map((function(t){return t.poly.precision(3)}));e[o]=u.LA.cutOut(n.concat(r===t?t.holesWithDoors[i.holeId]:[]),[r.hullOutline])})),e.forEach((function(t,e){t.forEach((function(t){return t.translate(-o[e].pngRect.x,-o[e].pngRect.y)}));var r=t.map((function(t){return"".concat(t.svgPath)})).join(" ");i.clipPath[e]=r.length?"path('".concat(r,"')"):"none"}))},updateObservableDoors:function(){var t=this,e=o[i.gmId],r=e.roomGraph.nodesArray[i.holeId],a=o.map((function(t){return[]}));a[i.gmId]=e.roomGraph.getAdjacentDoors(r).map((function(t){return t.doorIndex})),e.roomGraph.getAdjacentHullDoorIds(e,r).flatMap((function(t){var e=t.hullDoorIndex;return n.getAdjacentHoleCtxt(i.gmId,e)||[]})).forEach((function(t){var e=t.adjGmId,r=t.adjDoorId;return a[e]=[r]})),o.forEach((function(e,r){return t.doorsApi.setVisible(r,a[r])}))}}}),{overwrite:{gmId:!0,holeId:!0},deps:[o,n]});return a.default.useEffect((function(){if(o.length&&i.doorsApi.ready){i.update();var t=i.wire.pipe((0,s.h)((function(t){return"closed-door"===t.key||"opened-door"===t.key}))).subscribe((function(t){i.update()}));return function(){return t.unsubscribe()}}}),[o.length,i.doorsApi.ready]),o.length?(0,I.BX)(m.Z,{stageKey:"stage-nav-demo-1",dark:!0,className:v,zoom:.4,children:[o.map((function(t){return(0,I.tZ)("img",{className:"geomorph",src:(0,l.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}})})),(0,I.tZ)(f,{onLoad:function(t){i.npcsApi=t,e()},disabled:t.disabled,stageKey:"stage-nav-demo-1"}),o.map((function(t,e){return(0,I.tZ)("img",{className:"geomorph-dark",src:(0,l.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{clipPath:i.clipPath[e],WebkitClipPath:i.clipPath[e],left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}},e)})),i.doorsApi.ready&&(0,I.tZ)(A,{gms:o,gmGraph:n,doorsApi:i.doorsApi,gmId:i.gmId,holeId:i.holeId,setHole:function(t,e){var r=[t,e];i.gmId=r[0],i.holeId=r[1],i.update()}}),(0,I.tZ)(h.Z,{gms:o,gmGraph:n,wire:i.wire,onLoad:function(t){return i.doorsApi=t}})]}):null}var v=(0,i.iv)(y||(y=(0,n.Z)(["\n  img {\n    position: absolute;\n    transform-origin: top left;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])));function A(t){var e=t.gms[t.gmId],r=t.doorsApi.getVisible(t.gmId);return(0,I.BX)("div",{onClick:function(r){var n=r.target,a=Number(n.getAttribute("data-door-index")),i=e.doors[a],d=i.holeIds.filter((function(e){return e!==t.holeId})),s=(0,o.Z)(d,1)[0];if(null!==s)return t.setHole(t.gmId,s);var l=e.hullDoors.indexOf(i),u=t.gmGraph.getAdjacentHoleCtxt(t.gmId,l);u?t.setHole(u.adjGmId,u.adjHoleId):console.info("hull door is isolated",t.gmId,l)},children:[t.outlines&&t.gms.map((function(t,e){return(0,I.tZ)("div",{style:{position:"absolute",left:t.gridRect.x,top:t.gridRect.y,width:t.gridRect.width,height:t.gridRect.height,border:"2px red solid"}},e)})),(0,I.tZ)("div",{className:"debug",style:{transform:e.transformStyle,position:"absolute"},children:r.map((function(r){var o=e.doors[r],n=o.poly,a=o.normal,i=o.holeIds[0]===t.holeId?1:-1,d=u.dl.from(a).scale(-i).angle,s=n.center.addScaledVector(a,i*w);return(0,I.tZ)("div",{"data-door-index":r,style:{width:2*x,height:2*x,borderRadius:x,position:"absolute",left:s.x-x,top:s.y-x,transform:"rotate(".concat(d,"rad)"),backgroundImage:"url('/icon/solid_arrow-circle-right.svg')",cursor:"pointer"}},r)}))},e.itemKey)]})}var x=5,w=18}}]);