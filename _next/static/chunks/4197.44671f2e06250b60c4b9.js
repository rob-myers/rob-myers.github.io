"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4197],{4197:function(n,t,e){e.r(t),e.d(t,{default:function(){return B}});var r=e(52209),o=e(92809),a=e(59748),i=e(88269),c=e(95090),u=e(36694),s=e(91441),l=e(48103),f=e(49082),p=e(27375),d=e(35650),y=e(97131),m=e(79056),g=e(84175),h=e(68216),v=e(25997),b=e(91077),w=e(30268),k=e(92953);function x(n){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}();return function(){var e,r=(0,k.Z)(n);if(t){var o=(0,k.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,w.Z)(this,e)}}var Z=function(n){(0,b.Z)(e,n);var t=x(e);function e(){return(0,h.Z)(this,e),t.apply(this,arguments)}return(0,v.Z)(e,null,[{key:"fromGmItems",value:function(n){var t=new e,r=[].concat((0,y.Z)(n.map((function(n){return{type:"gm",gmKey:n.layoutKey,id:"gm-".concat(n.layoutKey,"-[").concat(n.transform,"]"),transform:n.transform}}))),(0,y.Z)(n.flatMap((function(n){return n.hullDoors.map((function(t,e){var r=t.poly.center.addScaledVector(t.normal,10),o=n.pngRect.contains(r)?1:-1;return{type:"door",gmKey:n.layoutKey,id:"door-".concat(n.layoutKey,"-[").concat(n.transform,"]-").concat(e),hullDoorIndex:e,transform:n.transform,roomSign:o}}))}))));t.registerNodes(r);var o=n.flatMap((function(n){var t="gm-".concat(n.layoutKey,"-[").concat(n.transform,"]");return n.hullDoors.map((function(e,r){return{src:t,dst:"door-".concat(n.layoutKey,"-[").concat(n.transform,"]-").concat(r)}}))})),a=n.flatMap((function(t,e){var r=n.filter((function(n,r){return r>e&&n.pngRect.intersects(t.pngRect)}));return console.info("geomorph to geomorph:",t,"--\x3e",r),t.hullDoors.flatMap((function(n,e){var o="door-".concat(t.layoutKey,"-[").concat(t.transform,"]-").concat(e),a=l.UL.fromJson(n.rect),i=new l.UL,c=r.flatMap((function(n){return n.hullDoors.map((function(t){return[n,t]}))})).find((function(n){var t=(0,m.Z)(n,2),e=(t[0],t[1].rect);return a.intersects(i.setFromJson(e))}));if(void 0!==c){var u=(0,m.Z)(c,2),s=u[0],f=u[1],p=s.hullDoors.indexOf(f);return console.info("hull door to hull door:",t,e,"==>",s,s.hullDoors.indexOf(f)),{src:o,dst:"door-".concat(s.layoutKey,"-[").concat(s.transform,"]-").concat(p)}}return[]}))}));return[].concat((0,y.Z)(o),(0,y.Z)(a)).forEach((function(n){var e=n.src,r=n.dst;e&&r&&(t.connect({src:e,dst:r}),t.connect({src:r,dst:e}))})),t}}]),e}(e(82405).b),K=e(95814);var O,R,P=e(87079),j=e(30245),A=e(94184),D=e.n(A),I=e(77277),S=e(8311);function N(n,t){var e="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=function(n,t){if(!n)return;if("string"===typeof n)return L(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);"Object"===e&&n.constructor&&(e=n.constructor.name);if("Map"===e||"Set"===e)return Array.from(n);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return L(n,t)}(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return i=n.done,n},e:function(n){c=!0,a=n},f:function(){try{i||null==e.return||e.return()}finally{if(c)throw a}}}}function L(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function E(n){var t=(0,p.Z)(),e=(0,d.Z)((function(){var r={apis:[],root:{},npcRef:function(n){if(n){var t=e.apis.find((function(t){return n.classList.contains(t.key)}));t?(t.el={root:n},n.style.left="".concat(t.def.position.x,"px"),n.style.top="".concat(t.def.position.y,"px")):console.error("".concat(E.name,": npc not found for div.").concat(Array.from(n.classList.values()).join(".")))}},rootRef:function(n){n&&(e.root=n)},spawn:function(r){if((0,I.l)(n.stageKey)){console.log("spawning...",r),e.apis=e.apis.filter((function(n){return!r.some((function(t){return n.key===t.key}))}));var o,a=N(r);try{for(a.s();!(o=a.n()).done;){var i=o.value;e.apis.push({key:i.key,def:i,animState:"idle",el:{}})}}catch(c){a.e(c)}finally{a.f()}}else console.error("".concat(E.name,': cannot spawn into non-existent stage "').concat(n.stageKey,'"'));t()}};return n.onLoad(r),r}));return(0,S.tZ)("div",{className:G,ref:e.rootRef,children:(0,S.tZ)("div",{className:D()("npcs",{disabled:n.disabled}),onPointerDown:function(n){var r=n.target;(0,g.Nh)(e.apis.find((function(n){return r.classList.contains(n.key)}))).animState="walk",t()},onPointerUp:function(n){var r=n.target;(0,g.Nh)(e.apis.find((function(n){return r.classList.contains(n.key)}))).animState="idle",t()},children:e.apis.map((function(n){return(0,S.tZ)("div",{className:D()("npc",n.key,n.animState,U),ref:e.npcRef,children:(0,S.tZ)("div",{className:D()("body","no-select",n.key)})},n.key)}))})})}var C,G=(0,i.iv)(O||(O=(0,r.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"]))),H=new l.dl(51,26).scale(2),M=new l.dl(49,37).scale(2),U=(0,i.iv)(R||(R=(0,r.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    transform: scale(0.18);\n    pointer-events: all;\n    filter: grayscale(100%);\n  }\n  \n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 300ms steps(",") infinite;\n    background: url('/npc/first-npc--walk.png');\n  }\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: idle 2s steps(",") infinite;\n    background: url('/npc/first-npc--idle.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n"])),M.x,M.y,-M.x/2,-M.y/2,3,H.x,H.y,-H.x/2,-H.y/2,1,-3*M.x,-1*H.x);function _(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function q(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?_(Object(e),!0).forEach((function(t){(0,o.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):_(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function B(n){var t=(0,p.Z)(),e=function(n){var t=a.default.useState((function(){return n.map((function(n){return n.layoutKey}))})),e=(0,m.Z)(t,2),r=e[0],o=e[1];a.default.useEffect((function(){var t=n.map((function(n){return n.layoutKey})).filter((function(n){return!r.includes(n)}));t.length&&o([].concat((0,y.Z)(r),(0,y.Z)(t)))}),[r]);var i=r.map((function(n){return(0,K.Z)(n,{staleTime:1/0})})),c=i.every((function(n){return n.data}))&&n.every((function(n){return r.includes(n.layoutKey)}));return a.default.useMemo((function(){if(c){var t=n.map((function(n){var t=r.findIndex((function(t){return t===n.layoutKey})),e=(0,g.Nh)(i[t].data),o=n.transform||[1,0,0,1,0,0];return(0,f.mI)(e,o)}));return{gms:t,gmGraph:Z.fromGmItems(t)}}return{gms:[],gmGraph:new Z}}),[c])}([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]}]),r=e.gms,i=(e.gmGraph,(0,d.Z)((function(){return{clipPath:f.Ey.reduce((function(n,t){return q(q({},n),{},(0,o.Z)({},t,"none"))}),{}),currentHoleId:0,doorsApi:{},npcsApi:{},wire:new c.x,getAdjacentHoleIds:function(n){var t=n.roomGraph,e=i.doorsApi[n.layoutKey].getOpen();return t.getEnterableRooms(t.nodesArray[i.currentHoleId],e).map((function(n){return n.holeIndex}))},onChangeDeps:function(){if(r.length){i.updateClipPath(),i.updateObservableDoors(),t();var n=i.wire.pipe((0,u.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){i.updateClipPath(),t()}));return function(){return n.unsubscribe()}}},updateClipPath:function(){r.map((function(n){var t=n.holesWithDoors,e=n.hullOutline,r=n.pngRect,o=[i.currentHoleId].concat(i.getAdjacentHoleIds(n)).map((function(n){return t[n]})),a=l.LA.cutOut(o,[e]).map((function(n){return n.translate(-r.x,-r.y)})).map((function(n){return"".concat(n.svgPath)})).join(" ");i.clipPath[n.layoutKey]=a.length?"path('".concat(a,"')"):"none"}))},updateObservableDoors:function(){var n=this;r.map((function(t){var e=t.roomGraph,r=e.nodesArray[i.currentHoleId],o=e.getAdjacentDoors(r);n.doorsApi[t.layoutKey].setObservableDoors(o.map((function(n){return n.doorIndex})))}))}}}),[r],{equality:{currentHoleId:!0}}));return r.length?(0,S.BX)(P.Z,{stageKey:"stage-nav-demo-1",dark:!0,className:X,zoom:.4,children:[r.map((function(n){return(0,S.tZ)("img",{className:"geomorph",src:(0,s.qX)(n.layoutKey),draggable:!1,width:n.pngRect.width,height:n.pngRect.height,style:{left:n.pngRect.x,top:n.pngRect.y}})})),(0,S.tZ)(E,{onLoad:function(n){i.npcsApi=n,t()},disabled:n.disabled,stageKey:"stage-nav-demo-1"}),r.map((function(n){return[(0,S.tZ)("img",{className:"geomorph-dark",src:(0,s.qX)(n.layoutKey),draggable:!1,width:n.pngRect.width,height:n.pngRect.height,style:{clipPath:i.clipPath[n.layoutKey],WebkitClipPath:i.clipPath[n.layoutKey],left:n.pngRect.x,top:n.pngRect.y}}),(0,S.tZ)(j.Z,{gm:n,wire:i.wire,onLoad:function(t){return i.doorsApi[n.layoutKey]=t}})]}))]}):null}var X=(0,i.iv)(C||(C=(0,r.Z)(["\n  img {\n    position: absolute;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])))}}]);