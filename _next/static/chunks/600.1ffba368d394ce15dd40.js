"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[600],{89600:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var r,i=n(52209),o=n(92809),a=n(79056),l=n(30266),c=n(809),s=n.n(c),u=n(59748),p=n(88269),f=n(88767),g=n(94184),d=n.n(g),y=n(48103),b=n(91441),v=n(68451),h=n(35490),E=n(83159),m=n(50269),w=n(8311);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){var t=u.default.useState((function(){return{position:y.dl.from(e.initial),target:y.dl.from(e.initial),dragging:!1,lineEl:{},circleEl:{},startDrag:function(e){e.stopPropagation(),r.dragging=!0,r.lineEl.style.display="inline",r.target.copy(r.position),["x1","x2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.x))})),["y1","y2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.y))}));var t=r.lineEl.ownerSVGElement;t.addEventListener("pointermove",r.onMove),t.addEventListener("pointerleave",r.endDrag),t.addEventListener("pointerup",r.applyDrag),window.addEventListener("keydown",r.endDragOnEscape),t.style.cursor="grabbing"},onMove:function(e){if(e.stopPropagation(),r.dragging){var t=(0,m.zk)({clientX:e.clientX,clientY:e.clientY,ownerSvg:r.lineEl.ownerSVGElement,pointerId:null}),n=t.x,i=t.y;r.target.set(n,i),r.lineEl.setAttribute("x2",String(n)),r.lineEl.setAttribute("y2",String(i))}},endDrag:function(){r.dragging=!1,r.lineEl.style.display="none",r.lineEl.setAttribute("x2",r.lineEl.getAttribute("x1")),r.lineEl.setAttribute("y2",r.lineEl.getAttribute("y1"));var e=r.lineEl.ownerSVGElement;e.removeEventListener("pointermove",r.onMove),e.removeEventListener("pointerleave",r.endDrag),e.removeEventListener("pointerup",r.applyDrag),window.removeEventListener("keydown",r.endDragOnEscape),e.style.cursor="auto"},applyDrag:function(){r.endDrag(),r.position.copy(r.target),r.lineEl.setAttribute("x1",String(r.target.x)),r.lineEl.setAttribute("y1",String(r.target.y)),i(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r)),e.onChange(y.dl.from(r.position))},endDragOnEscape:function(e){"Escape"===e.key&&r.endDrag()}}})),n=(0,a.Z)(t,2),r=n[0],i=n[1],l=e.radius||10;return(0,w.BX)("g",{className:P,children:[(0,w.tZ)("line",{ref:function(e){return e&&(r.lineEl=e)},className:"drag-indicator"}),(0,w.tZ)("circle",{ref:function(e){e&&(r.circleEl=e,e.addEventListener("pointerdown",r.startDrag),e.addEventListener("pointerup",r.applyDrag))},className:"node",cx:r.position.x,cy:r.position.y,r:l})]})}var D,P=(0,p.iv)(r||(r=(0,i.Z)(["\n  > .node {\n    fill: blue;\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  > .drag-indicator {\n    stroke: black;\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n  }\n"])));function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(e){var t=(0,f.useQuery)("".concat(e.layoutKey,"-json"),(0,l.Z)(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",fetch((0,b.tU)(e.layoutKey)).then((function(e){return e.json()})));case 1:case"end":return t.stop()}}),t)})))).data,n=u.default.useState((function(){return{lightA:new y.dl(205,385),lightB:new y.dl(930,385)}})),r=(0,a.Z)(n,1)[0];return(0,w.tZ)(E.Z,{gridBounds:h.l,initViewBox:h.r,maxZoom:6,className:d()(A,e.disabled&&"disabled"),children:t&&(0,w.BX)(w.HY,{children:[(0,w.tZ)("image",x(x({},t.pngRect),{},{className:"geomorph",href:(0,b.qX)(e.layoutKey)})),(0,w.tZ)(S,{init:r.lightA,walls:t.walls,hull:t.hull.poly}),(0,w.tZ)(S,{init:r.lightB,walls:t.walls,hull:t.hull.poly})]})})}function S(e){var t=e.init,n=e.walls,r=e.hull,i=u.default.useState((function(){return t})),o=(0,a.Z)(i,2),l=o[0],c=o[1],s=(0,u.useMemo)((function(){if(y.LA.from(r[0]).removeHoles().contains(l)){var e=n.map((function(e){return y.LA.from(e)})).flatMap((function(e){return v.J.triangulationToPolys(e.fastTriangulate())}));return v.J.lightPolygon(l,2e3,e)}return new y.LA}),[l.x,l.y]);return(0,w.BX)(w.HY,{children:[(0,w.tZ)("path",{className:"light",d:s.svgPath}),(0,w.tZ)(j,{initial:l,onChange:c,radius:14})]})}var A=(0,p.iv)(D||(D=(0,i.Z)(["\n  path.light {\n    fill: #00f;\n    animation: fadein 1s infinite alternate;\n    \n    @keyframes fadein {\n      from { opacity: 0; }\n      to { opacity: 0.35; }\n    }\n  }\n  &.disabled path.light {\n    animation: none;\n    opacity: 0.25;\n  }\n"])))},91441:function(e,t,n){n.d(t,{Dv:function(){return r},tU:function(){return i},qX:function(){return o}});var r={sizePx:11,noTailPx:10,font:"".concat(11,"px sans-serif"),padX:4,padY:2};function i(e){return"/geomorph/".concat(e,".json")}function o(e){return"/geomorph/".concat(e,".png")}}}]);