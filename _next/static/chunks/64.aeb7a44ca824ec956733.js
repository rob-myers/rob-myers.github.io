"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64],{65064:function(e,n,t){t.r(n),t.d(n,{default:function(){return D}});var r,i=t(52209),o=t(92809),l=t(79056),a=t(30266),c=t(809),s=t.n(c),u=t(59748),p=t(88269),f=t(88767),d=t(94184),g=t.n(d),y=t(48103),v=t(91441),b=t(68451),E=t(35490),h=t(83159),m=t(12891),w=t(8311);function O(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function j(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?O(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function D(e){var n=(0,f.useQuery)("".concat(e.layoutKey,"-json"),(0,a.Z)(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fetch((0,v.tU)(e.layoutKey)).then((function(e){return e.json()})));case 1:case"end":return n.stop()}}),n)})))).data,t=u.default.useState((function(){return{lightA:new y.dl(205,385),lightB:new y.dl(930,385)}})),r=(0,l.Z)(t,1)[0];return(0,w.tZ)(h.Z,{gridBounds:E.l,initViewBox:E.r,maxZoom:6,className:g()(S,e.disabled&&"disabled"),children:n&&(0,w.BX)(w.HY,{children:[(0,w.tZ)("image",j(j({},n.pngRect),{},{className:"geomorph",href:(0,v.qX)(e.layoutKey)})),(0,w.tZ)(P,{init:r.lightA,walls:n.walls,hull:n.hull.poly}),(0,w.tZ)(P,{init:r.lightB,walls:n.walls,hull:n.hull.poly})]})})}function P(e){var n=e.init,t=e.walls,r=e.hull,i=u.default.useState((function(){return n})),o=(0,l.Z)(i,2),a=o[0],c=o[1],s=(0,u.useMemo)((function(){if(y.LA.from(r[0]).removeHoles().contains(a)){var e=t.map((function(e){return y.LA.from(e)})).flatMap((function(e){return b.J.triangulationToPolys(e.fastTriangulate())}));return b.J.lightPolygon(a,2e3,e)}return new y.LA}),[a.x,a.y]);return(0,w.BX)(w.HY,{children:[(0,w.tZ)("path",{className:"light",d:s.svgPath}),(0,w.tZ)(m.Z,{initial:a,onStop:c,radius:14})]})}var S=(0,p.iv)(r||(r=(0,i.Z)(["\n  path.light {\n    fill: #00f;\n    animation: fadein 1s infinite alternate;\n    \n    @keyframes fadein {\n      from { opacity: 0; }\n      to { opacity: 0.35; }\n    }\n  }\n  &.disabled path.light {\n    animation: none;\n    opacity: 0.25;\n  }\n"])))},91441:function(e,n,t){t.d(n,{Dv:function(){return r},tU:function(){return i},qX:function(){return o}});var r={sizePx:11,noTailPx:10,font:"".concat(11,"px sans-serif"),padX:4,padY:2};function i(e){return"/geomorph/".concat(e,".json")}function o(e){return"/geomorph/".concat(e,".png")}},12891:function(e,n,t){t.d(n,{Z:function(){return d}});var r,i=t(52209),o=t(92809),l=t(79056),a=t(88269),c=t(59748),s=t(48103),u=t(50269),p=t(8311);function f(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function d(e){var n=c.default.useState((function(){return{position:s.dl.from(e.initial),target:s.dl.from(e.initial),dragging:!1,rootEl:{},lineEl:{},circleEl:{},startDrag:function(n){var t;n.stopPropagation(),r.dragging=!0,r.lineEl.style.display="inline",r.target.copy(r.position),["x1","x2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.x))})),["y1","y2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.y))}));var i=r.lineEl.ownerSVGElement;i.addEventListener("pointermove",r.onMove),i.addEventListener("pointerleave",r.endDrag),i.addEventListener("pointerup",r.applyDrag),window.addEventListener("keydown",r.endDragOnEscape),i.style.cursor="grabbing",null===(t=e.onStart)||void 0===t||t.call(e)},onMove:function(e){if(e.stopPropagation(),r.dragging){var n=(0,u.zk)({clientX:e.clientX,clientY:e.clientY,ownerSvg:r.lineEl.ownerSVGElement,pointerId:null}),t=n.x,i=n.y;r.target.set(t,i),r.lineEl.setAttribute("x2",String(t)),r.lineEl.setAttribute("y2",String(i))}},endDrag:function(){r.dragging=!1,r.lineEl.style.display="none",r.lineEl.setAttribute("x2",r.lineEl.getAttribute("x1")),r.lineEl.setAttribute("y2",r.lineEl.getAttribute("y1"));var e=r.lineEl.ownerSVGElement;e.removeEventListener("pointermove",r.onMove),e.removeEventListener("pointerleave",r.endDrag),e.removeEventListener("pointerup",r.applyDrag),window.removeEventListener("keydown",r.endDragOnEscape),e.style.cursor="auto"},applyDrag:function(){var n;r.endDrag(),r.position.copy(r.target),r.lineEl.setAttribute("x1",String(r.target.x)),r.lineEl.setAttribute("y1",String(r.target.y)),i(function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?f(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}({},r)),null===(n=e.onStop)||void 0===n||n.call(e,s.dl.from(r.position))},endDragOnEscape:function(e){"Escape"===e.key&&r.endDrag()}}})),t=(0,l.Z)(n,2),r=t[0],i=t[1],a=e.radius||10;return(0,p.BX)("g",{className:g,ref:function(e){e&&(r.rootEl=e,r.lineEl=e.querySelector("line.drag-indicator"),r.circleEl=e.querySelector("circle.node"),r.circleEl.addEventListener("pointerdown",r.startDrag),r.circleEl.addEventListener("pointerup",r.applyDrag))},children:[(0,p.tZ)("circle",{className:"node",cx:r.position.x,cy:r.position.y,r:a+20}),(0,p.tZ)("circle",{className:"inner-node",fill:e.fill||"blue",cx:r.position.x,cy:r.position.y,r:a}),(0,p.tZ)("line",{className:"drag-indicator"})]})}var g=(0,a.iv)(r||(r=(0,i.Z)(["\n  > circle.node {\n    fill: rgba(0, 0, 0, 0.2);\n    cursor: pointer;\n  }\n  > circle.inner-node {\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  > line.drag-indicator {\n    stroke: black;\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n    pointer-events: none;\n  }\n"])))}}]);