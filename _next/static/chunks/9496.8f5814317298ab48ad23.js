"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9496],{9496:function(e,t,r){r.r(t),r.d(t,{default:function(){return C}});var n,o=r(52209),c=r(92809),i=r(88269),a=r(24790),u=r(84175),f=r(91441),s=r(49345),l=r(35650),p=r(21225),d=r(35490),h=r(83159),g=r(59748),y=r(8311);function b(e){var t=e.json,r=(0,l.Z)((function(){return{api:{evt:new a.x},onClick:function(t){var r=t.target,n=r.classList.toggle("open");e.wire.next({key:n?"opened-door":"closed-door",index:Number(r.getAttribute("data-index"))})}}}));return(0,y.tZ)("g",{className:v,onPointerUp:r.onClick,children:t.doors.map((function(e,t){var r=e.rect,n=e.angle;return(0,y.tZ)("rect",{"data-index":t,className:"door",x:r.x,y:r.y,width:r.width,height:r.height,style:{transform:"rotate(".concat(n,"rad)"),transformOrigin:"".concat(r.x,"px ").concat(r.y,"px")}},t)}))})}var v=(0,i.iv)(n||(n=(0,o.Z)(["\n  rect.door {\n    cursor: pointer;\n    fill: #000;\n    stroke: black;\n    opacity: 1;\n    transition: opacity 100ms linear;\n    &.open {\n      opacity: 0;\n    }\n  }\n"]))),O=r(79056),w=r(48103),m=r(68451),j=r(27375);function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,c.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){var t=(0,j.Z)(),r=(0,l.Z)((function(){return{lights:[],doors:{},computeLights:function(e){var t=e.json,n=e.defs,o=w.LA.from(t.hull.poly[0]).removeHoles(),c=t.walls.concat(t.doors.filter((function(e,t){return"open"!==r.doors[t]})).map((function(e){return e.poly}))).map((function(e){return w.LA.from(e)})).flatMap((function(e){return m.J.triangulationToPolys(e.fastTriangulate())})),i=n.filter((function(e){var t=(0,O.Z)(e.def,1)[0];return o.contains(t)}));r.lights=i.map((function(e){var t=(0,O.Z)(e.def,2),r=t[0],n=t[1],o=m.J.lightPolygon(r,n,c),i=o.rect;return{position:r,poly:o,ratio:new w.dl((r.x-i.x)/i.width,(r.y-i.y)/i.height),dist:n,scale:i.width>=i.height?new w.dl(1,i.width/i.height):new w.dl(i.height/i.width,1),r:n/(Math.max(i.width,i.height)/2)*.5}}))}}}));return g.default.useEffect((function(){r.computeLights(e);var n=e.wire.subscribe((function(n){switch(n.key){case"opened-door":r.doors[n.index]="open",r.computeLights(e),t();break;case"closed-door":r.doors[n.index]="closed",r.computeLights(e),t()}}));return function(){return n.unsubscribe()}}),[e.defs]),(0,y.BX)(y.HY,{children:[(0,y.BX)("defs",{children:[r.lights.map((function(e,t){var r=e.ratio,n=e.scale,o=e.r;return(0,y.BX)("radialGradient",{id:"my-radial-".concat(t),cx:r.x,cy:r.y,r:o,gradientTransform:"translate(".concat(r.x,", ").concat(r.y,") scale(").concat(n.x,", ").concat(n.y,") translate(").concat(-r.x,", ").concat(-r.y,")"),children:[(0,y.tZ)("stop",{offset:"0%","stop-color":"#aaa"}),(0,y.tZ)("stop",{offset:"80%","stop-color":"#000"}),(0,y.tZ)("stop",{offset:"100%","stop-color":"#000"})]})})),(0,y.BX)("mask",{id:"lights-mask",children:[(0,y.tZ)("rect",Z(Z({},e.json.pngRect),{},{fill:"#000"})),r.lights.map((function(e,t){var r=e.poly;return(0,y.tZ)("path",{d:r.svgPath,fill:"url(#my-radial-".concat(t,")")})})),(0,y.tZ)("circle",{cx:"50",cy:"50",r:"50",fill:"url(#my-radial)"})]})]}),(0,y.tZ)("image",Z(Z({},e.json.pngRect),{},{className:"geomorph-light",href:(0,f.qX)(e.json.key),mask:"url(#lights-mask)"})),r.lights.map((function(e){var t=e.position;e.poly;return(0,y.tZ)(y.HY,{children:(0,y.tZ)("image",{href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:t.x-10,y:t.y-10})})}))]})}var k,D=r(30266),E=r(809),S=r.n(E),_=r(88767);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,c.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function I(e){var t=(0,_.useQuery)("Image:".concat(e.href,"(").concat(e.darken||0,")"),(0,D.Z)(S().mark((function t(){var r,n,o,c;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Image,n=document.createElement("canvas"),t.next=4,new Promise((function(t,n){r.src=e.href,r.onload=function(){return t(r)},r.onerror=function(){return n(new Error("failed to load image: ".concat(e.href)))}}));case 4:return o=[r.width,r.height],n.width=o[0],n.height=o[1],(c=(0,u.Cq)(n.getContext("2d"))).drawImage(r,0,0),c.fillStyle="rgba(0, 0, 0, ".concat(e.darken,")"),c.fillRect(0,0,n.width,n.height),t.abrupt("return",n.toDataURL());case 12:case"end":return t.stop()}}),t)})))).data;return(0,y.tZ)("image",N(N({},e),{},{href:t}))}function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,c.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e){var t=(0,p.Z)(X).data,r=(0,l.Z)((function(){return{lightDefs:[{key:"light-def",def:[new s.d(205,385),170,1]},{key:"light-def",def:[new s.d(420,400),150,.5]},{key:"light-def",def:[new s.d(620,315),250,1]}],wire:new a.x}}),{lightDefs:function(e,t){return(0,u.fS)(e,t)}});return(0,y.tZ)(h.Z,{dark:!0,gridBounds:d.l,initViewBox:d.r,maxZoom:6,className:A,children:t&&(0,y.BX)(y.HY,{children:[(0,y.tZ)(I,B(B({},t.pngRect),{},{className:"geomorph",href:(0,f.qX)(X),darken:.85})),(0,y.tZ)(x,{json:t,defs:r.lightDefs,wire:r.wire}),(0,y.tZ)(b,{json:t,wire:r.wire})]})})}var X="g-301--bridge",A=(0,i.iv)(k||(k=(0,o.Z)(["\n  path.shadow {\n    fill: #00000066;\n    pointer-events: none;\n  }\n"])))},21225:function(e,t,r){r.d(t,{Z:function(){return p}});var n=r(92809),o=r(30266),c=r(809),i=r.n(c),a=r(88767),u=r(18264),f=r(91441);function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){return(0,a.useQuery)((0,f.tU)(e),(0,o.Z)(i().mark((function t(){var r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch((0,f.tU)(e)).then((function(e){return e.json()}));case 2:return r=t.sent,t.abrupt("return",l(l({},r),{},{d:{navPoly:r.navPoly.map(u.L.from)}}));case 4:case"end":return t.stop()}}),t)}))),{keepPreviousData:!0,cacheTime:1/0})}},35650:function(e,t,r){r.d(t,{Z:function(){return c}});var n=r(79056),o=r(59748);function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=o.default.useState(e),c=(0,n.Z)(r,1),i=c[0];return o.default.useEffect((function(){var r=e.toString()!==i._prevFn;if(i._prevFn){if(r){for(var o=e(),c=0,a=Object.entries(o);c<a.length;c++){var u,f=(0,n.Z)(a[c],2),s=f[0],l=f[1];"function"===typeof l?i[s]=l:s in i?i._prevInit&&!1===(null===(u=t[s])||void 0===u?void 0:u.call(t,i._prevInit[s],o[s]))&&(i[s]=o[s]):i[s]=l}for(var p=0,d=Object.entries(i);p<d.length;p++){var h=(0,n.Z)(d[p],2),g=h[0];h[1];g in o||delete i[g]}i._prevFn=e.toString(),i._prevInit=o}}else i._prevFn=e.toString(),i._prevInit=e()}),[]),i}},84175:function(e,t,r){function n(e,t){if(void 0===e)throw new Error("Encountered unexpected undefined value".concat(t?" for '".concat(t,"'"):""));return e}function o(e,t){if(null==e)throw new Error("Encountered unexpected null or undefined value".concat(t?" for '".concat(t,"'"):""));return e}function c(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(r>10)throw Error("equals: recursive depth exceeded 10");return"function"===typeof(null===e||void 0===e?void 0:e.equals)?!0===e.equals(t):Array.isArray(e)?e.every((function(e,r){return c(e,t[r])}),r+1):i(e)?Object.keys(e).every((function(r){return c(e[r],t[r])}),r+1):e===t}function i(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}r.d(t,{Nh:function(){return n},Cq:function(){return o},fS:function(){return c}})}}]);