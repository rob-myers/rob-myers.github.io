"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1746],{30245:function(n,t,e){e.d(t,{Z:function(){return x}});var r,o=e(52209),i=e(92809),a=e(67294),c=e(88269),s=e(94184),u=e.n(s),d=e(16716),l=e(84175),f=e(50269),p=e(13702),m=e(44275),g=e(27375),v=e(85893);function h(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function y(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?h(Object(e),!0).forEach((function(t){(0,i.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):h(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function x(n){var t=(0,g.Z)(),e=(0,m.Z)((function(){return{canvas:[],events:new d.x,open:n.gms.map((function(t,e){return t.doors.map((function(t,r){var o;return(null===(o=n.initOpen[e])||void 0===o?void 0:o.includes(r))||!1}))})),ready:!0,rootEl:{},vis:n.gms.map((function(n){return{}})),drawInvisibleInCanvas:function(t){var r=e.canvas[t],o=(0,l.Cq)(r.getContext("2d")),i=n.gms[t];o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,r.width,r.height),o.setTransform(1,0,0,1,-i.pngRect.x,-i.pngRect.y),o.fillStyle="#555";var a=i.doors.flatMap((function(n,r){var o;return e.vis[t][r]&&e.open[t][r]&&(null===(o=i.extendDoorId)||void 0===o?void 0:o[r])||[]})).filter((function(n){return e.open[t][n]}));i.doors.forEach((function(n,r){var i=n.poly;e.vis[t][r]||a.includes(r)||(0,f.Fx)(o,[i])}))},getClosed:function(n){return e.open[n].flatMap((function(n,t){return n?[]:t}))},getOpen:function(n){return e.open[n].flatMap((function(n,t){return n?t:[]}))},getVisible:function(n){return Object.keys(e.vis[n]).map(Number)},onToggleDoor:function(t){var r=t.target.getAttribute("data-gm-id"),o=Number(r),i=Number(t.target.getAttribute("data-door-id")),a=Number(t.target.getAttribute("data-hull-door-id")),c=-1===a?null:n.gmGraph.getDoorNodeByIds(o,a);if(null!==r&&e.vis[o][i]&&(null===c||void 0===c||!c.sealed)&&n.playerNearDoor(o,i)&&(!e.open[o][i]||n.safeToCloseDoor(o,i))){e.open[o][i]=!e.open[o][i];var s=e.open[o][i]?"opened-door":"closed-door";e.events.next({key:s,gmIndex:o,index:i});var u=-1!==a?n.gmGraph.getAdjacentRoomCtxt(o,a):null;u&&(e.open[u.adjGmId][u.adjDoorId]=e.open[o][i],e.events.next({key:s,gmIndex:u.adjGmId,index:u.adjDoorId}))}},setVisible:function(n,r){e.vis[n]=r.reduce((function(n,t){return y(y({},n),{},(0,i.Z)({},t,!0))}),{}),e.drawInvisibleInCanvas(n),t()}}}));return a.useEffect((function(){n.onLoad(e)}),[]),a.useEffect((function(){n.gms.forEach((function(n,t){return e.drawInvisibleInCanvas(t)}));var t=function(n){return e.onToggleDoor(n)};return e.rootEl.addEventListener("pointerup",t),function(){e.rootEl.removeEventListener("pointerup",t)}}),[n.gms]),(0,v.jsx)("div",{ref:function(n){return n&&(e.rootEl=n)},className:u()(p.vR.doors,I),children:n.gms.map((function(n,t){return(0,v.jsxs)("div",{style:{transform:n.transformStyle},children:[n.doors.map((function(r,o){var a;return e.vis[t][o]&&(0,v.jsx)("div",{className:u()(p.vR.door,(a={},(0,i.Z)(a,p.vR.hull,r.tags.includes("hull")),(0,i.Z)(a,p.vR.iris,r.tags.includes("iris")),(0,i.Z)(a,p.vR.open,e.open[t][o]),a)),style:{left:r.baseRect.x,top:r.baseRect.y,width:r.baseRect.width,height:r.baseRect.height,transform:"rotate(".concat(r.angle,"rad)"),transformOrigin:"top left"},children:(0,v.jsx)("div",{className:p.vR.doorTouchUi,"data-gm-id":t,"data-door-id":o,"data-hull-door-id":n.hullDoors.indexOf(r)})},o)})),(0,v.jsx)("canvas",{ref:function(n){return n&&(e.canvas[t]=n)},width:n.pngRect.width,height:n.pngRect.height,style:{left:n.pngRect.x,top:n.pngRect.y}})]},n.itemKey)}))})}var I=(0,c.iv)(r||(r=(0,o.Z)(["\n  --npc-door-touch-radius: 10px;\n\n  position: absolute;\n\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n\n  div.door {\n    position: absolute;\n    pointer-events: none;\n    \n    .door-touch-ui {\n      cursor: pointer;\n      pointer-events: all;\n      position: absolute;\n\n      width: calc(100% + 2 * var(--npc-door-touch-radius));\n      min-width: calc( 2 * var(--npc-door-touch-radius) );\n      top: calc(-1 * var(--npc-door-touch-radius) + ","px ); /** 5px for hull */\n      left: calc(-1 * var(--npc-door-touch-radius));\n      height: calc(2 * var(--npc-door-touch-radius));\n\n      background: rgba(100, 0, 0, 0.1);\n      border-radius: var(--npc-door-touch-radius);\n    }\n\n    &.hull .door-touch-ui {\n      top: calc(-1 * var(--npc-door-touch-radius) + ","px );\n    }\n\n    &:not(.iris) {\n      background: #444;\n      border: 1px solid #999;\n\n      transition: width 300ms ease-in;\n      &.open {\n        width: 4px !important;\n      }\n    }\n\n    &.iris {\n      background-image: linear-gradient(45deg, #000 33.33%, #888 33.33%, #888 50%, #000 50%, #000 83.33%, #888 83.33%, #aaa 100%);\n      background-size: 4.24px 4.24px;\n      border: 1px solid #aaa;\n      \n      opacity: 1;\n      transition: opacity 300ms ease;\n      &.open {\n        opacity: 0.2;\n      }\n    }\n  }\n"])),p.j7/2,p.gv/2)},97301:function(n,t,e){e.d(t,{Z:function(){return k}});var r=e(97131),o=e(79056),i=e(67294),a=e(84175),c=e(68216),s=e(25997),u=e(14695),d=e(91077),l=e(30268),f=e(92953),p=e(92809),m=e(48103),g=e(82405),v=e(68451),h=e(39660),y=e(2026),x=e(13702);function I(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function w(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?I(Object(e),!0).forEach((function(t){(0,p.Z)(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):I(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function b(n){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(n){return!1}}();return function(){var e,r=(0,f.Z)(n);if(t){var o=(0,f.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,l.Z)(this,e)}}var D=function(n){(0,d.Z)(e,n);var t=b(e);function e(n){var r;return(0,c.Z)(this,e),r=t.call(this),(0,p.Z)((0,u.Z)(r),"gms",void 0),(0,p.Z)((0,u.Z)(r),"gmData",void 0),(0,p.Z)((0,u.Z)(r),"entry",void 0),r.gms=n,r.gmData=n.reduce((function(n,t){return w(w({},n),{},(0,p.Z)({},t.key,t))}),{}),r.entry=new Map,r}return(0,s.Z)(e,[{key:"findPath",value:function(n,t){var e=this,r=this.gms.findIndex((function(t){return t.gridRect.contains(n)})),o=this.gms.findIndex((function(n){return n.gridRect.contains(t)}));if(-1===r||-1===o)return null;for(var i=[],a=m.dl.from(n),c=m.dl.from(t).sub(n),s=r;s!==o;){var u=v.J.compassPoints(c),d=u.flatMap((function(n){return e.getConnectedDoorsBySide(s,n)})).reduce((function(n,r){var o=e.getDoorEntry(r),i=o.distanceToSquared(t);return!n.node||i<n.d?{d:i,v:o,node:r}:n}),{d:1/0,v:new m.dl});if(!d.node)return(0,y.vU)("global nav: ".concat(s," ").concat(u,": no closest node")),null;var l=this.getAdjacentDoor(d.node);if(!l||l.gmId===s)return(0,y.vU)("global nav: ".concat(s," ").concat(d.node.id," has no adjacent door")),null;i.push({srcGmId:s,srcRoomId:this.gms[s].doors[d.node.doorId].roomIds.find((function(n){return null!==n})),srcDoorId:d.node.doorId,srcHullDoorId:d.node.hullDoorId,srcDoorEntry:d.v,dstGmId:l.gmId,dstRoomId:this.gms[l.gmId].doors[l.doorId].roomIds.find((function(n){return null!==n})),dstDoorId:l.doorId,dstHullDoorId:l.hullDoorId,dstDoorEntry:this.getDoorEntry(l)}),s=l.gmId,a.copy(d.v),c.copy(t).sub(a)}return i}},{key:"findRoomContaining",value:function(n){var t=this.gms.findIndex((function(t){return t.gridRect.contains(n)}));if(-1===t)return null;var e=this.gms[t],r=new m.dl,o=e.rooms.findIndex((function(t){return t.contains(e.inverseMatrix.transformPoint(r.copy(n)))}));return-1===o?null:{gmId:t,roomId:o}}},{key:"getAdjacentDoor",value:function(n){var t=this.getSuccs(n).find((function(n){return"door"===n.type}));return t||null}},{key:"getConnectedDoorsBySide",value:function(n,t){var e=this.nodesArray[n];return this.getSuccs(e).filter((function(n){return!n.sealed&&n.direction===t}))}},{key:"getAdjacentRoomCtxt",value:function(n,t){var r=this.gms[n],o=this.nodesArray[n],i=j(r.key,r.transform,t),a=this.getNodeById(i);if(!a)return console.error("".concat(e.name,": failed to find hull door node: ").concat(i)),null;var c=this.getSuccs(a).find((function(n){return n!==o}));if(!c)return console.info("".concat(e.name,": hull door ").concat(i," on boundary")),null;var s=c.gmId,u=c.hullDoorId,d=c.doorId;return{adjGmId:s,adjRoomId:this.gms[s].hullDoors[u].roomIds.find((function(n){return"number"===typeof n})),adjHullId:u,adjDoorId:d}}},{key:"getDoorEntry",value:function(n){return this.entry.get(n)}},{key:"getDoorNode",value:function(n){return this.getNodeById(n)}},{key:"getDoorNodeByIds",value:function(n,t){var e=this.gms[n],r=j(e.key,e.transform,t);return this.getNodeById(r)}},{key:"getOpenDoorArea",value:function(n,t){var r=this.gms[n],o=r.doors[t],i=r.hullDoors.indexOf(o);if(-1===i){var a=r.roomGraph.getAdjacentRooms(r.roomGraph.getDoorNode(t)).map((function(n){return r.roomsWithDoors[n.roomId]}));return{gmId:n,doorId:t,adjRoomId:null,poly:m.LA.union(a)[0]}}var c=this.getAdjacentRoomCtxt(n,i);if(c){var s=o.roomIds.find((function(n){return"number"===typeof n})),u=this.gms[c.adjGmId],d=u.roomsWithDoors[c.adjRoomId],l=m.LA.union([r.roomsWithDoors[s].clone().applyMatrix(r.matrix).applyMatrix(u.inverseMatrix),d])[0];return{gmId:c.adjGmId,doorId:c.adjDoorId,adjRoomId:c.adjRoomId,poly:l}}return console.error("".concat(e.name,": getOpenDoorArea failed to get context"),{gmIndex:n,doorIndex:t,hullDoorIndex:i}),null}},{key:"getOpenWindowPolygon",value:function(n,t){var e=this.gms[n],r=e.windows[t],o=e.roomGraph.getAdjacentRooms(e.roomGraph.getWindowNode(t));return m.LA.union(o.map((function(n){return e.rooms[n.roomId]})).concat(r.poly))[0]}},{key:"computeLightPolygons",value:function(n,t,e){var o=this,i=this.gms[n],a=i.roomGraph.nodesArray[t],c=i.roomGraph.getEnterableRooms(a,e),s=c.map((function(n){return n.doorId})),u=c.flatMap((function(a){var c,u=a.doorId,d=a.roomId;return[{roomId:t,area:o.getOpenDoorArea(n,u)}].concat((0,r.Z)(((null===(c=i.extendDoorId)||void 0===c?void 0:c[u])||[]).filter((function(n){return e.includes(n)&&!s.includes(n)})).map((function(t){return{roomId:d,area:o.getOpenDoorArea(n,t)}}))))})).flatMap((function(n){var t,e=n.roomId,r=n.area;if(!r)return[];var a=o.gms[r.gmId].doors,c=a.filter((function(n,t){return t!==r.doorId})).map((function(n){return n.seg})),s=(null===(t=i.point.light[e])||void 0===t?void 0:t[r.doorId])||(0,h.AR)(a[r.doorId],e,x.Vx);return{gmIndex:r.gmId,poly:v.J.lightPolygon({position:s,range:2e3,exterior:r.poly,extraSegs:c})}})),d=i.roomGraph.getAdjacentWindows(a).filter((function(n){var e=i.windows[n.windowIndex];return!e.tags.includes("frosted")&&(!e.tags.includes("one-way")||e.roomIds[0]===t)})).map((function(n){return n.windowIndex})).map((function(e){return{gmIndex:n,poly:v.J.lightPolygon({position:(0,h.AR)(i.windows[e],t,x.dY),range:1e3,exterior:o.getOpenWindowPolygon(n,e)})}}));return[].concat((0,r.Z)(u),(0,r.Z)(d))}}],[{key:"computeHullDoorDirection",value:function(n,t,e){var r=n.tags.find((function(n){return/^hull\-[nesw]$/.test(n)}));if(r){var o=r.slice(-1),i=v.e.indexOf(o),a={x:e[0],y:e[1]},c={x:e[2],y:e[3]};if(1===a.x){if(1===c.y)return i;if(-1===c.y)return v.J.getFlippedDirection(i,"x")}else if(1===a.y){if(1===c.x)return v.J.getFlippedDirection(v.J.getDeltaDirection(i,2),"y");if(-1===a.x)return v.J.getDeltaDirection(i,1)}else if(-1===a.x){if(1===c.y)return v.J.getFlippedDirection(i,"y");if(-1===c.y)return v.J.getDeltaDirection(i,2)}else if(-1===a.y){if(1===c.x)return v.J.getDeltaDirection(i,3);if(-1===c.x)return v.J.getFlippedDirection(v.J.getDeltaDirection(i,3),"y")}(0,y.vU)("hullDoor ".concat(t,": ").concat(r,': failed to parse transform "').concat(e,'"'))}else(0,y.vU)("hullDoor ".concat(t,': expected tag "hull-{n,e,s,w}" in hull door'));return null}},{key:"fromGms",value:function(n){var t=this,i=new e(n),a=[].concat((0,r.Z)(n.map((function(n,t){return{type:"gm",gmKey:n.key,gmIndex:t,id:R(n.key,n.transform),transform:n.transform}}))),(0,r.Z)(n.flatMap((function(n,e){var r=n.key,o=n.hullDoors,i=n.transform,a=n.pngRect,c=n.doors;return o.map((function(n,o){var s=n.poly.center.addScaledVector(n.normal,20),u=a.contains(s),d=t.computeHullDoorDirection(n,o,i);return{type:"door",gmKey:r,gmId:e,id:j(r,i,o),doorId:c.indexOf(n),hullDoorId:o,transform:i,gmInFront:u,direction:d,sealed:!0}}))}))));i.registerNodes(a),a.forEach((function(t){if("door"===t.type){var e=n[t.gmId],r=e.matrix,o=e.doors,a=o[t.doorId].roomIds.findIndex((function(n){return null!==n})),c=o[t.doorId].entries[a];i.entry.set(t,r.transformPoint(c.clone()))}}));var c=n.flatMap((function(n){var t=n.key,e=n.hullDoors,r=n.transform,o=R(t,r);return e.map((function(n,e){return{src:o,dst:j(t,r,e)}}))})),s=n.flatMap((function(t,e){var r=n.filter((function(n,r){return r!==e&&n.gridRect.intersects(t.gridRect)})),a=new m.UL,c=new m.UL,s=new m._3,u=new m._3;return t.hullDoors.flatMap((function(n,e){var d=j(t.key,t.transform,e);s.setMatrixValue(t.transform),a.copy(n.poly.rect.applyMatrix(s));var l=r.flatMap((function(n){return n.hullDoors.map((function(t){return[n,t]}))})).find((function(n){var t=(0,o.Z)(n,2),e=t[0].transform,r=t[1].poly;return a.intersects(c.copy(r.rect.applyMatrix(u.setMatrixValue(e))))}));if(void 0!==l){var f=(0,o.Z)(l,2),p=f[0],m=f[1],g=p.hullDoors.indexOf(m),v=j(p.key,p.transform,g);return i.getDoorNode(d).sealed=!1,{src:d,dst:v}}return[]}))}));return[].concat((0,r.Z)(c),(0,r.Z)(s)).forEach((function(n){var t=n.src,e=n.dst;t&&e&&(i.connect({src:t,dst:e}),i.connect({src:e,dst:t}))})),i}}]),e}(g.b);function R(n,t){return"gm-".concat(n,"-[").concat(t,"]")}function j(n,t,e){return"door-".concat(n,"-[").concat(t,"]-").concat(e)}var O=e(95814);function k(n){var t=i.useState((function(){return n.map((function(n){return n.layoutKey}))})),e=(0,o.Z)(t,2),c=e[0],s=e[1];i.useMemo((function(){var t=n.map((function(n){return n.layoutKey})).filter((function(n){return!c.includes(n)}));t.length&&s([].concat((0,r.Z)(c),(0,r.Z)(t)))}),[n]);var u=c.map((function(n){return(0,O.Z)(n)})),d=n.every((function(n){return c.includes(n.layoutKey)}))&&u.every((function(n){return n.data}));return i.useMemo((function(){if(d){var t=n.map((function(n){var t=c.findIndex((function(t){return t===n.layoutKey})),e=(0,a.Nh)(u[t].data),r=n.transform||[1,0,0,1,0,0];return(0,h.OQ)(e,r)}));return{gms:t,gmGraph:D.fromGms(t)}}return{gms:[],gmGraph:new D([])}}),[d].concat((0,r.Z)(u.map((function(n){return n.data})))))}},87079:function(n,t,e){e.d(t,{Z:function(){return D}});var r,o,i=e(52209),a=e(79056),c=e(30266),s=e(97131),u=e(809),d=e.n(u),l=e(67294),f=e(94184),p=e.n(f),m=e(88269),g=e(16716),v=e(73460),h=e(84175),y=e(48103),x=e(44275),I=e(85893);function w(n,t){var e="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=function(n,t){if(!n)return;if("string"===typeof n)return b(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);"Object"===e&&n.constructor&&(e=n.constructor.name);if("Map"===e||"Set"===e)return Array.from(n);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return b(n,t)}(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return a=n.done,n},e:function(n){c=!0,i=n},f:function(){try{a||null==e.return||e.return()}finally{if(c)throw i}}}}function b(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function D(n){var t=(0,x.Z)((function(){return{ready:!0,parent:{},translateRoot:{},scaleRoot:{},panning:!1,opts:{minScale:.05,maxScale:10,step:.05,idleMs:200},pointers:[],origin:void 0,scale:1,start:{clientX:void 0,clientY:void 0,scale:1,distance:0},x:0,y:0,events:new g.x,idleTimeoutId:0,transitionTimeoutId:0,anims:[null,null],worldPointerDown:new y.dl,evt:{wheel:function(n){t.delayIdle(),t.animationAction("cancel"),t.zoomWithWheel(n)},pointerdown:function(n){t.delayIdle(),t.animationAction("cancel"),O(t.pointers,n),t.panning=!0,t.origin=new y.dl(t.x,t.y);var e=k(t.pointers);t.start={clientX:e.clientX,clientY:e.clientY,scale:t.scale,distance:Z(t.pointers)},t.worldPointerDown.copy(t.getWorld(n))},pointermove:function(n){if(void 0!==t.origin&&void 0!==t.start.clientX&&void 0!==t.start.clientY){t.delayIdle(),O(t.pointers,n);var e=k(t.pointers);if(t.pointers.length>1){0===t.start.distance&&(t.start.distance=Z(t.pointers));var r=Z(t.pointers)-t.start.distance,o=3*t.opts.step,i=Math.min(Math.max(r*o/80+t.start.scale,t.opts.minScale),t.opts.maxScale);t.zoomToClient(i,e)}else{var a=t.origin.x+(e.clientX-t.start.clientX)/t.scale,c=t.origin.y+(e.clientY-t.start.clientY)/t.scale;t.x===a&&t.y===c||(t.x=a,t.y=c,t.setStyles())}}},pointerup:function(n){if(function(n,t){if(t.touches){for(;n.length;)n.pop();return}var e=n.findIndex((function(n){return n.pointerId===t.pointerId}));e>-1&&n.splice(e,1)}(t.pointers,n),t.panning){var e=t.getWorld(n);t.events.next({key:"pointerup",point:e,distance:t.worldPointerDown.distanceTo(e),tags:(n.target.getAttribute("data-tags")||"").split(" ")}),t.panning=!1,t.origin=t.start.clientX=t.start.clientY=void 0}}},animationAction:function(n){if(t.anims[0])switch(n){case"cancel":t.syncStyles(),t.anims.forEach((function(n){return null===n||void 0===n?void 0:n.cancel()})),t.anims=[null,null];break;case"pause":t.anims.forEach((function(n){return null===n||void 0===n?void 0:n.pause()}));break;case"play":t.anims.forEach((function(n){return null===n||void 0===n?void 0:n.play()}));break;default:throw(0,h.Ql)(n)}},computePathKeyframes:function(n){var e=t.getWorldAtCenter(),r=n.map((function(t,r){return Number(t.distanceTo(0===r?e:n[r-1]).toFixed(2))})),o=t.parent.getBoundingClientRect(),i=o.width,a=o.height,c=t.getCurrentTransform(),u=r.reduce((function(n,t){return n+t}),0),d=0;return{keyframes:[{offset:0,transform:"translate(".concat(c.x,"px, ").concat(c.y,"px)")}].concat((0,s.Z)(r.map((function(t,e){return{offset:(d+=t)/u,transform:"translate(".concat(i/2-c.scale*n[e].x,"px, ").concat(a/2-c.scale*n[e].y,"px)")}})))),distance:u}},delayIdle:function(){t.idleTimeoutId&&window.clearTimeout(t.idleTimeoutId),t.idleTimeoutId=window.setTimeout(t.idleTimeout,t.opts.idleMs)},distanceTo:function(n){return n.distanceTo(t.getWorldAtCenter())},followPath:function(n,e){return(0,c.Z)(d().mark((function r(){var o,i,a,c,s;return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.animScaleFactor,t.animationAction("cancel"),i=t.computePathKeyframes(n),a=i.keyframes,c=i.distance,s=c*o,t.anims[0]=t.translateRoot.animate(a,{duration:s,direction:"normal",fill:"forwards",easing:"linear"}),r.next=7,new Promise((function(n,e){var r=t.anims[0];r.addEventListener("finish",(function(){n("completed")})),r.addEventListener("cancel",(function(){e("cancelled")}))}));case 7:case"end":return r.stop()}}),r)})))()},getCurrentTransform:function(){var n=t.parent.getBoundingClientRect(),e=t.translateRoot.getBoundingClientRect();return{x:e.x-n.x,y:e.y-n.y,scale:t.scaleRoot.getBoundingClientRect().width}},getWorld:function(n){var e=t.parent.getBoundingClientRect(),r=n.clientX-e.left,o=n.clientY-e.top,i=t.getCurrentTransform();return{x:(r-i.x)/i.scale,y:(o-i.y)/i.scale}},getWorldAtCenter:function(){var n=t.parent.getBoundingClientRect(),e=t.getCurrentTransform();return{x:(n.width/2-e.x)/e.scale,y:(n.height/2-e.y)/e.scale}},idleTimeout:function(){0===t.pointers.length?(t.idleTimeoutId=0,t.events.next({key:"ui-idle"})):t.delayIdle()},isIdle:function(){return 0===t.idleTimeoutId},panZoomTo:function(n,e,r,o){return(0,c.Z)(d().mark((function i(){var a,c,s,u,l,f;return d().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n=n||t.scale,e=e||t.getWorldAtCenter(),o=o||"ease",t.animationAction("cancel"),a=t.parent.getBoundingClientRect(),c=a.width,s=a.height,u=c/2-n*e.x,l=s/2-n*e.y,f=t.getCurrentTransform(),t.anims[0]=t.translateRoot.animate([{offset:0,transform:"translate(".concat(f.x,"px, ").concat(f.y,"px)")},{offset:1,transform:"translate(".concat(u,"px, ").concat(l,"px)")}],{duration:r,direction:"normal",fill:"forwards",easing:o}),n!==f.scale&&(t.anims[1]=t.scaleRoot.animate([{offset:0,transform:"scale(".concat(f.scale,")")},{offset:1,transform:"scale(".concat(n,")")}],{duration:r,direction:"normal",fill:"forwards",easing:o})),i.next=12,new Promise((function(n,e){var r=t.anims[0];r.addEventListener("finish",(function(){n("completed"),t.events.next({key:"completed-panzoom-to"})})),r.addEventListener("cancel",(function(){e("cancelled"),t.events.next({key:"cancelled-panzoom-to"})}))}));case 12:case"end":return i.stop()}}),i)})))()},rootRef:function(n){n&&(t.parent=n.parentElement,t.translateRoot=n,t.scaleRoot=n.children[0],t.parent.addEventListener("wheel",(function(n){return t.evt.wheel(n)})),t.parent.addEventListener("pointerdown",(function(n){return t.evt.pointerdown(n)})),t.parent.addEventListener("pointermove",(function(n){return t.evt.pointermove(n)})),t.parent.addEventListener("pointerup",(function(n){return t.evt.pointerup(n)})),t.parent.addEventListener("pointerleave",(function(n){return t.evt.pointerup(n)})),t.parent.addEventListener("pointercancel",(function(n){return t.evt.pointerup(n)})))},syncStyles:function(){Object.assign(t,t.getCurrentTransform()),t.setStyles()},setStyles:function(){t.translateRoot.style.transform="translate(".concat(t.x,"px, ").concat(t.y,"px)"),t.scaleRoot.style.transform="scale(".concat(t.scale,")")},zoomToClient:function(n,e){var r=t.parent.getBoundingClientRect(),o=e.clientX-r.left,i=e.clientY-r.top,a=(o-t.x)/t.scale,c=(i-t.y)/t.scale;t.x=o-a*n,t.y=i-c*n,t.scale=n,t.setStyles()},zoomWithWheel:function(n){n.preventDefault();var e=(0===n.deltaY&&n.deltaX?n.deltaX:n.deltaY)<0?1:-1,r=Math.min(Math.max(t.scale*Math.exp(e*t.opts.step*.5/3),t.opts.minScale),t.opts.maxScale);t.zoomToClient(r,n)}}}),{deeper:["evt"]});l.useEffect((function(){var e;null===(e=n.onLoad)||void 0===e||e.call(n,t),t.setStyles(),t.panZoomTo(n.initZoom||1,n.initCenter||{x:0,y:0},1e3)}),[]);var e=(0,v.Z)({debounce:30,scroll:!1}),r=(0,a.Z)(e,2),o=r[0],i=r[1];return l.useEffect((function(){i.width&&i.height&&t.events.next({key:"resized-bounds",bounds:{x:i.x,y:i.y,width:i.width,height:i.height}})}),[i.width,i.height]),(0,I.jsx)("div",{className:p()("panzoom-parent",R,j(n)),"data-tags":"no-ui",ref:o,children:(0,I.jsx)("div",{ref:t.rootRef,className:p()("panzoom-translate",n.className),children:(0,I.jsxs)("div",{className:"panzoom-scale",children:[(0,I.jsx)("div",{className:"origin"}),n.children,n.grid&&(0,I.jsx)("div",{className:"small-grid"}),n.grid&&(0,I.jsx)("div",{className:"large-grid"})]})})})}var R=(0,m.iv)(r||(r=(0,i.Z)(["\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  user-select: none;\n  /** This is important for mobile to prevent scrolling while panning */\n  touch-action: none;\n  cursor: auto;\n  \n  .panzoom-translate {\n    width: 0;\n    height: 0;\n    user-select: none;\n    touch-action: none;\n    transform-origin: 0 0;\n    \n    .panzoom-scale {\n      /** So can infer scale during CSS animation via getBoundingClientRect().width */\n      width: 1px;\n      height: 1px;\n      transform-origin: 0 0;\n    }\n\n    .small-grid, .large-grid {\n      position: absolute;\n      pointer-events: none;\n      left: ","px;\n      top: ","px;\n      width: ","px;\n      height: ","px;\n    }\n    .small-grid {\n      background-image:\n        linear-gradient(to right, rgba(200, 200, 200, 0.08) 1px, transparent 1px),\n        linear-gradient(to bottom, rgba(200, 200, 200, 0.08) 1px, transparent 1px);\n        background-size: 10px 10px;\n      }\n      .large-grid {\n      background-image:\n        linear-gradient(to right, rgba(200, 200, 200, 0.15) 1px, transparent 1px),\n        linear-gradient(to bottom, rgba(200, 200, 200, 0.15) 1px, transparent 1px);\n      background-size: 60px 60px;\n    }\n    .origin {\n      position: absolute;\n    }\n  }\n"])),-3600,-3600,7200,7200),j=function(n){return(0,m.iv)(o||(o=(0,i.Z)(["\n  background-color: ",";\n"])),n.dark?"#000":"#fff")};function O(n,t){var e;if(t.touches){e=0;var r,o=w(t.touches);try{for(o.s();!(r=o.n()).done;){var i=r.value;i.pointerId=e++,O(n,i)}}catch(a){o.e(a)}finally{o.f()}}else(e=n.findIndex((function(n){return n.pointerId===t.pointerId})))>-1&&n.splice(e,1),n.push(t)}function k(n){for(var t,e=(n=n.slice(0)).pop();t=n.pop();)e={clientX:(t.clientX-e.clientX)/2+e.clientX,clientY:(t.clientY-e.clientY)/2+e.clientY};return e}function Z(n){if(n.length<2)return 0;var t=n[0],e=n[1];return Math.sqrt(Math.pow(Math.abs(e.clientX-t.clientX),2)+Math.pow(Math.abs(e.clientY-t.clientY),2))}}}]);