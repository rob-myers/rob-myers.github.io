"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4366],{24366:function(t,e,r){r.r(e),r.d(e,{default:function(){return q}});var a=r(79056),o=r(97131),n=r(52209),i=r(59748),s=r(88269),l=r(95090),c=r(36694),d=r(91441),p=r(48103),g=r(27375),f=r(44275),u=r(97301),m=r(87079),h=r(30245),y=r(94184),b=r.n(y),x=r(7008),k=r(2026),v=r(84175),w=r(19964);var N,Z,P=JSON.parse('{"HB":{"idle":{"animName":"idle","aabb":{"x":1,"y":5,"width":51,"height":26},"frames":[[{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":13.01,"cy":12.141,"rx":2.543,"ry":4.334},{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":35.357,"cy":9.867,"rx":2.543,"ry":4.334},{"tags":["body"],"transform":[0.996287,-0.086089,0.086089,0.996287,-1.555586,2.295072],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9","pointer-events":"auto"},"tagName":"path","d":"M 50.101 18.756 C 50.101 21.697 49.323 24.884 46.299 26.669 C 37.059 32.124 9.907 27.894 6.553 26.184 C 3.203 24.476 1.563 21.31 1.563 18.756 C 1.563 15.979 2.322 11.997 6.231 10.438 C 10.708 8.652 18.808 9.489 25.963 9.489 C 32.686 9.489 40.378 9.386 44.74 10.968 C 49.074 12.54 50.101 15.787 50.101 18.756 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-460.694993,48.039796],"style":{"fill":"rgb(255, 255, 255)","stroke-opacity":"0.5","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.552,"ry":10.94},{"tags":["head"],"transform":[-1,0,0,-1,0,0],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":-25.337,"cy":-18.048,"rx":9.093,"ry":11.127},{"tags":["hair"],"style":{"stroke":"rgb(203, 126, 12)","stroke-width":"0.5px","fill":"rgb(230, 167, 72)"},"tagName":"ellipse","cx":25.337,"cy":19.048,"rx":10.001,"ry":11.127}]]},"walk":{"animName":"walk","aabb":{"x":1,"y":0,"width":49,"height":37},"frames":[[{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":34.283,"cy":11.094,"rx":2.543,"ry":4.334},{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":14.283,"cy":11.094,"rx":2.543,"ry":4.334},{"tags":["body"],"transform":[0.999847,0.017476,-0.017476,0.999847,0.322512,-0.438486],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 48.906 16.715 C 48.906 22.672 39.294 27.928 25.891 27.928 C 12.488 27.928 1.593 24.404 1.593 18.447 C 1.593 12.49 12.562 8.539 25.965 8.539 C 39.368 8.539 48.906 10.758 48.906 16.715 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-461.086931,46.676881],"style":{"fill":"rgb(255, 255, 255)","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.082,"ry":11.097},{"tags":["head"],"style":{"fill-opacity":"0.5","stroke-opacity":"0.5","stroke-width":"0.25px","fill":"rgb(244, 212, 255)","stroke":"rgb(0, 0, 0)"},"tagName":"path","d":"M 35.338 17.202 C 35.338 23.332 30.722 28.301 25.028 28.301 C 19.334 28.301 14.718 23.332 14.718 17.202 C 14.718 11.072 19.334 6.103 25.028 6.103 C 30.722 6.103 35.338 11.072 35.338 17.202 Z"},{"tags":["hair"],"style":{"stroke-width":"0.35px","fill":"rgb(230, 167, 72)","stroke":"rgb(203, 126, 12)"},"tagName":"ellipse","cx":25.028,"cy":18.202,"rx":10.31,"ry":11.099}],[{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":13.064,"cy":32.06,"rx":2.692,"ry":1.912},{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":34.283,"cy":8.094,"rx":2.543,"ry":4.334},{"tags":["hand-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":7.952,"cy":5.122,"rx":2.389,"ry":4.334},{"tags":["leg-l"],"style":{"stroke":"rgb(0, 0, 0)","stroke-width":"0.5px","fill":"rgb(39, 79, 4)"},"tagName":"path","d":"M 10.377 32.072 L 15.679 31.832 L 15.981 24.627 L 9.523 24.791 L 10.377 32.072 Z"},{"tags":["arm-l"],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 5.808 4.315 L 9.984 4.232 L 11.426 17.64 L 2.216 17.64 L 5.808 4.315 Z"},{"tags":["hand-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":45.093,"cy":26.058,"rx":2.389,"ry":4.334},{"tags":["arm-r"],"transform":[-1,0,0,-1,90.183002,43.816],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 43.189 16.521 L 47.003 16.318 L 48.483 27.444 L 41.7 27.498 L 43.189 16.521 Z"},{"tags":["body"],"transform":[0.996287,-0.086089,0.086089,0.996287,-1.475964,2.241398],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 48.906 16.715 C 48.906 22.672 39.294 27.928 25.891 27.928 C 12.488 27.928 1.593 24.404 1.593 18.447 C 1.593 12.49 12.562 8.539 25.965 8.539 C 39.368 8.539 48.906 10.758 48.906 16.715 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-461.086931,46.676881],"style":{"fill":"rgb(255, 255, 255)","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.082,"ry":11.097},{"tags":["head"],"style":{"fill-opacity":"0.5","stroke-opacity":"0.5","stroke-width":"0.25px","fill":"rgb(244, 212, 255)","stroke":"rgb(0, 0, 0)"},"tagName":"path","d":"M 35.338 17.202 C 35.338 23.332 30.722 28.301 25.028 28.301 C 19.334 28.301 14.718 23.332 14.718 17.202 C 14.718 11.072 19.334 6.103 25.028 6.103 C 30.722 6.103 35.338 11.072 35.338 17.202 Z"},{"tags":["hair"],"style":{"stroke-width":"0.35px","fill":"rgb(230, 167, 72)","stroke":"rgb(203, 126, 12)"},"tagName":"ellipse","cx":25.028,"cy":18.202,"rx":10.31,"ry":11.099}],[{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":15.952,"cy":6.815,"rx":2.692,"ry":2.312},{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":36.896,"cy":33.713,"rx":2.543,"ry":1.398},{"tags":["hand-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":5.09,"cy":28.291,"rx":2.767,"ry":2.202},{"tags":["leg-r"],"style":{"stroke":"rgb(0, 0, 0)","stroke-width":"0.5px","fill":"rgb(39, 79, 4)"},"tagName":"path","d":"M 34.27 33.567 L 39.572 33.327 L 39.874 26.122 L 33.416 26.286 L 34.27 33.567 Z"},{"tags":["arm-l"],"transform":[-1,0,0,-1,12.878001,43.071],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 5.394 14.574 L 10.256 15.696 L 10.975 28.278 L 1.903 28.497 L 5.394 14.574 Z"},{"tags":["hand-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":42.225,"cy":4.274,"rx":2.603,"ry":2.906},{"tags":["arm-r"],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 39.894 4.415 L 44.514 4.462 L 48.025 17.517 L 39.214 12.746 L 39.894 4.415 Z"},{"tags":["body"],"transform":[0.983224,0.182401,-0.182401,0.983224,3.775767,-4.293457],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 49.031 16.812 C 49.031 22.964 39.419 28.393 26.016 28.393 C 12.613 28.393 1.427 24.65 1.427 18.497 C 1.427 12.345 12.687 8.367 26.09 8.367 C 39.493 8.367 49.031 10.659 49.031 16.812 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-460.896837,46.145188],"style":{"fill":"rgb(255, 255, 255)","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.08,"ry":11.489},{"tags":["head"],"style":{"fill-opacity":"0.5","stroke-opacity":"0.5","stroke-width":"0.25px","fill":"rgb(244, 212, 255)","stroke":"rgb(0, 0, 0)"},"tagName":"path","d":"M 35.578 17.163 C 35.578 23.293 30.962 28.262 25.268 28.262 C 19.574 28.262 14.958 23.293 14.958 17.163 C 14.958 11.034 19.574 6.064 25.268 6.064 C 30.962 6.064 35.578 11.034 35.578 17.163 Z"},{"tags":["hair"],"style":{"stroke-width":"0.35px","fill":"rgb(230, 167, 72)","stroke":"rgb(203, 126, 12)"},"tagName":"ellipse","cx":25.081,"cy":18.017,"rx":10.31,"ry":11.004}]]}},"sP":2}'),I=r(8311);function C(t){var e=(0,g.Z)(),r=function(t,e){var r=i.default.useState((function(){return t.gms.map((function(t){return t.key}))})),n=(0,a.Z)(r,2),s=n[0],l=n[1];i.default.useMemo((function(){var e=t.gms.map((function(t){return t.key})).filter((function(t){return!s.includes(t)}));e.length&&l([].concat((0,o.Z)(s),(0,o.Z)(e)))}),[t]);var c=s.map((function(r){return(0,w.Z)(r,t.gmData[r],e)})),d=t.gms.every((function(t){return s.includes(t.key)}))&&c.every((function(t){return t.data}));return i.default.useMemo((function(){return d?{pfs:t.gms.map((function(t){var e=s.findIndex((function(e){return e===t.key}));return(0,v.Nh)(c[e].data)}))}:{pfs:[]}}),[d])}(t.gmGraph,t.disabled),n=(0,f.Z)((function(){return{npc:{},debugPath:{},getGlobalNavPath:function(e,r){var a=t.gmGraph.gms,o=a.findIndex((function(t){return t.gridRect.contains(e)})),i=a.findIndex((function(t){return t.gridRect.contains(r)}));if(-1===o||-1===i)return(0,k.vU)("getGlobalNavPath: src/dst must be inside some geomorph's aabb"),null;if(o===i)return{paths:[n.getLocalNavPath(o,e,r)],edges:[]};var s=t.gmGraph.findPath(e,r);if(!s)return(0,k.vU)("getGlobalNavPath: gmGraph.findPath not found: ".concat(JSON.stringify(e)," -> ").concat(JSON.stringify(r))),null;for(var l=[],c=0;c<s.length+1;c++)0===c?l[c]=n.getLocalNavPath(o,e,s[0].src.exit):c===s.length?l[c]=n.getLocalNavPath(i,s[c-1].dst.entry,r):l[c]=n.getLocalNavPath(s[c-1].dst.gmId,s[c-1].dst.entry,s[c].src.exit);return{paths:l,edges:s}},getLocalNavPath:function(e,a,o){var n=t.gmGraph.gms[e],i=r.pfs[e],s=n.inverseMatrix.transformPoint(p.dl.from(a)),l=n.inverseMatrix.transformPoint(p.dl.from(o)),c=i.graph.findPath(s,l);return c?[p.dl.from(s)].concat(c.normalisedPaths.flatMap((function(t){return t}))).map((function(t){return n.matrix.transformPoint(t).precision(2)})):[]},moveNpcAlongPath:function(t,e){t.origPath=e.map(p.dl.from),t.animPath=t.origPath.slice(),t.updateAnimAux(),t.followNavPath()},npcRef:function(t){if(t){var e=t.getAttribute("data-npc-key"),r=n.npc[e];r.el.root=t,r.el.body=t.childNodes[0],r.el.root.style.transform="translate(".concat(r.def.position.x,"px, ").concat(r.def.position.y,"px)"),r.el.body.style.transform="scale(".concat(G,")")}}}}),{deps:[r,t.doorsApi]});return i.default.useEffect((function(){var r=(0,x.f)(t.wireKey),a=r.subscribe((function(a){if("spawn"===a.key){var i={key:a.npcKey,uid:"".concat(a.npcKey,"-").concat(++L),def:{key:a.npcKey,position:a.at,angle:Math.PI/4,paused:!!t.disabled},el:{root:{},body:{}},anim:{root:new Animation,body:new Animation},animPath:[],aux:{angs:[],count:0,edges:[],elens:[],navPathPolys:[],sofars:[],total:0},origPath:[],spriteSheetState:"idle",followNavPath:function(){var t=this.aux;if(!(this.animPath.length<=1||0===t.total)){var e="paused"===this.anim.root.playState;this.anim.root=this.el.root.animate(this.animPath.flatMap((function(e,r){return[{offset:t.sofars[r]/t.total,transform:"translate(".concat(e.x,"px, ").concat(e.y,"px) rotateZ(").concat(t.angs[r-1]||t.angs[r]||0,"rad)")},{offset:t.sofars[r]/t.total,transform:"translate(".concat(e.x,"px, ").concat(e.y,"px) rotateZ(").concat(t.angs[r]||t.angs[r-1]||0,"rad)")}]})),{duration:15*t.total,direction:"normal",fill:"forwards"}),(e||0===t.count&&this.def.paused)&&this.pause(),t.count++}},getAngle:function(){var t=new DOMMatrixReadOnly(window.getComputedStyle(this.el.root).transform);return Math.atan2(t.m12,t.m11)},getPosition:function(){var e=p.dl.from(this.el.root.getBoundingClientRect()),r=e.x,a=e.y;return p.dl.from(t.panZoomApi.getWorld({clientX:r,clientY:a}))},pause:function(){"running"===this.anim.body.playState&&this.anim.body.pause()},updateAnimAux:function(){var t=this.animPath,e=this.aux;e.edges=t.map((function(e,r){return{p:e,q:t[r+1]}})).slice(0,-1),e.angs=e.edges.map((function(t){return Number(Math.atan2(t.q.y-t.p.y,t.q.x-t.p.x).toFixed(2))})),e.elens=e.edges.map((function(t){var e=t.p,r=t.q;return Number(e.distanceTo(r).toFixed(2))})),e.navPathPolys=e.edges.map((function(t){var e=t.q.clone().sub(t.p).rotate(Math.PI/2).normalize(.01);return new p.LA([t.p.clone().add(e),t.q.clone().add(e),t.q.clone().sub(e),t.p.clone().sub(e)])}));var r=e.elens.reduce((function(t,e){return t.total+=e,t.sofars.push(t.sofars[t.sofars.length-1]+e),t}),{sofars:[0],total:0}),a=[r.sofars,r.total];e.sofars=a[0],e.total=a[1]}};n.npc[a.npcKey]=i,e()}else if("nav-req"===a.key){var s=n.npc[a.npcKey],l=n.getGlobalNavPath(s.getPosition(),a.dst);r.next({key:"nav-res",req:a,res:l})}else if("move-req"===a.key){var c=n.npc[a.npcKey],d=n.moveNpcAlongPath(c,a.path);r.next({key:"move-res",req:a,res:d})}else if("debug-path"===a.key){var g=a.path.map(p.dl.from);n.debugPath[a.pathName]={path:g,aabb:p.UL.from.apply(p.UL,(0,o.Z)(g)).outset(10)},e()}}));return function(){return a.unsubscribe()}}),[t.panZoomApi]),(0,I.BX)(I.HY,{children:[(0,I.tZ)("div",{className:b()("npcs",M),children:Object.values(n.npc).map((function(t){return(0,I.tZ)("div",{"data-npc-key":t.key,className:b()("npc",t.key,t.spriteSheetState,K),ref:n.npcRef,children:(0,I.tZ)("div",{className:b()("body",t.key,"no-select")})},t.uid)}))}),(0,I.tZ)(S,{debugPath:n.debugPath})]})}var A,L=0,M=(0,s.iv)(N||(N=(0,n.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"]))),R=P.HB,O=P.sP,G=.18,K=(0,s.iv)(Z||(Z=(0,n.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    transform: scale(0.18);\n    pointer-events: all;\n    filter: grayscale(100%);\n  }\n  \n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 300ms steps(",") infinite;\n    background: url('/npc/first-npc--walk.png');\n  }\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: idle 2s steps(",") infinite;\n    background: url('/npc/first-npc--idle.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n"])),R.walk.aabb.width*O,R.walk.aabb.height*O,-R.walk.aabb.width*O*.5,-R.walk.aabb.height*O*.5,R.walk.frames.length,R.idle.aabb.width*O,R.idle.aabb.height*O,-R.idle.aabb.width*O*.5,-R.idle.aabb.height*O*.5,R.idle.frames.length,-R.walk.frames.length*R.walk.aabb.width*O,-R.idle.frames.length*R.idle.aabb.width*O);function S(t){return(0,I.tZ)(I.HY,{children:Object.entries(t.debugPath).map((function(t){var e=(0,a.Z)(t,2),r=e[0],o=e[1],n=o.path,i=o.aabb;return(0,I.tZ)("svg",{className:"debug-path",width:i.width,height:i.height,style:{position:"absolute",left:i.x,top:i.y},children:(0,I.BX)("g",{style:{transform:"translate(".concat(-i.x,"px, ").concat(-i.y,"px)")},children:[(0,I.tZ)("polyline",{fill:"none",stroke:"blue",strokeWidth:2,points:"".concat(n)}),n.map((function(t){return(0,I.tZ)("circle",{fill:"none",stroke:"red",r:2.5,cx:t.x,cy:t.y})}))]})},r)}))})}function q(t){var e=(0,g.Z)(),r=(0,u.Z)([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]},{layoutKey:"g-302--xboat-repair-bay",transform:[1,0,0,1,-1200,600]},{layoutKey:"g-303--passenger-deck",transform:[1,0,0,-1,-1200,1800]},{layoutKey:"g-302--xboat-repair-bay",transform:[-1,0,0,1,2400,600]},{layoutKey:"g-301--bridge",transform:[1,0,0,-1,0,2400]}]),a=r.gms,o=r.gmGraph,n=(0,f.Z)((function(){return{gmId:0,roomId:9,initOpen:{0:[24]},clipPath:a.map((function(t){return"none"})),doorsApi:{ready:!1},npcsApi:{},panZoomApi:{},wire:new l.x,update:function(){n.updateClipPath(),n.updateVisibleDoors(),e()},updateClipPath:function(){var t=a[n.gmId],e=a.map((function(t){return[]})),r=n.doorsApi.getOpen(n.gmId),i=o.computeLightPolygons(n.gmId,n.roomId,r);a.forEach((function(r,a){var o=i.filter((function(t){return a===t.gmIndex})).map((function(t){return t.poly.precision(2)}));e[a]=r===t?p.LA.cutOut(o.concat(t.roomsWithDoors[n.roomId]),[r.hullOutline]):p.LA.cutOut(o,[r.hullOutline])})),e.forEach((function(t,e){t.forEach((function(t){return t.translate(-a[e].pngRect.x,-a[e].pngRect.y)}));var r=t.map((function(t){return"".concat(t.svgPath)})).join(" ");n.clipPath[e]=r.length?"path('".concat(r,"')"):"none"}))},updateVisibleDoors:function(){var t=this,e=a[n.gmId],r=e.roomGraph.nodesArray[n.roomId],i=a.map((function(t){return[]}));i[n.gmId]=e.roomGraph.getAdjacentDoors(r).map((function(t){return t.doorId})),e.roomGraph.getAdjacentHullDoorIds(e,r).flatMap((function(t){var e=t.hullDoorIndex;return o.getAdjacentRoomCtxt(n.gmId,e)||[]})).forEach((function(t){var e=t.adjGmId,r=t.adjDoorId;return i[e]=[r]})),a.forEach((function(e,r){return t.doorsApi.setVisible(r,i[r])}))}}}),{overwrite:{gmId:!0,roomId:!0},deps:[a,o]});return i.default.useEffect((function(){if(a.length&&n.doorsApi.ready){n.update();var t=n.wire.pipe((0,c.h)((function(t){return"closed-door"===t.key||"opened-door"===t.key}))).subscribe((function(t){n.update()}));return function(){return t.unsubscribe()}}}),[a,n.doorsApi.ready]),a.length?(0,I.BX)(m.Z,{className:D,zoom:.4,dark:!0,wireKey:j,onLoad:function(t){return n.panZoomApi=t},children:[a.map((function(t){return(0,I.tZ)("img",{className:"geomorph",src:(0,d.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}})})),(0,I.tZ)(C,{disabled:t.disabled,doorsApi:n.doorsApi,gmGraph:o,panZoomApi:n.panZoomApi,wireKey:j}),a.map((function(t,e){return(0,I.tZ)("img",{className:"geomorph-dark",src:(0,d.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{clipPath:n.clipPath[e],WebkitClipPath:n.clipPath[e],left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}},e)})),n.doorsApi.ready&&(0,I.tZ)(B,{showIds:!0,gms:a,gmGraph:o,doorsApi:n.doorsApi,gmId:n.gmId,roomId:n.roomId,setRoom:function(t,e){var r=[t,e];n.gmId=r[0],n.roomId=r[1],n.update()}}),(0,I.tZ)(h.Z,{gms:a,gmGraph:o,wire:n.wire,initOpen:n.initOpen,onLoad:function(t){n.doorsApi=t,e()}})]}):null}var j="wire-demo-1",D=(0,s.iv)(A||(A=(0,n.Z)(["\n  img {\n    position: absolute;\n    transform-origin: top left;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) brightness(60%);\n    /* opacity: 0.6; */\n  }\n\n  div.debug {\n    position: absolute;\n    div.debug-door-arrow {\n      cursor: pointer;\n      position: absolute;\n      background-image: url('/icon/solid_arrow-circle-right.svg');\n      border-radius: ","px;\n    }\n    div.debug-door-id-icon, div.debug-room-id-icon {\n      position: absolute;\n      background: black;\n      color: white;\n      font-size: 8px;\n      line-height: 1;\n      border: 1px solid black;\n    }\n    div.debug-room-id-icon {\n      color: #4f4;\n    }\n    div.debug-window {\n      position: absolute;\n      background: #0000ff40;\n      border: 1px solid white;\n      pointer-events: none;\n      transform-origin: top left;\n    }\n    svg.debug-room-nav {\n      position: absolute;\n      path.nav-poly {\n        pointer-events: none;\n        fill: rgba(255, 0, 0, 0.1);\n        stroke: blue;\n      }\n    }\n  }\n\n"])),5);function B(t){var e=t.gms[t.gmId],r=t.doorsApi.getVisible(t.gmId),n=e.lazy.roomNavPoly[t.roomId],i=p.UL.from.apply(p.UL,(0,o.Z)(n.map((function(t){return t.rect}))));return(0,I.BX)("div",{onClick:function(r){var o=r.target.getAttribute("data-debug-door-index");if(null!==o){var n=e.doors[Number(o)],i=n.roomIds.filter((function(e){return e!==t.roomId})),s=(0,a.Z)(i,1)[0];if(null!==s)return t.setRoom(t.gmId,s);var l=e.hullDoors.indexOf(n),c=t.gmGraph.getAdjacentRoomCtxt(t.gmId,l);c?t.setRoom(c.adjGmId,c.adjRoomId):console.info("hull door is isolated",t.gmId,l)}},children:[t.outlines&&t.gms.map((function(t,e){return(0,I.tZ)("div",{style:{position:"absolute",left:t.gridRect.x,top:t.gridRect.y,width:t.gridRect.width,height:t.gridRect.height,border:"2px red solid"}},e)})),(0,I.BX)("div",{className:"debug",style:{transform:e.transformStyle},children:[t.localNav&&(0,I.tZ)("svg",{className:"debug-room-nav",width:i.width,height:i.height,style:{left:i.x,top:i.y},children:(0,I.tZ)("g",{style:{transform:"translate(".concat(-i.x,"px, ").concat(-i.y,"px)")},children:n.map((function(t,e){return(0,I.tZ)("path",{className:"nav-poly",d:t.svgPath},e)}))})}),r.map((function(r){var a=e.doors[r],o=a.poly,n=a.normal,i=a.roomIds[0]===t.roomId?1:-1,s=p.dl.from(n).scale(-i).angle,l=o.center.addScaledVector(n,18*i),c=o.center.addScaledVector(n,18*-i);return(0,I.BX)(I.HY,{children:[(0,I.tZ)("div",{"data-debug-door-index":r,className:"debug-door-arrow",style:{left:l.x-5,top:l.y-5,width:10,height:10,transform:"rotate(".concat(s,"rad)")}},r),t.showIds&&(0,I.tZ)("div",{className:"debug-door-id-icon",style:{left:c.x,top:c.y-4},children:r},"icon")]})})),t.showIds&&(0,I.tZ)("div",{className:"debug-room-id-icon",style:{left:i.x,top:i.bottom},children:t.roomId}),t.windows&&e.windows.map((function(t,e){var r=t.rect,a=t.angle;return(0,I.tZ)("div",{className:"debug-window",style:{left:r.x,top:r.y,width:r.width,height:r.height,transform:"rotate(".concat(a,"rad)")}},"window-".concat(e))}))]},e.itemKey)]})}}}]);