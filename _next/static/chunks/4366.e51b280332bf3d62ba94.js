"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4366],{24366:function(t,e,r){r.r(e),r.d(e,{default:function(){return K}});var o=r(79056),n=r(52209),a=r(59748),i=r(88269),l=r(95090),s=r(36694),c=r(91441),p=r(48103),u=r(27375),d=r(44275),f=r(97301),g=r(87079),y=r(30245),h=r(97131),m=r(94184),b=r.n(m),k=r(7008),v=r(18907),x=r(84175),w=r(62985);var Z,N,I=JSON.parse('{"HB":{"idle":{"animName":"idle","aabb":{"x":1,"y":5,"width":51,"height":26},"frames":[[{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":13.01,"cy":12.141,"rx":2.543,"ry":4.334},{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":35.357,"cy":9.867,"rx":2.543,"ry":4.334},{"tags":["body"],"transform":[0.996287,-0.086089,0.086089,0.996287,-1.555586,2.295072],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9","pointer-events":"auto"},"tagName":"path","d":"M 50.101 18.756 C 50.101 21.697 49.323 24.884 46.299 26.669 C 37.059 32.124 9.907 27.894 6.553 26.184 C 3.203 24.476 1.563 21.31 1.563 18.756 C 1.563 15.979 2.322 11.997 6.231 10.438 C 10.708 8.652 18.808 9.489 25.963 9.489 C 32.686 9.489 40.378 9.386 44.74 10.968 C 49.074 12.54 50.101 15.787 50.101 18.756 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-460.694993,48.039796],"style":{"fill":"rgb(255, 255, 255)","stroke-opacity":"0.5","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.552,"ry":10.94},{"tags":["head"],"transform":[-1,0,0,-1,0,0],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":-25.337,"cy":-18.048,"rx":9.093,"ry":11.127},{"tags":["hair"],"style":{"stroke":"rgb(203, 126, 12)","stroke-width":"0.5px","fill":"rgb(230, 167, 72)"},"tagName":"ellipse","cx":25.337,"cy":19.048,"rx":10.001,"ry":11.127}]]},"walk":{"animName":"walk","aabb":{"x":1,"y":0,"width":49,"height":37},"frames":[[{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":34.283,"cy":11.094,"rx":2.543,"ry":4.334},{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":14.283,"cy":11.094,"rx":2.543,"ry":4.334},{"tags":["body"],"transform":[0.999847,0.017476,-0.017476,0.999847,0.322512,-0.438486],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 48.906 16.715 C 48.906 22.672 39.294 27.928 25.891 27.928 C 12.488 27.928 1.593 24.404 1.593 18.447 C 1.593 12.49 12.562 8.539 25.965 8.539 C 39.368 8.539 48.906 10.758 48.906 16.715 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-461.086931,46.676881],"style":{"fill":"rgb(255, 255, 255)","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.082,"ry":11.097},{"tags":["head"],"style":{"fill-opacity":"0.5","stroke-opacity":"0.5","stroke-width":"0.25px","fill":"rgb(244, 212, 255)","stroke":"rgb(0, 0, 0)"},"tagName":"path","d":"M 35.338 17.202 C 35.338 23.332 30.722 28.301 25.028 28.301 C 19.334 28.301 14.718 23.332 14.718 17.202 C 14.718 11.072 19.334 6.103 25.028 6.103 C 30.722 6.103 35.338 11.072 35.338 17.202 Z"},{"tags":["hair"],"style":{"stroke-width":"0.35px","fill":"rgb(230, 167, 72)","stroke":"rgb(203, 126, 12)"},"tagName":"ellipse","cx":25.028,"cy":18.202,"rx":10.31,"ry":11.099}],[{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":13.064,"cy":32.06,"rx":2.692,"ry":1.912},{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":34.283,"cy":8.094,"rx":2.543,"ry":4.334},{"tags":["hand-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":7.952,"cy":5.122,"rx":2.389,"ry":4.334},{"tags":["leg-l"],"style":{"stroke":"rgb(0, 0, 0)","stroke-width":"0.5px","fill":"rgb(39, 79, 4)"},"tagName":"path","d":"M 10.377 32.072 L 15.679 31.832 L 15.981 24.627 L 9.523 24.791 L 10.377 32.072 Z"},{"tags":["arm-l"],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 5.808 4.315 L 9.984 4.232 L 11.426 17.64 L 2.216 17.64 L 5.808 4.315 Z"},{"tags":["hand-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":45.093,"cy":26.058,"rx":2.389,"ry":4.334},{"tags":["arm-r"],"transform":[-1,0,0,-1,90.183002,43.816],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 43.189 16.521 L 47.003 16.318 L 48.483 27.444 L 41.7 27.498 L 43.189 16.521 Z"},{"tags":["body"],"transform":[0.996287,-0.086089,0.086089,0.996287,-1.475964,2.241398],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 48.906 16.715 C 48.906 22.672 39.294 27.928 25.891 27.928 C 12.488 27.928 1.593 24.404 1.593 18.447 C 1.593 12.49 12.562 8.539 25.965 8.539 C 39.368 8.539 48.906 10.758 48.906 16.715 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-461.086931,46.676881],"style":{"fill":"rgb(255, 255, 255)","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.082,"ry":11.097},{"tags":["head"],"style":{"fill-opacity":"0.5","stroke-opacity":"0.5","stroke-width":"0.25px","fill":"rgb(244, 212, 255)","stroke":"rgb(0, 0, 0)"},"tagName":"path","d":"M 35.338 17.202 C 35.338 23.332 30.722 28.301 25.028 28.301 C 19.334 28.301 14.718 23.332 14.718 17.202 C 14.718 11.072 19.334 6.103 25.028 6.103 C 30.722 6.103 35.338 11.072 35.338 17.202 Z"},{"tags":["hair"],"style":{"stroke-width":"0.35px","fill":"rgb(230, 167, 72)","stroke":"rgb(203, 126, 12)"},"tagName":"ellipse","cx":25.028,"cy":18.202,"rx":10.31,"ry":11.099}],[{"tags":["foot-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":15.952,"cy":6.815,"rx":2.692,"ry":2.312},{"tags":["foot-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(0, 255, 0)","stroke-width":"0.5px"},"tagName":"ellipse","cx":36.896,"cy":33.713,"rx":2.543,"ry":1.398},{"tags":["hand-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":5.09,"cy":28.291,"rx":2.767,"ry":2.202},{"tags":["leg-r"],"style":{"stroke":"rgb(0, 0, 0)","stroke-width":"0.5px","fill":"rgb(39, 79, 4)"},"tagName":"path","d":"M 34.27 33.567 L 39.572 33.327 L 39.874 26.122 L 33.416 26.286 L 34.27 33.567 Z"},{"tags":["arm-l"],"transform":[-1,0,0,-1,12.878001,43.071],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 5.394 14.574 L 10.256 15.696 L 10.975 28.278 L 1.903 28.497 L 5.394 14.574 Z"},{"tags":["hand-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","fill":"rgb(244, 212, 255)","stroke-width":"0.25px"},"tagName":"ellipse","cx":42.225,"cy":4.274,"rx":2.603,"ry":2.906},{"tags":["arm-r"],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 39.894 4.415 L 44.514 4.462 L 48.025 17.517 L 39.214 12.746 L 39.894 4.415 Z"},{"tags":["body"],"transform":[0.983224,0.182401,-0.182401,0.983224,3.775767,-4.293457],"style":{"stroke":"rgb(0, 0, 0)","fill-opacity":"0.9"},"tagName":"path","d":"M 49.031 16.812 C 49.031 22.964 39.419 28.393 26.016 28.393 C 12.613 28.393 1.427 24.65 1.427 18.497 C 1.427 12.345 12.687 8.367 26.09 8.367 C 39.493 8.367 49.031 10.659 49.031 16.812 Z"},{"tags":["body-hole"],"transform":[0.981298,-0.192495,0.192495,0.981298,-460.896837,46.145188],"style":{"fill":"rgb(255, 255, 255)","fill-opacity":"0.9"},"tagName":"ellipse","cx":482.933,"cy":64.706,"rx":12.08,"ry":11.489},{"tags":["head"],"style":{"fill-opacity":"0.5","stroke-opacity":"0.5","stroke-width":"0.25px","fill":"rgb(244, 212, 255)","stroke":"rgb(0, 0, 0)"},"tagName":"path","d":"M 35.578 17.163 C 35.578 23.293 30.962 28.262 25.268 28.262 C 19.574 28.262 14.958 23.293 14.958 17.163 C 14.958 11.034 19.574 6.064 25.268 6.064 C 30.962 6.064 35.578 11.034 35.578 17.163 Z"},{"tags":["hair"],"style":{"stroke-width":"0.35px","fill":"rgb(230, 167, 72)","stroke":"rgb(203, 126, 12)"},"tagName":"ellipse","cx":25.081,"cy":18.017,"rx":10.31,"ry":11.004}]]}},"sP":2}'),C=r(8311);function P(t){var e=(0,u.Z)(),r=function(t,e){var r=a.default.useState((function(){return t.gms.map((function(t){return t.key}))})),n=(0,o.Z)(r,2),i=n[0],l=n[1];a.default.useMemo((function(){var e=t.gms.map((function(t){return t.key})).filter((function(t){return!i.includes(t)}));e.length&&l([].concat((0,h.Z)(i),(0,h.Z)(e)))}),[t]);var s=i.map((function(r){var o;return(0,w.Z)(r,null===(o=t.gmDataLookup[r])||void 0===o?void 0:o.navZone,e)})),c=t.gms.every((function(t){return i.includes(t.key)}))&&s.every((function(t){return t.data}));return a.default.useMemo((function(){return c?{pfs:t.gms.map((function(t){var e=i.findIndex((function(e){return e===t.key}));return(0,x.Nh)(s[e].data)}))}:{pfs:[]}}),[c])}(t.gmGraph,t.disabled),n=(0,d.Z)((function(){return{npc:{},debugPath:{},getLocalNavPath:function(e,o,n){var a=t.gmGraph.gms[e].key,i=(r.pfs[e].floorGraph,v.k.findPath(o,p.dl.from(n),a,0));return i?[p.dl.from(o)].concat(i.path):[]},npcRef:function(t){if(t){var e=t.getAttribute("data-npc-key"),r=n.npc[e];r.el.root=t,t.style.left="".concat(r.def.position.x,"px"),t.style.top="".concat(r.def.position.y,"px")}}}}),{deps:[r]});return a.default.useEffect((function(){var r=(0,k.f)(t.wireKey),o=r.subscribe((function(o){if("spawn"===o.key)n.npc[o.npcKey]={key:o.npcKey,uid:"".concat(o.npcKey,"-").concat(++A),def:{key:o.npcKey,position:o.at},spriteSheetState:"idle",el:{root:{}},getPosition:function(){var e=p.dl.from(this.el.root.getBoundingClientRect()),r=e.x,o=e.y;return p.dl.from(t.panZoomApi.getWorld({clientX:r,clientY:o}))}},e();else if("nav-req"===o.key){var a=n.npc[o.npcKey],i=n.getLocalNavPath(0,a.getPosition(),o.dst);i.forEach((function(t){return t.precision(3)})),r.next({key:"nav-res",npcKey:o.npcKey,path:i,req:o})}else if("debug-path"===o.key){var l=o.path.map(p.dl.from);n.debugPath[o.pathName]={path:l,aabb:p.UL.from.apply(p.UL,(0,h.Z)(l)).outset(10)},e()}}));return function(){return o.unsubscribe()}}),[t.panZoomApi]),(0,C.BX)(C.HY,{children:[(0,C.tZ)("div",{className:b()("npcs",L),children:Object.values(n.npc).map((function(t){return(0,C.tZ)("div",{"data-npc-key":t.key,className:b()("npc",t.key,t.spriteSheetState,S),ref:n.npcRef,children:(0,C.tZ)("div",{className:b()("body",t.key,"no-select")})},t.uid)}))}),(0,C.tZ)(E,{debugPath:n.debugPath})]})}var O,A=0,L=(0,i.iv)(Z||(Z=(0,n.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"]))),j=I.HB,R=I.sP,S=(0,i.iv)(N||(N=(0,n.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    transform: scale(0.18);\n    pointer-events: all;\n    filter: grayscale(100%);\n  }\n  \n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 300ms steps(",") infinite;\n    background: url('/npc/first-npc--walk.png');\n  }\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: idle 2s steps(",") infinite;\n    background: url('/npc/first-npc--idle.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n"])),j.walk.aabb.width*R,j.walk.aabb.height*R,-j.walk.aabb.width*R*.5,-j.walk.aabb.height*R*.5,j.walk.frames.length,j.idle.aabb.width*R,j.idle.aabb.height*R,-j.idle.aabb.width*R*.5,-j.idle.aabb.height*R*.5,j.idle.frames.length,-j.walk.frames.length*j.walk.aabb.width*R,-j.idle.frames.length*j.idle.aabb.width*R);function E(t){return(0,C.tZ)(C.HY,{children:Object.entries(t.debugPath).map((function(t){var e=(0,o.Z)(t,2),r=e[0],n=e[1],a=n.path,i=n.aabb;return(0,C.tZ)("svg",{className:"debug-path",width:i.width,height:i.height,style:{position:"absolute",left:i.x,top:i.y},children:(0,C.BX)("g",{style:{transform:"translate(".concat(-i.x,"px, ").concat(-i.y,"px)")},children:[(0,C.tZ)("polyline",{fill:"none",stroke:"blue",strokeWidth:2,points:"".concat(a)}),a.map((function(t){return(0,C.tZ)("circle",{fill:"none",stroke:"red",r:2.5,cx:t.x,cy:t.y})}))]})},r)}))})}function K(t){var e=(0,u.Z)(),r=(0,f.Z)([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]},{layoutKey:"g-302--xboat-repair-bay",transform:[1,0,0,1,-1200,600]},{layoutKey:"g-303--passenger-deck",transform:[1,0,0,-1,-1200,1800]},{layoutKey:"g-302--xboat-repair-bay",transform:[-1,0,0,1,2400,600]},{layoutKey:"g-301--bridge",transform:[1,0,0,-1,0,2400]}]),o=r.gms,n=r.gmGraph,i=(0,d.Z)((function(){return{gmId:0,holeId:2,clipPath:o.map((function(t){return"none"})),doorsApi:{ready:!1},npcsApi:{},panZoomApi:{},wire:new l.x,getEnterableHoleIds:function(){var t=i.gmId,e=o[t].roomGraph,r=i.doorsApi.getOpen(t),n=e.nodesArray[i.holeId];return e.getEnterableRooms(n,r).map((function(t){return t.holeIndex}))},update:function(){i.updateClipPath(),i.updateObservableDoors(),e()},updateClipPath:function(){var t=o[i.gmId],e=o.map((function(t){return[]})),r=i.doorsApi.getOpen(i.gmId),a=n.computeLightPolygons(i.gmId,i.holeId,r);o.forEach((function(r,o){var n=a.filter((function(t){return o===t.gmIndex})).map((function(t){return t.poly.precision(3)}));e[o]=p.LA.cutOut(n.concat(r===t?t.holesWithDoors[i.holeId]:[]),[r.hullOutline])})),e.forEach((function(t,e){t.forEach((function(t){return t.translate(-o[e].pngRect.x,-o[e].pngRect.y)}));var r=t.map((function(t){return"".concat(t.svgPath)})).join(" ");i.clipPath[e]=r.length?"path('".concat(r,"')"):"none"}))},updateObservableDoors:function(){var t=this,e=o[i.gmId],r=e.roomGraph.nodesArray[i.holeId],a=o.map((function(t){return[]}));a[i.gmId]=e.roomGraph.getAdjacentDoors(r).map((function(t){return t.doorIndex})),e.roomGraph.getAdjacentHullDoorIds(e,r).flatMap((function(t){var e=t.hullDoorIndex;return n.getAdjacentHoleCtxt(i.gmId,e)||[]})).forEach((function(t){var e=t.adjGmId,r=t.adjDoorId;return a[e]=[r]})),o.forEach((function(e,r){return t.doorsApi.setVisible(r,a[r])}))}}}),{overwrite:{gmId:!0,holeId:!0},deps:[o,n]});return a.default.useEffect((function(){if(o.length&&i.doorsApi.ready){i.update();var t=i.wire.pipe((0,s.h)((function(t){return"closed-door"===t.key||"opened-door"===t.key}))).subscribe((function(t){i.update()}));return function(){return t.unsubscribe()}}}),[o,i.doorsApi.ready]),o.length?(0,C.BX)(g.Z,{className:D,zoom:.4,dark:!0,wireKey:M,onLoad:function(t){return i.panZoomApi=t},children:[o.map((function(t){return(0,C.tZ)("img",{className:"geomorph",src:(0,c.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}})})),(0,C.tZ)(P,{gmGraph:n,disabled:t.disabled,wireKey:M,panZoomApi:i.panZoomApi}),o.map((function(t,e){return(0,C.tZ)("img",{className:"geomorph-dark",src:(0,c.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{clipPath:i.clipPath[e],WebkitClipPath:i.clipPath[e],left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}},e)})),i.doorsApi.ready&&(0,C.tZ)(G,{gms:o,gmGraph:n,doorsApi:i.doorsApi,gmId:i.gmId,holeId:i.holeId,setHole:function(t,e){var r=[t,e];i.gmId=r[0],i.holeId=r[1],i.update()}}),(0,C.tZ)(y.Z,{gms:o,gmGraph:n,wire:i.wire,onLoad:function(t){return i.doorsApi=t}})]}):null}var M="wire-demo-1",D=(0,i.iv)(O||(O=(0,n.Z)(["\n  img {\n    position: absolute;\n    transform-origin: top left;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])));function G(t){var e=t.gms[t.gmId],r=t.doorsApi.getVisible(t.gmId);return(0,C.BX)("div",{onClick:function(r){var n=r.target,a=Number(n.getAttribute("data-door-index")),i=e.doors[a],l=i.holeIds.filter((function(e){return e!==t.holeId})),s=(0,o.Z)(l,1)[0];if(null!==s)return t.setHole(t.gmId,s);var c=e.hullDoors.indexOf(i),p=t.gmGraph.getAdjacentHoleCtxt(t.gmId,c);p?t.setHole(p.adjGmId,p.adjHoleId):console.info("hull door is isolated",t.gmId,c)},children:[t.outlines&&t.gms.map((function(t,e){return(0,C.tZ)("div",{style:{position:"absolute",left:t.gridRect.x,top:t.gridRect.y,width:t.gridRect.width,height:t.gridRect.height,border:"2px red solid"}},e)})),(0,C.tZ)("div",{className:"debug",style:{transform:e.transformStyle,position:"absolute"},children:r.map((function(r){var o=e.doors[r],n=o.poly,a=o.normal,i=o.holeIds[0]===t.holeId?1:-1,l=p.dl.from(a).scale(-i).angle,s=n.center.addScaledVector(a,i*B);return(0,C.tZ)("div",{"data-door-index":r,style:{width:2*H,height:2*H,borderRadius:H,position:"absolute",left:s.x-H,top:s.y-H,transform:"rotate(".concat(l,"rad)"),backgroundImage:"url('/icon/solid_arrow-circle-right.svg')",cursor:"pointer"}},r)}))},e.itemKey)]})}var H=5,B=18},62985:function(t,e,r){r.d(e,{Z:function(){return N}});var o=r(79056),n=r(68216),a=r(25997),i=r(14695),l=r(91077),s=r(30268),c=r(92953),p=r(92809),u=r(48103),d=r(82405),f=r(81033),g=r(38826),y=r(65249);function h(t,e){var r="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"===typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(t,e)}(t))||e&&t&&"number"===typeof t.length){r&&(t=r);var o=0,n=function(){};return{s:n,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){l=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw a}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function k(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){(0,p.Z)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function v(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,o=(0,c.Z)(t);if(e){var n=(0,c.Z)(this).constructor;r=Reflect.construct(o,arguments,n)}else r=o.apply(this,arguments);return(0,s.Z)(this,r)}}var x=function(t){(0,l.Z)(r,t);var e=v(r);function r(){var t;(0,n.Z)(this,r);for(var o=arguments.length,a=new Array(o),l=0;l<o;l++)a[l]=arguments[l];return t=e.call.apply(e,[this].concat(a)),(0,p.Z)((0,i.Z)(t),"vectors",[]),t}return(0,a.Z)(r,[{key:"findPath",value:function(t,e){var r=this.getClosestNode(t),o=this.getClosestNode(e);if(!r||!o)return null;var n=g.O.search(this.nodesArray,r,o);return{path:this.computeStringPull(t,e,n).path.map(u.dl.from).slice(1).reduce((function(t,e){return t.length&&e.equals(t[t.length-1])?t:t.concat(e)}),[]),nodePath:n}}},{key:"getClosestNode",value:function(t){var e=this.nodesArray,r=this.vectors,o=null,n=1/0;return e.forEach((function(e){var a=e.centroid.distanceToSquared(t);a<n&&f.c.isVectorInPolygon(t,e,r)&&(o=e,n=a)})),o||e.forEach((function(e){var r=f.c.distanceToSquared(e.centroid,t);r<n&&(o=e,n=r)})),o}},{key:"getPortalFromTo",value:function(t,e){for(var r=0;r<t.neighbours.length;r++)if(t.neighbours[r]===e.index)return t.portals[r]}},{key:"json",value:function(){return k(k({},this.plainJson()),{},{vectors:this.vectors})}},{key:"computeStringPull",value:function(t,e,r){var o=new y.$;o.push(t);for(var n=0;n<r.length;n++){var a=r[n],i=r[n+1];if(i){var l=this.getPortalFromTo(a,i);o.push(this.vectors[l[0]],this.vectors[l[1]])}}return o.push(e),o.stringPull(),o}}],[{key:"fromZone",value:function(t){for(var e=new r,n=(0,o.Z)(t.groups,1)[0],a=t.vertices,i=0,l=Object.entries(n);i<l.length;i++){var s=(0,o.Z)(l[i],2),c=s[0],p=s[1];e.registerNode({type:"tri",id:"tri-".concat(c),index:Number(c),vertexIds:p.vertexIds.slice(),portals:p.portals.map((function(t){return t.slice()})),cost:1,visited:!1,closed:!1,parent:null,centroid:u.dl.from(p.centroid),neighbours:p.neighbours.slice()})}for(var d=function(){var t=(0,o.Z)(g[f],2),r=t[0],n=t[1],a="tri-".concat(r);n.neighbours.map((function(t){return"tri-".concat(t)})).forEach((function(t){return e.registerEdge({src:a,dst:t})}))},f=0,g=Object.entries(n);f<g.length;f++)d();return e.vectors=a,e}},{key:"from",value:function(t){var e,o=new r,n=t.nodes,a=t.edges,i=t.vectors,l=h(n);try{for(l.s();!(e=l.n()).done;){var s=e.value;o.registerNode({type:"tri",id:s.id,index:s.index,vertexIds:s.vertexIds.slice(),portals:s.portals.map((function(t){return t.slice()})),cost:1,visited:!1,closed:!1,parent:null,centroid:u.dl.from(s.centroid),neighbours:[]})}}catch(b){l.e(b)}finally{l.f()}var c,p=h(a);try{for(p.s();!(c=p.n()).done;){var d=c.value;o.registerEdge(d)}}catch(b){p.e(b)}finally{p.f()}var f,g=h(n);try{for(g.s();!(f=g.n()).done;){var y=f.value,m=o.getNodeById(y.id);m.neighbours=o.getSuccs(m).map((function(t){return t.index}))}}catch(b){g.e(b)}finally{g.f()}return o.vectors=i.map(u.dl.from),o}}]),r}(d.b),w=r(88767),Z=r(18907);function N(t,e,r){return(0,w.useQuery)(function(t){return"pathfinding-".concat(t)}(t),(function(){var r=e;return Z.k.setZoneData(t,r),{zone:r,floorGraph:x.fromZone(r)}}),{enabled:!!e&&!r,keepPreviousData:!0,staleTime:1/0})}}}]);