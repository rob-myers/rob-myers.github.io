"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1221],{27160:function(e,t,r){r.r(t),r.d(t,{default:function(){return A}});var s=r(52209),n=r(59748),i=r(88269),o=r(20296),a=r(79056),u=r(30266),c=r(68216),h=r(25997),l=r(92809),f=r(809),d=r.n(f),p=r(86576),m=r(1472),v=r(97468);function y(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}var k=function(){function e(t,r){var s=this;(0,c.Z)(this,e),this.xterm=t,this.session=r,(0,l.Z)(this,"commandBuffer",void 0),(0,l.Z)(this,"cursor",void 0),(0,l.Z)(this,"cursorRow",void 0),(0,l.Z)(this,"input",void 0),(0,l.Z)(this,"readyForInput",void 0),(0,l.Z)(this,"promptReady",void 0),(0,l.Z)(this,"nextPrintId",void 0),(0,l.Z)(this,"prompt",void 0),(0,l.Z)(this,"historyIndex",-1),(0,l.Z)(this,"preHistory",void 0),(0,l.Z)(this,"linesPerUpdate",500),(0,l.Z)(this,"refreshMs",0),(0,l.Z)(this,"forceLowerCase",!1),(0,l.Z)(this,"runCommands",(function(){var e,t=0;for(s.nextPrintId=null;(e=s.commandBuffer.shift())&&t<=s.linesPerUpdate;)switch(e.key){case"await-prompt":return void s.commandBuffer.unshift(e);case"clear":s.clearScreen();break;case"line":s.xterm.writeln(e.line),s.trackCursorRow(1),t++;break;case"newline":for(var r=s.offsetToColRow(s.input,s.cursor).row,n=s.offsetToColRow(s.input,s.input.length).row;r++<n;)s.xterm.write("\r\n");return s.xterm.write("\r\n"),s.trackCursorRow(1),void s.sendLine();case"paste-line":return s.xterm.writeln(e.line),s.trackCursorRow(1),s.input=e.line,void s.sendLine();case"resolve":e.resolve();break;case"prompt":s.xterm.write(e.prompt),s.promptReady=!0;break;default:throw(0,p.Ql)(e)}s.printPending()})),this.input="",this.cursor=0,this.prompt="",this.readyForInput=!0,this.promptReady=!1,this.commandBuffer=[],this.nextPrintId=null,this.cursorRow=0,this.historyIndex=-1,this.preHistory=this.input}return(0,h.Z)(e,[{key:"initialise",value:function(){this.xterm.onData(this.handleXtermInput.bind(this)),this.session.io.handleWriters(this.onMessage.bind(this)),this.xterm.writeln("".concat(v.Dx,"Connected to session ").concat(v.Sv).concat(this.session.key).concat(v.eI)),this.clearInput(),this.cursorRow=2}},{key:"actualCursor",value:function(e,t){return this.actualLine(e.slice(0,t)).length}},{key:"actualLine",value:function(e){return this.prompt+e}},{key:"clearInput",value:function(){this.setCursor(0);var e=Math.min(this.numLines(),this.xterm.rows+1-this.cursorRow);e>1?(this.xterm.write("\r\x1b[K\x1b[E".repeat(e)),this.xterm.write("\x1b[F".repeat(e))):this.xterm.write("\r\x1b[K"),this.input=""}},{key:"clearScreen",value:function(){for(var e=0;e<this.xterm.rows;e++)this.xterm.writeln("");this.xterm.write("\x1b[F".repeat(this.xterm.rows)),this.xterm.scrollToBottom(),this.cursorRow=1,this.showPendingInput()}},{key:"closestLeftBoundary",value:function(e,t){return this.wordBoundaries(e,!0).reverse().find((function(e){return e<t}))||0}},{key:"closestRightBoundary",value:function(e,t){return this.wordBoundaries(e,!1).find((function(e){return e>t}))||e.length}},{key:"deletePreviousWord",value:function(){var e=this.closestLeftBoundary(this.input,this.cursor);if(null!=e){var t=this.input.slice(0,e)+this.input.slice(this.cursor);this.clearInput(),this.setInput(t),this.setCursor(e)}}},{key:"handleCursorErase",value:function(e){var t=this.cursor,r=this.input;if(e){if(t<=0)return;var s=-1;"\n"===this.input.charAt(this.cursor+s)&&(s=-2);var n=r.slice(0,t+s)+r.slice(t);this.clearInput(),this.setInput(n),this.setCursor(t+s)}else{var i=r.slice(0,t)+r.slice(t+1);this.clearInput(),this.setInput(i),this.setCursor(t)}}},{key:"handleCursorInsert",value:function(e){var t=this.input,r=this.cursor,s=t.slice(0,r)+e+t.slice(r),n=this.cursor+e.length;this.clearInput(),this.setInput(s),this.setCursor(n)}},{key:"handleCursorMove",value:function(e){var t=1===e?Math.min(e,this.input.length-this.cursor):Math.max(e,-this.cursor),r=this.input.charAt(this.cursor+t);1===e?"\r"===r?t+=2:"\n"===r&&(t+=1):"\n"===r&&(t-=1),this.setCursor(this.cursor+t)}},{key:"handleXtermInput",value:function(){var e=(0,u.Z)(d().mark((function e(t){var r,s,n,i,o,a,u=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.readyForInput||"\x03"===t){e.next=2;break}return e.abrupt("return");case 2:if(!(t.length>1&&t.includes("\r"))){e.next=26;break}r=t.replace(/[\r\n]+/g,"\n"),(s=r.split("\n"))[0]="".concat(this.input).concat(s[0]),n=!r.endsWith("\n")&&s.pop(),i=y(s),e.prev=8,a=d().mark((function e(){var t;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.value,e.next=3,new Promise((function(e){u.queueCommands([{key:"paste-line",line:t},{key:"await-prompt"},{key:"resolve",resolve:e}])}));case 3:case"end":return e.stop()}}),e)})),i.s();case 11:if((o=i.n()).done){e.next=15;break}return e.delegateYield(a(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),i.e(e.t1);case 20:return e.prev=20,i.f(),e.finish(20);case 23:n&&this.queueCommands([{key:"resolve",resolve:function(){u.clearInput(),u.setInput(n)}}]),e.next=27;break;case 26:this.handleXtermKeypresses(t);case 27:case"end":return e.stop()}}),e,this,[[8,17,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleXtermKeypresses",value:function(e){var t,r=e.charCodeAt(0);if(!(e.length>1&&this.input.startsWith(e)))if(27==r)switch(e.slice(1)){case"[A":this.promptReady&&this.reqHistoryLine(1);break;case"[B":this.promptReady&&this.reqHistoryLine(-1);break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this.input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(t=this.closestLeftBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"f":null!=(t=this.closestRightBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"\x7f":this.deletePreviousWord()}else if(r<32||127===r)switch(e){case"\r":this.queueCommands([{key:"newline"}]);break;case"\x7f":this.handleCursorErase(!0);break;case"\t":this.handleCursorInsert("  ");break;case"\x03":this.sendSigKill();break;case"\x17":this.deletePreviousWord();break;case"\x01":this.setCursor(0);break;case"\x05":this.setCursor(this.input.length);break;case"\f":this.clearScreen();break;case"\v":var s=this.input.slice(0,this.cursor);this.clearInput(),this.setInput(s);break;case"\x15":var n=this.input.slice(this.cursor);this.clearInput(),this.setInput(n),this.setCursor(0)}else this.forceLowerCase&&1===e.length&&!this.input.includes("/")&&(e=e.toLowerCase()),this.handleCursorInsert(e)}},{key:"hasInput",value:function(){return this.input.length>0}},{key:"inputEndsAtEdge",value:function(e){var t=this.actualLine(e),r=this.actualCursor(e,e.length);return 0===this.offsetToColRow(t,r).col}},{key:"offsetToColRow",value:function(e,t){for(var r=this.xterm.cols,s=0,n=0,i=0;i<t;++i){("\n"===e.charAt(i)||(n+=1)>=r)&&(n=0,s+=1)}return{row:s,col:n}}},{key:"onMessage",value:function(e){var t=this;if("string"===typeof e){var r=e.split("\n"),s=r.map((function(e){return{key:"line",line:"".concat(v.Dx).concat(e).concat(v.eI)}}));return this.session.rememberLastValue(r[r.length-1]),this.queueCommands(s)}if(null===e)return this.session.rememberLastValue(null),this.queueCommands([{key:"line",line:"".concat(v.D2,"null").concat(v.eI)}]);if(void 0!==e)switch(e.key){case"send-xterm-prompt":return void this.setPrompt(e.prompt);case"clear-xterm":return void this.clearScreen();case"tty-received-line":return this.input="",void(this.readyForInput=!0);case"send-history-line":if(e.line){var n=e.line.split(/\r?\n/).join("\r\n");-1===this.historyIndex&&(this.preHistory=this.input),this.clearInput(),this.setInput(n),this.historyIndex=e.nextIndex}else 0===e.nextIndex&&(this.clearInput(),this.setInput(this.input!==this.preHistory?this.preHistory:""),this.historyIndex=-1,this.preHistory="");return;case"error":this.queueCommands([{key:"line",line:"".concat(v.NS).concat(e.msg).concat(v.eI)}]);break;case"warn":this.queueCommands([{key:"line",line:"".concat(v.D2).concat(e.msg).concat(v.eI)}]);break;default:(0,m.jO)(e)?e.items.slice(-2*m.bt).forEach((function(e){return t.onMessage(e)})):(this.queueCommands([{key:"line",line:"".concat(v.D2).concat((0,p.or)(e)).concat(v.eI)}]),this.session.rememberLastValue(e))}}},{key:"numLines",value:function(){return 1+this.offsetToColRow(this.input,this.input.length+2).row}},{key:"queueCommands",value:function(e){var t,r=y(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;this.commandBuffer.push(s)}}catch(n){r.e(n)}finally{r.f()}this.printPending()}},{key:"reqHistoryLine",value:function(e){this.session.io.writeToReaders({key:"req-history-line",historyIndex:this.historyIndex+e})}},{key:"printPending",value:function(){this.commandBuffer.length&&!this.nextPrintId&&(this.nextPrintId=window.setTimeout(this.runCommands,this.refreshMs))}},{key:"sendLine",value:function(){this.prompt="",this.readyForInput=this.promptReady=!1,this.historyIndex=-1,this.preHistory="",this.session.io.writeToReaders({key:"send-line",line:this.input})}},{key:"sendSigKill",value:function(){this.input="",this.setCursor(0),this.xterm.write("^C\r\n"),this.trackCursorRow(1),this.cursor=0,this.commandBuffer.length=0,this.session.io.writeToReaders({key:"send-kill-sig"})}},{key:"setCursor",value:function(e){e<0?e=0:e>this.input.length&&(e=this.input.length);var t=this.actualLine(this.input),r=this.actualCursor(this.input,this.cursor),s=this.offsetToColRow(t,r),n=s.col,i=s.row,o=this.actualCursor(this.input,e),a=this.offsetToColRow(t,o),u=a.col,c=a.row;if(c>i)for(var h=i;h<c;++h)this.xterm.write("\x1b[B");else for(var l=c;l<i;++l)this.xterm.write("\x1b[A");if(this.trackCursorRow(c-i),u>n)for(var f=n;f<u;++f)this.xterm.write("\x1b[C");else for(var d=u;d<n;++d)this.xterm.write("\x1b[D");this.cursor=e}},{key:"setInput",value:function(e){this.setCursor(0);var t=this.actualLine(e);this.xterm.write(t),t&&this.inputEndsAtEdge(e)&&(this.xterm.write("\r\n"),this.trackCursorRow(1)),this.input=e,this.cursor=e.length}},{key:"setPrompt",value:function(e){this.prompt=e;var t=(0,a.Z)(this.commandBuffer,1)[0];t&&"await-prompt"===t.key&&this.commandBuffer.shift(),this.queueCommands([{key:"prompt",prompt:e}])}},{key:"showPendingInput",value:function(){this.promptReady&&this.setInput(this.input)}},{key:"trackCursorRow",value:function(e){this.cursorRow+=e,this.cursorRow<1?this.cursorRow=1:this.cursorRow>this.xterm.rows&&(this.cursorRow=this.xterm.rows)}},{key:"wordBoundaries",value:function(e){for(var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=[],n=/\w+/g;t=n.exec(e);)s.push(r?t.index:t.index+t[0].length);return s}}]),e}(),x=r(50269),C=r(42563);var g,b=r(59885),I=r(94184),L=r.n(I),R=r(44275),Z=r(8311);function S(e){var t=(0,R.Z)((function(){return{onClick:function(t){var r=t.target,s=e.session.ttyShell.xterm;if(s.xterm.scrollToBottom(),r.classList.contains("lowercase")){var n=s.forceLowerCase=!s.forceLowerCase,i="\u26a0\ufe0f  input ".concat(n?"forced as":"not forced as"," lowercase");C.default.api.warnCleanly(e.session.key,i),r.classList.toggle("enabled"),localStorage.setItem(T,"".concat(n))}else r.classList.contains("ctrl-c")?s.sendSigKill():r.classList.contains("clear")?s.clearScreen():r.classList.contains("up")?s.reqHistoryLine(1):r.classList.contains("down")&&s.reqHistoryLine(-1);s.xterm.focus()}}}));return n.default.useEffect((function(){var t=e.session.ttyShell.xterm;return localStorage.getItem(T)||localStorage.setItem(T,"true"),t.forceLowerCase="true"===localStorage.getItem(T),function(){t.forceLowerCase=!1}}),[]),(0,Z.BX)("div",{className:P,onClick:t.onClick,style:{top:"".concat(e.offset,"px")},children:[(0,Z.tZ)("div",{className:L()("icon lowercase",{enabled:e.session.ttyShell.xterm.forceLowerCase}),children:"abc"}),(0,Z.tZ)("div",{className:"icon ctrl-c",children:"\ud83d\udc80"}),(0,Z.tZ)("div",{className:"icon clear",children:"\u2205"}),(0,Z.tZ)("div",{className:"icon up",children:"\u2b06\ufe0f"}),(0,Z.tZ)("div",{className:"icon down",children:"\u2b07\ufe0f"})]})}var B,T="touch-tty-force-lowercase",P=(0,i.iv)(g||(g=(0,s.Z)(["\n  position: absolute;\n  z-index: 100000;\n  top: 0;\n  right: 16px;\n  width: 32px;\n  height: 128px;\n\n  line-height: 1; /** Needed for mobile viewing 'Desktop site' */\n  background-color: rgba(0, 0, 0, 0.7);\n  font-size: 0.75rem;\n  border: 1px solid #555;\n  border-width: 1px 1px 1px 1px;\n  color: white;\n\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  transition: top 500ms ease;\n\n  .lowercase {\n    color: #999;\n    &.enabled {\n      color: white;\n    }\n  }\n\n  .icon {\n    cursor: pointer;\n    width: 100%;\n    text-align: center;\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n  }\n"]))),E=r(27375),q=r(84175);function A(e){var t=e.sessionKey,r=e.env,s=(0,E.Z)(),i=(0,R.Z)((function(){return{offset:0,xtermReady:!1,isTouchDevice:(0,x.us)(),session:null}}));return function(e){var t=n.default.useState((function(){return e()})),r=(0,a.Z)(t,2),s=r[0],i=r[1];n.default.useEffect((function(){function t(){i(e())}return window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}),[])}((function(){return i.isTouchDevice=(0,x.us)()})),n.default.useEffect((function(){return i.session=C.default.api.createSession(t,r),s(),function(){return C.default.api.removeSession(t)}}),[t]),(0,Z.BX)(D,{children:[i.session&&(0,Z.tZ)(b.Od,{onMount:function(e){var t=(0,q.Cq)(i.session),r=new k(e,{key:t.key,io:t.ttyIo,rememberLastValue:function(e){return t.var._=e}});r.initialise(),t.ttyShell.initialise(r),i.xtermReady=!0,s(),r.xterm.onLineFeed((0,o.debounce)((function(){i.isTouchDevice&&(i.offset=Math.max(1,parseInt(e.textarea.style.top)-100),s())}),100))},options:M}),i.isTouchDevice&&i.session&&i.xtermReady&&(0,Z.tZ)(S,{session:i.session,offset:i.offset})]})}var D=(0,i.zo)("div")(B||(B=(0,s.Z)(["\n  grid-area: terminal;\n  background: black;\n  height: 100%;\n  padding: 4px;\n  /** TODO fix padding without scrollbar offset */\n"]))),M={allowProposedApi:!0,fontSize:16,cursorBlink:!0,rendererType:"canvas",rightClickSelectsWord:!0,theme:{background:"black",foreground:"#41FF00"},convertEol:!1,scrollback:250,rows:50}},17120:function(e,t,r){r.d(t,{Z:function(){return a}});var s=r(32296),n=r(99846),i=r(16988),o=r(95243);function a(e){return(0,s.Z)(e)||(0,n.Z)(e)||(0,i.Z)(e)||(0,o.Z)()}}}]);