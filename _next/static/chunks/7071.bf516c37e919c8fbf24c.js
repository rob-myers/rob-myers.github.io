"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7071],{67071:function(t,n,e){e.r(n),e.d(n,{default:function(){return S}});var r=e(52209),o=e(88269),i=e(48103),a=e(24790),c=e(91441),l=e(95814),s=e(35650),u=e(87079),p=e(79056),d=e(59748),f=e(50269),h=e(68451),g=e(8311);function v(t){var n=(0,s.Z)((function(){return{canvas:{},ctxt:{},doors:{},lights:[],rootRef:function(e){e&&(n.canvas=e,n.canvas.width=2*t.json.pngRect.width,n.canvas.height=2*t.json.pngRect.height,n.ctxt=n.canvas.getContext("2d"),n.updateLights(t))},updateLights:function(t){var e=t.json,r=t.defs,o=n.ctxt;o.globalCompositeOperation="source-over",o.clearRect(0,0,o.canvas.width,o.canvas.height);var a=e.walls.concat(e.doors.filter((function(t,e){return"open"!==n.doors[e]})).map((function(t){return t.poly}))).map((function(t){return i.LA.from(t)})).flatMap((function(t){return h.J.triangulationToPolys(t.fastTriangulate())}));n.lights=r.map((function(t,n){var e=(0,p.Z)(t.def,4),r=e[0],o=(e[1],e[2]);e[3];return{key:"light",index:n,intensity:o,position:r,poly:h.J.lightPolygon(r,1e3,a),radius:1e3}})),n.lights.forEach((function(t){var e=t.poly,r=t.position,i=(t.radius,t.intensity);o.setTransform(1,0,0,1,0,0),o.filter="none",o.setTransform(2,0,0,2,0,0);var a=o.createRadialGradient(r.x,r.y,0,r.x,r.y,300*i);a.addColorStop(0,"rgba(0, 0, 0, ".concat(i,")")),a.addColorStop(.56,"rgba(0, 0, 0, ".concat(i/2,")")),a.addColorStop(.86,"#00000000"),o.fillStyle=a,(0,f.Fx)(n.ctxt,[e])})),o.globalCompositeOperation="source-in",o.setTransform(1,0,0,1,2*e.pngRect.x,2*e.pngRect.y),o.drawImage(e.image,0,0)}}}));return d.default.useEffect((function(){n.updateLights(t);var e=t.wire.subscribe((function(e){switch(e.key){case"opened-door":n.doors[e.index]="open",n.updateLights(t);break;case"closed-door":n.doors[e.index]="closed",n.updateLights(t)}}));return function(){return e.unsubscribe()}}),[t.defs]),(0,g.tZ)("canvas",{ref:n.rootRef,style:{width:t.json.pngRect.width}})}var m,y=e(84175),b=e(94184),w=e.n(b);function x(t){var n=t.json,e=(0,s.Z)((function(){return{api:{evt:new a.x},open:{},onClick:function(n){var r=n.target,o=Number(r.getAttribute("data-index")),i=r.classList.toggle("open");e.open[o]=i,t.wire.next({key:i?"opened-door":"closed-door",index:o})}}}));return(0,g.tZ)("div",{className:j,onPointerUp:e.onClick,children:n.doors.map((function(t,n){var r=t.rect,o=t.angle;return(0,g.tZ)("div",{"data-index":n,className:w()("door",{open:e.open[n]}),style:{left:r.x,top:r.y,width:r.width,height:r.height,transform:"rotate(".concat(o,"rad)"),transformOrigin:"top left"}},n)}))})}var O,j=(0,o.iv)(m||(m=(0,r.Z)(["\n  div.door {\n    position: absolute;\n    cursor: pointer;\n    background: #000;\n    opacity: 1;\n    transition: opacity 100ms linear;\n    &.open {\n      opacity: 0.2;\n    }\n  }\n"])));function S(t){var n=(0,l.Z)(Z).data,e=(0,s.Z)((function(){return{lightDefs:[{key:"light-def",def:[new i.dl(205,385),130,.7,0]},{key:"light-def",def:[new i.dl(740,430),80,.6,0]},{key:"light-def",def:[new i.dl(420,400),80,.8,1]},{key:"light-def",def:[new i.dl(600,315),250,1,1]}],wire:new a.x}}),{lightDefs:function(t,n){return(0,y.fS)(t,n)}});return(0,g.tZ)(u.Z,{dark:!0,className:k,children:n&&(0,g.BX)(g.HY,{children:[(0,g.tZ)("img",{src:(0,c.qX)(Z),draggable:!1,style:{left:n.pngRect.x,top:n.pngRect.y,width:n.pngRect.width,height:n.pngRect.height}}),(0,g.tZ)(v,{json:n,defs:e.lightDefs,wire:e.wire}),(0,g.tZ)(x,{json:n,wire:e.wire})]})})}var Z="g-301--bridge",k=(0,o.iv)(O||(O=(0,r.Z)(["\n  img {\n    filter: contrast(200%) invert(100%) brightness(30%);\n    position: absolute;\n  }\n  canvas {\n    position: absolute;\n  }\n"])))},95814:function(t,n,e){e.d(n,{Z:function(){return f}});var r=e(92809),o=e(79056),i=e(30266),a=e(809),c=e.n(a),l=e(88767),s=e(18264),u=e(91441);function p(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function d(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?p(Object(e),!0).forEach((function(n){(0,r.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):p(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function f(t){return(0,l.useQuery)((0,u.tU)(t),(0,i.Z)(c().mark((function n(){var e,r,i,a,l;return c().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Promise.all([fetch((0,u.tU)(t)).then((function(t){return t.json()})),new Promise((function(n,e){var r=new Image;r.onload=function(){return n(r)},r.onerror=e,r.src=(0,u.qX)(t)}))]);case 2:return e=n.sent,r=(0,o.Z)(e,2),i=r[0],a=r[1],l=d(d({},i),{},{image:a,d:{navPoly:i.navPoly.map(s.L.from),hullOutine:s.L.from(i.hull.poly[0]).removeHoles()}}),n.abrupt("return",l);case 8:case"end":return n.stop()}}),n)}))),{keepPreviousData:!0,cacheTime:1/0})}},35650:function(t,n,e){e.d(n,{Z:function(){return i}});var r=e(79056),o=e(59748);function i(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=o.default.useState(t),i=(0,r.Z)(e,1),a=i[0];return o.default.useEffect((function(){var e=t.toString()!==a._prevFn;if(a._prevFn){if(e){for(var o=t(),i=0,c=Object.entries(o);i<c.length;i++){var l,s=(0,r.Z)(c[i],2),u=s[0],p=s[1];"function"===typeof p?a[u]=p:u in a?a._prevInit&&!1===(null===(l=n[u])||void 0===l?void 0:l.call(n,a._prevInit[u],o[u]))&&(a[u]=o[u]):a[u]=p}for(var d=0,f=Object.entries(a);d<f.length;d++){var h=(0,r.Z)(f[d],2),g=h[0];h[1];g in o||delete a[g]}a._prevFn=t.toString(),a._prevInit=o}}else a._prevFn=t.toString(),a._prevInit=t()}),[]),a}},87079:function(t,n,e){e.d(n,{Z:function(){return f}});var r,o=e(52209),i=(e(59748),e(94184)),a=e.n(i),c=e(88269),l=e(48103),s=e(35650),u=e(8311);function p(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"===typeof t)return d(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return d(t,n)}(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(c)throw i}}}}function d(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function f(t){var n=(0,s.Z)((function(){return{root:{},parent:{},opts:{minScale:.2,maxScale:8,step:.1},pointers:[],isPanning:!1,x:0,y:0,scale:1,origin:void 0,start:{clientX:0,clientY:0,scale:1,distance:0},evt:{wheel:function(t){n.zoomWithWheel(t)},pointerdown:function(t){g(n.pointers,t),n.isPanning=!0,n.origin=new l.dl(n.x,n.y);var e=v(n.pointers);n.start={clientX:e.clientX,clientY:e.clientY,scale:n.scale,distance:m(n.pointers)}},pointermove:function(t){if(void 0!==n.origin&&void 0!==n.start.clientX&&void 0!==n.start.clientY){g(n.pointers,t);var e=v(n.pointers);if(n.pointers.length>1){0===n.start.distance&&(n.start.distance=m(n.pointers));var r=m(n.pointers)-n.start.distance,o=3*n.opts.step,i=Math.min(Math.max(r*o/80+n.start.scale,n.opts.minScale),n.opts.maxScale);n.zoomToPoint(i,e)}else n.pan(n.origin.x+(e.clientX-n.start.clientX)/n.scale,n.origin.y+(e.clientY-n.start.clientY)/n.scale)}},pointerup:function(t){!function(t,n){if(n.touches){for(;t.length;)t.pop();return}var e=t.findIndex((function(t){return t.pointerId===n.pointerId}));e>-1&&t.splice(e,1)}(n.pointers,t),n.isPanning&&(n.isPanning=!1,n.origin=n.start.clientX=n.start.clientY=void 0)}},pan:function(t,e){n.x===t&&n.y===e||(n.x=t,n.y=e,n.root.style.transform="scale(".concat(n.scale,") translate(").concat(n.x,"px, ").concat(n.y,"px)"))},rootRef:function(t){t&&(n.root=t,n.parent=t.parentElement,n.parent.addEventListener("wheel",n.evt.wheel),n.parent.addEventListener("pointerdown",n.evt.pointerdown),n.parent.addEventListener("pointermove",n.evt.pointermove),n.parent.addEventListener("pointerup",n.evt.pointerup),n.parent.addEventListener("pointerleave",n.evt.pointerup),n.parent.addEventListener("pointercancel",n.evt.pointerup))},zoom:function(t,e){t=Math.min(Math.max(t,n.opts.minScale),n.opts.maxScale);var r=n.x,o=n.y;if(e.focal){var i=e.focal;r=(i.x/t-i.x/n.scale+n.x*t)/t,o=(i.y/t-i.y/n.scale+n.y*t)/t}n.x=r,n.y=o,n.scale=t,n.root.style.transform="scale(".concat(n.scale,") translate(").concat(n.x,"px, ").concat(n.y,"px)")},zoomToPoint:function(t,e){var r=function(t){var n=t.parentNode,e=window.getComputedStyle(t),r=window.getComputedStyle(n),o=t.getBoundingClientRect(),i=n.getBoundingClientRect();return{elem:{style:e,width:o.width,height:o.height,top:o.top,bottom:o.bottom,left:o.left,right:o.right,margin:y(t,"margin",e),border:y(t,"border",e)},parent:{style:r,width:i.width,height:i.height,top:i.top,bottom:i.bottom,left:i.left,right:i.right,padding:y(n,"padding",r),border:y(n,"border",r)}}}(n.root),o=r.parent.width-r.parent.padding.left-r.parent.padding.right-r.parent.border.left-r.parent.border.right,i=r.parent.height-r.parent.padding.top-r.parent.padding.bottom-r.parent.border.top-r.parent.border.bottom,a=e.clientX-r.parent.left-r.parent.padding.left-r.parent.border.left-r.elem.margin.left,c=e.clientY-r.parent.top-r.parent.padding.top-r.parent.border.top-r.elem.margin.top,l={x:(a-=r.elem.width/n.scale/2)/o*(o*t),y:(c-=r.elem.height/n.scale/2)/i*(i*t)};return n.zoom(t,{focal:l})},zoomWithWheel:function(t){t.preventDefault();var e=(0===t.deltaY&&t.deltaX?t.deltaX:t.deltaY)<0?1:-1,r=Math.min(Math.max(n.scale*Math.exp(e*n.opts.step/3),n.opts.minScale),n.opts.maxScale);return n.zoomToPoint(r,t)}}}));return(0,u.tZ)("div",{className:a()("panzoom-parent",h(t)),children:(0,u.BX)("div",{ref:n.rootRef,className:a()("panzoom-root",t.className),children:[t.children,(0,u.tZ)("div",{className:"grid"})]})})}var h=function(t){return(0,c.iv)(r||(r=(0,o.Z)(["\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  user-select: none;\n  /** This is important for mobile to prevent scrolling while panning */\n  touch-action: none;\n  cursor: auto;\n\n  background-color: ",";\n  \n  .panzoom-root {\n    width: 100%;\n    height: 100%;\n    user-select: none;\n    touch-action: none;\n    transform-origin: 50% 50%;\n    \n    .grid {\n      position: absolute;\n      pointer-events: none;\n      left: ","px;\n      top: ","px;\n      width: ","px;\n      height: ","px;\n      background-size: 10px 10px;\n      background-image:\n        linear-gradient(to right, rgba(100, 100, 100, 0.1) 1px, transparent 1px),\n        linear-gradient(to bottom, rgba(100, 100, 100, 0.15) 1px, transparent 1px);\n    }\n  }\n"])),t.dark?"#000":"#fff",-2e3,-2e3,4e3,4e3)};function g(t,n){var e;if(n.touches){e=0;var r,o=p(n.touches);try{for(o.s();!(r=o.n()).done;){var i=r.value;i.pointerId=e++,g(t,i)}}catch(a){o.e(a)}finally{o.f()}}else(e=t.findIndex((function(t){return t.pointerId===n.pointerId})))>-1&&t.splice(e,1),t.push(n)}function v(t){for(var n,e=(t=t.slice(0)).pop();n=t.pop();)e={clientX:(n.clientX-e.clientX)/2+e.clientX,clientY:(n.clientY-e.clientY)/2+e.clientY};return e}function m(t){if(t.length<2)return 0;var n=t[0],e=t[1];return Math.sqrt(Math.pow(Math.abs(e.clientX-n.clientX),2)+Math.pow(Math.abs(e.clientY-n.clientY),2))}function y(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.getComputedStyle(t),r="border"===n?"Width":"";return{left:b("".concat(n,"Left").concat(r),e),right:b("".concat(n,"Right").concat(r),e),top:b("".concat(n,"Top").concat(r),e),bottom:b("".concat(n,"Bottom").concat(r),e)}}function b(t,n){return parseFloat(n[t])||0}},84175:function(t,n,e){function r(t,n){if(void 0===t)throw new Error("Encountered unexpected undefined value".concat(n?" for '".concat(n,"'"):""));return t}function o(t,n){if(null==t)throw new Error("Encountered unexpected null or undefined value".concat(n?" for '".concat(n,"'"):""));return t}function i(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e>10)throw Error("equals: recursive depth exceeded 10");return(void 0===t||void 0!==n)&&("function"===typeof(null===t||void 0===t?void 0:t.equals)?!0===t.equals(n):Array.isArray(t)?t.every((function(t,e){return i(t,n[e])}),e+1)&&t.length===n.length:a(t)?Object.keys(t).every((function(e){return i(t[e],n[e])}),e+1)&&Object.keys(t).length===Object.keys(n).length:t===n)}function a(t){if("[object Object]"!==Object.prototype.toString.call(t))return!1;var n=Object.getPrototypeOf(t);return null===n||n===Object.prototype}e.d(n,{Nh:function(){return r},Cq:function(){return o},fS:function(){return i}})}}]);