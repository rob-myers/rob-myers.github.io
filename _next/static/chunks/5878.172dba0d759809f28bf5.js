"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5878],{75878:function(n,e,t){t.r(e),t.d(e,{default:function(){return E}});var r,o=t(52209),i=t(92809),l=t(79056),a=t(59748),c=t(88269),s=t(94184),u=t.n(s),p=t(48103),g=t(91441),d=t(68451),f=t(35490),y=t(83159),h=t(90101),v=t(95814),m=t(8311);function w(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function b(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?w(Object(t),!0).forEach((function(e){(0,i.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function E(n){var e=(0,v.Z)(n.layoutKey).data,t=a.default.useState((function(){return{lightA:new p.dl(205,385),lightB:new p.dl(930,385)}})),r=(0,l.Z)(t,1)[0];return(0,m.tZ)(y.Z,{gridBounds:f.l,initViewBox:f.r,maxZoom:6,className:u()(P,n.disabled&&"disabled"),dark:!0,children:e&&(0,m.BX)(m.HY,{children:[(0,m.tZ)("image",b(b({},e.pngRect),{},{className:"geomorph",href:(0,g.qX)(n.layoutKey)})),(0,m.tZ)(O,{init:r.lightA,walls:e.groups.walls,hull:e.hullPoly}),(0,m.tZ)(O,{init:r.lightB,walls:e.groups.walls,hull:e.hullPoly})]})})}function O(n){var e=n.init,t=n.walls,r=n.hull,o=a.default.useState((function(){return e})),i=(0,l.Z)(o,2),c=i[0],s=i[1],u=(0,a.useMemo)((function(){if(r[0].clone().removeHoles().contains(c)){var n=t.flatMap((function(n){return d.J.triangulationToPolys(n.fastTriangulate())}));return d.J.lightPolygon({position:c,range:2e3,tris:n})}return new p.LA}),[c.x,c.y]);return(0,m.BX)(m.HY,{children:[(0,m.tZ)("path",{className:"light",d:u.svgPath}),(0,m.tZ)(h.Z,{initial:c,onStop:s,radius:20,stroke:"black",icon:"eye"})]})}var P=(0,c.iv)(r||(r=(0,o.Z)(["\n  image {\n    filter: contrast(200%) invert(100%);\n  }\n\n  path.light {\n    fill: red;\n    animation: fadein 1s infinite alternate;\n    \n    @keyframes fadein {\n      from { opacity: 0; }\n      to { opacity: 0.4; }\n    }\n  }\n  &.disabled path.light {\n    animation: none;\n    opacity: 0.25;\n  }\n"])))},90101:function(n,e,t){t.d(e,{Z:function(){return g}});var r,o=t(52209),i=t(79056),l=t(59748),a=t(88269),c=t(48103),s=t(50269),u=t(27375),p=t(8311);function g(n){var e=(0,u.Z)(),t=l.default.useState((function(){var t,o={position:c.dl.from(n.initial),target:c.dl.from(n.initial),dragging:!1,rootEl:{},lineEl:{},circleEl:{},rootRef:function(n){n&&(r.rootEl=n,r.lineEl=n.querySelector("line.drag-indicator"),r.circleEl=n.querySelector("circle.node"),r.circleEl.addEventListener("pointerdown",r.startDrag),r.circleEl.addEventListener("pointerup",r.applyDrag))},startDrag:function(e){var t;e.stopPropagation(),r.dragging=!0,r.lineEl.style.display="inline",r.target.copy(r.position),["x1","x2"].forEach((function(n){return r.lineEl.setAttribute(n,String(r.position.x))})),["y1","y2"].forEach((function(n){return r.lineEl.setAttribute(n,String(r.position.y))}));var o=r.lineEl.ownerSVGElement;o.addEventListener("pointermove",r.onMove),o.addEventListener("pointerleave",r.endDrag),o.addEventListener("pointerup",r.applyDrag),window.addEventListener("keydown",r.endDragOnEscape),o.style.cursor="grabbing",null===(t=n.onStart)||void 0===t||t.call(n)},onMove:function(n){if(n.stopPropagation(),r.dragging){var e=(0,s.zk)({clientX:n.clientX,clientY:n.clientY,ownerSvg:r.lineEl.ownerSVGElement,pointerId:null}),t=e.x,o=e.y,i=new c.dl(t,o);r.position.distanceTo(i)>=20&&(r.target.set(t,o),r.lineEl.setAttribute("x2",String(t)),r.lineEl.setAttribute("y2",String(o)))}},endDrag:function(){if(r.dragging){r.dragging=!1,r.lineEl.style.display="none",r.lineEl.setAttribute("x2",r.lineEl.getAttribute("x1")),r.lineEl.setAttribute("y2",r.lineEl.getAttribute("y1"));var n=r.lineEl.ownerSVGElement;n.removeEventListener("pointermove",r.onMove),n.removeEventListener("pointerleave",r.endDrag),n.removeEventListener("pointerup",r.applyDrag),window.removeEventListener("keydown",r.endDragOnEscape),n.style.cursor="auto"}},applyDrag:function(){var e,t,o;r.dragging&&(r.endDrag(),null!==(e=n.shouldCancel)&&void 0!==e&&e.call(n,r.position.clone(),r.target.clone())||(r.target.distanceTo(r.position)<20?null===(t=n.onClick)||void 0===t||t.call(n,r.position.clone()):(r.moveTo(r.target),null===(o=n.onStop)||void 0===o||o.call(n,r.target.clone()))))},endDragOnEscape:function(n){"Escape"===n.key&&r.endDrag()},moveTo:function(n){r.position.copy(n),r.lineEl.setAttribute("x1",String(r.target.x)),r.lineEl.setAttribute("y1",String(r.target.y)),e()}};return null===(t=n.onLoad)||void 0===t||t.call(n,{moveTo:o.moveTo,getPosition:function(){return r.position.clone()}}),o})),r=(0,i.Z)(t,1)[0],o=n.radius||8;return(0,p.BX)("g",{className:d,ref:r.rootRef,children:[n.icon&&{eye:(0,p.tZ)("image",{className:"icon",href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),down:(0,p.tZ)("image",{className:"icon",href:"/icon/solid_arrow-circle-down.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),right:(0,p.tZ)("image",{className:"icon",href:"/icon/solid_arrow-circle-right.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),run:(0,p.tZ)("image",{className:"icon",href:"/icon/person-running-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),finish:(0,p.tZ)("image",{className:"icon",href:"/icon/flag-checkered-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10})}[n.icon]||(0,p.tZ)("circle",{className:"inner-node",cx:r.position.x,cy:r.position.y,r:4}),(0,p.tZ)("circle",{className:"node",cx:r.position.x,cy:r.position.y,r:o}),(0,p.tZ)("line",{className:"drag-indicator",stroke:n.stroke||"blue"})]})}var d=(0,a.iv)(r||(r=(0,o.Z)(["\n  circle.node {\n    fill: rgba(0, 0, 100, 0.1);\n    stroke: rgba(0, 0, 100, 0.2);\n    stroke-dasharray: 4px 4px;\n    cursor: pointer;\n  }\n  circle.inner-node {\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  line.drag-indicator {\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n    pointer-events: none;\n  }\n"])))},95814:function(n,e,t){t.d(e,{Z:function(){return f}});var r=t(92809),o=t(97131),i=t(30266),l=t(809),a=t.n(l),c=t(88767),s=t(91441),u=t(48103),p=t(5524);function g(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function d(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?g(Object(t),!0).forEach((function(e){(0,r.Z)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function f(n,e){return(0,c.useQuery)((0,s.tU)(n),(0,i.Z)(a().mark((function e(){var t,r,i,l,c,g;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch((0,s.tU)(n)).then((function(n){return n.json()})).then(p.Vn);case 2:return t=e.sent,r=t.roomGraph,i=r.nodesArray.filter((function(n){return"room"===n.type})).map((function(n,e){var i=r.getEdgesFrom(n).flatMap((function(n){var e=n.dst;return"door"===e.type?t.doors[e.doorId].poly:[]}));return u.LA.union([t.rooms[e]].concat((0,o.Z)(i)))[0]})),l=t.groups.singles.filter((function(n){return n.tags.includes("switch")})).map((function(n){return n.poly.center})),c=t.groups.singles.filter((function(n){return n.tags.includes("spawn")})).map((function(n){return n.poly.center})),(g=d(d({},t),{},{roomsWithDoors:i,roomsSwitch:t.rooms.map((function(n){return l.find((function(e){return n.contains(e)}))||n.rect.center})),hullDoors:t.doors.filter((function(n){return n.tags.includes("hull")})),hullOutline:t.hullPoly[0].removeHoles(),pngRect:u.UL.fromJson(t.items[0].pngRect),spawnPoints:c,lazy:null})).lazy=y(g),e.abrupt("return",g);case 10:case"end":return e.stop()}}),e)}))),d({cacheTime:1/0},e))}function y(n){var e={roomNavPoly:{}},t=new Proxy({},{get:function(t,r){if("string"===typeof r){var o=Number(r);return n.roomsWithDoors[o]&&!e.roomNavPoly[o]&&(e.roomNavPoly[o]=u.LA.intersect(n.navPoly,[n.roomsWithDoors[o]])),e.roomNavPoly[o]}}});return new Proxy(e,{get:function(n,e){if("roomNavPoly"===e)return t}})}}}]);