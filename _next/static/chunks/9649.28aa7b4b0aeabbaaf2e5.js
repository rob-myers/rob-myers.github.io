"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9649],{9649:function(e,t,n){n.r(t),n.d(t,{default:function(){return G}});var r=n(52209),o=n(92809),a=n(21844),i=n(97131),c=n(79056),l=n(59748),s=n(88269),u=n(35490),d=n(48103),f=n(91441),p=n(83159),g=n(95814),v=n(62985),h=n(18907),y=n(90101);var m,b=24,w=n(50269),P=n(49345),E=n(8311);function k(e){var t=l.default.useState((function(){var t,r={source:new P.d,angle:0,target:new P.d,dragging:!1,disabled:!0,circleEl:{},lineEl:{},rootRef:function(e){e&&(n.circleEl=e.querySelector("circle.drag-source"),n.lineEl=e.querySelector("line.drag-indicator"),n.circleEl.addEventListener("pointerdown",n.startDrag),n.circleEl.addEventListener("pointerup",n.applyDrag))},startDrag:function(t){var r;if(n.disabled){var o;null===(o=e.onClick)||void 0===o||o.call(e)}else{t.stopPropagation(),n.dragging=!0,n.lineEl.style.display="inline",["x2","y2"].forEach((function(e){return n.lineEl.setAttribute(e,"0")}));var a=n.lineEl.ownerSVGElement;a.addEventListener("pointermove",n.onMove),a.addEventListener("pointerleave",n.endDrag),a.addEventListener("pointerup",n.applyDrag),window.addEventListener("keydown",n.endDragOnEscape),a.style.cursor="grabbing",n.target.copy(n.source),null===(r=e.onStart)||void 0===r||r.call(e)}},onMove:function(e){if(e.stopPropagation(),n.dragging){var t=(0,w.zk)({clientX:e.clientX,clientY:e.clientY,ownerSvg:n.lineEl.ownerSVGElement,pointerId:null});n.target.copy(t);var r=P.d.from(t).sub(n.source).rotate(-n.angle);r.length>=20&&(n.lineEl.setAttribute("x2",String(r.x)),n.lineEl.setAttribute("y2",String(r.y)))}},endDrag:function(){if(n.dragging){n.dragging=!1,n.lineEl.style.display="none",["x2","y2"].forEach((function(e){return n.lineEl.setAttribute(e,"0")}));var e=n.lineEl.ownerSVGElement;e.removeEventListener("pointermove",n.onMove),e.removeEventListener("pointerleave",n.endDrag),e.removeEventListener("pointerup",n.applyDrag),window.removeEventListener("keydown",n.endDragOnEscape),e.style.cursor="auto"}},applyDrag:function(){if(n.dragging){n.endDrag();var t,r=n.source.distanceTo(n.target);if(r<8)null===(t=e.onClick)||void 0===t||t.call(e);else if(r>20){var o;null===(o=e.onStop)||void 0===o||o.call(e,n.target.clone())}}},endDragOnEscape:function(e){"Escape"===e.key&&n.endDrag()}};return null===(t=e.onLoad)||void 0===t||t.call(e,{disable:function(){n.disabled=!0},enable:function(e,t){n.source.copy(e),n.angle=t,n.disabled=!1},setAngle:function(e){n.angle=e}}),r})),n=(0,c.Z)(t,1)[0];return(0,E.BX)("g",{className:Z,ref:n.rootRef,children:[(0,E.tZ)("circle",{className:"drag-source",fill:"rgba(0, 0, 0, 0.2)",r:e.radius}),(0,E.tZ)("line",{className:"drag-indicator",stroke:"#444",strokeWidth:2})]})}var x,Z=(0,s.iv)(m||(m=(0,r.Z)(["\n  circle {\n    cursor: crosshair;\n  }\n  line {\n    pointer-events: none;\n  }\n"])));function A(e){var t=l.default.useState((function(){var t=e.defs,r=t.map((function(e){return h.k.getGroup(e.zoneKey,e.src)}));r.forEach((function(e,n){return null===e&&console.warn("NPC: ".concat(t[n].key,": init.src: ").concat(t[n].src.x,", ").concat(t[n].src.y,": no group found"))}));var o=t.map((function(e,t){var n={key:e.key,def:e,el:{npc:{},look:{},path:{},dots:{}},srcApi:{},dstApi:{},rayApi:{},move:{},look:{},geom:{animPath:[],navPath:[],navPathPolys:[]},aux:{groupId:r[t],count:0,edges:[],elens:[],sofars:[],total:0,angs:[]},getPosition:function(){var e=new DOMMatrixReadOnly(window.getComputedStyle(n.el.npc).transform);return new d.dl(e.m41,e.m42)},getLookAngle:function(){var e=new DOMMatrixReadOnly(window.getComputedStyle(n.el.look).transform);return Math.atan2(e.m12,e.m11)},getNPCAngle:function(){var e=new DOMMatrixReadOnly(window.getComputedStyle(n.el.npc).transform);return Math.atan2(e.m12,e.m11)},pause:function(){"running"===n.move.playState&&n.move.pause()},play:function(){n.move.play(),n.internal.resetLook()},internal:null};return n.internal=function(e){var t=e.def,n={followNavPath:function(){var r=e.geom.animPath,o=e.aux;if(r.length<=1||0===o.total)e.rayApi.enable(e.getPosition(),e.getNPCAngle());else{var a="paused"===e.move.playState;e.move=e.el.npc.animate(r.flatMap((function(e,t){return[{offset:o.sofars[t]/o.total,transform:"translate(".concat(e.x,"px, ").concat(e.y,"px) rotateZ(").concat(o.angs[t-1]||o.angs[t]||0,"rad)")},{offset:o.sofars[t]/o.total,transform:"translate(".concat(e.x,"px, ").concat(e.y,"px) rotateZ(").concat(o.angs[t]||o.angs[t-1]||0,"rad)")}]})),{duration:15*o.total,direction:"normal",fill:"forwards"}),e.move.addEventListener("finish",n.onFinishMove),e.rayApi.disable(),(a||0===o.count&&t.paused)&&(e.pause(),e.rayApi.enable(e.getPosition(),e.getNPCAngle())),e.aux.count++}},initialize:function(n){e.el.npc=n.querySelector("g.npc.".concat(t.key)),e.el.look=e.el.npc.querySelector("g.look"),e.el.path=n.querySelector("polyline.navpath.".concat(t.key)),e.el.dots=n.querySelector("g.navdots.".concat(t.key)),e.move=new Animation,e.el.npc.style.transform="translate(".concat(t.src.x,"px, ").concat(t.src.y,"px)"),e.look=new Animation,e.el.look.style.transform="rotateZ(".concat(t.angle,"rad)")},onDraggedSrcNode:function(){n.resetLook(),n.updateNavPath(e.srcApi.getPosition()),n.followNavPath()},onClickedSrcNode:function(){if("finished"===e.move.playState)n.reverseNavPath(),e.geom.animPath=e.geom.navPath.slice(),n.updateAnimAux(),n.followNavPath();else if("paused"===e.move.playState){var t=e.getPosition(),r=e.geom.navPathPolys.findIndex((function(e){return e.contains(t)}));if(-1===r)return console.warn("onClickedSrcNode: failed to find npc on its navPath");e.geom.animPath=e.geom.navPath.slice(0,r+1).concat(t).reverse(),n.reverseNavPath(),n.updateAnimAux(),n.followNavPath()}else n.togglePaused()},onDraggedDstNode:function(){n.resetLook(),n.updateNavPath(e.dstApi.getPosition()),n.followNavPath()},onClickedDstNode:function(){n.togglePaused()},onDragLookRay:function(t){var n=e.getLookAngle(),r=t.clone().sub(e.getPosition()),o=Math.atan2(r.y,r.x)-e.getNPCAngle();o-n>Math.PI?o-=2*Math.PI:o-n<-Math.PI&&(o+=2*Math.PI),e.look.cancel(),e.el.look.style.transform="rotateZ(".concat(o,"rad)"),e.look=e.el.look.animate([{transform:"rotateZ(".concat(n.toFixed(2),"rad)")},{transform:"rotateZ(".concat(o.toFixed(2),"rad)")}],{duration:150,direction:"normal"})},onFinishMove:function(){e.rayApi.enable(e.getPosition(),e.getNPCAngle())},resetLook:function(){e.el.look.style.transform="rotateZ(0rad)"},renderNavPath:function(){e.el.path.setAttribute("points","".concat(e.geom.navPath)),Array.from(e.el.dots.childNodes).forEach((function(e){return e.remove()})),e.geom.navPath.forEach((function(t){var n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("cx","".concat(t.x)),n.setAttribute("cy","".concat(t.y)),n.setAttribute("r","2"),e.el.dots.appendChild(n)}))},reverseNavPath:function(){e.geom.navPath.reverse(),e.geom.navPathPolys.reverse(),n.renderNavPath(),n.swapNavNodes(),n.resetLook()},shouldCancelNavDrag:function(n,r,o){if(null===h.k.getGroup(t.zoneKey,r))return!0;var a=n.distanceTo(r)>=20,i=e.getPosition(),c="src"===o?e.dstApi.getPosition():e.srcApi.getPosition();return a&&(r.distanceTo(i)<=2*b||r.distanceTo(c)<=2*b)},swapNavNodes:function(){var t=[e.srcApi.getPosition(),e.dstApi.getPosition()],n=t[0],r=t[1];e.srcApi.moveTo(r),e.dstApi.moveTo(n)},togglePaused:function(){"finished"!==e.move.playState&&("paused"===e.move.playState?(e.rayApi.disable(),e.play()):(e.rayApi.enable(e.getPosition(),e.getNPCAngle()),e.pause()))},updateAnimAux:function(){var t=e.geom.animPath,n=e.aux;n.edges=t.map((function(e,n){return{p:e,q:t[n+1]}})).slice(0,-1),n.elens=n.edges.map((function(e){var t=e.p,n=e.q;return Number(t.distanceTo(n).toFixed(2))}));var r=n.elens.reduce((function(e,t){return e.total+=t,e.sofars.push(e.sofars[e.sofars.length-1]+t),e}),{sofars:[0],total:0}),o=[r.sofars,r.total];n.sofars=o[0],n.total=o[1],n.angs=n.edges.map((function(e){return Number(Math.atan2(e.q.y-e.p.y,e.q.x-e.p.x).toFixed(2))}))},updateNavPath:function(r){var o,a=h.k.getGroup(t.zoneKey,r);if(null===a)return console.warn("computeNavPath: dst: ".concat(r.x,", ").concat(r.y,": no group found"));if(a!==e.aux.groupId)return console.warn("computeNavPath: (src, dst) have different groupIds: (".concat(e.aux.groupId,", ").concat(a,")"));var i=e.getPosition(),c=(null===(o=h.k.findPath(i,r,t.zoneKey,e.aux.groupId))||void 0===o?void 0:o.path)||[];c.forEach((function(e){return e.precision(2)})),e.geom.navPath=[d.dl.from(i)].concat(c),e.geom.animPath=e.geom.navPath.slice(),e.srcApi.moveTo(i),e.dstApi.moveTo(r),n.renderNavPath(),n.updateAnimAux(),e.geom.navPathPolys=e.aux.edges.map((function(e){var t=e.q.clone().sub(e.p).rotate(Math.PI/2).normalize(.01);return new d.LA([e.p.clone().add(t),e.q.clone().add(t),e.q.clone().sub(t),e.p.clone().sub(t)])}))}};return n}(n),n})),a={apis:o,highlightPath:function(e){n.apis.forEach((function(t){t.key===e?t.el.path.classList.add("active"):t.el.path.classList.remove("active")}))}};return e.onLoad(a),{apis:o,api:a,mounted:!1,rootRef:function(e){e&&!n.mounted&&(n.apis.forEach((function(t){t.internal.initialize(e),t.internal.updateNavPath(d.dl.from(t.def.dst)),t.internal.followNavPath()})),n.mounted=!0)}}})),n=(0,c.Z)(t,1)[0];return(0,E.BX)("g",{className:O,ref:n.rootRef,children:[(0,E.tZ)("g",{className:"navpaths",children:n.apis.map((function(e){return(0,E.BX)("g",{children:[(0,E.tZ)("polyline",{className:"navpath ".concat(e.key)}),(0,E.tZ)("g",{className:"navdots ".concat(e.key)}),(0,E.tZ)(y.Z,{initial:e.def.src,radius:b,onLoad:function(t){return e.srcApi=t},onStop:e.internal.onDraggedSrcNode,shouldCancel:function(t,n){return e.internal.shouldCancelNavDrag(t,n,"src")},onClick:e.internal.onClickedSrcNode},"src"),(0,E.tZ)(y.Z,{initial:e.def.dst,radius:b,onLoad:function(t){return e.dstApi=t},onStop:e.internal.onDraggedDstNode,shouldCancel:function(t,n){return e.internal.shouldCancelNavDrag(t,n,"dst")},onClick:e.internal.onClickedDstNode},"dst")]},e.key)}))}),n.apis.map((function(e){return(0,E.BX)("g",{className:"npc ".concat(e.key),children:[(0,E.tZ)("circle",{className:"body",fill:"#fff",stroke:"black",strokeWidth:2,r:9}),(0,E.tZ)("g",{className:"look",children:(0,E.tZ)("line",{className:"body",stroke:"black",strokeWidth:2,x2:9})}),(0,E.tZ)(k,{radius:9,onLoad:function(t){return e.rayApi=t},onStop:e.internal.onDragLookRay,onClick:function(){return n.api.highlightPath(e.key)}})]},e.key)}))]})}var N,O=(0,s.iv)(x||(x=(0,r.Z)(["\n  polyline.navpath {\n    fill: none;\n    stroke: #222;\n    stroke-width: 1;\n    stroke-dasharray: 1px;\n  }\n  polyline.navpath.active {\n    stroke-width: 2;\n    stroke: blue;\n  }\n"]))),S=n(94184),D=n.n(S);function L(e){var t=l.default.useState((function(){return{root:{},rootRef:function(e){e&&(n.root=e)}}})),n=(0,c.Z)(t,1)[0];return l.default.useEffect((function(){var t;null===(t=e.onLoad)||void 0===t||t.call(e,{createText:function(e,t,r){var o=r.x,a=r.y,l=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");l.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),l.setAttribute("class","message ".concat(e)),Object.entries({x:o,y:a,width:"100%",height:"100%"}).forEach((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1];return l.setAttribute(n,"".concat(r))}));var s=l.appendChild(document.createElement("div"));t.forEach((function(e){return s.appendChild(document.createElement("div")).textContent=e})),n.root.appendChild(l),setTimeout((function(){var e=(0,w.dD)(l.ownerSVGElement),t=Array.from(s.children).map((function(e){return e.getBoundingClientRect()})),n=Math.max.apply(Math,(0,i.Z)(t.map((function(e){return e.width}))))*e,r=t.reduce((function(e,t){return e+t.height}),0)*e;l.setAttribute("width","".concat(n)),l.setAttribute("height","".concat(r))}),100)},get:function(e){var t=n.root.querySelectorAll("message .".concat(e));return t.length?t[0]:void 0},remove:function(e){var t=n.root.querySelectorAll(".".concat(e));return t.forEach((function(e){return e.remove()})),t.length>0}})}),[]),(0,E.tZ)("g",{className:D()("messages",q),ref:n.rootRef})}var j,C=12,T="sans-serif",M=[4,8],I=2,q=(0,s.iv)(N||(N=(0,r.Z)(["\n  foreignObject > div {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n\n    font-size: ","px;\n    font-family: ",";\n    line-height: 1;\n    \n    color: white;\n    > div {\n      padding: ","px ","px;\n      background: rgba(0, 0, 0, 0.4);\n      border-radius: ","px;\n    }\n  }\n"])),C,T,M[0],M[1],I),R=n(68451);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function G(e){var t="g-301--bridge",n=l.default.useState((function(){return{defs:[0,1,2].map((function(e){return{key:"npc-".concat(e),src:(0,a.Z)(d.dl,(0,i.Z)([[250,100],[260,200],[40,550]][e])),dst:(0,a.Z)(d.dl,(0,i.Z)([[600,500],[600,340],[1100,50]][e])),zoneKey:t,paused:!1,angle:0}})),api:{},metas:[0,1,2].map((function(e){return{wasPlaying:!1}})),testLight:new d.dl(205,385)}})),r=(0,c.Z)(n,1)[0],o=(0,g.Z)(t).data,s=(0,v.Z)(t,null===o||void 0===o?void 0:o.navZone,e.disabled).data;return l.default.useEffect((function(){s&&(e.disabled?r.api.apis.forEach((function(e,t){r.metas[t].wasPlaying="running"===e.move.playState,e.pause()})):r.api.apis.forEach((function(e,t){return r.metas[t].wasPlaying&&e.play()})))}),[e.disabled,s]),(0,E.tZ)(p.Z,{dark:!0,gridBounds:u.l,initViewBox:F,maxZoom:6,children:(0,E.BX)("g",{className:X,children:[o&&(0,E.tZ)("image",B(B({},o.pngRect),{},{className:"geomorph",href:(0,f.qX)(t)})),(0,E.tZ)("g",{className:"navtris",children:!e.disabled&&(null===s||void 0===s?void 0:s.zone.groups.map((function(e){return e.map((function(e){var t=e.vertexIds;return(0,E.tZ)("polygon",{className:"navtri",points:"".concat(t.map((function(e){return s.zone.vertices[e]})))})}))})))}),s&&(0,E.tZ)(A,{defs:r.defs,onLoad:function(e){return r.api=e}}),o&&(0,E.tZ)(V,{init:r.testLight,walls:o.groups.walls,hull:o.hullPoly}),(0,E.tZ)(L,{onLoad:function(e){e.createText("test",["Once upon a time.","Foo bar baz qux!","Awooga!"],new d.dl(260,300)),r.defs.forEach((function(t){e.createText(t.key,["".concat(t.key)],t.src)}))}})]})})}var X=(0,s.iv)(j||(j=(0,r.Z)(["\n  border: 1px solid #555555;\n  height: inherit;\n\n  image {\n    /* filter: invert(100%) sepia(50%); */\n    /* filter: invert(100%); */\n    filter: brightness(40%);\n  }\n\n  polygon.navtri {\n    fill: transparent;\n    &:hover {\n      fill: rgba(0, 0, 0, 0.03);\n      stroke: #888;\n    }\n  }\n\n  path.light {\n    /* TODO radial fall-off */\n    /* TODO flicker on/off */\n    /* TODO blur ourside light */\n    fill: #ffffff34;\n    pointer-events: none;\n  }\n"]))),F=new d.UL(0,0,800,800);function V(e){var t=e.init,n=e.walls,r=e.hull,o=l.default.useState((function(){return t})),a=(0,c.Z)(o,2),i=a[0],s=a[1],u=l.default.useMemo((function(){if(r[0].clone().removeHoles().contains(i)){var e=n.flatMap((function(e){return R.J.triangulationToPolys(e.fastTriangulate())}));return R.J.lightPolygon({position:i,range:2e3,tris:e})}return new d.LA}),[i.x,i.y]);return(0,E.BX)(E.HY,{children:[(0,E.tZ)("path",{className:"light",d:u.svgPath}),(0,E.tZ)(y.Z,{initial:i,onStop:s,radius:20,stroke:"black",icon:"eye"})]})}},90101:function(e,t,n){n.d(t,{Z:function(){return f}});var r,o=n(52209),a=n(79056),i=n(59748),c=n(88269),l=n(48103),s=n(50269),u=n(27375),d=n(8311);function f(e){var t=(0,u.Z)(),n=i.default.useState((function(){var n,o={position:l.dl.from(e.initial),target:l.dl.from(e.initial),dragging:!1,rootEl:{},lineEl:{},circleEl:{},rootRef:function(e){e&&(r.rootEl=e,r.lineEl=e.querySelector("line.drag-indicator"),r.circleEl=e.querySelector("circle.node"),r.circleEl.addEventListener("pointerdown",r.startDrag),r.circleEl.addEventListener("pointerup",r.applyDrag))},startDrag:function(t){var n;t.stopPropagation(),r.dragging=!0,r.lineEl.style.display="inline",r.target.copy(r.position),["x1","x2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.x))})),["y1","y2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.y))}));var o=r.lineEl.ownerSVGElement;o.addEventListener("pointermove",r.onMove),o.addEventListener("pointerleave",r.endDrag),o.addEventListener("pointerup",r.applyDrag),window.addEventListener("keydown",r.endDragOnEscape),o.style.cursor="grabbing",null===(n=e.onStart)||void 0===n||n.call(e)},onMove:function(e){if(e.stopPropagation(),r.dragging){var t=(0,s.zk)({clientX:e.clientX,clientY:e.clientY,ownerSvg:r.lineEl.ownerSVGElement,pointerId:null}),n=t.x,o=t.y,a=new l.dl(n,o);r.position.distanceTo(a)>=20&&(r.target.set(n,o),r.lineEl.setAttribute("x2",String(n)),r.lineEl.setAttribute("y2",String(o)))}},endDrag:function(){if(r.dragging){r.dragging=!1,r.lineEl.style.display="none",r.lineEl.setAttribute("x2",r.lineEl.getAttribute("x1")),r.lineEl.setAttribute("y2",r.lineEl.getAttribute("y1"));var e=r.lineEl.ownerSVGElement;e.removeEventListener("pointermove",r.onMove),e.removeEventListener("pointerleave",r.endDrag),e.removeEventListener("pointerup",r.applyDrag),window.removeEventListener("keydown",r.endDragOnEscape),e.style.cursor="auto"}},applyDrag:function(){var t,n,o;r.dragging&&(r.endDrag(),null!==(t=e.shouldCancel)&&void 0!==t&&t.call(e,r.position.clone(),r.target.clone())||(r.target.distanceTo(r.position)<20?null===(n=e.onClick)||void 0===n||n.call(e,r.position.clone()):(r.moveTo(r.target),null===(o=e.onStop)||void 0===o||o.call(e,r.target.clone()))))},endDragOnEscape:function(e){"Escape"===e.key&&r.endDrag()},moveTo:function(e){r.position.copy(e),r.lineEl.setAttribute("x1",String(r.target.x)),r.lineEl.setAttribute("y1",String(r.target.y)),t()}};return null===(n=e.onLoad)||void 0===n||n.call(e,{moveTo:o.moveTo,getPosition:function(){return r.position.clone()}}),o})),r=(0,a.Z)(n,1)[0],o=e.radius||8;return(0,d.BX)("g",{className:p,ref:r.rootRef,children:[e.icon&&{eye:(0,d.tZ)("image",{className:"icon",href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),down:(0,d.tZ)("image",{className:"icon",href:"/icon/solid_arrow-circle-down.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),right:(0,d.tZ)("image",{className:"icon",href:"/icon/solid_arrow-circle-right.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),run:(0,d.tZ)("image",{className:"icon",href:"/icon/person-running-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),finish:(0,d.tZ)("image",{className:"icon",href:"/icon/flag-checkered-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10})}[e.icon]||(0,d.tZ)("circle",{className:"inner-node",cx:r.position.x,cy:r.position.y,r:4}),(0,d.tZ)("circle",{className:"node",cx:r.position.x,cy:r.position.y,r:o}),(0,d.tZ)("line",{className:"drag-indicator",stroke:e.stroke||"blue"})]})}var p=(0,c.iv)(r||(r=(0,o.Z)(["\n  circle.node {\n    fill: rgba(0, 0, 100, 0.1);\n    stroke: rgba(0, 0, 100, 0.2);\n    stroke-dasharray: 4px 4px;\n    cursor: pointer;\n  }\n  circle.inner-node {\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  line.drag-indicator {\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n    pointer-events: none;\n  }\n"])))},95814:function(e,t,n){n.d(t,{Z:function(){return g}});var r=n(92809),o=n(97131),a=n(30266),i=n(809),c=n.n(i),l=n(88767),s=n(91441),u=n(48103),d=n(23121);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){return(0,l.useQuery)((0,s.tU)(e),(0,a.Z)(c().mark((function t(){var n,r,a,i,l,f;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch((0,s.tU)(e)).then((function(e){return e.json()})).then(d.Vn);case 2:return n=t.sent,r=n.roomGraph,a=r.nodesArray.filter((function(e){return"room"===e.type})).map((function(e,t){var a=r.getEdgesFrom(e).flatMap((function(e){var t=e.dst;return"door"===t.type?n.doors[t.doorIndex].poly:[]}));return u.LA.union([n.holes[t]].concat((0,o.Z)(a)))[0]})),i=n.groups.singles.filter((function(e){return e.tags.includes("switch")})).map((function(e){return e.poly.center})),l=n.groups.singles.filter((function(e){return e.tags.includes("spawn")})).map((function(e){return e.poly.center})),f=p(p({},n),{},{holesWithDoors:a,holeSwitches:n.holes.map((function(e){return i.find((function(t){return e.contains(t)}))||e.rect.center})),hullDoors:n.doors.filter((function(e){return e.tags.includes("hull")})),hullOutline:n.hullPoly[0].removeHoles(),pngRect:u.UL.fromJson(n.items[0].pngRect),spawnPoints:l}),t.abrupt("return",f);case 9:case"end":return t.stop()}}),t)}))),p({cacheTime:1/0},t))}},62985:function(e,t,n){n.d(t,{Z:function(){return x}});var r=n(79056),o=n(68216),a=n(25997),i=n(14695),c=n(91077),l=n(30268),s=n(92953),u=n(92809),d=n(48103),f=n(82405),p=n(81033),g=n(38826),v=n(65249);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,u.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.Z)(e);if(t){var o=(0,s.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var P=function(e){(0,c.Z)(n,e);var t=w(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,a=new Array(r),c=0;c<r;c++)a[c]=arguments[c];return e=t.call.apply(t,[this].concat(a)),(0,u.Z)((0,i.Z)(e),"vectors",[]),e}return(0,a.Z)(n,[{key:"findPath",value:function(e,t){var n=this.getClosestNode(e),r=this.getClosestNode(t);if(!n||!r)return null;var o=g.O.search(this.nodesArray,n,r);return{path:this.computeStringPull(e,t,o).path.map(d.dl.from).slice(1).reduce((function(e,t){return e.length&&t.equals(e[e.length-1])?e:e.concat(t)}),[]),nodePath:o}}},{key:"getClosestNode",value:function(e){var t=this.nodesArray,n=this.vectors,r=null,o=1/0;return t.forEach((function(t){var a=t.centroid.distanceToSquared(e);a<o&&p.c.isVectorInPolygon(e,t,n)&&(r=t,o=a)})),r||t.forEach((function(t){var n=p.c.distanceToSquared(t.centroid,e);n<o&&(r=t,o=n)})),r}},{key:"getPortalFromTo",value:function(e,t){for(var n=0;n<e.neighbours.length;n++)if(e.neighbours[n]===t.index)return e.portals[n]}},{key:"json",value:function(){return b(b({},this.plainJson()),{},{vectors:this.vectors})}},{key:"computeStringPull",value:function(e,t,n){var r=new v.$;r.push(e);for(var o=0;o<n.length;o++){var a=n[o],i=n[o+1];if(i){var c=this.getPortalFromTo(a,i);r.push(this.vectors[c[0]],this.vectors[c[1]])}}return r.push(t),r.stringPull(),r}}],[{key:"fromZone",value:function(e){for(var t=new n,o=(0,r.Z)(e.groups,1)[0],a=e.vertices,i=0,c=Object.entries(o);i<c.length;i++){var l=(0,r.Z)(c[i],2),s=l[0],u=l[1];t.registerNode({type:"tri",id:"tri-".concat(s),index:Number(s),vertexIds:u.vertexIds.slice(),portals:u.portals.map((function(e){return e.slice()})),cost:1,visited:!1,closed:!1,parent:null,centroid:d.dl.from(u.centroid),neighbours:u.neighbours.slice()})}for(var f=function(){var e=(0,r.Z)(g[p],2),n=e[0],o=e[1],a="tri-".concat(n);o.neighbours.map((function(e){return"tri-".concat(e)})).forEach((function(e){return t.registerEdge({src:a,dst:e})}))},p=0,g=Object.entries(o);p<g.length;p++)f();return t.vectors=a,t}},{key:"from",value:function(e){var t,r=new n,o=e.nodes,a=e.edges,i=e.vectors,c=h(o);try{for(c.s();!(t=c.n()).done;){var l=t.value;r.registerNode({type:"tri",id:l.id,index:l.index,vertexIds:l.vertexIds.slice(),portals:l.portals.map((function(e){return e.slice()})),cost:1,visited:!1,closed:!1,parent:null,centroid:d.dl.from(l.centroid),neighbours:[]})}}catch(m){c.e(m)}finally{c.f()}var s,u=h(a);try{for(u.s();!(s=u.n()).done;){var f=s.value;r.registerEdge(f)}}catch(m){u.e(m)}finally{u.f()}var p,g=h(o);try{for(g.s();!(p=g.n()).done;){var v=p.value,y=r.getNodeById(v.id);y.neighbours=r.getSuccs(y).map((function(e){return e.index}))}}catch(m){g.e(m)}finally{g.f()}return r.vectors=i.map(d.dl.from),r}}]),n}(f.b),E=n(88767),k=n(18907);function x(e,t,n){return(0,E.useQuery)(function(e){return"pathfinding-".concat(e)}(e),(function(){var n=t;return k.k.setZoneData(e,n),{zone:n,floorGraph:P.fromZone(n)}}),{enabled:!!t&&!n,keepPreviousData:!0,staleTime:1/0})}}}]);