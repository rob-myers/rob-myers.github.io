"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2464],{62464:function(e,t,n){n.r(t),n.d(t,{default:function(){return Z}});var r,o,i=n(52209),a=n(92809),c=n(79056),l=n(59748),s=n(88269),u=n(94184),f=n.n(u),p=n(35490),d=n(48103),g=n(18907),v=n(91441),h=n(83159),y=n(90101),m=n(95814),b=n(62985),E=n(8311);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(e){var t="g-301--bridge",n=t,r=(0,m.Z)(t).data,o=(0,b.Z)(n,null===r||void 0===r?void 0:r.navZone,e.disabled).data,i=l.default.useState((function(){return{rootEl:{},pathEl:null,source:new d.dl(300,300),target:new d.dl(600,300),path:[],updatePath:function(){var e,t,r=g.k.getGroup(n,a.source);null!==r&&(a.path=[a.source.clone()].concat((null===(e=g.k.findPath(a.source,a.target,n,r))||void 0===e?void 0:e.path)||[]),a.pathEl=a.pathEl||a.rootEl.querySelector("polyline.navpath"),null===(t=a.pathEl)||void 0===t||t.setAttribute("points","".concat(a.path)))}}})),a=(0,c.Z)(i,1)[0];return(0,E.tZ)(h.Z,{gridBounds:p.l,initViewBox:p.r,maxZoom:6,children:(0,E.BX)("g",{className:f()(P,!e.disabled&&x),ref:function(e){e&&(a.rootEl=e,a.updatePath())},children:[r&&(0,E.tZ)("image",O(O({},r.pngRect),{},{className:"geomorph",href:(0,v.qX)(t)})),!e.disabled&&(null===o||void 0===o?void 0:o.zone.groups.map((function(e){return e.map((function(e){var t=e.vertexIds;return(0,E.tZ)("polygon",{className:"navtri",points:"".concat(t.map((function(e){return null===o||void 0===o?void 0:o.zone.vertices[e]})))})}))}))),r&&(0,E.BX)(E.HY,{children:[(0,E.tZ)(y.Z,{initial:a.source,icon:"run",onStop:function(e){if(!r.navPoly.some((function(t){return t.contains(e)})))return"cancel";a.source.copy(e),a.updatePath()}}),(0,E.tZ)("polyline",{className:"navpath",points:"".concat(a.path)}),(0,E.tZ)(y.Z,{initial:a.target,icon:"finish",onStop:function(e){if(!r.navPoly.some((function(t){return t.contains(e)})))return"cancel";a.target.copy(e),a.updatePath()}})]})]})})}var P=(0,s.iv)(r||(r=(0,i.Z)(["\n  border: 1px solid #555555;\n  height: inherit;\n\n  image.geomorph {\n    filter: invert(100%);\n  }\n  image.icon {\n    filter: invert(100%);\n  }\n\n  polyline.navpath {\n    fill: none;\n    stroke: #083;\n    stroke-width: 4;\n    stroke-dasharray: 8px;\n    stroke-dashoffset: 16px;\n  }\n\n  @keyframes stringPullFlash {\n    0% { stroke-dashoffset: 16px; }\n    100% { stroke-dashoffset: 0px; }\n  }\n\n  polygon.navtri {\n    fill: transparent;\n    &:hover {\n      stroke: #2b9900;\n    }\n  }\n"]))),x=(0,s.iv)(o||(o=(0,i.Z)(["\n  polyline.navpath {\n    animation: 600ms stringPullFlash infinite linear;\n  }\n"])))},90101:function(e,t,n){n.d(t,{Z:function(){return p}});var r,o=n(52209),i=n(79056),a=n(59748),c=n(88269),l=n(48103),s=n(50269),u=n(27375),f=n(8311);function p(e){var t=(0,u.Z)(),n=a.default.useState((function(){var n,o={position:l.dl.from(e.initial),target:l.dl.from(e.initial),dragging:!1,rootEl:{},lineEl:{},circleEl:{},rootRef:function(e){e&&(r.rootEl=e,r.lineEl=e.querySelector("line.drag-indicator"),r.circleEl=e.querySelector("circle.node"),r.circleEl.addEventListener("pointerdown",r.startDrag),r.circleEl.addEventListener("pointerup",r.applyDrag))},startDrag:function(t){var n;t.stopPropagation(),r.dragging=!0,r.lineEl.style.display="inline",r.target.copy(r.position),["x1","x2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.x))})),["y1","y2"].forEach((function(e){return r.lineEl.setAttribute(e,String(r.position.y))}));var o=r.lineEl.ownerSVGElement;o.addEventListener("pointermove",r.onMove),o.addEventListener("pointerleave",r.endDrag),o.addEventListener("pointerup",r.applyDrag),window.addEventListener("keydown",r.endDragOnEscape),o.style.cursor="grabbing",null===(n=e.onStart)||void 0===n||n.call(e)},onMove:function(e){if(e.stopPropagation(),r.dragging){var t=(0,s.zk)({clientX:e.clientX,clientY:e.clientY,ownerSvg:r.lineEl.ownerSVGElement,pointerId:null}),n=t.x,o=t.y,i=new l.dl(n,o);r.position.distanceTo(i)>=20&&(r.target.set(n,o),r.lineEl.setAttribute("x2",String(n)),r.lineEl.setAttribute("y2",String(o)))}},endDrag:function(){if(r.dragging){r.dragging=!1,r.lineEl.style.display="none",r.lineEl.setAttribute("x2",r.lineEl.getAttribute("x1")),r.lineEl.setAttribute("y2",r.lineEl.getAttribute("y1"));var e=r.lineEl.ownerSVGElement;e.removeEventListener("pointermove",r.onMove),e.removeEventListener("pointerleave",r.endDrag),e.removeEventListener("pointerup",r.applyDrag),window.removeEventListener("keydown",r.endDragOnEscape),e.style.cursor="auto"}},applyDrag:function(){var t,n,o;r.dragging&&(r.endDrag(),null!==(t=e.shouldCancel)&&void 0!==t&&t.call(e,r.position.clone(),r.target.clone())||(r.target.distanceTo(r.position)<20?null===(n=e.onClick)||void 0===n||n.call(e,r.position.clone()):(r.moveTo(r.target),null===(o=e.onStop)||void 0===o||o.call(e,r.target.clone()))))},endDragOnEscape:function(e){"Escape"===e.key&&r.endDrag()},moveTo:function(e){r.position.copy(e),r.lineEl.setAttribute("x1",String(r.target.x)),r.lineEl.setAttribute("y1",String(r.target.y)),t()}};return null===(n=e.onLoad)||void 0===n||n.call(e,{moveTo:o.moveTo,getPosition:function(){return r.position.clone()}}),o})),r=(0,i.Z)(n,1)[0],o=e.radius||8;return(0,f.BX)("g",{className:d,ref:r.rootRef,children:[e.icon&&{eye:(0,f.tZ)("image",{className:"icon",href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),down:(0,f.tZ)("image",{className:"icon",href:"/icon/solid_arrow-circle-down.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),right:(0,f.tZ)("image",{className:"icon",href:"/icon/solid_arrow-circle-right.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),run:(0,f.tZ)("image",{className:"icon",href:"/icon/person-running-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10}),finish:(0,f.tZ)("image",{className:"icon",href:"/icon/flag-checkered-fa6.svg",width:"20",height:"20",x:r.position.x-10,y:r.position.y-10})}[e.icon]||(0,f.tZ)("circle",{className:"inner-node",cx:r.position.x,cy:r.position.y,r:4}),(0,f.tZ)("circle",{className:"node",cx:r.position.x,cy:r.position.y,r:o}),(0,f.tZ)("line",{className:"drag-indicator",stroke:e.stroke||"blue"})]})}var d=(0,c.iv)(r||(r=(0,o.Z)(["\n  circle.node {\n    fill: rgba(0, 0, 100, 0.1);\n    stroke: rgba(0, 0, 100, 0.2);\n    stroke-dasharray: 4px 4px;\n    cursor: pointer;\n  }\n  circle.inner-node {\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 0.5;\n  }\n  line.drag-indicator {\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n    pointer-events: none;\n  }\n"])))},95814:function(e,t,n){n.d(t,{Z:function(){return g}});var r=n(92809),o=n(97131),i=n(30266),a=n(809),c=n.n(a),l=n(88767),s=n(91441),u=n(48103),f=n(23121);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){return(0,l.useQuery)((0,s.tU)(e),(0,i.Z)(c().mark((function t(){var n,r,i,a,l,p;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch((0,s.tU)(e)).then((function(e){return e.json()})).then(f.Vn);case 2:return n=t.sent,r=n.roomGraph,i=r.nodesArray.filter((function(e){return"room"===e.type})).map((function(e,t){var i=r.getEdgesFrom(e).flatMap((function(e){var t=e.dst;return"door"===t.type?n.doors[t.doorIndex].poly:[]}));return u.LA.union([n.holes[t]].concat((0,o.Z)(i)))[0]})),a=n.groups.singles.filter((function(e){return e.tags.includes("switch")})).map((function(e){return e.poly.center})),l=n.groups.singles.filter((function(e){return e.tags.includes("spawn")})).map((function(e){return e.poly.center})),p=d(d({},n),{},{holesWithDoors:i,holeSwitches:n.holes.map((function(e){return a.find((function(t){return e.contains(t)}))||e.rect.center})),hullDoors:n.doors.filter((function(e){return e.tags.includes("hull")})),hullOutline:n.hullPoly[0].removeHoles(),pngRect:u.UL.fromJson(n.items[0].pngRect),spawnPoints:l}),t.abrupt("return",p);case 9:case"end":return t.stop()}}),t)}))),d({cacheTime:1/0},t))}},62985:function(e,t,n){n.d(t,{Z:function(){return P}});var r=n(79056),o=n(68216),i=n(25997),a=n(14695),c=n(91077),l=n(30268),s=n(92953),u=n(92809),f=n(48103),p=n(82405),d=n(81033),g=n(38826),v=n(65249);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,u.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.Z)(e);if(t){var o=(0,s.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,l.Z)(this,n)}}var w=function(e){(0,c.Z)(n,e);var t=E(n);function n(){var e;(0,o.Z)(this,n);for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];return e=t.call.apply(t,[this].concat(i)),(0,u.Z)((0,a.Z)(e),"vectors",[]),e}return(0,i.Z)(n,[{key:"findPath",value:function(e,t){var n=this.getClosestNode(e),r=this.getClosestNode(t);if(!n||!r)return null;var o=g.O.search(this.nodesArray,n,r);return{path:this.computeStringPull(e,t,o).path.map(f.dl.from).slice(1).reduce((function(e,t){return e.length&&t.equals(e[e.length-1])?e:e.concat(t)}),[]),nodePath:o}}},{key:"getClosestNode",value:function(e){var t=this.nodesArray,n=this.vectors,r=null,o=1/0;return t.forEach((function(t){var i=t.centroid.distanceToSquared(e);i<o&&d.c.isVectorInPolygon(e,t,n)&&(r=t,o=i)})),r||t.forEach((function(t){var n=d.c.distanceToSquared(t.centroid,e);n<o&&(r=t,o=n)})),r}},{key:"getPortalFromTo",value:function(e,t){for(var n=0;n<e.neighbours.length;n++)if(e.neighbours[n]===t.index)return e.portals[n]}},{key:"json",value:function(){return b(b({},this.plainJson()),{},{vectors:this.vectors})}},{key:"computeStringPull",value:function(e,t,n){var r=new v.$;r.push(e);for(var o=0;o<n.length;o++){var i=n[o],a=n[o+1];if(a){var c=this.getPortalFromTo(i,a);r.push(this.vectors[c[0]],this.vectors[c[1]])}}return r.push(t),r.stringPull(),r}}],[{key:"fromZone",value:function(e){for(var t=new n,o=(0,r.Z)(e.groups,1)[0],i=e.vertices,a=0,c=Object.entries(o);a<c.length;a++){var l=(0,r.Z)(c[a],2),s=l[0],u=l[1];t.registerNode({type:"tri",id:"tri-".concat(s),index:Number(s),vertexIds:u.vertexIds.slice(),portals:u.portals.map((function(e){return e.slice()})),cost:1,visited:!1,closed:!1,parent:null,centroid:f.dl.from(u.centroid),neighbours:u.neighbours.slice()})}for(var p=function(){var e=(0,r.Z)(g[d],2),n=e[0],o=e[1],i="tri-".concat(n);o.neighbours.map((function(e){return"tri-".concat(e)})).forEach((function(e){return t.registerEdge({src:i,dst:e})}))},d=0,g=Object.entries(o);d<g.length;d++)p();return t.vectors=i,t}},{key:"from",value:function(e){var t,r=new n,o=e.nodes,i=e.edges,a=e.vectors,c=h(o);try{for(c.s();!(t=c.n()).done;){var l=t.value;r.registerNode({type:"tri",id:l.id,index:l.index,vertexIds:l.vertexIds.slice(),portals:l.portals.map((function(e){return e.slice()})),cost:1,visited:!1,closed:!1,parent:null,centroid:f.dl.from(l.centroid),neighbours:[]})}}catch(m){c.e(m)}finally{c.f()}var s,u=h(i);try{for(u.s();!(s=u.n()).done;){var p=s.value;r.registerEdge(p)}}catch(m){u.e(m)}finally{u.f()}var d,g=h(o);try{for(g.s();!(d=g.n()).done;){var v=d.value,y=r.getNodeById(v.id);y.neighbours=r.getSuccs(y).map((function(e){return e.index}))}}catch(m){g.e(m)}finally{g.f()}return r.vectors=a.map(f.dl.from),r}}]),n}(p.b),O=n(88767),Z=n(18907);function P(e,t,n){return(0,O.useQuery)(function(e){return"pathfinding-".concat(e)}(e),(function(){var n=t;return Z.k.setZoneData(e,n),{zone:n,floorGraph:w.fromZone(n)}}),{enabled:!!t&&!n,keepPreviousData:!0,staleTime:1/0})}}}]);