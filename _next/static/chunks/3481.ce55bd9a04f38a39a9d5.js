"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3481],{73481:function(n,e,t){t.r(e),t.d(e,{default:function(){return S}});var o,r=t(52209),i=t(97131),a=t(59748),l=t(88269),u=t(95090),c=t(36694),s=t(48103),d=t(91441),p=t(84175),h=t(68451),f=t(60168),g=t(95814),m=t(35650),b=t(27375),y=t(87079),v=t(30245),w=t(8311);function A(n,e){var t="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(n,e){if(!n)return;if("string"===typeof n)return k(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(n);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return k(n,e)}(n))||e&&n&&"number"===typeof n.length){t&&(n=t);var o=0,r=function(){};return{s:r,n:function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}},e:function(n){throw n},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,l=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return a=n.done,n},e:function(n){l=!0,i=n},f:function(){try{a||null==t.return||t.return()}finally{if(l)throw i}}}}function k(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}function S(n){var e=(0,b.Z)(),t=(0,g.Z)(x).data,o=a.default.useMemo((function(){return t?[(0,f.mI)(t,[1,0,0,1,0,0])]:[]}),[t]),r=(0,m.Z)((function(){return{clipPath:"none",doorsApi:{},isHoleShown:{},wire:new u.x,onToggleLight:function(n){var e=n.target,t=Number(e.getAttribute("data-index"));t in r.isHoleShown?delete r.isHoleShown[t]:r.isHoleShown[t]=!0,r.updateMasks()},updateMasks:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=(0,p.Nh)(t),a=o.doors,l=o.windows,u=o.holes,c=o.pngRect,d=o.hullOutline,f=o.holesWithDoors,g=o.roomGraph,m=Object.keys(r.isHoleShown).map(Number),b=r.doorsApi.getOpen(0),y=m.flatMap((function(n){var e=g.nodesArray[n],t=g.getAdjacentDoors(e).map((function(n){return n.doorIndex})).filter((function(n){return b.includes(n)})),o=a.flatMap((function(n,e){return t.includes(e)?[]:n.poly})),r=t.map((function(e){var t=a[e],r=g.getAdjacentRooms(g.getDoorNode(e)),i=t.holeIds[0]===n?1:t.holeIds[1]===n?-1:null;null===i&&console.warn("hole ".concat(n,": door ").concat(e,": roomSign is null"));var l=t.poly.center.addScaledVector(t.normal,20*(i||0)),u=s.LA.union(r.map((function(n){return f[n.holeIndex]})))[0],c=o.flatMap((function(n){return h.J.triangulationToPolys(n.fastTriangulate())}));return h.J.lightPolygon(l,1e3,c,u)})),c=g.getAdjacentWindows(e).map((function(n){return n.windowIndex})).map((function(e){var t=l[e],o=g.getAdjacentRooms(g.getWindowNode(e)),r=t.holeIds[0]===n?1:t.holeIds[1]===n?-1:null;null===r&&console.warn("hole ".concat(n,": window ").concat(e,": roomSign is null"));var i=t.poly.center.addScaledVector(t.normal,60*(r||0)),a=s.LA.union(o.map((function(n){return u[n.holeIndex]})).concat(t.poly))[0];return h.J.lightPolygon(i,1e3,void 0,a)}));return[].concat((0,i.Z)(r),(0,i.Z)(c))})),v=m.map((function(n){return f[n]})).concat(y).map((function(n){return n.precision(3)})),w=g.getAdjacentDoors.apply(g,(0,i.Z)(m.map((function(n){return g.nodesArray[n]}))));this.doorsApi.setObservableDoors(0,w.map((function(n){return n.doorIndex})));var A=s.LA.cutOut(v,[d]).map((function(n){return n.translate(-c.x,-c.y)})),k=A.map((function(n){return"".concat(n.svgPath)})).join(" ");e(),setTimeout((function(){r.clipPath="path('".concat(k,"')"),e()}),n)}}}),[t]);return a.default.useEffect((function(){if(t){var n,e=A(Object.keys(r.isHoleShown).map(Number));try{for(e.s();!(n=e.n()).done;){var o=n.value;t.holes[o]||delete r.isHoleShown[o]}}catch(a){e.e(a)}finally{e.f()}r.updateMasks();var i=r.wire.pipe((0,c.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){return r.updateMasks("closed-door"===n.key?300:0)}));return function(){return i.unsubscribe()}}}),[t]),(0,w.tZ)(y.Z,{dark:!0,className:Z,children:t&&(0,w.BX)(w.HY,{children:[(0,w.tZ)("img",{className:"geomorph",src:(0,d.qX)(x),draggable:!1,style:{left:t.pngRect.x,top:t.pngRect.y,width:t.pngRect.width,height:t.pngRect.height}}),(0,w.tZ)("img",{className:"geomorph-dark",src:(0,d.qX)(x),draggable:!1,style:{left:t.pngRect.x,top:t.pngRect.y,width:t.pngRect.width,height:t.pngRect.height,clipPath:r.clipPath,WebkitClipPath:r.clipPath}}),(0,w.tZ)("div",{className:"light-toggles",onClick:r.onToggleLight,children:t.holeSwitches.map((function(n,e){return(0,w.tZ)("div",{"data-index":e,className:"toggle",style:{left:n.x-5,top:n.y-5,borderColor:r.isHoleShown[e]?"#5f5":"rgba(200, 0, 0, 0.3)",outline:r.isHoleShown[e]?"1px solid black":"1px solid rgba(255, 255, 255, 0.5)"}},e)}))}),(0,w.tZ)(v.Z,{gms:o,wire:r.wire,onLoad:function(n){return r.doorsApi=n}})]})})}var x="g-101--multipurpose",Z=(0,l.iv)(o||(o=(0,r.Z)(["\n  img.geomorph-dark {\n    position: absolute;\n    filter: invert(100%) brightness(45%) contrast(200%) sepia(0%) hue-rotate(0deg) blur(0px);\n  }\n  img.geomorph {\n    position: absolute;\n    filter: brightness(65%) sepia(50%) hue-rotate(180deg);\n  }\n  div.light-toggles {\n    position: absolute;\n\n    div.toggle {\n      border-radius: 5px;\n      border: 5px solid white;\n      position: absolute;\n      cursor: pointer;\n    }\n  }\n  svg.room-graph {\n    position: absolute;\n    pointer-events: none;\n    circle, line {\n      pointer-events: none;\n    }\n  }\n"])))}}]);