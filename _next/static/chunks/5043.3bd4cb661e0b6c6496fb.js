(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5043],{61572:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return E}});var o=n(79056),a=n(97131),r=n(52209),i=n(59748),s=n(88269),l=n(95090),d=n(36694),p=n(91441),c=n(48103),g=n(27375),u=n(44275),f=n(97301),h=n(87079),m=n(30245),y=n(94184),b=n.n(y),k=n(84175),v=n(7008),x=n(2026),w=n(19964);var C=JSON.parse('{"HB":{"idle":{"animName":"idle","aabb":{"x":1,"y":0,"width":128,"height":128},"frames":[[{"tags":["leg-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(85, 85, 85)","pointer-events":"none"},"tagName":"path","d":"M 60 44.8 L 60 64.2 L 40.569 64.094 L 40.464 44.726 L 60 44.8 Z"},{"tags":["leg-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","pointer-events":"none","fill":"rgb(85, 85, 85)"},"tagName":"path","d":"M 60 63.8 L 60 83.2 L 40.569 83.094 L 40.464 63.726 L 60 63.8 Z"},{"tags":["arm-l"],"style":{"stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(0, 0, 255)","pointer-events":"none"},"tagName":"path","d":"M 73.757 27.592 C 77.488 33.379 73.687 40.059 71.654 40.059 C 69.621 40.059 42.563 45.526 42.563 40.897 C 42.563 38.575 48.41 31.536 52.168 28.766 C 55.903 26.014 61.447 25.498 62.46 25.498 C 63.391 25.498 70.604 22.702 73.757 27.592 Z"},{"tags":["arm-r"],"style":{"stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(0, 0, 255)","pointer-events":"none"},"tagName":"path","d":"M 73.757 98.868 C 77.488 93.081 73.687 86.401 71.654 86.401 C 69.621 86.401 42.563 80.934 42.563 85.563 C 42.563 87.885 48.41 94.924 52.168 97.694 C 55.903 100.446 61.447 100.962 62.46 100.962 C 63.391 100.962 70.604 103.758 73.757 98.868 Z"},{"tags":["chest"],"transform":[0.01447,0.999895,-0.999895,0.01447,121.633866,2.25406],"style":{"stroke":"rgb(0, 0, 0)","stroke-width":"0.5px","fill-opacity":"0.6","pointer-events":"none"},"tagName":"path","d":"M 80.075 74.799 C 70.043 83.088 51.376 82.024 41.04 74.116 C 34.966 69.469 32.911 53.997 34.653 52.08 C 39.876 46.332 46.16 45.915 46.16 45.915 C 46.16 45.915 56.074 44.754 61.102 44.935 C 66.859 45.142 78.137 47.856 78.137 47.856 C 78.137 47.856 80.794 48.058 84.152 51.354 C 85.779 52.95 86.19 69.746 80.075 74.799 Z"},{"tags":["shoulders"],"transform":[0.996287,-0.086089,0.086089,0.996287,-4.280137,5.791421],"style":{"stroke":"rgb(0, 0, 0)","pointer-events":"none","fill-opacity":"0.8"},"tagName":"path","d":"M 71.193 45.781 C 69.548 47.998 67.392 68.574 68.64 82.936 C 68.823 85.04 69.426 91.476 69.032 93.334 C 67.512 100.5 64.866 101.625 60.057 101.209 C 49.367 100.284 43.193 90.748 39.398 84.544 C 35.603 78.34 40.237 47.595 41.122 43.481 C 42.481 37.165 53.855 23.986 61.01 23.986 C 67.733 23.986 67.432 24.652 71.794 26.234 C 76.128 27.806 72.962 43.397 71.193 45.781 Z"},{"tags":["head"],"transform":[-1,0,0,-1,0,0],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","fill":"rgb(244, 212, 255)","stroke-width":"0.25px","pointer-events":"none"},"tagName":"ellipse","cx":-66.745,"cy":-63.901,"rx":14.49,"ry":14.792},{"tags":["hair"],"transform":[-1,0,0,-1,129.848003,127.802002],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-width":"0.25px","pointer-events":"none"},"tagName":"path","d":"M 77.593 63.901 C 77.593 72.07 71.106 78.693 63.103 78.693 C 55.1 78.693 52.255 73.558 52.255 65.389 C 52.255 57.22 55.1 49.109 63.103 49.109 C 71.106 49.109 77.593 55.732 77.593 63.901 Z"}]]},"walk":{"animName":"walk","aabb":{"x":1,"y":0,"width":128,"height":128},"frames":[[{"tags":["leg-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(85, 85, 85)","pointer-events":"none"},"tagName":"path","d":"M 61 44.8 L 61 64.2 L 41.569 64.094 L 34.682 60.232 L 34.476 50.851 L 41.464 44.726 L 61 44.8 Z"},{"tags":["leg-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","pointer-events":"none","fill":"rgb(85, 85, 85)"},"tagName":"path","d":"M 61 63.8 L 61 83.2 L 41.569 83.094 L 41.464 63.726 L 61 63.8 Z"},{"tags":["arm-l"],"style":{"stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(0, 0, 255)","pointer-events":"none"},"tagName":"path","d":"M 74.757 27.592 C 78.488 33.379 74.687 40.059 72.654 40.059 C 70.621 40.059 43.563 45.526 43.563 40.897 C 43.563 38.575 49.41 31.536 53.168 28.766 C 56.903 26.014 62.447 25.498 63.46 25.498 C 64.391 25.498 71.604 22.702 74.757 27.592 Z"},{"tags":["arm-r"],"style":{"stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(0, 0, 255)","pointer-events":"none"},"tagName":"path","d":"M 71.324 98.99 C 75.055 93.203 74.687 86.401 72.654 86.401 C 70.621 86.401 43.563 80.934 43.563 85.563 C 43.563 87.885 49.41 94.924 53.168 97.694 C 56.903 100.446 62.447 100.962 63.46 100.962 C 64.391 100.962 68.171 103.88 71.324 98.99 Z"},{"tags":["chest"],"transform":[0.01447,0.999895,-0.999895,0.01447,122.663403,1.105447],"style":{"stroke":"rgb(0, 0, 0)","stroke-width":"0.5px","fill-opacity":"0.6","pointer-events":"none"},"tagName":"path","d":"M 81.223 74.845 C 71.191 83.134 52.524 82.07 42.188 74.162 C 36.114 69.515 34.059 54.043 35.801 52.126 C 41.024 46.378 47.308 45.961 47.308 45.961 C 47.308 45.961 57.222 44.8 62.25 44.981 C 68.007 45.188 79.285 47.902 79.285 47.902 C 79.285 47.902 81.942 48.104 85.3 51.4 C 86.927 52.996 87.338 69.792 81.223 74.845 Z"},{"tags":["shoulders"],"transform":[0.996287,-0.086089,0.086089,0.996287,-5.241301,5.215904],"style":{"stroke":"rgb(0, 0, 0)","pointer-events":"none","fill-opacity":"0.8"},"tagName":"path","d":"M 73.097 46.523 C 71.452 48.74 69.296 69.316 70.544 83.678 C 70.727 85.782 71.33 92.218 70.936 94.076 C 69.416 101.242 66.77 102.367 61.961 101.951 C 51.271 101.026 45.097 91.49 41.302 85.286 C 37.507 79.082 42.141 48.337 43.026 44.223 C 44.385 37.907 55.759 24.728 62.914 24.728 C 69.637 24.728 69.336 25.394 73.698 26.976 C 78.032 28.548 74.866 44.139 73.097 46.523 Z"},{"tags":["head"],"transform":[-1,0,0,-1,0,0],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","fill":"rgb(244, 212, 255)","stroke-width":"0.25px","pointer-events":"none"},"tagName":"ellipse","cx":-67.745,"cy":-63.901,"rx":14.49,"ry":14.792},{"tags":["hair"],"transform":[-1,0,0,-1,131.848003,127.802002],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-width":"0.25px","pointer-events":"none"},"tagName":"path","d":"M 78.593 63.901 C 78.593 72.07 72.106 78.693 64.103 78.693 C 56.1 78.693 53.255 73.558 53.255 65.389 C 53.255 57.22 56.1 49.109 64.103 49.109 C 72.106 49.109 78.593 55.732 78.593 63.901 Z"}],[{"tags":["leg-l"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(85, 85, 85)","pointer-events":"none"},"tagName":"path","d":"M 61 44.8 L 61 64.2 L 41.569 64.094 L 34.682 60.232 L 34.476 50.851 L 41.464 44.726 L 61 44.8 Z"},{"tags":["leg-r"],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","pointer-events":"none","fill":"rgb(85, 85, 85)"},"tagName":"path","d":"M 61 63.8 L 61 83.2 L 41.569 83.094 L 41.464 63.726 L 61 63.8 Z"},{"tags":["arm-l"],"style":{"stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(0, 0, 255)","pointer-events":"none"},"tagName":"path","d":"M 74.757 27.592 C 78.488 33.379 74.687 40.059 72.654 40.059 C 70.621 40.059 43.563 45.526 43.563 40.897 C 43.563 38.575 49.41 31.536 53.168 28.766 C 56.903 26.014 62.447 25.498 63.46 25.498 C 64.391 25.498 71.604 22.702 74.757 27.592 Z"},{"tags":["arm-r"],"style":{"stroke":"rgb(0, 0, 0)","stroke-opacity":"0.5","stroke-width":"0.5px","fill":"rgb(0, 0, 255)","pointer-events":"none"},"tagName":"path","d":"M 71.324 98.99 C 75.055 93.203 74.687 86.401 72.654 86.401 C 70.621 86.401 43.563 80.934 43.563 85.563 C 43.563 87.885 49.41 94.924 53.168 97.694 C 56.903 100.446 62.447 100.962 63.46 100.962 C 64.391 100.962 68.171 103.88 71.324 98.99 Z"},{"tags":["chest"],"transform":[0.01447,0.999895,-0.999895,0.01447,122.663403,1.105447],"style":{"stroke":"rgb(0, 0, 0)","stroke-width":"0.5px","fill-opacity":"0.6","pointer-events":"none"},"tagName":"path","d":"M 81.223 74.845 C 71.191 83.134 52.524 82.07 42.188 74.162 C 36.114 69.515 34.059 54.043 35.801 52.126 C 41.024 46.378 47.308 45.961 47.308 45.961 C 47.308 45.961 57.222 44.8 62.25 44.981 C 68.007 45.188 79.285 47.902 79.285 47.902 C 79.285 47.902 81.942 48.104 85.3 51.4 C 86.927 52.996 87.338 69.792 81.223 74.845 Z"},{"tags":["shoulders"],"transform":[0.996287,-0.086089,0.086089,0.996287,-5.241301,5.215904],"style":{"stroke":"rgb(0, 0, 0)","pointer-events":"none","fill-opacity":"0.8"},"tagName":"path","d":"M 73.097 46.523 C 71.452 48.74 69.296 69.316 70.544 83.678 C 70.727 85.782 71.33 92.218 70.936 94.076 C 69.416 101.242 66.77 102.367 61.961 101.951 C 51.271 101.026 45.097 91.49 41.302 85.286 C 37.507 79.082 42.141 48.337 43.026 44.223 C 44.385 37.907 55.759 24.728 62.914 24.728 C 69.637 24.728 69.336 25.394 73.698 26.976 C 78.032 28.548 74.866 44.139 73.097 46.523 Z"},{"tags":["head"],"transform":[-1,0,0,-1,0,0],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","fill":"rgb(244, 212, 255)","stroke-width":"0.25px","pointer-events":"none"},"tagName":"ellipse","cx":-67.745,"cy":-63.901,"rx":14.49,"ry":14.792},{"tags":["hair"],"transform":[-1,0,0,-1,131.848003,127.802002],"style":{"fill-opacity":"0.5","stroke":"rgb(0, 0, 0)","stroke-width":"0.25px","pointer-events":"none"},"tagName":"path","d":"M 78.593 63.901 C 78.593 72.07 72.106 78.693 64.103 78.693 C 56.1 78.693 53.255 73.558 53.255 65.389 C 53.255 57.22 56.1 49.109 64.103 49.109 C 72.106 49.109 78.593 55.732 78.593 63.901 Z"}]]}},"sP":2}');n(77503),n(292),n(26470),n(7951),n(28949),n(42830),n(89539),n(21801);n(48764).Buffer;var Z,N,P=15,I=n(8311);function L(t){var e=(0,g.Z)(),n=function(t,e){var n=i.default.useState((function(){return t.gms.map((function(t){return t.key}))})),r=(0,o.Z)(n,2),s=r[0],l=r[1];i.default.useMemo((function(){var e=t.gms.map((function(t){return t.key})).filter((function(t){return!s.includes(t)}));e.length&&l([].concat((0,a.Z)(s),(0,a.Z)(e)))}),[t]);var d=s.map((function(n){return(0,w.Z)(n,t.gmData[n],e)})),p=t.gms.every((function(t){return s.includes(t.key)}))&&d.every((function(t){return t.data}));return i.default.useMemo((function(){return p?{pfs:t.gms.map((function(t){var e=s.findIndex((function(e){return e===t.key}));return(0,k.Nh)(d[e].data)}))}:{pfs:[]}}),[p])}(t.gmGraph,t.disabled),r=(0,u.Z)((function(){return{npc:{},debugPath:{},getGlobalNavPath:function(e,n){var o=t.gmGraph.gms,a=o.findIndex((function(t){return t.gridRect.contains(e)})),i=o.findIndex((function(t){return t.gridRect.contains(n)}));if(-1===a||-1===i)return(0,x.vU)("getGlobalNavPath: src/dst must be inside some geomorph's aabb"),null;if(a===i)return{paths:[r.getLocalNavPath(a,e,n)],edges:[]};var s=t.gmGraph.findPath(e,n);if(!s)return(0,x.vU)("getGlobalNavPath: gmGraph.findPath not found: ".concat(JSON.stringify(e)," -> ").concat(JSON.stringify(n))),null;for(var l=[],d=0;d<s.length+1;d++)0===d?l[d]=r.getLocalNavPath(a,e,s[0].src.exit):d===s.length?l[d]=r.getLocalNavPath(i,s[d-1].dst.entry,n):l[d]=r.getLocalNavPath(s[d-1].dst.gmId,s[d-1].dst.entry,s[d].src.exit);return{paths:l,edges:s}},getLocalNavPath:function(e,o,a){var r=t.gmGraph.gms[e],i=n.pfs[e],s=r.inverseMatrix.transformPoint(c.dl.from(o)),l=r.inverseMatrix.transformPoint(c.dl.from(a)),d=i.graph.findPath(s,l);return d?[c.dl.from(s)].concat(d.normalisedPaths.flatMap((function(t){return t}))).map((function(t){return r.matrix.transformPoint(t).precision(2)})):[]},moveNpcAlongPath:function(t,n){t.origPath=n.map(c.dl.from),t.animPath=t.origPath.slice(),t.updateAnimAux(),t.followNavPath(),e()},npcRef:function(t){if(t){var e=t.getAttribute("data-npc-key"),n=r.npc[e];n.el.root=t,n.el.body=t.childNodes[0],n.el.root.style.transform="translate(".concat(n.def.position.x,"px, ").concat(n.def.position.y,"px)"),n.el.body.style.transform="scale(".concat(G,") rotate(").concat(S,"deg)")}}}}),{deps:[n,t.doorsApi]});return i.default.useEffect((function(){var n=(0,v.f)(t.wireKey),o=n.subscribe((function(o){if("spawn"===o.key)r.npc[o.npcKey]=function(t,e,n){var o=n.disabled,a=n.panZoomApi,r=n.update;return{key:t,uid:"".concat(t,"-").concat((0,p.PX)()),def:{key:t,position:e,angle:0,paused:!!o},el:{root:{},body:{}},anim:{root:new Animation,body:new Animation},animPath:[],aux:{angs:[],count:0,edges:[],elens:[],navPathPolys:[],sofars:[],total:0},origPath:[],spriteSheet:"idle",followNavPath:function(){var t=this,e=this.aux;if(!(this.animPath.length<=1||0===e.total)){var n="paused"===this.anim.root.playState;this.anim.root=this.el.root.animate(this.animPath.flatMap((function(t,n){return[{offset:e.sofars[n]/e.total,transform:"translate(".concat(t.x,"px, ").concat(t.y,"px) rotateZ(").concat(e.angs[n-1]||e.angs[n]||0,"rad)")},{offset:e.sofars[n]/e.total,transform:"translate(".concat(t.x,"px, ").concat(t.y,"px) rotateZ(").concat(e.angs[n]||e.angs[n-1]||0,"rad)")}]})),{duration:e.total*P,direction:"normal",fill:"forwards"}),this.spriteSheet="walk",this.anim.root.addEventListener("finish",(function(){t.spriteSheet="idle",r()})),(n||0===e.count&&this.def.paused)&&this.pause(),e.count++}},getAngle:function(){var t=new DOMMatrixReadOnly(window.getComputedStyle(this.el.root).transform);return Math.atan2(t.m12,t.m11)},getPosition:function(){var t=c.dl.from(this.el.root.getBoundingClientRect()),e=t.x,n=t.y;return c.dl.from(a.getWorld({clientX:e,clientY:n}))},pause:function(){"running"===this.anim.body.playState&&this.anim.body.pause()},updateAnimAux:function(){var t=this.animPath,e=this.aux;e.edges=t.map((function(e,n){return{p:e,q:t[n+1]}})).slice(0,-1),e.angs=e.edges.map((function(t){return Number(Math.atan2(t.q.y-t.p.y,t.q.x-t.p.x).toFixed(2))})),e.elens=e.edges.map((function(t){var e=t.p,n=t.q;return Number(e.distanceTo(n).toFixed(2))})),e.navPathPolys=e.edges.map((function(t){var e=t.q.clone().sub(t.p).rotate(Math.PI/2).normalize(.01);return new c.LA([t.p.clone().add(e),t.q.clone().add(e),t.q.clone().sub(e),t.p.clone().sub(e)])}));var n=e.elens.reduce((function(t,e){return t.total+=e,t.sofars.push(t.sofars[t.sofars.length-1]+e),t}),{sofars:[0],total:0}),o=[n.sofars,n.total];e.sofars=o[0],e.total=o[1]}}}(o.npcKey,o.at,{panZoomApi:t.panZoomApi,update:e,disabled:t.disabled}),e();else if("nav-req"===o.key){var i=r.npc[o.npcKey],s=r.getGlobalNavPath(i.getPosition(),o.dst);n.next({key:"nav-res",req:o,res:s})}else if("move-req"===o.key){var l=r.npc[o.npcKey],d=r.moveNpcAlongPath(l,o.path);n.next({key:"move-res",req:o,res:d})}else if("debug-path"===o.key){var g=o.path.map(c.dl.from);r.debugPath[o.pathName]={path:g,aabb:c.UL.from.apply(c.UL,(0,a.Z)(g)).outset(10)},e()}}));return Object.values(r.npc).forEach((function(t){delete r.npc[t.key],n.next({key:"spawn",npcKey:t.key,at:t.getPosition()})})),function(){return o.unsubscribe()}}),[t.panZoomApi]),(0,I.BX)("div",{className:b()("npcs",M),onClick:function(t){if(t.target instanceof HTMLDivElement&&t.target.classList.contains("body")){var n=t.target.getAttribute("data-npc-key"),o=r.npc[n];o.spriteSheet=K[(K.indexOf(o.spriteSheet)+1)%K.length],e()}},children:[(0,I.tZ)(j,{debugPath:r.debugPath}),Object.values(r.npc).map((function(t){return(0,I.tZ)("div",{ref:r.npcRef,className:b()("npc",t.key,t.spriteSheet,q),"data-npc-key":t.key,children:(0,I.tZ)("div",{className:b()("body",t.key,"no-select"),"data-npc-key":t.key})},t.uid)}))]})}var A,M=(0,s.iv)(Z||(Z=(0,r.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"]))),R=C.HB,O=C.sP,G=.3,S=0,K=(0,k.XP)(R),q=(0,s.iv)(N||(N=(0,r.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    pointer-events: all;\n    filter: grayscale(100%);\n    /* transform: scale(0.18) rotate(90deg); */\n  }\n  \n  /* &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 0.45s steps(",") infinite;\n    background: url('/npc/first-npc--walk.png');\n  } */\n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 0.45s steps(",") infinite;\n    background: url('/npc/guard1_walk.png');\n  }\n  /* &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: idle 2s steps(",") infinite;\n    background: url('/npc/first-npc--idle.png');\n  } */\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    /* animation: idle 2s steps(",") infinite; */\n    background: url('/npc/guard1_walk.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  /* @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  } */\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n"])),R.walk.aabb.width*O,R.walk.aabb.height*O,-R.walk.aabb.width*O*.5,-R.walk.aabb.height*O*.5,R.walk.frames.length,128,128,-64,-64,10,R.idle.aabb.width*O,R.idle.aabb.height*O,-R.idle.aabb.width*O*.5,-R.idle.aabb.height*O*.5,R.idle.frames.length,128,128,-64,-64,1,-R.walk.frames.length*R.walk.aabb.width*O,-1280,128*-R.idle.frames.length*O);function j(t){return(0,I.tZ)(I.HY,{children:Object.entries(t.debugPath).map((function(t){var e=(0,o.Z)(t,2),n=e[0],a=e[1],r=a.path,i=a.aabb;return(0,I.tZ)("svg",{className:"debug-path",width:i.width,height:i.height,style:{position:"absolute",left:i.x,top:i.y},children:(0,I.BX)("g",{style:{transform:"translate(".concat(-i.x,"px, ").concat(-i.y,"px)")},children:[(0,I.tZ)("polyline",{fill:"none",stroke:"blue",strokeWidth:2,points:"".concat(r)}),r.map((function(t){return(0,I.tZ)("circle",{fill:"none",stroke:"red",r:2.5,cx:t.x,cy:t.y})}))]})},n)}))})}function E(t){var e=(0,g.Z)(),n=(0,f.Z)([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]},{layoutKey:"g-302--xboat-repair-bay",transform:[1,0,0,1,-1200,600]},{layoutKey:"g-303--passenger-deck",transform:[1,0,0,-1,-1200,1800]},{layoutKey:"g-302--xboat-repair-bay",transform:[-1,0,0,1,2400,600]},{layoutKey:"g-301--bridge",transform:[1,0,0,-1,0,2400]}]),o=n.gms,a=n.gmGraph,r=(0,u.Z)((function(){return{gmId:0,roomId:2,initOpen:{0:[24]},clipPath:o.map((function(t){return"none"})),doorsApi:{ready:!1},npcsApi:{},panZoomApi:{},wire:new l.x,update:function(){r.updateClipPath(),r.updateVisibleDoors(),e()},updateClipPath:function(){var t=o[r.gmId],e=o.map((function(t){return[]})),n=r.doorsApi.getOpen(r.gmId),i=a.computeLightPolygons(r.gmId,r.roomId,n);o.forEach((function(n,o){var a=i.filter((function(t){return o===t.gmIndex})).map((function(t){return t.poly.precision(2)}));e[o]=n===t?c.LA.cutOut(a.concat(t.roomsWithDoors[r.roomId]),[n.hullOutline]):c.LA.cutOut(a,[n.hullOutline])})),e.forEach((function(t,e){t.forEach((function(t){return t.translate(-o[e].pngRect.x,-o[e].pngRect.y)}));var n=t.map((function(t){return"".concat(t.svgPath)})).join(" ");r.clipPath[e]=n.length?"path('".concat(n,"')"):"none"}))},updateVisibleDoors:function(){var t=this,e=o[r.gmId],n=e.roomGraph.nodesArray[r.roomId],i=o.map((function(t){return[]}));i[r.gmId]=e.roomGraph.getAdjacentDoors(n).map((function(t){return t.doorId})),e.roomGraph.getAdjacentHullDoorIds(e,n).flatMap((function(t){var e=t.hullDoorIndex;return a.getAdjacentRoomCtxt(r.gmId,e)||[]})).forEach((function(t){var e=t.adjGmId,n=t.adjDoorId;return i[e]=[n]})),o.forEach((function(e,n){return t.doorsApi.setVisible(n,i[n])}))}}}),{overwrite:{gmId:!0,roomId:!0},deps:[o,a]});return i.default.useEffect((function(){if(o.length&&r.doorsApi.ready){r.update();var t=r.wire.pipe((0,d.h)((function(t){return"closed-door"===t.key||"opened-door"===t.key}))).subscribe((function(t){r.update()}));return function(){return t.unsubscribe()}}}),[o,r.doorsApi.ready]),o.length?(0,I.BX)(h.Z,{className:X,zoom:.4,dark:!0,wireKey:D,onLoad:function(t){return r.panZoomApi=t},children:[o.map((function(t){return(0,I.tZ)("img",{className:"geomorph",src:(0,p.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}})})),(0,I.tZ)(L,{disabled:t.disabled,doorsApi:r.doorsApi,gmGraph:a,panZoomApi:r.panZoomApi,wireKey:D}),o.map((function(t,e){return(0,I.tZ)("img",{className:"geomorph-dark",src:(0,p.qX)(t.key),draggable:!1,width:t.pngRect.width,height:t.pngRect.height,style:{clipPath:r.clipPath[e],WebkitClipPath:r.clipPath[e],left:t.pngRect.x,top:t.pngRect.y,transform:t.transformStyle,transformOrigin:t.transformOrigin}},e)})),r.doorsApi.ready&&(0,I.tZ)(B,{showIds:!0,gms:o,gmGraph:a,doorsApi:r.doorsApi,gmId:r.gmId,roomId:r.roomId,setRoom:function(t,e){var n=[t,e];r.gmId=n[0],r.roomId=n[1],r.update()}}),(0,I.tZ)(m.Z,{gms:o,gmGraph:a,wire:r.wire,initOpen:r.initOpen,onLoad:function(t){r.doorsApi=t,e()}})]}):null}var D="wire-demo-1",X=(0,s.iv)(A||(A=(0,r.Z)(["\n  img {\n    position: absolute;\n    transform-origin: top left;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) brightness(60%);\n    /* opacity: 0.6; */\n  }\n\n  div.debug {\n    position: absolute;\n    div.debug-door-arrow {\n      cursor: pointer;\n      position: absolute;\n      background-image: url('/icon/solid_arrow-circle-right.svg');\n      border-radius: ","px;\n    }\n    div.debug-door-id-icon, div.debug-room-id-icon {\n      position: absolute;\n      background: black;\n      color: white;\n      font-size: 8px;\n      line-height: 1;\n      border: 1px solid black;\n    }\n    div.debug-room-id-icon {\n      color: #4f4;\n    }\n    div.debug-window {\n      position: absolute;\n      background: #0000ff40;\n      border: 1px solid white;\n      pointer-events: none;\n      transform-origin: top left;\n    }\n    svg.debug-room-nav {\n      position: absolute;\n      path.nav-poly {\n        pointer-events: none;\n        fill: rgba(255, 0, 0, 0.1);\n        stroke: blue;\n      }\n    }\n  }\n\n"])),5);function B(t){var e=t.gms[t.gmId],n=t.doorsApi.getVisible(t.gmId),r=e.lazy.roomNavPoly[t.roomId],i=c.UL.from.apply(c.UL,(0,a.Z)(r.map((function(t){return t.rect}))));return(0,I.BX)("div",{onClick:function(n){var a=n.target.getAttribute("data-debug-door-index");if(null!==a){var r=e.doors[Number(a)],i=r.roomIds.filter((function(e){return e!==t.roomId})),s=(0,o.Z)(i,1)[0];if(null!==s)return t.setRoom(t.gmId,s);var l=e.hullDoors.indexOf(r),d=t.gmGraph.getAdjacentRoomCtxt(t.gmId,l);d?t.setRoom(d.adjGmId,d.adjRoomId):console.info("hull door is isolated",t.gmId,l)}},children:[t.outlines&&t.gms.map((function(t,e){return(0,I.tZ)("div",{style:{position:"absolute",left:t.gridRect.x,top:t.gridRect.y,width:t.gridRect.width,height:t.gridRect.height,border:"2px red solid"}},e)})),(0,I.BX)("div",{className:"debug",style:{transform:e.transformStyle},children:[t.localNav&&(0,I.tZ)("svg",{className:"debug-room-nav",width:i.width,height:i.height,style:{left:i.x,top:i.y},children:(0,I.tZ)("g",{style:{transform:"translate(".concat(-i.x,"px, ").concat(-i.y,"px)")},children:r.map((function(t,e){return(0,I.tZ)("path",{className:"nav-poly",d:t.svgPath},e)}))})}),n.map((function(n){var o=e.doors[n],a=o.poly,r=o.normal,i=o.roomIds[0]===t.roomId?1:-1,s=c.dl.from(r).scale(-i).angle,l=a.center.addScaledVector(r,18*i),d=a.center.addScaledVector(r,18*-i);return(0,I.BX)(I.HY,{children:[(0,I.tZ)("div",{"data-debug-door-index":n,className:"debug-door-arrow",style:{left:l.x-5,top:l.y-5,width:10,height:10,transform:"rotate(".concat(s,"rad)")}},n),t.showIds&&(0,I.tZ)("div",{className:"debug-door-id-icon",style:{left:d.x,top:d.y-4},children:n},"icon")]})})),t.showIds&&(0,I.tZ)("div",{className:"debug-room-id-icon",style:{left:i.x,top:i.bottom},children:t.roomId}),t.windows&&e.windows.map((function(t,e){var n=t.rect,o=t.angle;return(0,I.tZ)("div",{className:"debug-window",style:{left:n.x,top:n.y,width:n.width,height:n.height,transform:"rotate(".concat(o,"rad)")}},"window-".concat(e))}))]},e.itemKey)]})}},69862:function(){},40964:function(){},28949:function(){}}]);