"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{80003:function(t,n,e){e.r(n);var r,o,a=e(52209),i=e(92809),c=e(79056),s=e(59748),l=e(88269),u=e(94184),p=e.n(u),f=e(8935),d=e(35490),g=e(48103),h=e(50269),m=e(83159),v=e(91441),y=e(95814),b=e(8311);function w(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"===typeof t)return x(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return x(t,n)}(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){c=!0,a=t},f:function(){try{i||null==e.return||e.return()}finally{if(c)throw a}}}}function x(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function Z(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function O(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?Z(Object(e),!0).forEach((function(n){(0,i.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):Z(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}n.default=(0,f.withSize)({refreshMode:"debounce"})((function(t){var n=(0,y.Z)(t.layoutKey).data,e=s.default.useState((function(){return{root3d:{},eye:{},svg:{},onUpdate:function(t){var n=t.viewBox.baseVal.height,e=d.r.height/n,o=r.root3d,a=r.eye;if(o){o.style.perspective="".concat(100+500/e,"px");var i=a.getBoundingClientRect(),c=(0,h.zk)({clientX:i.x,clientY:i.y,ownerSvg:t,pointerId:null});o.style.perspectiveOrigin="".concat(c.x,"px ").concat(c.y,"px")}}}})),r=(0,c.Z)(e,1)[0];return(0,b.BX)(D,{children:[(0,b.tZ)(m.Z,{gridBounds:d.l,initViewBox:d.r,maxZoom:6,onUpdate:r.onUpdate,dark:!0,children:n&&!t.disabled&&(0,b.BX)("g",{ref:function(t){t&&(r.root3d=t.querySelector(".root-3d"),r.svg=t.ownerSVGElement,setTimeout((function(){return r.onUpdate(t.ownerSVGElement)})))},children:[(0,b.tZ)("image",O(O({},n.pngRect),{},{href:(0,v.qX)(t.layoutKey)})),(0,b.tZ)(P,{gm:n})]})}),(0,b.tZ)("div",{className:"eye",ref:function(t){return t&&(r.eye=t)}})]})}));var D=(0,l.zo)("div")(r||(r=(0,a.Z)(["\n  height: 100%;\n  > .eye {\n    position: absolute;\n    width: 2px;\n    height: 2px;\n    top: calc(50% - 1px);\n    left: calc(50% - 1px);\n    background: red;\n    pointer-events: none;\n  }\n"])));function P(t){var n=t.gm,e=function(t){return s.default.useMemo((function(){var n=document.createElement("canvas"),e=n.getContext("2d"),r=[t.pngRect.width,t.pngRect.height];n.width=r[0],n.height=r[1],e.translate(-t.pngRect.x,-t.pngRect.y);var o=t.groups.walls;e.fillStyle=U,(0,h.Fx)(e,o);var a=n.toDataURL();e.clearRect(0,0,n.width,n.height);var i=t.groups.obstacles;e.fillStyle=j,(0,h.Fx)(e,i);var c=n.toDataURL();e.clearRect(0,0,n.width,n.height),e.font=v.Dv.font,e.textBaseline="top";var s,l=w(t.labels);try{for(l.s();!(s=l.n()).done;){var u=s.value,p=u.text,f=u.rect,d=u.padded;e.fillStyle="#000",e.fillRect(d.x,d.y,d.width,d.height),e.fillStyle="#fff",e.fillText(p,f.x,f.y)}}catch(g){l.e(g)}finally{l.f()}return{wallsDataUrl:a,obstaclesDataUrl:c,labelsDataUrl:n.toDataURL()}}),[t.groups.walls])}(n),r=e.wallsDataUrl,o=e.obstaclesDataUrl,a=e.labelsDataUrl,i=s.default.useMemo((function(){return{wallSegs:n.groups.walls.flatMap((function(t){return t.translate(-n.pngRect.x,-n.pngRect.y).lineSegs})),doorSegs:n.doors.map((function(t){var e=(0,c.Z)(t.seg,2);return[e[0],e[1]].map((function(t){return g.dl.from(t).translate(-n.pngRect.x,-n.pngRect.y)}))})),obstacleSegs:n.groups.obstacles.flatMap((function(t){return t.translate(-n.pngRect.x,-n.pngRect.y).lineSegs}))}}),[n.groups.walls]),l=i.wallSegs,u=i.doorSegs,f=i.obstacleSegs;return(0,b.tZ)("foreignObject",O(O({xmlns:"http://www.w3.org/1999/xhtml"},n.pngRect),{},{children:(0,b.BX)("div",{className:p()("root-3d",B),children:[l.map((function(t,n){var e=(0,c.Z)(t,2),r=e[0],o=e[1];return S.copy(o).sub(r),(0,b.tZ)("div",{className:"wall",style:{transform:"translate3d(".concat(r.x,"px, ").concat(r.y,"px, 0px) rotateZ(").concat(S.angle,"rad) rotateX(90deg)"),width:S.length}},"wall-".concat(n))})),f.map((function(t,n){var e=(0,c.Z)(t,2),r=e[0],o=e[1];return S.copy(o).sub(r),(0,b.tZ)("div",{className:"obstacle",style:{transform:"translate3d(".concat(r.x,"px, ").concat(r.y,"px, 0px) rotateZ(").concat(S.angle,"rad) rotateX(90deg)"),width:S.length}},"obstacle-".concat(n))})),u.map((function(t,n){var e=(0,c.Z)(t,2),r=e[0],o=e[1];return S.copy(r).sub(o),(0,b.tZ)("div",{className:"door",style:{transform:"translate3d(".concat(o.x,"px, ").concat(o.y,"px, 0px) rotateZ(").concat(S.angle,"rad) rotateX(90deg)"),width:S.length}},"door-".concat(n))})),(0,b.tZ)("img",{src:r,className:"wall-tops"}),(0,b.tZ)("img",{src:o,className:"obstacle-tops"}),(0,b.tZ)("img",{src:a,className:"labels"})]})}))}var S=g.dl.zero,j="#666",k="#444",U="#222",R="#000",N="#444",B=(0,l.iv)(o||(o=(0,a.Z)(["\n  pointer-events: none;\n  transform-style: preserve-3d;\n  \n  .door {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n  }\n  .obstacle {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n    backface-visibility: hidden;\n  }\n  .wall {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n    backface-visibility: hidden;\n  }\n  .obstacle-tops {\n    position: absolute;\n    transform-origin: top left;\n    transform: translateZ(","px);\n  }\n  .labels, .wall-tops {\n    position: absolute;\n    transform-origin: top left;\n    transform: translateZ(","px);\n  }\n"])),150,N,75,k,150,R,75,150)},35490:function(t,n,e){e.d(n,{l:function(){return o},r:function(){return a}});var r=e(48103),o=new r.UL(-5e3,-5e3,10001,10001),a=new r.UL(0,0,1200,600)},95814:function(t,n,e){e.d(n,{Z:function(){return m}});var r=e(79056),o=e(92809),a=e(97131),i=e(30266),c=e(809),s=e.n(c),l=e(88767),u=e(91441),p=e(48103),f=e(2026),d=e(39660);function g(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?g(Object(e),!0).forEach((function(n){(0,o.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):g(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t){return(0,l.useQuery)((0,u.tU)(t),(0,i.Z)(s().mark((function n(){var e,o,i,c,l,f,g;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=d.Vn,n.next=3,fetch((0,u.tU)(t)).then((function(t){return t.json()}));case 3:return n.t1=n.sent,e=(0,n.t0)(n.t1),o=e.roomGraph,i=o.nodesArray.filter((function(t){return"room"===t.type})).map((function(t,n){var r=o.getEdgesFrom(t).flatMap((function(t){var n=t.dst;return"door"===n.type?e.doors[n.doorId].poly:[]}));return p.LA.union([e.rooms[n]].concat((0,a.Z)(r)))[0]})),c=e.groups.singles.filter((function(t){return t.tags.includes("spawn")})).map((function(t){return t.poly.center})),l=e.groups.singles.filter((function(t){return t.tags.includes("switch")})).map((function(t){return t.poly.center})),f=e.groups.singles.filter((function(t){return t.tags.includes("light")})).map((function(t){var n=t.poly.rect;return[n.center,n]})),(g=h(h({},e),{},{hullDoors:e.doors.filter((function(t){return t.tags.includes("hull")})),hullOutline:e.hullPoly[0].removeHoles(),pngRect:p.UL.fromJson(e.items[0].pngRect),roomsWithDoors:i,point:{all:[].concat(f.map((function(t){return t[0]})),c,l),light:f.reduce((function(t,n,o){var a=(0,r.Z)(n,2),i=a[0],c=a[1],s=e.rooms.findIndex((function(t){return t.contains(i)})),l=e.doors.findIndex((function(t){return t.rect.intersects(c)}));return s>=0&&l>=0?(t[s]=t[s]||{})[l]=i:console.warn("useGeomorphData: light ".concat(o," roomId/doorId ").concat(s,"/").concat(l)),t}),{}),spawn:e.rooms.map((function(t){return c.filter((function(n){return t.contains(n)}))})),switch:e.rooms.map((function(t){return l.find((function(n){return t.contains(n)}))||t.rect.center}))},lazy:null})).lazy=v(g),y(g),n.abrupt("return",g);case 14:case"end":return n.stop()}}),n)}))),{cacheTime:1/0,keepPreviousData:!0,staleTime:1/0})}function v(t){var n={roomNavPoly:{}},e=new Proxy({},{get:function(e,r){if("string"===typeof r){var o=Number(r);if(t.roomsWithDoors[o]&&!n.roomNavPoly[o]){var a=p.LA.intersect(t.navPoly,[t.roomsWithDoors[o]]);a.sort((function(t,n){return t.rect.area>n.rect.area?-1:1})),n.roomNavPoly[o]=a[0]}return n.roomNavPoly[o]}}});return new Proxy(n,{get:function(t,n){if("roomNavPoly"===n)return e}})}function y(t){t.navZone.doorNodeIds.forEach((function(n,e){var r=t.doors[e];if(t.hullDoors.includes(r)){var o,i=r.roomIds.find((function(t){return null!==t}));if(Number.isFinite(i))(o=t.navZone.roomNodeIds[i]).push.apply(o,(0,a.Z)(n));else(0,f.ZK)("extendRoomNodeIds: ".concat(t.key," (hull) door ").concat(e," has empty roomIds"))}}))}},83159:function(t,n,e){e.d(n,{Z:function(){return d}});var r,o=e(52209),a=e(79056),i=e(59748),c=e(88269),s=e(94184),l=e.n(s),u=e(48103),p=e(50269),f=e(8311);function d(t){var n=i.useState((function(){var n=t.initViewBox.clone(),a=t.minZoom||.5,i=t.maxZoom||2;return{viewBox:n,panFrom:null,zoom:t.initZoom||1,ptrs:[],ptrDiff:null,root:{},rootCss:(0,c.iv)(r||(r=(0,o.Z)(["\n        width: 100%;\n        height: 100%;\n\n        touch-action: pan-x pan-y pinch-zoom;\n        background-color: ",";\n\n        > g.content {\n          /** TODO justification? */\n          shape-rendering: ",";\n        }\n        > .grid {\n          pointer-events: none;\n        }\n      "])),t.dark?"#000":"none",(0,p.us)()?"optimizeSpeed":"auto"),onPointerDown:function(t){(0,p.af)(t)&&e.ptrs.length<2&&(e.panFrom=(new u.dl).copy((0,p.zk)((0,p.Xs)(t))),e.ptrs.push((0,p.Xs)(t)))},onPointerMove:function(r){if(e.ptrs=e.ptrs.map((function(t){return t.pointerId===r.pointerId?(0,p.Xs)(r):t})),2===e.ptrs.length){var o=Math.abs(e.ptrs[1].clientX-e.ptrs[0].clientX);if(null!==e.ptrDiff){var a,i=(0,p._Y)(e.ptrs);e.zoomTo(i,.02*(o-e.ptrDiff)),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(a=t.onUpdate)||void 0===a||a.call(t,e.root)}e.ptrDiff=o}else if(e.panFrom){var c,s=(0,p.zk)((0,p.Xs)(r));n.delta(e.panFrom.x-s.x,e.panFrom.y-s.y),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(c=t.onUpdate)||void 0===c||c.call(t,e.root)}},onPointerUp:function(t){e.panFrom=null,e.ptrs=e.ptrs.filter((function(n){return t.pointerId!==n.pointerId})),e.ptrs.length<2&&(e.ptrDiff=null),1===e.ptrs.length&&(e.panFrom=(new u.dl).copy((0,p.zk)(e.ptrs[0])))},onTouchStart:function(t){t.preventDefault()},onWheel:function(n){if(n.preventDefault(),(0,p.af)(n)){var r,o=(0,p.zk)((0,p.Xs)(n));e.zoomTo(o,-.003*n.deltaY),e.root.setAttribute("viewBox","".concat(e.viewBox)),null===(r=t.onUpdate)||void 0===r||r.call(t,e.root)}},rootRef:function(t){t&&(e.root=t,t.addEventListener("wheel",e.onWheel,{passive:!1}),t.addEventListener("pointerdown",e.onPointerDown,{passive:!0}),t.addEventListener("pointermove",e.onPointerMove,{passive:!0}),t.addEventListener("pointerup",e.onPointerUp,{passive:!0}),t.addEventListener("pointercancel",e.onPointerUp,{passive:!0}),t.addEventListener("pointerleave",e.onPointerUp,{passive:!0}),t.addEventListener("touchstart",e.onTouchStart,{passive:!1}))},zoomTo:function(r,o){var c=Math.min(Math.max(e.zoom+o,a),i);n.x=e.zoom/c*(n.x-r.x)+r.x,n.y=e.zoom/c*(n.y-r.y)+r.y,n.width=1/c*t.initViewBox.width,n.height=1/c*t.initViewBox.height,e.zoom=c}}})),e=(0,a.Z)(n,1)[0];return(0,f.BX)("svg",{ref:e.rootRef,className:e.rootCss,preserveAspectRatio:"xMinYMin slice",viewBox:"".concat(e.viewBox),children:[(0,f.tZ)("g",{className:l()("content",t.className),children:t.children}),(0,f.tZ)(g,{bounds:t.gridBounds,dark:t.dark})]})}function g(t){var n=i.useMemo((function(){return h++}),[]);return(0,f.tZ)(f.HY,{children:[10,60].flatMap((function(e){return[(0,f.tZ)("defs",{children:(0,f.tZ)("pattern",{id:"pattern-grid-".concat(e,"x").concat(e,"--").concat(n),width:e,height:e,patternUnits:"userSpaceOnUse",children:(0,f.tZ)("path",{d:"M ".concat(e," 0 L 0 0 0 ").concat(e),fill:"none",stroke:t.dark?"rgba(200,200,200,0.2)":"rgba(0,0,0,0.5)",strokeWidth:"0.3"})})}),(0,f.tZ)("rect",{className:"grid",x:t.bounds.x,y:t.bounds.y,width:t.bounds.width,height:t.bounds.height,fill:"url(#pattern-grid-".concat(e,"x").concat(e,"--").concat(n,")")})]}))})}var h=0}}]);