"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[64],{65064:function(t,e,n){n.r(e),n.d(e,{default:function(){return w}});var r,o=n(52209),i=n(79056),a=n(92809),l=n(30266),s=n(809),c=n.n(s),u=n(59748),p=n(88269),g=n(88767),d=n(48103),f=n(84273),y=n(83159),E=n(43350),b=n(8311);function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){(0,a.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function w(t){var e=(0,g.useQuery)("".concat(t.layoutKey,"-json"),(0,l.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/geomorph/".concat(t.layoutKey,".json")).then((function(t){return t.json()})));case 1:case"end":return e.stop()}}),e)})))).data;return(0,b.tZ)(y.Z,{gridBounds:E.l,initViewBox:E.r,maxZoom:6,className:O,children:e&&(0,b.BX)(b.HY,{children:[(0,b.tZ)("image",h(h({},e.pngRect),{},{className:"geomorph",href:"/geomorph/".concat(t.layoutKey,".png")})),(0,b.tZ)(m,{gm:e})]})})}function m(t){var e=t.gm,n=u.default.useState(1),r=(0,i.Z)(n,2),o=(r[0],r[1]),a=u.default.useState((function(){return{position:new d.dl(300,300),target:new d.dl(300,300),dragging:!1,startDrag:function(t){t.stopPropagation(),s.dragging=!0,s.lineEl.style.display="inline",s.target.copy(s.position),["x1","x2"].forEach((function(t){return s.lineEl.setAttribute(t,String(s.position.x))})),["y1","y2"].forEach((function(t){return s.lineEl.setAttribute(t,String(s.position.y))}));var e=s.lineEl.ownerSVGElement;e.addEventListener("pointermove",s.onMove),e.addEventListener("pointerleave",s.endDrag),e.addEventListener("pointerup",s.applyDrag),window.addEventListener("keydown",s.endDragOnEscape),e.style.cursor="grabbing"},onMove:function(t){if(s.dragging){var e=(0,f.zk)({clientX:t.clientX,clientY:t.clientY,ownerSvg:s.lineEl.ownerSVGElement,pointerId:null}),n=e.x,r=e.y;s.target.set(n,r),s.lineEl.setAttribute("x2",String(n)),s.lineEl.setAttribute("y2",String(r))}},endDrag:function(){s.dragging=!1,s.lineEl.style.display="none",s.lineEl.setAttribute("x2",s.lineEl.getAttribute("x1")),s.lineEl.setAttribute("y2",s.lineEl.getAttribute("y1"));var t=s.lineEl.ownerSVGElement;t.removeEventListener("pointermove",s.onMove),t.removeEventListener("pointerleave",s.endDrag),t.removeEventListener("pointerup",s.applyDrag),window.removeEventListener("keydown",s.endDragOnEscape),t.style.cursor="auto"},applyDrag:function(){s.endDrag(),s.position.copy(s.target),s.lineEl.setAttribute("x1",String(s.target.x)),s.lineEl.setAttribute("y1",String(s.target.y)),o((function(t){return++t}))},endDragOnEscape:function(t){"Escape"===t.key&&s.endDrag()},lineEl:{}}})),l=(0,i.Z)(a,2),s=l[0],c=(l[1],(0,u.useMemo)((function(){var t=e.walls.map((function(t){return d.LA.from(t)})).flatMap((function(t){return f.J7.triangulationToPolys(t.fastTriangulate())})),n=f.J7.lightPolygon(s.position,1e3,t),r=n.rect;return{polygon:n,sourceRatios:s.position.clone().sub(r).scale(1/r.width,1/r.height)}}),[s.position.x,s.position.y]));return(0,b.BX)(b.HY,{children:[(0,b.tZ)("defs",{children:(0,b.BX)("radialGradient",{id:"light-radial",cx:"".concat(100*c.sourceRatios.x,"%"),cy:"".concat(100*c.sourceRatios.y,"%"),r:"50%",children:[(0,b.tZ)("stop",{offset:"0%",style:{stopColor:"rgba(255, 255, 225, 0.7)"}}),(0,b.tZ)("stop",{offset:"40%",style:{stopColor:"rgba(200, 200, 200, 0.2)"}}),(0,b.tZ)("stop",{offset:"100%",style:{stopColor:"rgba(255, 200, 255, 0)"}})]})}),(0,b.tZ)("path",{fill:"url(#light-radial)",d:c.polygon.svgPath}),(0,b.tZ)("line",{ref:function(t){return t&&(s.lineEl=t)},className:"drag-indicator"}),(0,b.tZ)("circle",{className:"light",cx:s.position.x,cy:s.position.y,r:10,onPointerDown:s.startDrag,onPointerUp:s.applyDrag})]})}var O=(0,p.iv)(r||(r=(0,o.Z)(["\n  .light {\n    fill: white;\n    stroke: black;\n    cursor: pointer;\n    stroke-width: 2;\n  }\n  .drag-indicator {\n    stroke: black;\n    display: none;\n    stroke-width: 2.5;\n    user-select: none;\n  }\n"])))}}]);