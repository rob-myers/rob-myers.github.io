(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[880],{52542:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r=n(52209),i=n(58377),s=n(92809),o=n(88823),a=n(11163),c=(n(59748),n(88269)),l=n(38456),u=n.n(l),h=n(76388),d=n.n(h),p=n(10043),m=n.n(p);function f(){var e=(0,r.Z)(["\n  h1 {\n    margin: 48px 0 24px;\n    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;\n    font-size: 7.5rem;\n    font-weight: 300;\n    cursor: pointer;\n    \n    @media(max-width: 1024px) {\n      margin: 12px 0 24px;\n      font-size: 6rem;\n    }\n    @media(max-width: 800px) {\n      font-size: 5rem;\n    }\n    @media(max-width: 400px) {\n      font-size: 3.6rem;\n    }\n  }\n  \n  p {// Site subtitle\n    color: #444;\n    margin: 0 0 32px 0;\n    padding-top: 8px;\n    letter-spacing: 1px;\n    font-size: 1rem;\n    font-family: monospace;\n   \n    @media(max-width: 400px) {\n      font-size: 0.8rem;\n      padding-top: 0;\n    }\n  }\n"]);return f=function(){return e},e}function v(){var e=(0,r.Z)(["\n  font-size: 1.2rem;\n  @media(max-width: 540px) {\n    font-size: 1.1rem;\n  }\n  \n  p {\n    line-height: 1.5;\n  }\n  code {\n    font-size: 12pt;\n    font-family: Courier, monospace;\n    color: #444;\n    background: #eee;\n  }\n  ul, ol {\n    margin: 20px 0;\n    line-height: 1.4;\n    li {\n      margin: 8px 0;\n      ul, ol {\n        line-height: 1.2;\n      }\n    }\n  }\n  ul.contains-task-list {\n    padding-left: 12px;\n    li.task-list-item {\n      list-style: none;\n    }\n  }\n\n  span.float {\n    float: right;\n    color: #555;\n    @media(max-width: 480px) {\n      float: unset;\n      display: block;\n      margin-top: 8px;\n    }\n  }\n\n  table {\n    border: 1px solid #ccc;\n    border-left: 4px solid #999;\n\n    th, td {\n      text-align: left;\n      vertical-align: top;\n      padding: 8px;\n      @media(max-width: 540px) {\n        padding: 4px 2px;\n      }\n    }\n  }\n\n  hr {\n    margin: 32px 0 24px;\n    height: 4px;\n    background: #ddd;\n    border-color: #ddd;\n  }\n"]);return v=function(){return e},e}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e){return(0,o.tZ)("div",{className:e.title?Z:k,children:(0,o.tZ)(u(),g({rehypePlugins:[d()],remarkPlugins:[m()],components:e.title?b:x},e))})}var b={h1(e){var{children:t}=e,n=(0,i.Z)(e,["children"]),r=(0,a.useRouter)();return(0,o.tZ)("h1",g(g({onClick:()=>r.push("/")},n),{},{children:t}))}},x={a(e){var{node:t,href:n,title:r,children:s}=e,a=(0,i.Z)(e,["node","href","title","children"]);return(0,o.tZ)("a",g(g(g({href:n,target:["@external"].includes(r)?"_blank":void 0,title:r},"#command"===n&&{onClick:e=>{e.preventDefault(),console.warn("link triggered command:",r)}}),a),{},{children:s}))},float(e){var{children:t}=e,n=(0,i.Z)(e,["children"]);return(0,o.tZ)("span",g(g({},n),{},{className:"float",style:g(g({},n.style),{},{fontSize:n.rem?"".concat(n.rem,"rem"):void 0}),children:t}))}},k=(0,c.iv)(v()),Z=(0,c.iv)(f())},22200:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(88823),i=n(52542);function s(){return(0,r.tZ)(i.Z,{title:!0,children:"\n  # Rogue Markup\n\n  $( roguelike | built online | game ai )\n\n  ---\n"})}},86576:function(e,t,n){"use strict";n.d(t,{I8:function(){return o},IC:function(){return a},Ql:function(){return c},Z$:function(){return l},wO:function(){return u},or:function(){return h},$G:function(){return d},Q8:function(){return p},BH:function(){return m},RT:function(){return f}});var r=n(92809),i=n(87668),s=n.n(i);function o(e){return JSON.parse(JSON.stringify(e))}function a(e){return JSON.stringify(e,null,"\t")}function c(e){return"testNever: ".concat(a(e)," not implemented.")}function l(e){return e[e.length-1]}function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((t=>setTimeout((()=>t()),e)))}function h(e){return"function"===typeof e?function(e){return e.trim().replace(/\s\s+/g," ").trim()}("".concat(e)):function(e){try{var t=[];return JSON.stringify(e,((e,n)=>"function"===typeof n?"[Function]".concat((t=Object.keys(n)).length?" ...{".concat(t,"} "):""):n))}catch(n){}}(e)||s()(e,((e,t)=>t instanceof HTMLElement?"HTMLElement[".concat(t.nodeName,"]"):t))}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e.length<=t?e:"".concat(e.slice(0,t)," ...")}function p(e,t){var n,r={};return(n=e,Object.keys(n)).forEach((n=>r[n]=t(e[n]))),r}class m{constructor(){(0,r.Z)(this,"resolve",null),(0,r.Z)(this,"reject",null),(0,r.Z)(this,"promise",new Promise(((e,t)=>{this.resolve=e,this.reject=t})))}}function f(e){return Array.from(v(e))}function*v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(null===e||void 0===e?void 0:e.constructor){case Object:for(var[n,r]of Object.entries(e))yield*v(r,[...t,n]);break;default:yield t.join("/")}}},29950:function(e,t,n){"use strict";n.d(t,{VN:function(){return a},v8:function(){return l},ww:function(){return h},$r:function(){return d},nL:function(){return p},Wc:function(){return m}});var r=n(83465),i=n.n(r),s=n(17473),o=n(86576);function a(e){return i()(e)}function c(e){var t,n,r;switch(e.type){case"ArithmCmd":case"ArithmExp":return[e.X];case"ArrayElem":return[...e.Index?[e.Index]:[],e.Value];case"ArrayExpr":return e.Elems;case"Assign":return[...e.Array?[e.Array]:[],...e.Index?[e.Index]:[],...e.Value?[e.Value]:[]];case"BinaryArithm":case"BinaryCmd":case"BinaryTest":return[e.X,e.Y];case"Block":return e.Stmts;case"CStyleLoop":return[e.Cond,e.Init,e.Post];case"CallExpr":return[].concat(e.Args,e.Assigns);case"CaseClause":return[].concat(e.Items,e.Word);case"CaseItem":return[].concat(e.Patterns,e.Stmts);case"CmdSubst":return e.Stmts;case"Comment":return[];case"CoprocClause":return[e.Stmt];case"DblQuoted":return e.Parts;case"DeclClause":return[].concat(e.Args,e.Variant);case"ExtGlob":return[];case"File":return e.Stmts;case"ForClause":return[...e.Do,e.Loop];case"FuncDecl":return[e.Body,e.Name];case"IfClause":return[...e.Cond,...e.Then,...e.Else?[e.Else]:[]];case"LetClause":return e.Exprs;case"Lit":return[];case"ParamExp":return[...null!==(t=e.Exp)&&void 0!==t&&t.Word?[e.Exp.Word]:[],...e.Index?[e.Index]:[],e.Param,...e.Repl?[e.Repl.Orig]:[],...null!==(n=e.Repl)&&void 0!==n&&n.With?[e.Repl.With]:[],...e.Slice?[e.Slice.Offset]:[],...null!==(r=e.Slice)&&void 0!==r&&r.Length?[e.Slice.Length]:[]];case"ParenArithm":case"ParenTest":return[e.X];case"ProcSubst":return e.Stmts;case"Redirect":return[...e.Hdoc?[e.Hdoc]:[],...e.N?[e.N]:[],e.Word];case"SglQuoted":return[];case"Stmt":return[...e.Cmd?[e.Cmd]:[],...e.Redirs];case"Subshell":return e.Stmts;case"TestClause":return[e.X];case"TimeClause":return[...e.Stmt?[e.Stmt]:[]];case"UnaryArithm":case"UnaryTest":return[e.X];case"WhileClause":return e.Cond.concat(e.Do);case"Word":return e.Parts;case"WordIter":return e.Items;default:throw(0,o.Ql)(e)}}function l(e,t){return{opts:u((0,s.Z)(e,t)),operands:e.filter((e=>"-"!==e[0]))}}function u(e){var t=e;return Object.keys(e).forEach((n=>{t.__optKeys=[],"_"!==n&&(Array.isArray(e[n])&&(t[n]=(0,o.Z$)(e[n])),t.__optKeys.push(n))})),t}function h(e,t){t(e),c(e).forEach((e=>h(e,t)))}function d(e){return h(e,(e=>{c(e).forEach((t=>t.parent=e))})),e}function p(e){return{type:"File",Stmts:"Stmt"===e.type?[e]:e.Stmts,meta:e.meta}}function m(e){return e.Else?[e,...m(e.Else)]:[e]}},63509:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Rt}});var r=n(88823),i=n(52209),s=n(59748),o=n(88269);class a{constructor(e,t){this.x=e,this.y=t}get angle(){return Math.atan2(this.y,this.x)}get coord(){return[this.x,this.y]}get json(){return{x:this.x,y:this.y}}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}get lengthSquared(){return this.x*this.x+this.y*this.y}static get zero(){return new a(0,0)}add(e){var{x:t,y:n}=e;return this.translate(t,n)}static average(e){return e.length?e.reduce(((e,t)=>e.add(t)),a.zero).scale(1/e.length):a.zero}clone(){return new a(this.x,this.y)}copy(e){return this.set(e.x,e.y)}distanceTo(e){return Math.sqrt(Math.pow(e.x-this.x,2)+Math.pow(e.y-this.y,2))}dot(e){return this.x*e.x+this.y*e.y}equals(e){var{x:t,y:n}=e;return this.x===t&&this.y===n}static from(e){return Array.isArray(e)?new a(e[0],e[1]):new a(e.x,e.y)}normalize(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.length?this.scale(e/this.length):(console.error("Cannot normalize Vector2 '".concat(this,"' to length '").concat(e,"'")),this)}rotate(e){var[t,n]=[this.x,this.y];return this.x=Math.cos(e)*t-Math.sin(e)*n,this.y=Math.sin(e)*t+Math.cos(e)*n,this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}scale(e){return this.x*=e,this.y*=e,this}set(e,t){return this.x=e,this.y=t,this}sub(e){var{x:t,y:n}=e;return this.translate(-t,-n)}toString(){return"".concat(this.x,",").concat(this.y)}transform(e){var{a:t,b:n,c:r,d:i,e:s,f:o}=e,{x:a,y:c}=this;return this.x=t*a+r*c+s,this.y=n*a+i*c+o,this}translate(e,t){return this.x+=e,this.y+=t,this}}class c{constructor(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r}get area(){return this.width*this.height}get bottom(){return this.y+this.height}get bottomLeft(){return new a(this.x,this.y+this.height)}get bottomRight(){return new a(this.x+this.width,this.y+this.height)}get center(){return new a(this.cx,this.cy)}get cx(){return this.x+.5*this.width}get cy(){return this.y+.5*this.height}get geoJson(){return{type:"Polygon",coordinates:[[[this.x,this.y],[this.x+this.width,this.y],[this.x+this.width,this.y+this.height],[this.x,this.y+this.height]]]}}get json(){return{x:this.x,y:this.y,width:this.width,height:this.height}}get key(){return"".concat(this.x,",").concat(this.y,",").concat(this.width,",").concat(this.height)}get dimension(){return Math.max(this.width,this.height)}get points(){return[new a(this.x,this.y),new a(this.x,this.y+this.height),new a(this.x+this.width,this.y+this.height),new a(this.x+this.width,this.y)]}get right(){return this.x+this.width}get topLeft(){return new a(this.x,this.y)}get topRight(){return new a(this.x+this.width,this.y)}static get zero(){return new c(0,0,0,0)}applyMatrix(e){if(!e.isIdentity){var t=e.transformPoint(this.topLeft),n=e.transformPoint(this.bottomRight);this.x=Math.min(t.x,n.x),this.y=Math.min(t.y,n.y),this.width=Math.max(t.x,n.x)-this.x,this.height=Math.max(t.y,n.y)-this.y}return this}clone(){return new c(this.x,this.y,this.width,this.height)}contains(e){var{x:t,y:n}=e;return this.x<=t&&t<=this.x+this.width&&this.y<=n&&n<=this.y+this.height}copy(e){var{x:t,y:n,width:r,height:i}=e;return this.x=t,this.y=n,this.width=r,this.height=i,this}covers(e){var{x:t,y:n,width:r,height:i}=e;return this.x<=t&&t+r<=this.x+this.width&&this.y<=n&&n+i<=this.y+this.height}delta(e,t){return this.x+=e,this.y+=t,this}static from(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length){if(t[0]instanceof a){var r=t,i=Math.min(...r.map((e=>{var{x:t}=e;return t}))),s=Math.min(...r.map((e=>{var{y:t}=e;return t}))),o=Math.max(...r.map((e=>{var{x:t}=e;return t}))),l=Math.max(...r.map((e=>{var{y:t}=e;return t})));return new c(i,s,o-i,l-s)}var u=t,h=Math.min(...u.map((e=>{var{x:t}=e;return t}))),d=Math.min(...u.map((e=>{var{y:t}=e;return t}))),p=Math.max(...u.map((e=>{var{x:t,width:n}=e;return t+n}))),m=Math.max(...u.map((e=>{var{y:t,height:n}=e;return t+n})));return new c(h,d,p-h,m-d)}return c.zero}static fromJson(e){var{x:t,y:n,width:r,height:i}=e;return new c(t,n,r,i)}inset(e){var[t,n]=[this.cx,this.cy];this.outset(-e),this.width<0&&(this.x=t,this.width=0),this.height<0&&(this.y=n,this.height=0)}intersects(e){return 2*Math.abs(this.cx-e.cx)<=this.width+e.width&&2*Math.abs(this.cy-e.cy)<=this.height+e.height}offset(e){var{x:t,y:n}=e;return this.x+=t,this.y+=n,this}outset(e){return this.x-=e,this.y-=e,this.width+=2*e,this.height+=2*e,this}scale(e){return this.x*=e,this.y*=e,this.width*=e,this.height*=e,this}setPosition(e){return this.x=e.x,this.y=e.y,this}toString(){return"".concat(this.x,",").concat(this.y,",").concat(this.width,",").concat(this.height)}}var l=n(90831),u=n(32676),h=n(9187),d=n.n(h);class p{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.outline=e,this.holes=t}get allPoints(){return this.outline.concat(...this.holes)}applyMatrix(e){return e.isIdentity||(this.outline=this.outline.map((t=>a.from(e.transformPoint(t)))),this.holes.forEach((t=>t.map((t=>a.from(e.transformPoint(t))))))),this}cleanFinalReps(){for(var e of[this.outline,...this.holes]){var t=e.pop();t&&!t.equals(e[0])&&e.push(t)}return this}clone(){var e=this.outline.map((e=>e.clone())),t=this.holes.map((e=>e.map((e=>e.clone()))));return new p(e,t)}createInset(e){if(0===e)return[this.clone()];var[t,...n]=[{ring:this.outline,inset:p.insetRing(this.outline,e)},...this.holes.map((t=>({ring:t,inset:p.insetRing(t,e)})))].map((e=>{var{ring:t,inset:n}=e;return t.map(((e,r)=>new p([t[r].clone(),n[r],n[(r+1)%t.length],t[(r+1)%t.length].clone()])))}));return e>0?p.cutOut(t.concat(...n),[this.clone()]):p.union([this.clone()].concat(t,...n))}createOutset(e){return this.createInset(-e)}static cutOut(e,t){return u.difference(t.map((e=>{var{geoJson:{coordinates:t}}=e;return t})),...e.map((e=>{var{geoJson:{coordinates:t}}=e;return t}))).map((e=>p.from(e).cleanFinalReps()))}fastTriangulate(){var{coordinates:e}=this.geoJson,t=d().flatten(e),n=d()(t.vertices,t.holes,2),r=n.reduce(((e,t,r)=>r%3===2?e.concat([[n[r-2],n[r-1],t]]):e),[]);return{vs:this.allPoints,tris:r}}static from(e){return e instanceof Array?new p(e[0].map((e=>{var[t,n]=e;return new a(t,n)})),e.slice(1).map((e=>e.map((e=>{var[t,n]=e;return new a(t,n)}))))):new p(e.coordinates[0].map((e=>{var[t,n]=e;return new a(t,n)})),e.coordinates.slice(1).map((e=>e.map((e=>{var[t,n]=e;return new a(t,n)})))))}static fromRect(e){return new p(e.points)}get geoJson(){return{type:"Polygon",coordinates:[this.outline.map((e=>{var{x:t,y:n}=e;return[t,n]}))].concat(this.holes.map((e=>e.map((e=>{var{x:t,y:n}=e;return[t,n]})))))}}static getLinesIntersection(e,t,n,r){var i=t.x,s=t.y,o=e.x,a=e.y,c=r.x,l=r.y,u=n.x,h=n.y;return Math.abs(-s*c+i*l)<1e-4?null:(c*(h-a)-l*(u-o))/(s*c-l*i)}static insetRing(e,t){var n=new p(e).tangents.outer,r=e.map(((r,i)=>[r.clone().translate(t*-n[i].y,t*n[i].x),e[(i+1)%e.length].clone().translate(t*-n[i].y,t*n[i].x)]));return r.map(((e,t)=>{var i=(t+1)%r.length,s=r[i],o=p.getLinesIntersection(e[1],n[t],s[0],n[i]);return o?e[1].translate(o*n[t].x,o*n[t].y):a.average([e[1],s[0]])}))}get json(){return{type:"Polygon",coordinates:[this.outline.map((e=>{var{x:t,y:n}=e;return[t,n]})),...this.holes.map((e=>e.map((e=>{var{x:t,y:n}=e;return[t,n]}))))]}}qualityTriangulate(){try{var e=this.outline.map(((e,t)=>{var{x:n,y:r}=e;return{x:n,y:r,id:t}})),t=e.length,n=this.holes.map((e=>e.map((e=>{var{x:n,y:r}=e;return{x:n,y:r,id:t++}})))),r=new l.SweepContext(e).addHoles(n).triangulate().getTriangles().map((e=>[e.getPoint(0),e.getPoint(1),e.getPoint(2)])).map((e=>{var[t,n,r]=e;return[t.id,n.id,r.id]}));return{vs:this.allPoints,tris:r}}catch(i){return console.error("Quality triangulation failed, falling back to earcut"),console.error(i),this.fastTriangulate()}}static pointInTriangle(e,t,n,r){var i=p.sign(e,t,n),s=p.sign(e,n,r),o=p.sign(e,r,t);return!((i<0||s<0||o<0)&&(i>0||s>0||o>0))}get rect(){return c.from(...this.outline)}round(){return this.outline.forEach((e=>e.round())),this.holes.forEach((e=>e.forEach((e=>e.round())))),this}scale(e){return this.outline.forEach((t=>t.scale(e))),this.holes.forEach((t=>t.forEach((t=>t.scale(e))))),this}static sign(e,t,n){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}get tangents(){var e=[this.outline,...this.holes],[t,...n]=e.map((e=>e.concat(e[0]).reduce(((e,t,n,r)=>n>0?e.concat(t.clone().sub(r[n-1]).normalize()):[]),[])));return{outer:t,inner:n}}translate(e){return this.outline.forEach((t=>t.translate(e.x,e.y))),this.holes.forEach((t=>t.forEach((t=>t.translate(e.x,e.y))))),this}static union(e){return u.union([],...e.map((e=>{var{geoJson:{coordinates:t}}=e;return t}))).map((e=>p.from(e).cleanFinalReps()))}}var m,f=n(70956);function v(e,t){var n;return(m=m||(null===e||void 0===e?void 0:e.createSVGPoint())).x=t.clientX,m.y=t.clientY,m.matrixTransform(null===e||void 0===e||null===(n=e.getScreenCTM())||void 0===n?void 0:n.inverse())}function y(e){var t=[],n=[];return(0,f.makeAbsolute)((0,f.parseSVG)(e)).forEach((e=>{switch(e.code){case"M":t.push(n=[]);case"L":case"H":case"V":case"Z":r=e.x||0,i=e.y||0,n.push(new a(r,i));break;default:throw Error("svg command ".concat(e.command," is not supported"))}var r,i})),t.map((e=>new p(e)))}var g=0;function w(){var e=(0,i.Z)(["\n        width: 100%;\n        height: 100%;\n        background: #fff;\n        touch-action: pan-x pan-y pinch-zoom;\n      "]);return w=function(){return e},e}function b(e){var[t,n]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{},{1:t}=(0,s.useState)(0);return[(0,s.useCallback)((()=>t((e=>++e))),[]),(0,s.useMemo)(e,[])]}((()=>{var r=e.initViewBox.clone(),i=e.minZoom||.5,s=e.maxZoom||2;return{viewBox:r,panFrom:null,zoom:e.initZoom||1,ptrEvent:[],ptrDiff:null,zoomTo:(t,o)=>{var a=Math.min(Math.max(n.zoom+o,i),s);r.x=n.zoom/a*(r.x-t.x)+t.x,r.y=n.zoom/a*(r.y-t.y)+t.y,r.width=1/a*e.initViewBox.width,r.height=1/a*e.initViewBox.height,n.zoom=a},onWheel:e=>{e.preventDefault();var r=v(n.rootEl,e);n.zoomTo(r,-.003*e.deltaY),t()},onPointerDown:e=>{n.panFrom=new a(0,0).copy(v(n.rootEl,e)),n.ptrEvent.push(e)},onPointerMove:e=>{if(n.ptrEvent=n.ptrEvent.map((t=>t.pointerId===e.pointerId?e:t)),2===n.ptrEvent.length){var i=Math.abs(n.ptrEvent[1].clientX-n.ptrEvent[0].clientX);if(null!==n.ptrDiff){var s=function(e,t){var n;return(m=m||(null===e||void 0===e?void 0:e.createSVGPoint())).x=m.y=0,t.forEach((e=>{m.x+=e.clientX,m.y+=e.clientY})),m.x/=t.length||1,m.y/=t.length||1,m.matrixTransform(null===e||void 0===e||null===(n=e.getScreenCTM())||void 0===n?void 0:n.inverse())}(n.rootEl,n.ptrEvent);n.zoomTo(s,.02*(i-n.ptrDiff)),t()}n.ptrDiff=i}else if(n.panFrom){var o=v(n.rootEl,e);r.delta(n.panFrom.x-o.x,n.panFrom.y-o.y),t()}},onPointerUp:e=>{n.panFrom=null,n.ptrEvent=n.ptrEvent.filter((t=>e.pointerId!==t.pointerId)),n.ptrEvent.length<2&&(n.ptrDiff=null)},rootEl:null,rootRef:e=>{e&&(n.rootEl=e,e.addEventListener("wheel",n.onWheel),e.addEventListener("pointerdown",n.onPointerDown,{passive:!0}),e.addEventListener("pointermove",n.onPointerMove,{passive:!0}),e.addEventListener("pointerup",n.onPointerUp,{passive:!0}),e.addEventListener("pointercancel",n.onPointerUp,{passive:!0}),e.addEventListener("pointerleave",n.onPointerUp,{passive:!0}),e.addEventListener("pointerout",n.onPointerUp,{passive:!0}),e.addEventListener("touchstart",(e=>e.preventDefault())))},rootCss:(0,o.iv)(w())}}));return(0,r.BX)("svg",{ref:n.rootRef,className:n.rootCss,preserveAspectRatio:"xMinYMin",viewBox:"".concat(n.viewBox),children:[(0,r.tZ)(k,{bounds:e.gridBounds}),e.children]})}function x(e){var t=s.useMemo((()=>"".concat("grid-").concat(g++)),[]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)("defs",{children:(0,r.tZ)("pattern",{id:t,width:"10",height:"10",patternUnits:"userSpaceOnUse",children:(0,r.tZ)("path",{d:"M 10 0 L 0 0 0 10",fill:"none",stroke:"rgba(0,0,0,0.5)",strokeWidth:"0.3"})})}),(0,r.tZ)("rect",{x:e.bounds.x,y:e.bounds.y,width:e.bounds.width,height:e.bounds.height,fill:"url(#".concat(t,")")})]})}var k=s.memo(x);function Z(){var e=(0,i.Z)(["\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  border: 2px solid #000;\n\n  > p {\n    padding: 12px 8px;\n    margin: 0;\n    font-family: monospace;\n    font-size: 16px;\n    background: #eee;\n  }\n"]);return Z=function(){return e},e}var S=new c(-5e3,-5e3,10001,10001),P=new c(0,0,200,200);var C=(0,o.iv)(Z()),E={"panzoom/PanZoom.jsx":"import * as React from 'react';\nimport { css } from 'goober';\nimport { Vect, Rect } from '../geom';\nimport { getSvgPos, getSvgMid, generateId } from '../service';\nimport useForceRefresh from '../hooks/use-force-refresh';\n\n/** @param {React.PropsWithChildren<Props>} props */\nexport default function PanZoom(props) {\n\n  const [refresh, state] = useForceRefresh(() => {\n    const viewBox = props.initViewBox.clone();\n    const minZoom = props.minZoom || 0.5;\n    const maxZoom = props.maxZoom || 2;\n    return {\n      viewBox,\n      /** @type {null | Vect} */\n      panFrom: null,\n      zoom: props.initZoom || 1,\n      /** @type {PointerEvent[]} */\n      ptrEvent: [],\n      /** @type {null | number} */\n      ptrDiff: null,\n      /**\n       * @param {DOMPoint} point \n       * @param {number} delta \n       */\n      zoomTo: (point, delta) => {\n        const zoom = Math.min(Math.max(state.zoom + delta, minZoom), maxZoom);\n        viewBox.x = (state.zoom / zoom) * (viewBox.x - point.x) + point.x;\n        viewBox.y = (state.zoom / zoom) * (viewBox.y - point.y) + point.y;\n        viewBox.width = (1 / zoom) * props.initViewBox.width;\n        viewBox.height = (1 / zoom) * props.initViewBox.height;\n        state.zoom = zoom;\n      },\n      /** @param {WheelEvent} e */\n      onWheel: e => {\n        e.preventDefault();\n        const point = getSvgPos(state.rootEl, e);\n        state.zoomTo(point, - 0.003 * e.deltaY);\n        refresh();\n      },\n      /** @param {PointerEvent} e */\n      onPointerDown: e => {\n        state.panFrom = (new Vect(0, 0)).copy(getSvgPos(state.rootEl, e));\n        state.ptrEvent.push(e);\n      },\n      /** @param {PointerEvent} e */\n      onPointerMove: e => {\n        state.ptrEvent = state.ptrEvent.map(x => x.pointerId === e.pointerId ? e : x);\n\n        if (state.ptrEvent.length === 2) {\n          const ptrDiff = Math.abs(state.ptrEvent[1].clientX - state.ptrEvent[0].clientX);\n          if (state.ptrDiff !== null) {\n            const point = getSvgMid(state.rootEl, state.ptrEvent);\n            state.zoomTo(point, 0.02 * (ptrDiff - state.ptrDiff));\n            refresh();\n          }          \n          state.ptrDiff = ptrDiff;\n        } else if (state.panFrom) {\n          const mouse = getSvgPos(state.rootEl, e);\n          viewBox.delta(state.panFrom.x - mouse.x, state.panFrom.y - mouse.y);\n          refresh();\n        }\n      },\n      /** @param {PointerEvent} e */\n      onPointerUp: (e) => {\n        state.panFrom = null;\n        state.ptrEvent = state.ptrEvent.filter(alt => e.pointerId !== alt.pointerId);\n        if (state.ptrEvent.length < 2) state.ptrDiff = null;\n      },\n      /** @type {null | SVGSVGElement} */\n      rootEl: null,\n      /** @type {(el: null | SVGSVGElement) => void} */\n      rootRef: el => {\n        if (el) {\n          state.rootEl = el;\n          el.addEventListener('wheel', state.onWheel);\n          el.addEventListener('pointerdown', state.onPointerDown, { passive: true });\n          el.addEventListener('pointermove', state.onPointerMove, { passive: true });\n          el.addEventListener('pointerup', state.onPointerUp, { passive: true });\n          el.addEventListener('pointercancel', state.onPointerUp, { passive: true });\n          el.addEventListener('pointerleave', state.onPointerUp, { passive: true });\n          el.addEventListener('pointerout', state.onPointerUp, { passive: true });\n          el.addEventListener('touchstart', e => e.preventDefault());\n        }\n      },\n      rootCss: css`\n        width: 100%;\n        height: 100%;\n        background: #fff;\n        touch-action: pan-x pan-y pinch-zoom;\n      `,\n    };\n  });\n\n  return (\n    <svg\n      ref={state.rootRef}\n      className={state.rootCss}\n      preserveAspectRatio=\"xMinYMin\"\n      viewBox={`${state.viewBox}`}\n    >\n      <MemoedGrid bounds={props.gridBounds} />\n      {props.children}\n    </svg>\n  );\n}\n\n/**\n * @typedef Props @type {object}\n * @property {Rect} initViewBox Initial viewbox in world coords\n * @property {Rect} gridBounds World bounds\n * @property {number=} minZoom Minimum zoom factor (default 0.5)\n * @property {number=} maxZoom Maximum zoom factor (default 2)\n * @property {number=} initZoom Initial zoom factor (default 1)\n */\n\n/** @param {{ bounds: Rect }} props */\nfunction Grid(props) {\n  const gridId = React.useMemo(() => generateId('grid-'), []);\n\n  return <>\n    <defs>\n      <pattern\n        id={gridId}\n        width=\"10\" \n        height=\"10\"\n        patternUnits=\"userSpaceOnUse\"\n      >\n        <path\n          d=\"M 10 0 L 0 0 0 10\"\n          fill=\"none\"\n          stroke=\"rgba(0,0,0,0.5)\"\n          strokeWidth=\"0.3\"\n        />\n      </pattern>\n    </defs>\n    <rect\n      x={props.bounds.x}\n      y={props.bounds.y}\n      width={props.bounds.width}\n      height={props.bounds.height}\n      fill={`url(#${gridId})`}\n    />\n  </>;\n}\n\nconst MemoedGrid = React.memo(Grid);\n","panzoom/PanZoomDemo.jsx":"import * as React from 'react';\nimport { css } from 'goober';\nimport PanZoom from './PanZoom';\nimport { Rect } from '../geom';\n\nconst gridBounds = new Rect(-5000, -5000, 10000 + 1, 10000 + 1);\nconst initViewBox = new Rect(0, 0, 200, 200);\n\nexport default function PanZoomDemo() {\n  return (\n    <div className={rootCss}>\n      <p>\n        drag to <strong>pan</strong>, scroll/pinch to <strong>zoom</strong>\n      </p>\n      <PanZoom initViewBox={initViewBox} gridBounds={gridBounds}>\n        <rect fill=\"red\" x={10} y={10} width={20} height={20} />\n      </PanZoom>\n    </div>\n  );\n}\n\nconst rootCss = css`\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  border: 2px solid #000;\n\n  > p {\n    padding: 12px 8px;\n    margin: 0;\n    font-family: monospace;\n    font-size: 16px;\n    background: #eee;\n  }\n`;","example/jsx-to-js.jsx":"import * as React from 'react';\nimport PanZoomDemo from '../panzoom/PanZoomDemo';\n\n// With JSX\nconst node = <div title=\"message\">Welcome!</div>;\n// Without JSX\nconst sameNode = React.createElement(\n  'div', { title: 'message' }, 'Welcome!',\n);\n\n// With JSX\nconst altNode = <div><PanZoomDemo /></div>;\n// Without JSX\nconst sameAltNode = React.createElement(\n  'div', null, React.createElement(PanZoomDemo, null),\n);"},O={"panzoom/PanZoomDemo.jsx":function(){return(0,r.BX)("div",{className:C,children:[(0,r.BX)("p",{children:["drag to ",(0,r.tZ)("strong",{children:"pan"}),", scroll/pinch to ",(0,r.tZ)("strong",{children:"zoom"})]}),(0,r.tZ)(b,{initViewBox:P,gridBounds:S,children:(0,r.tZ)("rect",{fill:"red",x:10,y:10,width:20,height:20})})]})}};var _=n(52542),j=n(92809),R=n(5152);function D(){var e=(0,i.Z)(["\n  height: ",";\n  background: #000000;\n  margin: ",";\n"]);return D=function(){return e},e}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){(0,j.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e){return(0,r.tZ)(B,{height:e.height,margin:e.margin,children:(0,r.tZ)(M,T({},e))})}var M=(0,R.default)((()=>Promise.all([n.e(126),n.e(135),n.e(209)]).then(n.bind(n,35209))),{ssr:!1,loadableGenerated:{webpack:()=>[35209],modules:["../components/code/WrappedCodeEditor.tsx -> ./CodeEditor"]}}),B=(0,o.zo)("section")(D(),(e=>e.height||"100%"),(e=>e.margin)),V=n(39944),A=n(30266),K=n(86576),W=n(24790),N=n(14671),F=n(38597),z=n(58377);function J(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,j.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e,t){return X(X({},t),{},{[e.key]:e})}function H(e,t){var{[e]:n}=t;return(0,z.Z)(t,[e].map(J))}function q(e,t,n){if(!t[e])return t;var r=n(t[e]);return r?X(X({},t),{},{[e]:X(X({},t[e]),r)}):t}var $=n(8068),Q=n(29950);var Y=new class{constructor(){var e=this;(0,j.Z)(this,"onOneLine",!0),(0,j.Z)(this,"multilineSrc",(e=>{this.onOneLine=!1;var t=this.src(e);return this.onOneLine=!0,t})),(0,j.Z)(this,"seqSrc",(function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.onOneLine){var r=[];return t.forEach((t=>r.push(e.src(t),e.isBackgroundNode(t)?" ":"; "))),(n?r:r.slice(0,-1)).join("")}return t.map((t=>e.src(t))).join("\n")})),(0,j.Z)(this,"src",(e=>{var t,n;if(!e)return"";switch(e.type){case"ArithmCmd":return"(( ".concat(this.src(e.X)," ))");case"BinaryCmd":var r=this.binaryCmds(e);return[r[0].X].concat(r.map((e=>{var{Y:t}=e;return t}))).map((e=>this.src(e))).join(" ".concat(e.Op).concat(this.onOneLine||"|"===e.Op?"":"\n"," "));case"BinaryArithm":return[e.X,e.Y].map((e=>this.src(e))).join("".concat(e.Op));case"UnaryArithm":return e.Post?"".concat(this.src(e.X)).concat(e.Op):"".concat(e.Op).concat(this.src(e.X));case"ParenArithm":return"(".concat(this.src(e.X),")");case"Word":return"string"===typeof e.string?e.string:e.Parts.map((e=>this.src(e))).join("");case"ArrayExpr":var i=e.Elems.map((e=>{var{Index:t,Value:n}=e;return t?"[".concat(this.src(t),"]=").concat(this.src(n)):this.src(n)}));return"(".concat(i.join(" "),")");case"Assign":var s=e.Name.Value;return e.Array?"".concat(s,"=").concat(this.src(e.Array)):e.Index?"".concat(s,"[").concat(this.src(e.Index),"]").concat(e.Append?"+":"","=").concat(this.src(e.Value)):"".concat(s).concat(e.Append?"+":"","=").concat(this.src(e.Value||null));case"Block":var{Stmts:o}=e,a=o.length&&this.isBackgroundNode((0,K.Z$)(o))?"":";";if(this.onOneLine)return"{ ".concat(this.seqSrc(o)).concat(a," }");var c=this.seqSrc(o).split("\n");return 1===c.length&&!c[0]&&c.pop(),"{\n".concat(c.map((e=>"  ".concat(e))).concat(e.Last.map((e=>"  #".concat(e.Text)))).join("\n"),"\n}");case"CallExpr":return[e.Assigns.map((e=>this.src(e))).join(" "),e.Args.map((e=>this.src(e))).join(" ")].filter(Boolean).join(" ");case"Stmt":var l=[e.Negated&&"!",this.src(e.Cmd),e.Redirs.map((e=>this.src(e))).join(" "),e.Background&&"&"].filter(Boolean).join(" ");if(!this.onOneLine&&e.Comments.length){var u=[];e.Comments.forEach((t=>t.Hash.Offset<e.Position.Offset?u.push("#".concat(t.Text)):l+=" #".concat(t.Text))),l=u.concat(l).join("\n")}return l;case"CaseClause":var h=e.Items.map((e=>{var{Patterns:t,Op:n,Stmts:r}=e;return{globs:t,terminal:n,child:r}}));return["case",this.src(e.Word),"in",h.flatMap((e=>{var{child:t,globs:n,terminal:r}=e;return["".concat(n.map((e=>this.src(e))).join(" | "),")"),this.seqSrc(t),r]})).join(" "),"esac"].filter(Boolean).join(" ");case"CoprocClause":return["coproc",null===(t=e.Name)||void 0===t?void 0:t.Value,this.src(e.Stmt)].filter(Boolean).join(" ");case"DeclClause":return[e.Variant.Value,e.Args.map((e=>this.src(e))).join(" ")].filter(Boolean).join(" ");case"ArithmExp":return"".concat("Stmt"===(null===(n=e.parent)||void 0===n?void 0:n.type)?"":"$","(( ").concat(this.src(e.X)," ))");case"CmdSubst":return"$( ".concat(this.seqSrc(e.Stmts)," )");case"DblQuoted":return'"'.concat(e.Parts.map((e=>this.src(e))).join(""),'"');case"ExtGlob":return e.Pattern.Value.replace(/\n/g,"");case"Lit":return e.Value;case"ParamExp":var d;return":-"===(null===(d=e.Exp)||void 0===d?void 0:d.Op)?"${".concat(e.Param.Value,":-").concat(this.src(e.Exp.Word),"}"):"${".concat(e.Param.Value,"}");case"ProcSubst":var p="<("===e.Op?"<":">";return"".concat(p,"( ").concat(this.seqSrc(e.Stmts)," )");case"SglQuoted":var m=e.Value;return"".concat(e.Dollar?"$":"","'").concat(m,"'");case"FuncDecl":return"".concat(e.Name.Value,"() ").concat(this.src(e.Body));case"IfClause":return(0,Q.Wc)(e).map(((e,t)=>{var{Cond:n,Then:r}=e;return n.length?"".concat(t?"elif":"if"," ").concat(this.seqSrc(n),"; then ").concat(this.seqSrc(r),"; "):"else ".concat(this.seqSrc(r),"; ")})).concat("fi").join("");case"LetClause":return"let ".concat(e.Exprs.map((e=>this.src(e))).join(" "));case"Redirect":var f=e.N?Number(e.N.Value):"";switch(e.Op){case">":case">>":var[v]=e.Word.Parts,y="Lit"===(null===v||void 0===v?void 0:v.type)&&v.Value.endsWith("-");return"".concat(f).concat(e.Op).concat(this.src(e.Word)).concat(y?"-":"");default:return""}case"File":return this.seqSrc(e.Stmts);case"Subshell":return"( ".concat(e.Stmts.map((e=>this.src(e))).join("; ")," )");case"TestClause":return"[[ ".concat(this.src(e.X)," ]]");case"BinaryTest":return[e.X,e.Y].map((e=>this.src(e))).join(" ".concat(e.Op," "));case"UnaryTest":return"".concat(e.Op," ").concat(this.src(e.X));case"ParenTest":return"(".concat(this.src(e.X),")");case"TimeClause":return"time ".concat(e.PosixFormat?"-p ":"").concat(this.src(e.Stmt));case"ForClause":var{Do:g,Loop:w}=e;return"CStyleLoop"===w.type?"for (( ".concat(this.src(w.Init),"; ").concat(this.src(w.Cond),"; ").concat(this.src(w.Post)," )); do ").concat(this.seqSrc(g,!0),"done"):"for ".concat(w.Name.Value," in ").concat(w.Items.map((e=>this.src(e))).join(" "),"; do ").concat(this.seqSrc(g,!0),"done");case"WhileClause":return"".concat(e.Until?"until":"while"," ").concat(this.seqSrc(e.Cond,!0),"do ").concat(this.seqSrc(e.Do,!0),"done");case"CStyleLoop":case"Comment":case"WordIter":case"ArrayElem":case"CaseItem":return"";default:throw(0,K.Ql)(e)}}))}binaryCmds(e){var{X:t,Y:n,Op:r}=e;return t.Cmd&&"BinaryCmd"===t.Cmd.type&&t.Cmd.Op===r?[...this.binaryCmds(t.Cmd),e]:n.Cmd&&"BinaryCmd"===n.Cmd.type&&n.Cmd.Op===r?[e,...this.binaryCmds(n.Cmd)]:[e]}isBackgroundNode(e){return"Stmt"===e.type&&e.Background}},ee=n(29209),te=n(29998),ne=n(36375),re=n(47480),ie=n(95775),se=n.n(ie),oe=n(86744),ae=n.n(oe);function ce(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.trim())return[];if(t)return e.trim().replace(/[\s]+/g," ").split(" ");var n=e.replace(/[\s]+/g," ").split(" ");return n[0]||(n.shift(),n[0]=" "+n[0]),(0,K.Z$)(n)||(n.pop(),n.push(n.pop()+" ")),n}function le(e){return{key:"expanded",values:e instanceof Array?e:[e],value:e instanceof Array?e.join(" "):e}}var ue={expand:!0,rangeLimit:1/0};class he extends Error{constructor(e,t,n){super(e),this.exitCode=t,this.original=n,Object.setPrototypeOf(this,he.prototype)}}class de extends Error{constructor(e,t,n){super(e),this.code=e,this.pid=t,this.sessionKey=n,Object.setPrototypeOf(this,de.prototype)}}function pe(e){return new de(Ve.SIGKILL,e.pid,e.sessionKey)}function me(e,t,n){return function(e,t){return ye(ve(e),t)}(e.startsWith("/")?e.split("/"):n.split("/").concat(e.split("/")),t)}function fe(e,t,n){return ve(e.startsWith("/")?e.split("/"):n.split("/").concat(e.split("/")))}function ve(e){return e.reduce(((e,t)=>t&&"."!==t?".."===t?e.slice(0,-1):e.concat(t):e),[])}function ye(e,t){return e.reduce(((e,t)=>e[t]),t)}var ge=n(30023),we=n.n(ge);function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){(0,j.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke={call:!0,cd:!0,declare:!0,echo:!0,expr:!0,false:!0,filter:!0,get:!0,help:!0,history:!0,kill:!0,ls:!0,poll:!0,ps:!0,pwd:!0,map:!0,reduce:!0,return:!0,rm:!0,run:!0,session:!0,set:!0,sleep:!0,split:!0,sponge:!0,true:!0,unset:!0};var Ze=new class{constructor(){(0,j.Z)(this,"shellUtil",{pretty:e=>(0,K.IC)(JSON.parse((0,K.or)(e)))})}isCmd(e){return e in ke}runCmd(e,t,n){var r=this;return(0,ee.Z)((function*(){var{meta:i}=e;switch(t){case"call":var s=Function("return ".concat(n[0]));yield s()(r.provideProcessCtxt(i,n.slice(1)));break;case"cd":if(n.length>1)throw new he("usage: `cd /`, `cd`, `cd foo/bar`, `cd /foo/bar`, `cd ..` and `cd -`",1);var o=Ne.api.getVar(i.sessionKey,"OLDPWD"),a=Ne.api.getVar(i.sessionKey,"PWD");Ne.api.setVar(i.sessionKey,"OLDPWD",a);try{if(n[0])if("-"===n[0])Ne.api.setVar(i.sessionKey,"PWD",o);else if(n[0].startsWith("/")){var c=ve(n[0].split("/"));if(void 0===ye(c,r.provideProcessCtxt(e.meta)))throw Error;Ne.api.setVar(i.sessionKey,"PWD",c.join("/"))}else{var l=ve(a.split("/").concat(n[0].split("/")));if(void 0===ye(l,r.provideProcessCtxt(e.meta)))throw Error;Ne.api.setVar(i.sessionKey,"PWD",l.join("/"))}else Ne.api.setVar(i.sessionKey,"PWD","home")}catch(Le){throw Ne.api.setVar(i.sessionKey,"OLDPWD",o),new he("".concat(n[0]," not found"),1)}break;case"declare":var u=Ne.api.getFuncs(i.sessionKey);for(var{key:h,src:d}of u){var p="".concat(tt).concat(h).concat(nt," () ").concat(d).split(/\r?\n/);for(var m of p)yield m;yield""}break;case"echo":var{opts:f,operands:v}=(0,Q.v8)(n,{boolean:["a","n"]});if(f.a)yield f.n?v.map(Number):v;else if(f.n)for(var y of v)yield Number(y);else yield v.join(" ");break;case"expr":yield r.parseJsArg(n.join(" "));break;case"false":e.exitCode=1;break;case"filter":var g=Function("fn = ".concat(n[0],"; return (...args) => fn(...args) ? args[0] : undefined"));yield*(0,ne.Z)((0,$.Z)(r.read(i,(e=>g()(e,r.provideProcessCtxt(i))))),te.Z);break;case"get":yield*(0,ne.Z)((0,$.Z)(r.get(e,n)),te.Z);break;case"help":var{ttyShell:w}=Ne.api.getSession(i.sessionKey);yield"1) The following commands are supported:";var b=we()(Object.keys(ke),{width:w.xterm.xterm.cols}).split(/\r?\n/);for(var x of b)yield"".concat(tt).concat(x);yield"2) Traverse context via `ls` or `ls -l var.foo.bar` (Object.keys).",yield"3) View shell functions via `declare`.",yield"4) Use Ctrl-c to interrupt and Ctrl-l to clear screen.",yield"5) View history via up/down or `history`.",yield"6) Traverse input using Option-left/right and Ctrl-{a,e}.",yield"7) Delete input using Ctrl-{w,u,k}.",yield"8) You can copy and paste.",yield"9) Pipes, command substitution and background processes are supported.";break;case"history":var{ttyShell:k}=Ne.api.getSession(i.sessionKey),Z=k.getHistory();for(var S of Z)yield S;break;case"kill":if("break"===function(){var{opts:e,operands:t}=(0,Q.v8)(n,{boolean:["STOP","CONT"]}),s=t.map((e=>r.parseJsonArg(e))).filter((e=>Number.isFinite(e)));for(var o of s){Ne.api.getProcesses(i.sessionKey,o).reverse().forEach((t=>{var n;if(e.STOP)null===(n=t.onSuspend)||void 0===n||n.call(t),t.onSuspend=null,t.status=De.Suspended;else if(e.CONT){var r;null===(r=t.onResume)||void 0===r||r.call(t),t.onResume=null,t.status=De.Running}else{var i;t.status=De.Killed,null===(i=t.onResume)||void 0===i||i.call(t),t.onSuspend=t.onResume=null,setTimeout((()=>{t.cleanups.forEach((e=>e())),t.cleanups.length=0}))}}))}return"break"}())break;case"ls":var{opts:P,operands:C}=(0,Q.v8)(n,{boolean:["1","l","r","a"]}),E=Ne.api.getVar(i.sessionKey,"PWD"),O=C.length?C.slice():[""],_=r.provideProcessCtxt(i),j=O.map((e=>me(e,_,E))),{ttyShell:R}=Ne.api.getSession(e.meta.sessionKey),D=function*(e,t){if(void 0===t)return Ne.api.warn(i.sessionKey,'ls: "'.concat(O[e],'" is not defined')),"continue";j.length>1&&(yield"".concat(tt).concat(O[e],":"));var n=(P.r?(0,K.RT)(t):Object.keys(t)).sort(),r=[];if("home"!==E||P.a||(n=n.filter((e=>e.toUpperCase()!==e))),P.l){"function"===typeof t&&(n=n.filter((e=>!["caller","callee","arguments"].includes(e))));var s=n.map((e=>{var n,r;return(null===(n=t[e])||void 0===n||null===(r=n.constructor)||void 0===r?void 0:r.name)||(null===t[e]?"null":"undefined")})),o=Math.max(...s.map((e=>e.length)));r=n.map(((e,t)=>"".concat(et).concat(s[t].padEnd(o)).concat(nt," ").concat(e)))}else r=P[1]?n:we()(n,{width:R.xterm.xterm.cols}).split(/\r?\n/);for(var a of r)yield a};for(var[I,T]of j.entries())yield*D(I,T);break;case"map":var L=Function("return ".concat(n[0]));yield*(0,ne.Z)((0,$.Z)(r.read(i,(e=>L()(e,r.provideProcessCtxt(i))))),te.Z);break;case"poll":var M=n.length?parseFloat(r.parseJsonArg(n[0]))||0:1,[B,V]=[1e3*Math.max(M,.5),new K.BH];Ne.api.addCleanup(i,(()=>V.resolve()));for(var A=1;;)yield A++,yield(0,te.Z)(Promise.race([(0,K.wO)(B),V.promise]));case"ps":var{opts:W}=(0,Q.v8)(n,{boolean:["a","s"]}),N=Object.values(Ne.api.getProcesses(i.sessionKey)).filter(W.a?e=>e:e=>{var{key:t,pgid:n}=e;return t===n}),F=["pid","ppid","pgid"].map((e=>e.padEnd(5))).join(" ");if(W.s)for(var{key:z,ppid:J,pgid:G,status:X,src:U}of N){var H=qe(X),q=[z,J,G].map(String).map((e=>e.padEnd(5))).join(" ");yield"".concat(tt).concat(F).concat(Ye),yield"".concat(q).concat(H),yield U+"\n"}else for(var{key:Y,ppid:ee,pgid:re,status:ie,src:se}of(yield"".concat(tt).concat(F).concat(Ye),N)){var oe=qe(ie),ae=[Y,ee,re].map(String).map((e=>e.padEnd(5))).join(" ");yield"".concat(ae).concat(oe,"  ").concat((0,K.$G)(se,30))}break;case"pwd":yield"/"+Ne.api.getVar(i.sessionKey,"PWD");break;case"reduce":var ce=[],le=Function("return ".concat(n[0]))();yield*(0,ne.Z)((0,$.Z)(r.read(i,(e=>{ce.push(e)}))),te.Z),yield n[1]?ce.reduce(le,r.parseJsArg(n[1])):ce.reduce(le);break;case"return":var ue,de=Ne.api.getProcess(i);de.status=De.Killed,null===(ue=de.onResume)||void 0===ue||ue.call(de),de.onSuspend=de.onResume=null;break;case"rm":var ge=r.provideProcessCtxt(i),be=Ne.api.getVar(i.sessionKey,"PWD");for(var xe of n){var Ze=fe(xe,0,be);if(!("home"===Ze[0]&&Ze.length>1))throw new he("cannot delete ".concat(xe),1);var Se=Ze.pop();delete ye(Ze,ge)[Se]}break;case"run":var Pe=Function("_","return async function *generator ".concat(n[0]));yield*(0,ne.Z)((0,$.Z)(Pe()(r.provideProcessCtxt(i,n.slice(1)))),te.Z);break;case"session":yield i.sessionKey;break;case"set":var Ce=r.provideProcessCtxt(i),Ee=r.parseJsArg(n[1]);if("/"===n[0][0])Function("__1","__2","return __1.".concat(n[0].slice(1)," = __2"))(Ce,Ee);else{var Oe=r.computeCwd(i,Ce);Function("__1","__2","return __1.".concat(n[0]," = __2"))(Oe,Ee)}break;case"sleep":if("break"===(yield*function*(){var e=Ne.api.getProcess(i),t=1e3*(n.length?parseFloat(r.parseJsonArg(n[0]))||0:1),s=-1;do{yield(0,te.Z)(new Promise(((n,r)=>{e.onSuspend=()=>{t=s+t-Date.now(),n()},Ne.api.addCleanup(i,(()=>r(pe(i)))),(s=Date.now())&&setTimeout(n,t)}))),yield}while(Date.now()<s+t-1);return"break"}()))break;case"split":var _e=r.parseJsonArg(n[0]);yield*(0,ne.Z)((0,$.Z)(void 0===_e?r.split(i):r.splitBy(i,_e)),te.Z);break;case"sponge":var je=[];yield*(0,ne.Z)((0,$.Z)(r.read(i,(e=>{je.push(e)}))),te.Z),yield je;break;case"true":e.exitCode=0;break;case"unset":var{var:Re,func:Ie}=Ne.api.getSession(i.sessionKey);for(var Te of n)delete Re[Te],delete Ie[Te];break;default:throw(0,K.Ql)(t)}}))()}get(e,t){var n=this.provideProcessCtxt(e.meta),r=Ne.api.getVar(e.meta.sessionKey,"PWD"),i=t.map((e=>me(e,n,r)));return e.exitCode=i.length&&i.every((e=>void 0===e))?1:0,i}computeCwd(e,t){return ye(Ne.api.getVar(e.sessionKey,"PWD").split("/"),t)}launchFunc(e,t,n){return(0,A.Z)((function*(){var r=(0,Q.VN)(t.node),{ttyShell:i}=Ne.api.getSession(e.meta.sessionKey);Object.assign(r.meta,xe(xe({},e.meta),{},{ppid:e.meta.pid,stack:e.meta.stack.concat(t.key)})),yield i.spawn(r,{posPositionals:n.slice()})}))()}provideProcessApi(e){var t=this;return{read:function(){var n=(0,A.Z)((function*(){var n=yield t.readOnce(e);return null!==n&&void 0!==n&&n.eof?null:n}));return function(){return n.apply(this,arguments)}}(),sleep:t=>new Promise(((n,r)=>{setTimeout(n,1e3*t),Ne.api.addCleanup(e,(()=>r(pe(e))))}))}}provideProcessCtxt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Ne.api.getSession(e.sessionKey);return new Proxy({home:n.var,util:this.shellUtil},{get:(n,r)=>"api"===r?this.provideProcessApi(e):"args"===r?t:n[r],deleteProperty:(e,t)=>!1})}readLoop(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,ee.Z)((function*(){var r=Ne.api.getProcess(e),i=Ne.api.resolve(0,e);if(i instanceof Oe&&0!==r.pgid)throw new he("background process tried to read tty",1);for(var s={};!(s=yield(0,te.Z)(i.readData(n))).eof&&(void 0===s.data||(yield t(s),!n));)yield(0,te.Z)(Ue(r,i))}))()}read(e,t){var n=this;return(0,ee.Z)((function*(){yield*(0,ne.Z)((0,$.Z)(n.readLoop(e,(e=>{if($e(e.data)){var n,r=[];for(var i of e.data.items)void 0!==(n=t(i))&&r.push(n);return e.data.items=r,e.data}return t(e.data)}))),te.Z)}))()}readOnce(e){var t=this;return(0,A.Z)((function*(){var n,r=!0,i=!1;try{for(var s,o,a=(0,$.Z)(t.readLoop(e,(e=>{var{data:t}=e;return t}),!0));r=(s=yield a.next()).done,o=yield s.value,!r;r=!0){return o}}catch(c){i=!0,n=c}finally{try{r||null==a.return||(yield a.return())}finally{if(i)throw n}}return{eof:!0}}))()}split(e){var t=this;return(0,ee.Z)((function*(){yield*(0,ne.Z)((0,$.Z)(t.readLoop(e,(e=>$e(e.data)?(e.data.items=e.data.items.flatMap((e=>e)),e.data):Array.isArray(e.data)?Qe(e.data):e.data))),te.Z)}))()}splitBy(e,t){var n=this;return(0,ee.Z)((function*(){yield*(0,ne.Z)((0,$.Z)(n.readLoop(e,(e=>{if($e(e.data))return e.data.items=e.data.items.flatMap((e=>e.split(t))),e.data;if("string"===typeof e.data)return Qe(e.data.split(t));throw new he("expected string",1)}))),te.Z)}))()}parseJsonArg(e){try{return void 0===e?void 0:JSON.parse(e)}catch(t){return e}}parseJsArg(e){try{return Function("return ".concat(e))()}catch(t){return e}}};var Se=new class{assignVars(e){var t=this;return(0,ee.Z)((function*(){for(var n of e.Assigns)yield*(0,ne.Z)((0,$.Z)(t.Assign(n)),te.Z)}))()}applyRedirects(e,t){var n=this;return(0,A.Z)((function*(){try{for(var r of t)r.exitCode=0,yield n.Redirect(r)}catch(o){var i,s;throw e.exitCode=null!==(i=null===(s=t.find((e=>e.exitCode)))||void 0===s?void 0:s.exitCode)&&void 0!==i?i:1,o}}))()}expandParameter(e,t){if(/^\d+$/.test(t))return Ne.api.getPositional(e.pid,e.sessionKey,Number(t));var n=Ne.api.getVar(e.sessionKey,t);return void 0===n||"string"===typeof n?n||"":se()(n)}handleShError(e,t,n){if(t instanceof de)throw t;if(t instanceof he){var r=[n,t.message].filter(Boolean).join(": ");Ne.api.warn(e.meta.sessionKey,r),console.error("ShError: ".concat(e.meta.sessionKey,": ").concat(r)),e.exitCode=t.exitCode}else{var i=[n,null===t||void 0===t?void 0:t.message].filter(Boolean).join(": ");Ne.api.warn(e.meta.sessionKey,i),console.error("Internal ShError: ".concat(e.meta.sessionKey,": ").concat(i)),console.error(t),e.exitCode=2}}handleTopLevelProcessError(e){if(e.code===Ve.SIGKILL){var t=Ne.api.getProcess({pid:e.pid,sessionKey:e.sessionKey});if(t)Ne.api.getProcesses(e.sessionKey,t.pgid).forEach((e=>{e.status=De.Killed,e.cleanups.forEach((e=>e())),e.cleanups.length=0}))}}lastExpanded(e){return(0,A.Z)((function*(){var t,n=void 0,r=!0,i=!1;try{for(var s,o,a=(0,$.Z)(e);r=(s=yield a.next()).done,o=yield s.value,!r;r=!0){n=o}}catch(c){i=!0,t=c}finally{try{r||null==a.return||(yield a.return())}finally{if(i)throw t}}return n}))()}stmts(e,t){return(0,ee.Z)((function*(){for(var n of t)yield*(0,ne.Z)((0,$.Z)(Pe.Stmt(n)),te.Z),e.exitCode=n.exitCode}))()}performShellExpansion(e){var t=this;return(0,A.Z)((function*(){var n=[];for(var r of e){var i=yield t.lastExpanded(t.Expand(r)),s=1===r.Parts.length?r.Parts[0]:null;if(r.exitCode)throw new he("failed to expand word",r.exitCode);"SglQuoted"===(null===s||void 0===s?void 0:s.type)?n.push(i.value):"ParamExp"===(null===s||void 0===s?void 0:s.type)||"CmdSubst"===(null===s||void 0===s?void 0:s.type)?ce(i.value).forEach((e=>n.push(e))):i.values.forEach((e=>n.push(e)))}return n}))()}Assign(e){var t=this,{meta:n,Name:r,Value:i,Naked:s}=e;return(0,ee.Z)((function*(){Ne.api.setVar(n.sessionKey,r.Value,!s&&i?(yield(0,te.Z)(t.lastExpanded(Pe.Expand(i)))).value:"")}))()}BinaryCmd(e){return(0,ee.Z)((function*(){var t=Y.binaryCmds(e),n=[t[0].X].concat(t.map((e=>{var{Y:t}=e;return t})));switch(e.Op){case"&&":for(var r of n)if(yield*(0,ne.Z)((0,$.Z)(Pe.Stmt(r)),te.Z),e.exitCode=r.exitCode)break;break;case"||":for(var i of n)if(yield*(0,ne.Z)((0,$.Z)(Pe.Stmt(i)),te.Z),!(e.exitCode=i.exitCode))break;break;case"|":var s=[],o=n.map((t=>{var n=(0,Q.nL)((0,Q.VN)(t));return n.meta.ppid=e.meta.pid,n}));try{var{ttyShell:a}=Ne.api.getSession(e.meta.sessionKey);for(var[c,l]of o.slice(0,-1).entries()){var u="/dev/fifo-".concat(l.meta.pid,"-").concat(c);s.push(Ne.api.createFifo(u)),o[c+1].meta.fd[0]=l.meta.fd[1]=u}var h=o.map((e=>{var{meta:t}=e;return Ne.api.resolve(1,t)}));yield(0,te.Z)(Promise.all(o.map(((t,n)=>new Promise(function(){var r=(0,A.Z)((function*(r,i){try{var s;if(yield a.spawn(t),h[n].finishedWriting(),null===(s=h[n-1])||void 0===s||s.finishedReading(),e.exitCode=t.exitCode)throw new he("pipe ".concat(n),e.exitCode);r()}catch(o){i(o)}}));return function(e,t){return r.apply(this,arguments)}}())))))}catch(d){throw o.map((e=>{var{meta:t}=e;return Ne.api.getProcess(t)})).forEach((e=>e&&(e.status=De.Killed))),pe(e.meta)}finally{s.forEach((e=>{e.finishedWriting(),Ne.api.removeDevice(e.key)}))}break;default:throw new he("binary command ".concat(e.Op," unsupported"),2)}}))()}Block(e){return this.stmts(e,e.Stmts)}CallExpr(e){return(0,ee.Z)((function*(){e.exitCode=0;var t,n=yield(0,te.Z)(Pe.performShellExpansion(e.Args)),[r,...i]=n;if(e.meta.verbose&&console.log("simple command",n),n.length)if(Ze.isCmd(r))yield*(0,ne.Z)((0,$.Z)(Ze.runCmd(e,r,i)),te.Z);else if(t=Ne.api.getFunc(e.meta.sessionKey,r))yield(0,te.Z)(Ze.launchFunc(e,t,i));else try{for(var s of n)if(s.includes("("))yield*(0,ne.Z)((0,$.Z)(Ze.get(e,[s])),te.Z);else{var o=Ze.get(e,[s]);if(void 0===o[0])throw Error();yield*(0,ne.Z)((0,$.Z)(o),te.Z)}}catch(a){throw new he("not found",127)}else yield*(0,ne.Z)((0,$.Z)(Pe.assignVars(e)),te.Z)}))()}Command(e,t){var n=this;return(0,ee.Z)((function*(){try{var r;if(yield(0,te.Z)(Pe.applyRedirects(e,t)),"CallExpr"===e.type)r=n.CallExpr(e);else switch(e.type){case"Block":r=n.Block(e);break;case"BinaryCmd":r=n.BinaryCmd(e);break;case"DeclClause":r=n.DeclClause(e);break;case"FuncDecl":r=n.FuncDecl(e);break;case"IfClause":r=n.IfClause(e);break;case"TimeClause":r=n.TimeClause(e);break;case"Subshell":r=n.Subshell(e);break;default:throw new he("not implemented",2)}var i=Ne.api.getProcess(e.meta),s=Ne.api.resolve(1,e.meta);if(!s)throw pe(e.meta);var o,a=!0,c=!1;try{for(var l,u,h=(0,$.Z)(r);a=(l=yield(0,te.Z)(h.next())).done,u=yield(0,te.Z)(l.value),!a;a=!0){var d=u;yield(0,te.Z)(Ge(i,s)),yield(0,te.Z)(s.writeData(d))}}catch(m){c=!0,o=m}finally{try{a||null==h.return||(yield(0,te.Z)(h.return()))}finally{if(c)throw o}}}catch(f){var p="CallExpr"===e.type?e.Args[0].string||"unknown CallExpr":e.type;(f instanceof he?f:new he("",1,f)).message="".concat(e.meta.stack.concat(p).join(": "),": ").concat(f.message||f),Pe.handleShError(e,f)}}))()}DeclClause(e){var t=this;return(0,ee.Z)((function*(){if("declare"!==e.Variant.Value)throw new he("Commmand: DeclClause: ".concat(e.Variant.Value," unsupported"),2);if(e.Args.length)for(var n of e.Args)yield*(0,ne.Z)((0,$.Z)(t.Assign(n)),te.Z);else e.exitCode=0,yield*(0,ne.Z)((0,$.Z)(Ze.runCmd(e,"declare",[])),te.Z)}))()}Expand(e){var t=this;return(0,ee.Z)((function*(){if(e.Parts.length>1){for(var n of e.Parts)n.string=(yield(0,te.Z)(t.lastExpanded(Pe.ExpandPart(n)))).value;var r=!1,i=[];for(var{type:s,string:o}of e.Parts){var a=o;if("ParamExp"===s||"CmdSubst"===s){var c=ce(a,!1);if(!c.length)continue;!i.length||r||/^\s/.test(c[0])?i.push(...c.map((e=>e.trim()))):(i.push(i.pop()+c[0].trim()),i.push(...c.slice(1).map((e=>e.trim())))),r=/\s$/.test((0,K.Z$)(c))}else!i.length||r?(i.push(a),r=!1):(i.push(i.pop()+a),r=!1)}e.string=i.join(" "),yield le(i)}else{var l,u=!0,h=!1;try{for(var d,p,m=(0,$.Z)(t.ExpandPart(e.Parts[0]));u=(d=yield(0,te.Z)(m.next())).done,p=yield(0,te.Z)(d.value),!u;u=!0){var f=p;e.string=f.value,yield f}}catch(v){h=!0,l=v}finally{try{u||null==m.return||(yield(0,te.Z)(m.return()))}finally{if(h)throw l}}}}))()}ExpandPart(e){var t=this;return(0,ee.Z)((function*(){switch(e.type){case"DblQuoted":var n=[];for(var r of e.Parts){var i=yield(0,te.Z)(t.lastExpanded(Pe.ExpandPart(r)));"ParamExp"===r.type&&"@"===r.Param.Value?n.push("".concat(n.pop()||"").concat(i.values[0]||""),...i.values.slice(1)):n.push("".concat(n.pop()||"").concat(i.value||""))}return void(yield le(n));case"Lit":yield le(function(e){var{Value:t,parent:n}=e;if(!n)throw Error("Literal must have parent");var r=t.replace(/\\\n/,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]");return"DblQuoted"===n.type?[r.replace(/\\(["\\$`])/g,"$1")]:"TestClause"===n.type||"Redirect"===n.type?[r.replace(/\\(.|$)/g,"$1")]:ae()(r,ue)}(e));break;case"SglQuoted":yield le(function(e){var t,{Dollar:n,Value:r}=e;return[n?(t=r,JSON.parse(JSON.stringify(t).replace(/\\\\e/g,"\\u001b").replace(/\\\\x([0-9a-f]{2})/g,"\\u00$1").replace(/\\\\([bfnrt])/g,"\\$1"))):r]}(e));break;case"CmdSubst":var s=(0,Q.nL)((0,Q.VN)(e)),o="/dev/fifo-cmd-".concat((0,re.x0)()),a=Ne.api.createFifo(o);s.meta.fd[1]=a.key;var{ttyShell:c}=Ne.api.getSession(e.meta.sessionKey);yield(0,te.Z)(c.spawn(s));try{yield le(a.readAll().map((e=>"string"===typeof e?e:se()(e))).join("\n").replace(/\n*$/,""))}finally{Ne.api.removeDevice(a.key)}break;case"ParamExp":return void(yield*(0,ne.Z)((0,$.Z)(t.ParamExp(e)),te.Z));case"ArithmExp":case"ExtGlob":case"ProcSubst":default:throw Error("".concat(e.type," unimplemented"))}}))()}File(e){return Pe.stmts(e,e.Stmts)}FuncDecl(e){return(0,ee.Z)((function*(){var t=(0,Q.VN)(e.Body),n=(0,Q.nL)(t);Ne.api.addFunc(e.meta.sessionKey,e.Name.Value,n)}))()}IfClause(e){return(0,ee.Z)((function*(){for(var{Cond:t,Then:n}of(0,Q.Wc)(e)){var r,i;if(!t.length)return yield*(0,ne.Z)((0,$.Z)(Pe.stmts(e,n)),te.Z),void(e.exitCode=(null===(r=(0,K.Z$)(n))||void 0===r?void 0:r.exitCode)||0);if(yield*(0,ne.Z)((0,$.Z)(Pe.stmts(e,t)),te.Z),0===(0,K.Z$)(t).exitCode)return yield*(0,ne.Z)((0,$.Z)(Pe.stmts(e,n)),te.Z),void(e.exitCode=(null===(i=(0,K.Z$)(n))||void 0===i?void 0:i.exitCode)||0)}}))()}ParamExp(e){var t=this,{meta:n,Param:r,Slice:i,Repl:s,Length:o,Excl:a,Exp:c}=e;return(0,ee.Z)((function*(){if(a||o||s||i)throw new he("ParamExp: ".concat(r.Value,": unsupported operation"),2);if(c)switch(c.Op){case":-":var e=t.expandParameter(n,r.Value);yield""===e&&c.Word?yield(0,te.Z)(t.lastExpanded(t.Expand(c.Word))):le(e);break;default:throw new he("ParamExp: ".concat(r.Value,": unsupported operation"),2)}else"@"===r.Value?yield le(Ne.api.getProcess(n).positionals.slice(1)):yield le(t.expandParameter(n,r.Value))}))()}Redirect(e){var t=this;return(0,A.Z)((function*(){if(">"===e.Op||">>"===e.Op){var{value:n}=yield t.lastExpanded(Pe.Expand(e.Word));if("/dev/null"===n)return Je(e.parent,{1:"/dev/null"});var r=Ne.api.createVarDevice(e.meta.sessionKey,n,">"===e.Op?"last":"array");return Je(e.parent,{1:r.key})}throw new he("".concat(e.Op,": unsupported redirect"),127)}))()}Stmt(e){var t=this;return(0,ee.Z)((function*(){if(!e.Cmd)throw new he("pure redirects are unsupported",2);if(e.Background&&0===e.meta.pgid){var{ttyShell:n}=Ne.api.getSession(e.meta.sessionKey),r=(0,Q.nL)((0,Q.VN)(e));r.meta.ppid=e.meta.pid,r.meta.pgid=Ne.api.getSession(e.meta.sessionKey).nextPid,n.spawn(r).catch((e=>{e instanceof de?t.handleTopLevelProcessError(e):console.error("background process error",e)})),e.exitCode=e.Negated?1:0}else yield*(0,ne.Z)((0,$.Z)(Pe.Command(e.Cmd,e.Redirs)),te.Z),e.exitCode=e.Cmd.exitCode,e.Negated&&(e.exitCode=1-Number(!!e.Cmd.exitCode))}))()}Subshell(e){return(0,ee.Z)((function*(){var t=(0,Q.nL)((0,Q.VN)(e)),{ttyShell:n}=Ne.api.getSession(e.meta.sessionKey);yield(0,te.Z)(n.spawn(t))}))()}TimeClause(e){return(0,ee.Z)((function*(){var t=Date.now();e.Stmt&&(yield*(0,ne.Z)((0,$.Z)(Pe.Stmt(e.Stmt)),te.Z)),Ne.api.resolve(1,e.meta).writeData("real\t".concat(Date.now()-t,"ms"))}))()}},Pe=Se,Ce={range:"{\ncall '({args}) =>\n  [...Array(Number(args[0]))].map((_, i) => i)\n' \"$1\"\n}",seq:'{\n  range "$1" | split\n}',pretty:"{\n  map '(x, {util}) => util.pretty(x)'\n}",keys:"{\n  map Object.keys\n}",log:"{\n  map 'x => console.log(x)'\n}"},Ee={};"\n\n".concat("\n\n# options key handler\nkey | run '({ api: {read}, var: {msg}, stage: {opt} }) {\n  while (msg = await read()) {\n    if (msg.type !== \"keydown\" || !opt.enabled) continue;\n    switch (msg.key) {\n      // NOOP\n    }\n  }\n}' &\n".trim(),"\n\n").trim();class Oe{constructor(e,t,n){this.sessionKey=e,this.io=t,this.history=n,(0,j.Z)(this,"key",void 0),(0,j.Z)(this,"xterm",void 0),(0,j.Z)(this,"inputs",[]),(0,j.Z)(this,"input",null),(0,j.Z)(this,"buffer",[]),(0,j.Z)(this,"maxLines",500),(0,j.Z)(this,"process",void 0),(0,j.Z)(this,"oneTimeReaders",[]),this.key="/dev/tty-".concat(e)}initialise(e){var t=this;return(0,A.Z)((function*(){for(var[n,r]of(t.xterm=e,t.io.read(t.onMessage.bind(t)),Ne.api.createProcess({sessionKey:t.sessionKey,ppid:0,pgid:0,src:""}),t.process=Ne.api.getSession(t.sessionKey).process[0],je.parse||(yield new Promise((e=>Re.push(e)))),t.loadShellFuncs(Ce),Object.entries(Ee)))Ne.api.setVar(t.sessionKey,n,r);yield t.runProfile(),t.prompt("$")}))()}onMessage(e){switch(e.key){case"req-history-line":var{line:t,nextIndex:n}=this.getHistoryLine(e.historyIndex);this.io.write({key:"send-history-line",line:t,nextIndex:n});break;case"send-line":this.oneTimeReaders.length?(this.oneTimeReaders.shift().resolve(e.line),this.io.write({key:"tty-received-line"})):(this.inputs.push({line:e.line,resolve:()=>this.io.write({key:"tty-received-line"})}),this.tryParse());break;case"send-kill-sig":this.buffer.length=0,this.oneTimeReaders.forEach((e=>{var{reject:t}=e;return t()})),this.oneTimeReaders.length=0,this.process.status!==De.Running?this.prompt("$"):Se.handleTopLevelProcessError(new de(Ve.SIGKILL,0,this.sessionKey));break;default:throw(0,K.Ql)(e)}}spawn(e){var t=arguments,n=this;return(0,A.Z)((function*(){var r=t.length>1&&void 0!==t[1]?t[1]:{},{meta:i}=e;if(r.leading)n.process.status=De.Running,n.process.onResume=null;else{var{ppid:s,pgid:o}=i,{positionals:a}=Ne.api.getProcess(i),c=Ne.api.createProcess({ppid:s,pgid:o,sessionKey:i.sessionKey,src:Y.src(e),posPositionals:r.posPositionals||a.slice(1)});i.pid=c.key}try{var l,u=!0,h=!1;try{for(var d,p=(0,$.Z)(Se.File(e));u=(d=yield p.next()).done,yield d.value,!u;u=!0);}catch(m){h=!0,l=m}finally{try{u||null==p.return||(yield p.return())}finally{if(h)throw l}}e.meta.verbose&&console.warn("".concat(i.sessionKey).concat(i.pgid?" (background)":"",": ").concat(i.pid,": exit ").concat(e.exitCode))}catch(f){throw f instanceof de&&console.error("".concat(i.sessionKey).concat(i.pgid?" (background)":"",": ").concat(i.pid,": ").concat(f.code)),f}finally{!r.leading&&Ne.api.removeProcess(i.pid,n.sessionKey)}}))()}tryParse(){var e=this;return(0,A.Z)((function*(){if(e.input=e.inputs.pop()||null,e.input)try{e.buffer.push(e.input.line);var t=je.tryParseBuffer(e.buffer.slice());switch(t.key){case"failed":var n="mvdan-sh: ".concat(t.error.replace(/^src\.sh:/,""));console.error(n),e.io.write({key:"error",msg:n}),e.buffer.length=0,e.prompt("$");break;case"complete":e.buffer.length=0;var r=Y.src(t.parsed);r&&e.storeSrcLine(r),e.process.src=r,e.provideContextToParsed(t.parsed),yield e.spawn(t.parsed,{leading:!0}),e.prompt("$");break;case"incomplete":e.prompt(">")}}catch(s){s instanceof de?Se.handleTopLevelProcessError(s):console.error("unexpected error propagated to tty.shell",s),e.prompt("$")}finally{var i;null===(i=e.input)||void 0===i||i.resolve(),e.input=null,e.process.status=De.Suspended}}))()}prompt(e){this.io.write({key:"send-xterm-prompt",prompt:"".concat(e," ")})}loadShellFuncs(e){for(var[t,n]of Object.entries(e))try{var r=je.parse("".concat(t," () ").concat(n.trim())).Stmts[0].Cmd.Body,i=(0,Q.nL)(r);Ne.api.addFunc(this.sessionKey,t,i)}catch(s){console.error("Failed to load function: ".concat(t)),console.error(s)}}runProfile(){var e=this;return(0,A.Z)((function*(){var t=Ne.api.getVar(e.sessionKey,"PROFILE")||"",n=je.parse(t);e.provideContextToParsed(n),yield e.spawn(n,{leading:!0})}))()}provideContextToParsed(e){Object.assign(e.meta,{sessionKey:this.sessionKey,pid:0,ppid:0,pgid:0,fd:{0:this.key,1:this.key,2:this.key},stack:[],verbose:!1})}getHistoryLine(e){var t=this.history.length-1;return{line:this.history[t-e]||"",nextIndex:e<0?0:e>t?t:e}}getHistory(){return this.history.slice()}storeSrcLine(e){var t=this.history.pop();if(t&&this.history.push(t),t!==e){for(this.history.push(e);this.history.length>this.maxLines;)this.history.shift();Ne.api.persist(this.sessionKey)}}readData(){var e=this;return(0,A.Z)((function*(){try{return yield new Promise(((t,n)=>{var r;e.oneTimeReaders.push({resolve:e=>t({data:e}),reject:n}),null===(r=e.input)||void 0===r||r.resolve(),e.input=null}))}catch(t){return{eof:!0}}}))()}writeData(e){var t=this;return(0,A.Z)((function*(){t.io.write(e)}))()}finishedWriting(){}finishedReading(){}}var _e,je={tryParseBuffer:e=>({key:"failed",error:"not ready"})},Re=[];Promise.all([n.e(763),n.e(474)]).then(n.bind(n,80557)).then((e=>{je=e.parseService,Re.forEach((e=>e())),Re.length=0})),function(e){e[e.Initial=0]="Initial",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected"}(_e||(_e={}));var De;class Ie{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;this.key=e,this.size=t,(0,j.Z)(this,"buffer",void 0),(0,j.Z)(this,"readerStatus",_e.Initial),(0,j.Z)(this,"writerStatus",_e.Initial),(0,j.Z)(this,"readerResolver",null),(0,j.Z)(this,"writerResolver",null),this.buffer=[]}readData(e){var t=this;return(0,A.Z)((function*(){var n;return t.readerStatus=t.readerStatus||_e.Connected,t.buffer.length?(null===(n=t.writerResolver)||void 0===n||n.call(t),t.writerResolver=null,e&&$e(t.buffer[0])?1===t.buffer[0].items.length?{data:t.buffer.shift().items[0]}:{data:t.buffer[0].items.shift()}:{data:t.buffer.shift()}):t.writerStatus===_e.Disconnected?{eof:!0}:new Promise((e=>{t.readerResolver=e})).then((()=>({data:void 0})))}))()}writeData(e){var t=this;return(0,A.Z)((function*(){var n;if(t.writerStatus=_e.Connected,t.readerStatus!==_e.Disconnected)return t.buffer.push(e),null===(n=t.readerResolver)||void 0===n||n.call(t),t.readerResolver=null,t.buffer.length>=t.size?new Promise((e=>{t.writerResolver=e})):void 0;t.buffer.length=0}))()}finishedReading(e){var t;if(e)return this.readerStatus===_e.Disconnected;this.readerStatus=_e.Disconnected,null===(t=this.writerResolver)||void 0===t||t.call(this),this.writerResolver=null}finishedWriting(e){var t;if(e)return this.writerStatus===_e.Disconnected;this.writerStatus=_e.Disconnected,null===(t=this.readerResolver)||void 0===t||t.call(this),this.readerResolver=null}readAll(){var e=[];return this.buffer.forEach((t=>{$e(t)?t.items.forEach((t=>e.push(t))):e.push(t)})),this.buffer.length=0,e}}class Te{constructor(e,t,n){this.sessionKey=e,this.varPath=t,this.mode=n,(0,j.Z)(this,"key",void 0),(0,j.Z)(this,"buffer",void 0),this.key="".concat(t,"@").concat(e),this.buffer=null}writeData(e){var t=this;return(0,A.Z)((function*(){if("array"===t.mode){if(t.buffer||(t.buffer=Ne.api.getVarDeep(t.sessionKey,t.varPath),Array.isArray(t.buffer)||Ne.api.setVarDeep(t.sessionKey,t.varPath,t.buffer=[])),void 0===e)return;$e(e)?t.buffer.push(...e.items):t.buffer.push(e)}else{if(void 0===e)return;$e(e)?Ne.api.setVarDeep(t.sessionKey,t.varPath,(0,K.Z$)(e.items)):Ne.api.setVarDeep(t.sessionKey,t.varPath,e)}}))()}readData(){return(0,A.Z)((function*(){return{eof:!0}}))()}finishedReading(){}finishedWriting(){}}class Le{constructor(e){this.key=e}writeData(e){return(0,A.Z)((function*(){}))()}readData(){return(0,A.Z)((function*(){return{eof:!0}}))()}finishedReading(){}finishedWriting(){}}function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){(0,j.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e[e.Suspended=0]="Suspended",e[e.Running=1]="Running",e[e.Killed=2]="Killed"}(De||(De={}));var Ve,Ae=(0,N.Z)((0,F.mW)((0,F.tJ)(((e,t)=>({device:{},session:{},persist:{},rehydrated:!1,api:{addCleanup:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Ke.getProcess(e).cleanups.push(...n)},addFunc:(e,t,n)=>{Ke.getSession(e).func[t]={key:t,node:n,src:Y.multilineSrc(n)}},createFifo(e,n){var r=new Ie(e,n);return t().device[r.key]=r},createProcess:e=>{var{sessionKey:n,ppid:r,pgid:i,src:s,posPositionals:o}=e,a=t().api.getNextPid(n),c=t().api.getSession(n).process;return c[a]={key:a,ppid:r,pgid:i,sessionKey:n,status:De.Running,src:s,positionals:["jsh",...o||[]],cleanups:[],onSuspend:null,onResume:null},c[a]},createSession:(n,r)=>{var i=Ke.ensurePersisted(n),s=new Fe(new ze,new ze),o=new Oe(n,s,i.history);return t().device[o.key]=o,t().device["/dev/null"]=new Le("/dev/null"),e((e=>{var{session:t}=e;return{session:U({key:n,func:{},nextPid:0,process:{},ttyIo:s,ttyShell:o,var:Be(Be({PWD:"",OLDPWD:""},i.var),(0,K.I8)(r))},t)}})),t().session[n]},createVarDevice(e,n,r){var i=new Te(e,n,r);return t().device[i.key]=i},ensureSession:(e,n)=>{var{session:r}=t();return r[e]=r[e]||t().api.createSession(e,n)},ensurePersisted:n=>{var r,i,s=null!==(r=null===(i=t().persist)||void 0===i?void 0:i[n])&&void 0!==r?r:{key:n,history:[],var:{}};return e((e=>{var{persist:t}=e;return{persist:U(s,t)}})),s},getFunc:(e,n)=>t().session[e].func[n]||void 0,getFuncs:e=>Object.values(t().session[e].func),getNextPid:e=>t().session[e].nextPid++,getPositional:(e,n,r)=>t().session[n].process[e].positionals[r]||"",getProcess:e=>{var{pid:n,sessionKey:r}=e;return t().session[r].process[n]},getProcesses:(e,n)=>{var r=Object.values(t().session[e].process);return void 0===n?r:r.filter((e=>e.pgid===n))},getVar:(e,n)=>t().session[e].var[n],getVarDeep:(e,n)=>{var r=t().session[e].var;return Function("__","return __.".concat(n))(r)},getSession:e=>t().session[e],persist:t=>{var{ttyShell:n,var:r}=Ke.getSession(t);e((e=>{var{persist:i}=e;return{persist:q(t,i,(()=>({history:n.getHistory(),var:(0,K.Q8)(r,(e=>{try{return JSON.parse(JSON.stringify(e))}catch(t){}}))})))}}))},removeDevice(e){delete t().device[e]},removeProcess(e,n){delete t().session[n].process[e]},removeSession:n=>{var{process:r,ttyShell:i}=t().session[n];for(var{cleanups:s}of Object.values(r))s.forEach((e=>e())),s.length=0;delete t().device[i.key],e((e=>{var{session:t}=e;return{session:H(n,t)}}))},resolve:(e,n)=>t().device[n.fd[e]],setVar:(e,t,n)=>{Ke.getSession(e).var[t]=n},setVarDeep:(e,t,n)=>{var r={home:Ke.getSession(e).var},i=fe(t,0,Ke.getVar(e,"PWD"));if(!("home"===i[0]&&i.length>1))throw new he("only the home directory is writable",1);var s=i.pop();try{ye(i,r)[s]=n}catch(o){throw new he("cannot resolve /".concat(i.join("/")),1)}},warn:(e,t)=>{Ke.getSession(e).ttyIo.write({key:"error",msg:t})}}})),{name:"session",version:0,blacklist:["api","device","session"],onRehydrateStorage:e=>()=>{We.setState({rehydrated:!0})}}),"session")),Ke=Ae.getState().api,We=Object.assign(Ae,{api:Ke}),Ne=We;class Fe{constructor(e,t){this.readable=e,this.writable=t}handleWriters(e){return this.writable.registerCallback(e),()=>this.writable.unregisterCallback(e)}read(e){return this.readable.registerCallback(e),()=>this.readable.unregisterCallback(e)}write(e){this.writable.write(e)}writeToReaders(e){this.readable.write(e)}}class ze{constructor(){(0,j.Z)(this,"internal",void 0),(0,j.Z)(this,"cbToSub",void 0),this.internal=new W.x,this.internal.subscribe(),this.cbToSub=new Map}registerCallback(e){this.cbToSub.set(e,this.internal.subscribe(e))}unregisterCallback(e){var t;null===(t=this.cbToSub.get(e))||void 0===t||t.unsubscribe(),this.cbToSub.delete(e)}write(e){this.internal.next(e)}}function Je(e,t){var n=(0,K.I8)(e.meta);Object.assign(n.fd,t),(0,Q.ww)(e,(e=>e.meta=n))}function Ge(e,t){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,A.Z)((function*(e,t){if(e.status===De.Killed||t.finishedReading(!0))throw new de(Ve.SIGKILL,e.key,e.sessionKey);e.status===De.Suspended&&(yield new Promise((t=>e.onResume=t)))}))).apply(this,arguments)}function Ue(e,t){return He.apply(this,arguments)}function He(){return(He=(0,A.Z)((function*(e,t){if(e.status===De.Killed)throw new de(Ve.SIGKILL,e.key,e.sessionKey);e.status===De.Suspended&&(yield new Promise((t=>e.onResume=t)))}))).apply(this,arguments)}function qe(e){switch(e){case De.Killed:return"\u2620";case De.Running:return"\u25b6\ufe0f";case De.Suspended:return"\u23f8\ufe0f"}}!function(e){e.SIGKILL="SIGKILL"}(Ve||(Ve={}));function $e(e){return void 0!==e&&null!==e&&e.__chunk__}function Qe(e){return{__chunk__:!0,items:e}}var Ye="\x1b[0m",et="\x1b[93m",tt="\x1b[1;34m",nt="\x1b[0;37m";class rt{constructor(e,t,n){this.xterm=e,this.sessionKey=t,this.io=n,(0,j.Z)(this,"commandBuffer",void 0),(0,j.Z)(this,"cursor",void 0),(0,j.Z)(this,"cursorRow",void 0),(0,j.Z)(this,"input",void 0),(0,j.Z)(this,"readyForInput",void 0),(0,j.Z)(this,"promptReady",void 0),(0,j.Z)(this,"nextPrintId",void 0),(0,j.Z)(this,"prompt",void 0),(0,j.Z)(this,"historyIndex",-1),(0,j.Z)(this,"preHistory",void 0),(0,j.Z)(this,"linesPerUpdate",500),(0,j.Z)(this,"refreshMs",0),(0,j.Z)(this,"runCommands",(()=>{var e,t=0;for(this.nextPrintId=null;(e=this.commandBuffer.shift())&&t<=this.linesPerUpdate;)switch(e.key){case"await-prompt":return void this.commandBuffer.unshift(e);case"clear":this.clearScreen();break;case"line":this.xterm.writeln(e.line),this.trackCursorRow(1),t++;break;case"newline":for(var{row:n}=this.offsetToColRow(this.input,this.cursor),{row:r}=this.offsetToColRow(this.input,this.input.length);n++<r;)this.xterm.write("\r\n");return this.xterm.write("\r\n"),this.trackCursorRow(1),void this.sendLine();case"paste-line":return this.xterm.writeln(e.line),this.trackCursorRow(1),this.input=e.line,void this.sendLine();case"resolve":e.resolve();break;case"prompt":this.xterm.write(e.prompt),this.promptReady=!0;break;default:throw(0,K.Ql)(e)}this.printPending()})),this.input="",this.cursor=0,this.prompt="",this.readyForInput=!0,this.promptReady=!1,this.commandBuffer=[],this.nextPrintId=null,this.cursorRow=0,this.historyIndex=-1,this.preHistory=this.input}initialise(){this.xterm.onData(this.handleXtermInput.bind(this)),this.io.handleWriters(this.onMessage.bind(this)),this.xterm.writeln("".concat(nt,"Connected to session ").concat(tt).concat(this.sessionKey).concat(Ye)),this.clearInput(),this.cursorRow=2}actualCursor(e,t){return this.actualLine(e.slice(0,t)).length}actualLine(e){return this.prompt+e}clearInput(){this.setCursor(0);var e=Math.min(this.numLines(),this.xterm.rows+1-this.cursorRow);e>1?(this.xterm.write("\r\x1b[K\x1b[E".repeat(e)),this.xterm.write("\x1b[F".repeat(e))):this.xterm.write("\r\x1b[K"),this.input=""}clearScreen(){for(var e=0;e<this.xterm.rows;e++)this.xterm.writeln("");this.xterm.write("\x1b[F".repeat(this.xterm.rows)),this.xterm.scrollToBottom(),this.cursorRow=1}closestLeftBoundary(e,t){return this.wordBoundaries(e,!0).reverse().find((e=>e<t))||0}closestRightBoundary(e,t){return this.wordBoundaries(e,!1).find((e=>e>t))||e.length}deletePreviousWord(){var e=this.closestLeftBoundary(this.input,this.cursor);if(null!=e){var t=this.input.slice(0,e)+this.input.slice(this.cursor);this.clearInput(),this.setInput(t),this.setCursor(e)}}handleCursorErase(e){var{cursor:t,input:n}=this;if(e){if(t<=0)return;var r=-1;"\n"===this.input.charAt(this.cursor+r)&&(r=-2);var i=n.slice(0,t+r)+n.slice(t);this.clearInput(),this.setInput(i),this.setCursor(t+r)}else{var s=n.slice(0,t)+n.slice(t+1);this.clearInput(),this.setInput(s),this.setCursor(t)}}handleCursorInsert(e){var{input:t,cursor:n}=this,r=t.slice(0,n)+e+t.slice(n),i=this.cursor+e.length;this.clearInput(),this.setInput(r),this.setCursor(i)}handleCursorMove(e){var t=1===e?Math.min(e,this.input.length-this.cursor):Math.max(e,-this.cursor),n=this.input.charAt(this.cursor+t);1===e?"\r"===n?t+=2:"\n"===n&&(t+=1):"\n"===n&&(t-=1),this.setCursor(this.cursor+t)}handleXtermInput(e){var t=this;return(0,A.Z)((function*(){if(t.readyForInput||"\x03"===e)if(e.length>1&&e.includes("\r")){var n=e.replace(/[\r\n]+/g,"\n"),r=n.split("\n");r[0]="".concat(t.input).concat(r[0]);var i=!n.endsWith("\n")&&r.pop(),s=function*(e){yield new Promise((n=>{t.queueCommands([{key:"paste-line",line:e},{key:"await-prompt"},{key:"resolve",resolve:n}])}))};for(var o of r)yield*s(o);i&&t.queueCommands([{key:"resolve",resolve:()=>{t.clearInput(),t.setInput(i)}}])}else t.handleXtermKeypresses(e)}))()}handleXtermKeypresses(e){var t,n=e.charCodeAt(0);if(27==n)switch(e.slice(1)){case"[A":this.promptReady&&this.io.writeToReaders({key:"req-history-line",historyIndex:this.historyIndex+1});break;case"[B":this.promptReady&&this.io.writeToReaders({key:"req-history-line",historyIndex:this.historyIndex-1});break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this.input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(t=this.closestLeftBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"f":null!=(t=this.closestRightBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"\x7f":this.deletePreviousWord()}else if(n<32||127===n)switch(e){case"\r":this.queueCommands([{key:"newline"}]);break;case"\x7f":this.handleCursorErase(!0);break;case"\t":this.handleCursorInsert("  ");break;case"\x03":this.sendSigKill();break;case"\x17":this.deletePreviousWord();break;case"\x01":this.setCursor(0);break;case"\x05":this.setCursor(this.input.length);break;case"\f":this.clearScreen(),this.setInput(this.input);break;case"\v":var r=this.input.slice(0,this.cursor);this.clearInput(),this.setInput(r);break;case"\x15":var i=this.input.slice(this.cursor);this.clearInput(),this.setInput(i),this.setCursor(0)}else this.handleCursorInsert(e)}inputEndsAtEdge(e){var t=this.actualLine(e),n=this.actualCursor(e,e.length),{col:r}=this.offsetToColRow(t,n);return 0===r}offsetToColRow(e,t){for(var{cols:n}=this.xterm,r=0,i=0,s=0;s<t;++s){("\n"===e.charAt(s)||(i+=1)>=n)&&(i=0,r+=1)}return{row:r,col:i}}onMessage(e){if("string"===typeof e)return this.queueCommands(e.split("\n").map((e=>({key:"line",line:"".concat(nt).concat(e).concat(Ye)}))));if(null===e)return this.queueCommands([{key:"line",line:"".concat(et,"null").concat(Ye)}]);if(void 0!==e)switch(e.key){case"send-xterm-prompt":return void this.setPrompt(e.prompt);case"clear-xterm":return void this.clearScreen();case"tty-received-line":return this.input="",void(this.readyForInput=!0);case"send-history-line":if(e.line){var t=e.line.split(/\r?\n/).join("\r\n");-1===this.historyIndex&&(this.preHistory=this.input),this.clearInput(),this.setInput(t),this.historyIndex=e.nextIndex}else 0===e.nextIndex&&(this.clearInput(),this.setInput(this.input!==this.preHistory?this.preHistory:""),this.historyIndex=-1,this.preHistory="");return;case"error":this.queueCommands([{key:"line",line:"".concat("\x1b[41;37m").concat(e.msg).concat(Ye)}]);break;default:$e(e)?e.items.slice(-400).forEach((e=>this.onMessage(e))):this.queueCommands([{key:"line",line:"".concat(et).concat((0,K.or)(e)).concat(Ye)}])}}numLines(){return 1+this.offsetToColRow(this.input,this.input.length+2).row}queueCommands(e){for(var t of e)this.commandBuffer.push(t);this.printPending()}printPending(){this.commandBuffer.length&&!this.nextPrintId&&(this.nextPrintId=window.setTimeout(this.runCommands,this.refreshMs))}sendLine(){this.prompt="",this.readyForInput=this.promptReady=!1,this.historyIndex=-1,this.preHistory="",this.io.writeToReaders({key:"send-line",line:this.input})}sendSigKill(){this.input="",this.setCursor(0),this.xterm.write("^C\r\n"),this.trackCursorRow(1),this.cursor=0,this.commandBuffer.length=0,this.io.writeToReaders({key:"send-kill-sig"})}setCursor(e){e<0?e=0:e>this.input.length&&(e=this.input.length);var t=this.actualLine(this.input),n=this.actualCursor(this.input,this.cursor),{col:r,row:i}=this.offsetToColRow(t,n),s=this.actualCursor(this.input,e),{col:o,row:a}=this.offsetToColRow(t,s);if(a>i)for(var c=i;c<a;++c)this.xterm.write("\x1b[B");else for(var l=a;l<i;++l)this.xterm.write("\x1b[A");if(this.trackCursorRow(a-i),o>r)for(var u=r;u<o;++u)this.xterm.write("\x1b[C");else for(var h=o;h<r;++h)this.xterm.write("\x1b[D");this.cursor=e}setInput(e){this.setCursor(0);var t=this.actualLine(e);this.xterm.write(t),t&&this.inputEndsAtEdge(e)&&(this.xterm.write("\r\n"),this.trackCursorRow(1)),this.input=e,this.cursor=e.length}setPrompt(e){this.prompt=e;var[t]=this.commandBuffer;t&&"await-prompt"===t.key&&this.commandBuffer.shift(),this.queueCommands([{key:"prompt",prompt:e}])}trackCursorRow(e){this.cursorRow+=e,this.cursorRow<1?this.cursorRow=1:this.cursorRow>this.xterm.rows&&(this.cursorRow=this.xterm.rows)}wordBoundaries(e){for(var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[],i=/\w+/g;t=i.exec(e);)r.push(n?t.index:t.index+t[0].length);return r}}(0,R.default)((()=>Promise.all([n.e(126),n.e(135),n.e(209)]).then(n.bind(n,35209))),{ssr:!1,loadableGenerated:{webpack:()=>[35209],modules:["../components/dynamic.tsx -> ./code/CodeEditor"]}});var it=(0,R.default)((()=>Promise.all([n.e(142),n.e(586)]).then(n.bind(n,17586))),{ssr:!1,loadableGenerated:{webpack:()=>[17586],modules:["../components/dynamic.tsx -> ./sh/XTerm"]}});function st(){var e=(0,i.Z)(["\n  grid-area: terminal;\n  background: black;\n  height: 100%;\n"]);return st=function(){return e},e}function ot(e){var{sessionKey:t,env:n}=e,i=Ne((e=>{var{session:n}=e;return t in n?n[t]:null}));(0,s.useEffect)((()=>(Ne.api.createSession(t,n),()=>Ne.api.removeSession(t))),[t]);var o=(0,s.useCallback)((()=>Ne.api.persist(t)),[]);return(0,V.x)(o),(0,r.tZ)(at,{children:i?(0,r.tZ)(it,{onMount:e=>{var t=new rt(e,i.key,i.ttyIo);t.initialise(),setTimeout((()=>i.ttyShell.initialise(t)))},options:ct}):null})}var at=(0,o.zo)("section")(st()),ct={allowProposedApi:!0,fontSize:16,cursorBlink:!0,rendererType:"canvas",theme:{background:"black",foreground:"#41FF00"},convertEol:!1,scrollback:250,rows:50},lt=n(86352);function ut(){var e=(0,i.Z)(["\n  height: 100%;\n  width: 100%;\n  border-top: 6px solid #444;\n"]);return ut=function(){return e},e}function ht(e){var{children:t}=e;return(0,r.tZ)(dt,{children:t})}var dt=(0,o.zo)("div")(ut());function pt(e){var{children:t}=e;return(0,r.tZ)("section",{children:(0,r.tZ)("strong",{children:t})})}function mt(){var e=(0,i.Z)(["\n  padding: 0 0 16px;\n  > div {\n    position: relative;\n    height: ",";\n    padding: 16px 0;\n  }\n  \n  .flexlayout__tabset_tabbar_outer {\n    background: #222;\n    border-bottom: 1px solid #555;\n  }\n  .flexlayout__tab_button--selected, .flexlayout__tab_button:hover {\n    background: #444;\n  }\n  .flexlayout__tab_button_content {\n    user-select: none;\n    font-size: 13px;\n    color: #aaa;\n  }\n  .flexlayout__tab_button--selected .flexlayout__tab_button_content {\n    color: #fff;\n  }\n  .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content {\n    color: #ddd;\n  }\n  .flexlayout__splitter_vert, .flexlayout__splitter_horz {\n    background: #827575;\n  }\n"]);return mt=function(){return e},e}function ft(e){var{tabs:t,height:n="300px"}=e,i=s.default.useMemo((()=>lt.Model.fromJson(function(e){return{global:{tabEnableRename:!1},layout:{type:"row",weight:100,children:[{type:"tabset",weight:50,selected:0,children:e.map((e=>({type:"tab",name:"code"===e.key?e.filepath:e.filepath.split("/").pop().slice(0,-4),config:{key:e.key,folds:"folds"in e?e.folds:void 0},component:e.filepath,enableClose:!1})))}]}}}(t))),[t]);return(0,r.tZ)(vt,{height:n,children:(0,r.tZ)(lt.Layout,{model:i,factory:yt})})}var vt=(0,o.zo)("div")(mt(),(e=>e.height));function yt(e){var{key:t,folds:n}=e.getConfig();switch(t){case"code":var i=e.getComponent()||"";return i in E?(0,r.tZ)(ht,{children:(0,r.tZ)(L,{height:"100%",lineNumbers:!0,readOnly:!0,code:E[i],folds:n})}):(0,r.BX)(pt,{children:["Unknown code with filepath ",i]});case"component":var o=e.getComponent()||"";if(o in O)return(0,r.tZ)(ht,{children:s.default.createElement(O[o])});default:return(0,r.BX)(pt,{children:["Unknown TabNode with name ",t]})}}var gt=n(22200),wt=n(88767),bt=n(77503),xt=n.n(bt);function kt(e){var t,n,i,{data:s}=(n=e.url,i=e.transform,(0,wt.useQuery)("use-svg-".concat(n),(0,A.Z)((function*(){var e=yield fetch(n).then((e=>e.text())),t=xt().load(e),r=new DOMMatrix(i),s=Array.from(t("svg > *")),o=s.find((e=>Zt(t,e,"background"))),a=s.find((e=>Zt(t,e,"hull"))),l=s.find((e=>Zt(t,e,"doors"))),u=(s.find((e=>Zt(t,e,"walls"))),s.find((e=>Zt(t,e,"obstacles"))),s.find((e=>Zt(t,e,"iris-valves"))),t(a).children("path").toArray().map((e=>{var{attribs:t}=e,n=y(t.d),i=r.multiply(new DOMMatrix(t.transform));return n.map((e=>e.applyMatrix(i)))})).map((e=>e[0]))),h=t(l).children("rect").toArray().map((e=>{var{attribs:t}=e;return new c(Number(t.x),Number(t.y),Number(t.width),Number(t.height)).applyMatrix(r.multiply(new DOMMatrix(t.transform)))}));return console.log({background:o,hull:a,doors:l,hullOutlines:u,doorRects:h}),{svgInnerText:s.map((e=>t.html(e))).join("\n"),hullOutline:p.union(u)[0],doorRects:h}}))));return(0,r.BX)("g",{className:"used ".concat(e.url.slice("/svg/".length)),children:[(0,r.tZ)("g",{className:"loaded",transform:e.transform,dangerouslySetInnerHTML:{__html:(null===s||void 0===s?void 0:s.svgInnerText)||""}}),(0,r.BX)("g",{className:"meta",children:[(0,r.tZ)("polygon",{fill:"rgba(100, 0, 0, 0.2)",points:null===s||void 0===s||null===(t=s.hullOutline)||void 0===t?void 0:t.outline.join(" ")}),((null===s||void 0===s?void 0:s.doorRects)||[]).map(((e,t)=>{var{x:n,y:i,width:s,height:o}=e;return(0,r.tZ)("rect",{fill:"rgba(0, 0, 200, 0.3)",x:n,y:i,width:s,height:o},t)}))]})]})}function Zt(e,t,n){return e(t).children("title").text()===n&&e(t).addClass(n)}function St(){var e=(0,i.Z)(["\n  border: 1px solid #555;\n  width: 100%;\n  height: 400px;\n  position: relative;\n"]);return St=function(){return e},e}var Pt=new c(0,0,1200,600),Ct=new c(-5e3,-5e3,10001,10001);function Et(){var e=s.useRef(null);return(0,r.tZ)("div",{className:Ot,ref:e,children:(0,r.BX)(b,{initViewBox:Pt,gridBounds:Ct,children:[(0,r.tZ)(kt,{url:"/svg/301--hull.svg"}),(0,r.tZ)(kt,{url:"/svg/bridge--042--8x9.svg",transform:"matrix(0.2, 0, 0, 0.2, 360, 60) "})]})})}var Ot=(0,o.iv)(St()),_t=(0,A.Z)((function*(){var e=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),t=yield e?n.e(912).then(n.bind(n,46912)):n.e(646).then(n.bind(n,69646)),{default:r}=t;return yield r(...arguments)}));function jt(){var e=s.useRef({}).current;return s.useEffect((()=>(_t({locateFile:(e,t)=>"/box2d/".concat(e)}).then((t=>{var n=new t.b2Vec2(0,0);e.world=new t.b2World(n),console.info("created world",e)})),()=>{var t;console.info("destroying world"),null===(t=e.world)||void 0===t||t.__destroy__(),Object.assign(e,{world:null})})),[]),null}function Rt(){return(0,r.tZ)("div",{className:"main",children:(0,r.BX)("section",{children:[(0,r.tZ)(gt.Z,{}),(0,r.tZ)(_.Z,{children:"\n\n## Objective <float rem=\"1.2\">19th July 2021</float>\n\nWe are going to build a video game step-by-step on this website.\nIt will be a realtime [roguelike](https://en.wikipedia.org/wiki/Roguelike), set in space. We'll assume the role of Captain of the starship _Gehennom_.\n\nAs an important side-effect, a popular approach to frontend development will be presented. The underlying technology is the Markup language HTML, brought to life via CSS, SVG and JavaScript.\n\n---\n\n## Constraints <float rem=\"1.2\">19th July 2021</float>\n\nI've necessarily made a large number of decisions. Here are the important ones, from low-level to high-level.\n\n### Concerning technology\n\n- We'll make a browser-based game.\n- Use CSS/SVG/PNGs instead of HTMLCanvas/WebGL.\n- Use [WebAssembly](https://developer.mozilla.org/en-US/docs/WebAssembly) for simulating physics.\n- Use React [function components](https://reactjs.org/docs/components-and-props.html#function-and-class-components) and CSS-in-JS.\n- Use [Preact](https://www.npmjs.com/package/preact) instead of React, and [Goober](https://www.npmjs.com/package/goober) instead of [Emotion](https://www.npmjs.com/package/@emotion/styled).\n- Use [NextJS](https://nextjs.org/) as our development environment.\n- Use [CodeSandbox](https://codesandbox.io) to share editable code.\n\n### Concerning game mechanics\n\n- Use a realtime birdseye camera, like [Teleglitch](https://en.wikipedia.org/wiki/Teleglitch). \n- Use [a recent port](https://www.npmjs.com/package/box2d-wasm) of the physics engine [Box2D](https://github.com/erincatto/box2d).\n- Use procedural generation e.g. spaceship building/docking.\n- Use explicitly illustrated NPC decisions as a game mechanic.\n\n### Concerning the setting\n  \n- The title of the game is _Rogue Markup_.\n- The player captains the starship _Gehennom_, working for _Unified Transport_.\n- The missions involve personnel transport, cargo transport, and hauling.\n- The graphical style is based on [Starship Geomorphs 2.0](http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html).\n\nOver time we'll clarify these constraints.\nBut first we emphasise:\n> _finishing a game is really fucking hard_.\n\nSpelunky's creator suggested [three important requirements](https://makegames.tumblr.com/post/1136623767/finishing-a-game). We'll now address them.\n\n### 1. Fun to develop (Games I want to make)\n\n_Rogue Markup_ will be fun to develop because I enjoy experimenting with NPC behaviour.\nOne of our underlying motivations is the lack of Game AI resources available on the web.\nIt is hard to discuss Game AI without actually building a game, so I chose a setting and game mechanics which felt fun for me.\n\n\x3c!--\nComplexity will arise from the environment and agent interaction, rather than complex individual thinking or scripted behaviour.\nSimple interacting robots fits the space travel theme nicely.\nThey're also analogous to UI components: parallel systems with some intercommunication.\n--\x3e\n\n### 2. The Result (Games I want to have made)\n\nAs an end result I want a _highly replayable space travel game_.\nThe underlying missions amount to going from A to B (ever was it so).\nMonotony will be overcome via mission specifics, encountered NPC behaviours, procedural generation, and ship building.\nFunctionally, think [Teleglitch](https://en.wikipedia.org/wiki/Teleglitch) where you can _place_ [room modules](https://steamcommunity.com/sharedfiles/filedetails/?id=175359117) when upgrading or docking.\nGraphically, see [Starship Geomorphs 2.0](http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html).\n\nImportantly, it should be easy for other people to extend this game.\nWe'll achieve this by providing source code, escape hatches to [CodeSandbox](https://codesandbox.io/), and clear explanations.\nComments will be shown so that [GitHub](https://github.com/) users can share ideas and links.\n\n\x3c!--\n[NetHack](https://en.wikipedia.org/wiki/NetHack)'s \u2265 34 year history shows _we needn't spell out a story_.\n--\x3e\n\x3c!--\nWe'll add cameras, guards, doors, keys, weapons etc.\nAll NPC decisions will be depicted graphically, such as future navpaths with probabilistic branches.\n--\x3e\n\n### 3. Experience (Games I\u2019m good at making)\n\nI work as a web developer, using React & Emotion on a daily basis. \nI have a [strong background](https://dblp.org/pid/81/8748.html) in Theoretical Computer Science,\nso won't confuse Game AI with AI, nor fall prey to the Deep Learning hype.\nI have also created similar game mechanics _many_ times over the years.\nHere's hoping my chain of unfinished projects is coming to a close!\n\n---\n\n## Technology  <float rem=\"1.2\">19th July 2021</float>\n\nWe will build the game using the following technologies.\n\n| Concept | Browser Technology |\n| - | - |\n| Component | React [function components](https://reactjs.org/docs/components-and-props.html#function-and-class-components) i.e. JavaScript functions using syntactic sugar known as [JSX](https://reactjs.org/docs/introducing-jsx.html) and internal state via [hooks](https://reactjs.org/docs/hooks-intro.html). |\n| Styles | CSS-in-JS via [Goober](https://www.npmjs.com/package/goober). |\n| Component framework | [Preact](https://preactjs.com/), a DOM-diffing alternative to React. |\n| Physics engine | The WebAssembly module [box2d-wasm](https://www.npmjs.com/package/box2d-wasm). |\n| Static analysis | TypeScript via [JSDoc comments](https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html); also [ESLint](https://www.npmjs.com/package/eslint). |\n| Live analysis | [Preact option hooks](https://preactjs.com/guide/v10/options/) and _our own in-browser terminal_. |\n| Code viewing | [CodeMirror](https://codemirror.net/) for viewing JavaScript on this site. [FlexLayout](https://github.com/caplin/FlexLayout) provides draggable tabs. |\n| Code editing | External [CodeSandbox](https://codesandbox.io/) links, using React. |\n| Code sharing | [GitHub](https://github.com/) comments shown on site; GitHub [repo](https://github.com/rob-myers/rob-myers.github.io) for this site. |\n\n\x3c!-- Our in-browser terminal is built using [Xterm.js](https://xtermjs.org/) and the shell parser [mvdan-sh](https://github.com/mvdan/sh/tree/master/_js). --\x3e\n\x3c!-- Typically we'll present a \"project\" as a number of tabs, consisting of source code _foo/bar.jsx_, and another tab i.e. the rendered output. --\x3e\n\nWe want to create a video game explicitly, exposing the code and underlying thought process.\nThen it is worth explaining these technologies before using them.\n\n### React, Styles and Preact\n\nCompeting web frameworks exist in the wild, often with their own notion of component.\nOne popular approach uses _React function components_, which are just JavaScript functions with constraints on their parameters and return values.\n\n- They have a single parameter, conventionally called _props_.\n  \n  It is a JavaScript object defining the component's named inputs, and possibly special properties like _children_, _key_ and _ref_.\n- They must return either null or a virtual [DOM node](https://developer.mozilla.org/en-US/docs/Web/API/Node).\n  \n  The returned value is an HTML fragment to be rendered.\n  It may depend on the component's props and internal state.\n\nReact developers compose components using an XML-like syntax, in order to obtain the desired dynamic DOM tree.\nIt is worth being a bit more precise, so consider some code.\n        "}),(0,r.tZ)(ft,{tabs:[{key:"code",filepath:"panzoom/PanZoom.jsx",folds:[{line:9,ch:0}]},{key:"component",filepath:"panzoom/PanZoomDemo.jsx"},{key:"code",filepath:"panzoom/PanZoomDemo.jsx"}],height:"400px"}),(0,r.tZ)(_.Z,{children:'\n\nThe file _panzoom/PanZoom.jsx_ defines two React function components, namely _PanZoom_ and _Grid_.\nThey are JavaScript functions with a single parameter, returning something which looks like HTML (but isn\'t).\n_PanZoom_ defines a pannable and zoomable grid.\nTo see it in action click the other tabs above, or view [this CodeSandbox](https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx "@external").\nBehaviourally:\n- _PanZoom_ renders an SVG consisting of its children (the red square in the demo) and _Grid_. It adjusts the [SVG viewBox](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox) in response to mouse/pointer events.\n- _Grid_ renders part of an SVG i.e. a grid obtained by repeating a 10x10 unit pattern.\n\nNotice _PanZoomDemo_ renders _PanZoom_ by using the XML tag _\\<PanZoom\\>_.\nThen although React function components are functions, they are not invoked like functions.\nWe now provide more details of a general nature.\n\n- React developers use a grammatical extension of JS called [JSX](https://en.wikipedia.org/wiki/JSX_(JavaScript)), naturally combining JavaScript and XML syntax.\n- Dev tools convert JSX into JS, by replacing XML tags with invocations of the function _React.createElement_.\n        '}),(0,r.tZ)(L,{margin:"0 0 0 40px",height:"310px",code:E["example/jsx-to-js.jsx"],lineNumbers:!0,readOnly:!0}),(0,r.tZ)(_.Z,{children:"\n\n- This website uses Preact instead of React. Technically, _react_ and _react-dom_ are aliases for the npm module [@preact/compat](https://www.npmjs.com/package/@preact/compat).\n  As a result, React.createElement corresponds to [this function](https://github.com/preactjs/preact/blob/master/src/create-element.js),\n  and constructs Preact VNode's (virtual DOM nodes).\n- The root component is conventionally called _App_.\n  Running a React application amounts to [invoking _ReactDOM.render_](https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/index.js \"@external\")\n  with two arguments: _\\<App/\\>_ and an extant DOM node _el_.\n  The [render function](https://github.com/preactjs/preact/blob/master/src/render.js) initially converts the virtual DOM tree into an actual DOM tree mounted at _el_.\n  Subsequent changes are [diffed](https://github.com/preactjs/preact/blob/master/src/diff/index.js), and only the difference is applied to the DOM.\n\n\x3c!--\nRecall the three pillars: HTML, CSS and JavaScript (JS), born in the early 1990s.\nTechnically, only HTML is needed to create a website, because CSS can be included via _\\<style\\>_ tags and JS via _\\<script\\>_ tags.\nBut of the three pillars, JS is the only programming language, the only way to dynamically change HTML and CSS.\nFor reasons of uniformity, it is increasingly common for the initial HTML and CSS to be generated by JS too.\n--\x3e\n\nSo, React function components are JavaScript functions.\nThey are written using XML syntax via JSX, and are composed together in the same way as HTML.\nThere's more to say e.g. how they represent internal state,\nbut we've said more than enough for now.\nWe'll close this subsection with two related remarks.\n\n_Preact vs React_. This website is built using Preact, a popular alternative to React with the same API.\nIt has a much smaller codebase (easier to understand),\nand provides hooks into its underlying operations (allowing performance monitoring).\nPreact has a reputation for being faster,\nalthough React has a _much_ wider scope via [custom renderers](https://github.com/chentsulin/awesome-react-renderer).\n    \n_CSS in JavaScript_. Traditionally, CSS is provided in separate files, linked in the _\\<head\\>_ and referenced by DOM elements via their class attribute.\nBoth _PanZoom_ and _PanZoomDemo_ are styled using CSS-in-JS.\nThis means the CSS is written inside JS or JSX files, often together with the React components it applies to.\nWe use the npm module [goober](https://www.npmjs.com/package/goober).\n\n\n### Physics Engine\n\nThe next browser technology we'll consider is a Physics engine.\n\n\n__TODO__ from here\n\n        "}),(0,r.tZ)(jt,{}),(0,r.tZ)(_.Z,{children:'\n\n- Raycast test\n- Dynamic collison test\n\n### Static and Runtime Analysis\n\n- Typescript via JSDoc, refering to CodeSandbox.\n- Terminal + Preact hooks\n- Terminal + Game AI\n\n### Comments\n\n- Display GitHub comments from Issue (build-time)\n- Can use anonymous credits to get recent\n\n---\n\n## Starship Geomorphs <float rem="1.2">19th July 2021</float>\n\n__TODO__ \n- GeomorphDemo\n- prepare CodeSandbox links for GeomorphDemo\n        '}),(0,r.tZ)(Et,{}),(0,r.tZ)(_.Z,{children:'\n\n---\n\n## Movement <float rem="1.2">19th July 2021</float>\n\n- Navigation\n- Follow camera\n- Map view\n- Support mobile too\n- CodeSandbox\n        '}),(0,r.tZ)("br",{}),(0,r.tZ)("section",{style:{height:200},children:(0,r.tZ)(ot,{sessionKey:"test",env:Dt.test})}),(0,r.tZ)("br",{}),(0,r.tZ)(_.Z,{children:'\nThis is an example of a [command link](#command "@test echo foo").\n        '})]})})}var Dt={test:{}}},35838:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/draft",function(){return n(63509)}])}},function(e){e.O(0,[774,488,372,888,179],(function(){return t=35838,e(e.s=t);var t}));var t=e.O();_N_E=t}]);