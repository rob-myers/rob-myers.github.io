"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[992],{37992:function(t,e,n){n.r(e),n.d(e,{default:function(){return O}});var r=n(52209),o=n(92809),a=n(30266),c=n(809),i=n.n(c),u=n(59748),l=n(88269),s=n(88767),f=n(20437),d=n(83159),p=n(79056),y=n(84273);function g(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return h(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){i=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(i)throw a}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var v,b=n(8311);function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach((function(e){(0,o.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function O(t){var e,n,r=(0,s.useQuery)("".concat(t.layoutKey,"-json"),(0,a.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("/geomorph/".concat(t.layoutKey,".json")).then((function(t){return t.json()})));case 1:case"end":return e.stop()}}),e)})))).data,o=(0,u.useMemo)((function(){var t=((null===r||void 0===r?void 0:r.walls.map((function(t){return f.LA.from(t)})))||[]).flatMap((function(t){return y.J7.triangulationToPolys(t.fastTriangulate())})),e=new f.dl(300,300),n=function(t,e,n){var r,o,a,c,i=new f.UL(t.x-e,t.y-e,2*e,2*e),u=n.filter((function(t){var e=t.rect;return i.intersects(e)})),l=new Set(u.reduce((function(t,e){var n=e.outline;return t.concat(n)}),[])),s=u.reduce((function(t,e){var n=(0,p.Z)(e.outline,3),r=n[0],o=n[1],a=n[2];return t.concat([[r,o],[o,a],[a,r]])}),[]),d=f.dl.zero,h=f.dl.zero,v=f.dl.zero,b=null,m=[],w=g(l);try{for(w.s();!(c=w.n()).done;){var O=c.value;h.copy(O).sub(t).normalize(),d.copy(h).rotate(-.001),v.copy(h).rotate(.001),r=o=a=e,s.forEach((function(e){var n=(0,p.Z)(e,2),c=n[0],i=n[1];null!==(b=y.J7.getLineLineSegIntersect(t,d,c,i))&&b>=0&&b<r&&(r=b),null!==(b=y.J7.getLineLineSegIntersect(t,h,c,i))&&b>=0&&b<o&&(o=b),null!==(b=y.J7.getLineLineSegIntersect(t,v,c,i))&&b>=0&&b<a&&(a=b)})),m.push(d.clone().scale(r),h.clone().scale(o),v.clone().scale(a))}}catch(j){w.e(j)}finally{w.f()}return m.sort((function(t,e){return y.J7.radRange(Math.atan2(e.y,e.x))-y.J7.radRange(Math.atan2(t.y,t.x))})),new f.LA(m.map((function(e){return e.add(t)})))}(e,800,t),o=n.rect;return{polygon:n,sourceRatios:new f.dl((e.x-o.x)/o.width,(e.y-o.y)/o.height)}}),[null===r||void 0===r?void 0:r.walls]);return(0,b.BX)(d.Z,{gridBounds:j,initViewBox:Z,maxZoom:6,className:x,children:[(0,b.tZ)("defs",{children:(0,b.BX)("radialGradient",{id:"light-radial",cx:"".concat(null!==(e=100*(null===o||void 0===o?void 0:o.sourceRatios.x))&&void 0!==e?e:0,"%"),cy:"".concat(null!==(n=100*(null===o||void 0===o?void 0:o.sourceRatios.y))&&void 0!==n?n:0,"%"),r:"50%",children:[(0,b.tZ)("stop",{offset:"0%",style:{stopColor:"rgba(255, 255, 230, 0.75)"}}),(0,b.tZ)("stop",{offset:"50%",style:{stopColor:"rgba(230, 230, 230, 0.2)"}}),(0,b.tZ)("stop",{offset:"100%",style:{stopColor:"rgba(255, 200, 255, 0)"}})]})}),r&&(0,b.BX)(b.HY,{children:[(0,b.tZ)("image",w(w({},r.pngRect),{},{className:"geomorph",href:"/geomorph/".concat(t.layoutKey,".png")})),"https://github.com/rob-myers/topdown-cli/blob/c5abf6487303e907af478aefddd8e5177c5d24b5/frontend/src/components/stage/stage.world.tsx",(0,b.tZ)("path",{fill:"url(#light-radial)",d:null===o||void 0===o?void 0:o.polygon.svgPath})]})]})}var j=new f.UL(-5e3,-5e3,10001,10001),Z=new f.UL(0,0,1200,600),x=(0,l.iv)(v||(v=(0,r.Z)(["\n  /* TODO */\n"])))}}]);