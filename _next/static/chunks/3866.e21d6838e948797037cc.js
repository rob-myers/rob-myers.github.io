(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3866],{48935:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ve}});var r=n(52209),o=n(30266),a=n(809),i=n.n(a),s=n(67294),c=n(88269),l=n(94975),u=n(84175),p=n(27375),d=n(44275),f=n(97301),g=n(87079),m=n(97131),h=n(79056),y=n(92809),v=n(94184),b=n.n(v),x=n(16716),w=n(24781),k=n(32817),A=n(95196),P=n(29127),N=n(74727),I=n(48103),j=n(23921),S=n(29120),O=n(29998),R=n(99763);function M(e,t){return T.apply(this,arguments)}function T(){return(T=(0,R.Z)(i().mark((function e(t,n){var r,o,a,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={promise:K()},o=!1,a=t.subscribe({next:function(e){window.setTimeout((function(){var t=r.promise;r.promise=K(),t.resolve(e)}))},error:function(e){window.setTimeout((function(){var t=r.promise;r.promise=K(),t.reject(e)}))},complete:function(){window.setTimeout((function(){o=!0,r.promise.resolve()}))}}),null===n||void 0===n||n(r,a),e.prev=4;case 5:return e.next=8,(0,O.Z)(r.promise);case 8:if(s=e.sent,!o){e.next=11;break}return e.abrupt("break",15);case 11:return e.next=13,s;case 13:e.next=5;break;case 15:return e.prev=15,a.unsubscribe(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,,15,18]])})))).apply(this,arguments)}function K(){var e={},t=new Promise((function(t,n){Object.assign(e,{resolve:t,reject:n})}));return Object.assign(t,e)}var Z=n(68451);n(77503),n(292),n(26470),n(7951),n(28949),n(42830),n(89539),n(21801);n(2026),n(48764).Buffer;function L(e){var t,n,r=e;return"global-nav"===(null===r||void 0===r?void 0:r.key)&&(null===(t=r.fullPath)||void 0===t||null===(n=t.every)||void 0===n?void 0:n.call(t,I.dl.isVectJson))&&Array.isArray(r.navMetas)||!1}var E=n(13702),D=n(50269),G=JSON.parse('{"HB":{"idle":{"animName":"idle","aabb":{"x":0,"y":0,"width":256,"height":256},"frameCount":1,"contacts":[{}],"deltas":[0,0],"totalDist":0},"walk":{"animName":"walk","aabb":{"x":0,"y":0,"width":256,"height":256},"frameCount":10,"contacts":[{"right":{"x":102.5,"y":153.5}},{"right":{"x":72.5,"y":153.5}},{"right":{"x":54.5,"y":153.5}},{"left":{"x":218.5,"y":114.5},"right":{"x":44.5,"y":153.5}},{"left":{"x":202.5,"y":116.5}},{"left":{"x":110.5,"y":137.008}},{"left":{"x":60.5,"y":145.008}},{"left":{"x":52.5,"y":146.848}},{"left":{"x":44.5,"y":144.664},"right":{"x":219.5,"y":107.666}},{"right":{"x":188.5,"y":105.98}}],"deltas":[0,30,18,10,16,92,50,8,8,31,86],"totalDist":349}},"sP":2}');function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,y.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=G.HB;var J=.19,q=40*J*G.sP,F=3*q,z={"enter-room":-.02,"exit-room":-.02,"pre-collide":-.02,"pre-exit-room":-(q+10),"pre-near-door":-(q+10),"start-seg":0},V=n(98379),U=n(19964);var H,_=n(34735),Q=n(85893),X=G.HB;function $(e){var t=e.npc;return s.useEffect((function(){return"idle"===t.anim.spriteSheet&&t.startAnimation(),function(){window.clearTimeout(t.anim.wayTimeoutId)}}),[]),(0,Q.jsxs)("div",{ref:t.npcRef.bind(t),className:b()("npc",t.key,t.anim.spriteSheet,ee),"data-npc-key":t.key,children:[(0,Q.jsx)("div",{className:b()("body",t.key,"no-select"),"data-npc-key":t.key}),(0,Q.jsx)("div",{className:"interact-circle"}),(0,Q.jsx)("div",{className:"bounds-circle"})]})}var Y,ee=(0,c.iv)(H||(H=(0,r.Z)(["\n  position: absolute;\n  pointer-events: none;\n  \n  .body {\n    position: absolute;\n    filter: grayscale(100%) brightness(140%);\n    /** Animate turning */\n    transition: transform 1s;\n    transform: rotate(calc(","rad + var(--npc-target-look-angle))) scale(",");\n  }\n  \n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    background: url('/npc/first-npc--walk.png');\n  }\n\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    background: url('/npc/first-npc--idle.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  .interact-circle {\n    display: var(--npcs-debug-display);\n    position: absolute;\n    width: calc(2 * var(--npcs-interact-radius));\n    height: calc(2 * var(--npcs-interact-radius));\n    left: calc(-1 * var(--npcs-interact-radius));\n    top: calc(-1 * var(--npcs-interact-radius));\n    border-radius: calc(2 * var(--npcs-interact-radius));\n    border: 1px solid rgba(0, 0, 255, 0.25);\n  }\n\n  .bounds-circle {\n    display: var(--npcs-debug-display);\n    position: absolute;\n    width: calc(2 * var(--npc-bounds-radius));\n    height: calc(2 * var(--npc-bounds-radius));\n    left: calc(-1 * var(--npc-bounds-radius));\n    top: calc(-1 * var(--npc-bounds-radius));\n    border-radius: calc(2 * var(--npc-bounds-radius));\n    border: 1px solid rgba(255, 0, 0, 0.25);\n  }\n"])),0,J,X.walk.aabb.width,X.walk.aabb.height,.5*-X.walk.aabb.width,.5*-X.walk.aabb.height,X.idle.aabb.width,X.idle.aabb.height,.5*-X.idle.aabb.width,.5*-X.idle.aabb.height);function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){(0,y.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e){var t=(0,p.Z)(),n=function(e,t){var n=s.useState((function(){return e.gms.map((function(e){return e.key}))})),r=(0,h.Z)(n,2),o=r[0],a=r[1];s.useMemo((function(){var t=e.gms.map((function(e){return e.key})).filter((function(e){return!o.includes(e)}));t.length&&a([].concat((0,m.Z)(o),(0,m.Z)(t)))}),[e]);var i=o.map((function(n){return(0,U.Z)(n,e.gmData[n],t)})),c=e.gms.every((function(e){return o.includes(e.key)}))&&i.every((function(e){return e.data}));return s.useMemo((function(){return c?{pfs:e.gms.map((function(e){var t=o.findIndex((function(t){return t===e.key}));return(0,u.Nh)(i[t].data)}))}:{pfs:[]}}),[c])}(e.gmGraph,e.disabled),r=e.worldApi.panZoomApi,a=(0,d.Z)((function(){return{decor:{},events:new x.x,npc:{},playerKey:null,rootEl:{},ready:!0,session:{},class:{Vect:I.dl},rxjs:{filter:l.h,first:A.P,map:P.U,take:N.q,otag:M},addTtyLineCtxts:function(e,t,n){a.session[e].tty[t]=n.map((function(e){return ne(ne({},e),{},{lineText:(0,j.vp)(e.lineText),linkText:(0,j.vp)(e.linkText)})}))},cleanSessionCtxts:function(){for(var e=0,t=Object.keys(a.session);e<t.length;e++){var n=t[e],r=_.default.api.getSession(n);r?function(){var e=a.session[n].tty,t=Math.max(0,r.ttyShell.xterm.totalLinesOutput-2*V.bt);Object.values(e).forEach((function(n){var r=(0,h.Z)(n,1)[0].lineNumber;return r<=t&&delete e[r]}))}():delete a.session[n]}},detectCollision:function(e,t){if(!e.getWalkBounds().intersects(t.getWalkBounds()))return null;var n=[e.getLineSeg(),t.getLineSeg()],r=n[0],o=n[1],a=(null===r||void 0===r?void 0:r.src)||e.getPosition(),i=(null===o||void 0===o?void 0:o.src)||t.getPosition(),s=a.clone().sub(i),c=s.lengthSquared,l=.9*(e.getRadius()+t.getRadius()),u=r?r.tangent.dot(s):NaN,p=o?o.tangent.dot(s):NaN;if(u>=0||p<=0)return null;if(c<=Math.pow(l,2))return{seconds:0,distA:0,distB:0};if(r&&o){var d=r.tangent.dot(o.tangent),f=[e.getSpeed(),t.getSpeed()],g=f[0],m=f[1],h=Math.pow(g,2)+Math.pow(m,2)-2*g*m*d,y=2*(g*u-m*p),v=c-Math.pow(l,2),b=Math.pow(y,2)-4*h*v,x=0;if(b>0&&(x=(-y-Math.sqrt(b))/(2*h))<=r.src.distanceTo(r.dst)/g)return{seconds:x,distA:x*g,distB:x*m}}else if(r||o){var w=r?u:-p,k=r?e.getSpeed():t.getSpeed(),A=r||o,P=Math.pow(w,2)-c+Math.pow(l,2),N=0;if(P>0&&(N=(-w-Math.sqrt(P))*(1/k))<=A.src.distanceTo(A.dst)/k){var I=N*k;return{seconds:N,distA:I,distB:I}}}return null},getGmGraph:function(){return e.gmGraph},getGlobalNavPath:function(t,n){var r=e.gmGraph.gms,o=r.findIndex((function(e){return e.gridRect.contains(t)})),i=r.findIndex((function(e){return e.gridRect.contains(n)}));if(-1===o||-1===i)throw Error("getGlobalNavPath: src/dst must be inside some geomorph's aabb");if(o===i){var s=a.getLocalNavPath(o,t,n);return console.log("localNavPath (single)",s),{key:"global-nav",fullPath:s.fullPath.slice(),navMetas:s.navMetas.map((function(e){return ne(ne({},e),{},{gmId:s.gmId})}))}}var c=e.gmGraph.findPath(t,n);if(!c)throw Error("getGlobalNavPath: gmGraph.findPath not found: ".concat(JSON.stringify(t)," -> ").concat(JSON.stringify(n)));console.log("gmEdges",c);for(var l=[],u=[],p=function(e){var r=0===e?a.getLocalNavPath(o,t,c[0].srcDoorEntry):e<c.length?a.getLocalNavPath(c[e-1].dstGmId,c[e-1].dstDoorEntry,c[e].srcDoorEntry):a.getLocalNavPath(i,c[e-1].dstDoorEntry,n);console.log("localNavPath",e,r);var s=c[e];if(0===e&&r.doorIds[0]>=0)l.push(I.dl.from(t));else if(e===c.length&&r.doorIds[1]>=0)l.push(I.dl.from(n));else{var p=l.length;l.push.apply(l,(0,m.Z)(r.fullPath)),u.push.apply(u,(0,m.Z)(r.navMetas.map((function(e){return ne(ne({},e),{},{index:p+e.index,gmId:r.gmId})}))))}if(s){var d={gmId:s.srcGmId,doorId:s.srcDoorId,hullDoorId:s.srcHullDoorId,index:l.length-1,otherRoomId:null};u.push({key:"start-seg",index:l.length-1,gmId:s.srcGmId}),u.push(ne({key:"pre-exit-room",willExitRoomId:s.srcRoomId},d)),u.push(ne({key:"exit-room",exitedRoomId:s.srcRoomId},d))}},d=0;d<c.length+1;d++)p(d);return{key:"global-nav",fullPath:l,navMetas:u}},getLocalNavPath:function(t,r,o){var a=e.gmGraph.gms[t],i=a.inverseMatrix.transformPoint(I.dl.from(r)),s=a.inverseMatrix.transformPoint(I.dl.from(o)),c=n.pfs[t].graph.findPath(i,s);return c?ne(ne({key:"local-nav",gmId:t},c),{},{fullPath:c.fullPath.map((function(e){return a.matrix.transformPoint(I.dl.from(e)).precision(3)}))}):{key:"local-nav",gmId:t,fullPath:[],navMetas:[],doorIds:[-1,-1]}},getNpcGlobalNav:function(e){var t=a.npc[e.npcKey];if(!t)throw Error('npcKey "'.concat(e.npcKey,'" does not exist'));if(!I.dl.isVectJson(e.point))throw Error("invalid point: ".concat(JSON.stringify(e.point)));if(!a.isPointLegal(e.point))throw Error("outside navPoly: ".concat(JSON.stringify(e.point)));var n=a.getGlobalNavPath(t.getPosition(),e.point);return e.debug&&a.setDecor(e.npcKey,{key:e.npcKey,type:"path",path:n.fullPath}),n},getNpcInteractRadius:function(){return(0,D.PK)(a.rootEl,E.vR.npcsInteractRadius)},getNpc:function(e){var t=a.npc[e];if(!t)throw Error('npc "'.concat(e,'" does not exist'));return t},getNpcsIntersecting:function(e){return Object.values(a.npc).filter((function(t){return Z.J.circleIntersectsConvexPolygon(t.getPosition(),t.getRadius()+(t.isWalking()?10:0),e)}))},getPanZoomApi:function(){return r},getPlayer:function(){return a.playerKey?a.getNpc(a.playerKey):null},getPointTags:function(e){var t=[];return a.isPointLegal(e)&&t.push("nav"),t},isPointLegal:function(t){var n=e.gmGraph.gms.findIndex((function(e){return e.gridRect.contains(t)}));if(-1===n)return!1;var r=e.gmGraph.gms[n],o=r.navPoly,a=r.inverseMatrix.transformPoint(I.dl.from(t));return o.some((function(e){return e.contains(a)}))},npcAct:function(e){return(0,o.Z)(i().mark((function t(){var n,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.action,t.next="add-decor"===t.t0?3:"cancel"===t.t0?5:"config"===t.t0?8:"get"===t.t0?11:"look-at"===t.t0?12:"pause"===t.t0?18:"play"===t.t0?21:"remove-decor"===t.t0?24:"set-player"===t.t0?26:28;break;case 3:return a.setDecor(e.key,e),t.abrupt("break",29);case 5:return t.next=7,a.getNpc(e.npcKey).cancel();case 7:return t.abrupt("break",29);case 8:return"number"===typeof e.interactRadius&&a.rootEl.style.setProperty(E.vR.npcsInteractRadius,"".concat(e.interactRadius,"px")),void 0!==e.debug&&a.rootEl.style.setProperty(E.vR.npcsDebugDisplay,e.debug?"initial":"none"),t.abrupt("break",29);case 11:return t.abrupt("return",a.getNpc(e.npcKey));case 12:if(r=a.getNpc(e.npcKey),I.dl.isVectJson(e.point)){t.next=15;break}throw Error("invalid point: ".concat(JSON.stringify(e.point)));case 15:return t.next=17,r.lookAt(e.point);case 17:return t.abrupt("break",29);case 18:return t.next=20,a.getNpc(e.npcKey).pause();case 20:return t.abrupt("break",29);case 21:return t.next=23,a.getNpc(e.npcKey).play();case 23:return t.abrupt("break",29);case 24:return a.setDecor(e.decorKey,null),t.abrupt("break",29);case 26:return a.events.next({key:"set-player",npcKey:null!==(n=e.npcKey)&&void 0!==n?n:null}),t.abrupt("break",29);case 28:throw Error((0,u.Ql)(e,'unrecognised action: "'.concat(JSON.stringify(e),'"')));case 29:case"end":return t.stop()}}),t)})))()},onTtyLink:function(e,t,n,r,o){var i,s;a.cleanSessionCtxts();var c=null===(i=a.session[e])||void 0===i||null===(s=i.tty[t])||void 0===s?void 0:s.find((function(e){return e.lineText===n&&e.linkStartIndex===o&&e.linkText===r}));if(c)switch(console.log("onTtyLink found",c),c.key){case"room":var l=a.getGmGraph().gms[c.gmId],u=l.matrix.transformPoint(l.point[c.roomId].default.clone());a.panZoomTo({zoom:2,ms:2e3,point:u})}},panZoomTo:function(e){return(0,o.Z)(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(!e||e.zoom&&!Number.isFinite(e.zoom)||e.point&&!I.dl.isVectJson(e.point)||e.ms&&!Number.isFinite(e.ms))){t.next=2;break}throw Error("expected format: { zoom?: number; point?: { x: number; y: number }; ms: number; easing?: string }");case 2:return t.prev=2,t.next=5,r.panZoomTo(e.zoom,e.point,e.ms,e.easing);case 5:return t.abrupt("return","completed");case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return","cancelled");case 11:case"end":return t.stop()}}),t,null,[[2,8]])})))()},rootRef:function(e){e&&(a.rootEl=e,e.style.setProperty(E.vR.npcsInteractRadius,"".concat(F,"px")),e.style.setProperty(E.vR.npcsDebugDisplay,"none"))},setDecor:function(e,n){if(n){if(!function(e){var t;return!(!e||"path"!==e.type||null===e||void 0===e||null===(t=e.path)||void 0===t||!t.every((function(e){return I.dl.isVectJson(e)})))||!(!e||"circle"!==e.type||!I.dl.isVectJson(e.center)||"number"!==typeof e.radius)}(n))throw Error("invalid decor");a.decor[e]=n}else delete a.decor[e];t()},setRoomByNpc:function(t){var n=a.getNpc(t).getPosition(),r=e.gmGraph.findRoomContaining(n);r?(e.worldApi.fovApi.setRoom(r.gmId,r.roomId),e.worldApi.updateAll()):console.error("set-player ".concat(t,": no room contains ").concat(JSON.stringify(n)))},spawn:function(n){if(!n.npcKey||"string"!==typeof n.npcKey||!n.npcKey.trim())throw Error("invalid npc key: ".concat(JSON.stringify(n.npcKey)));if(!n.point||"number"!==typeof n.point.x||"number"!==typeof n.point.y)throw Error("invalid point: ".concat(JSON.stringify(n.point)));if(!a.isPointLegal(n.point))throw Error("cannot spawn outside navPoly: ".concat(JSON.stringify(n.point)));a.npc[n.npcKey]=function(e,t,n){var r=n.disabled,a=n.panZoomApi,s=n.npcs,c={path:[],aux:{angs:[],bounds:new I.UL,edges:[],elens:[],navPathPolys:[],sofars:[],total:0},spriteSheet:"idle",translate:new Animation,rotate:new Animation,sprites:new Animation,wayMetas:[],wayTimeoutId:0};return{key:e,epochMs:Date.now(),def:{key:e,position:t.position,angle:t.angle,paused:!!r},el:{root:{},body:{}},mounted:!1,anim:c,cancel:function(){var e=this;return(0,o.Z)(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("cancel: cancelling ".concat(e.def.key)),"idle"!==c.spriteSheet){t.next=3;break}return t.abrupt("return");case 3:return e.clearWayMetas(),e.everAnimated()&&c.translate.commitStyles(),e.el.body instanceof HTMLDivElement&&e.setLookTarget(e.getAngle()),t.next=8,new Promise((function(e){c.translate.addEventListener("cancel",(function(){return e()})),c.translate.cancel(),c.rotate.cancel()}));case 8:case"end":return t.stop()}}),t)})))()},clearWayMetas:function(){c.wayMetas.length=0},everAnimated:function(){var e;return null===(e=this.el.root)||void 0===e?void 0:e.getAnimations().includes(c.translate)},followNavPath:function(e,t){var n=this;return(0,o.Z)(i().mark((function r(){return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(c.path=e.map(I.dl.from),n.clearWayMetas(),n.updateAnimAux(),!(c.path.length<=1||0===c.aux.total)){r.next=5;break}return r.abrupt("return");case 5:return null!==t&&void 0!==t&&t.globalNavMetas&&(c.wayMetas=t.globalNavMetas.map((function(e){return W(W({},e),{},{length:Math.max(0,c.aux.sofars[e.index]+z[e.key])})}))),n.setSpritesheet("walk"),n.startAnimation(),s.events.next({key:"started-walking",npcKey:n.def.key}),console.log("followNavPath: ".concat(n.def.key," started walk")),n.nextWayTimeout(),r.prev=11,r.next=14,new Promise((function(e,t){c.translate.addEventListener("finish",(function(){console.log("followNavPath: ".concat(n.def.key," finished walk")),e()})),c.translate.addEventListener("cancel",(function(){c.translate.finished||console.log("followNavPath: ".concat(n.def.key," cancelled walk")),t(new Error("cancelled"))}))}));case 14:return r.prev=14,n.setSpritesheet("idle"),n.startAnimation(),s.events.next({key:"stopped-walking",npcKey:n.def.key}),r.finish(14);case 19:case"end":return r.stop()}}),r,null,[[11,,14,19]])})))()},getAngle:function(){var e=new DOMMatrixReadOnly(window.getComputedStyle(this.el.body).transform);return Math.atan2(e.m12,e.m11)},getAnimDef:function(){var e=c.aux;return{translateKeyframes:c.path.flatMap((function(t,n){return[{offset:e.sofars[n]/e.total,transform:"translate(".concat(t.x,"px, ").concat(t.y,"px)")}]})),rotateKeyframes:c.path.flatMap((function(t,n){return[{offset:e.sofars[n]/e.total,transform:"rotateZ(".concat(e.angs[n-1]||e.angs[n]||0,"rad) scale(").concat(J,")")},{offset:e.sofars[n]/e.total,transform:"rotateZ(".concat(e.angs[n]||e.angs[n-1]||0,"rad) scale(").concat(J,")")}]})),opts:{duration:e.total*this.getAnimScaleFactor(),direction:"normal",fill:"forwards"}}},getAnimScaleFactor:function(){return 1/this.getSpeed()*1e3},getBounds:function(){var e=this.getPosition(),t=this.getRadius();return new I.UL(e.x-t,e.y-t,2*t,2*t)},getLineSeg:function(){var e=this.getTarget();if(e){var t=this.getPosition();return{src:t,dst:e,tangent:e.clone().sub(t).normalize()}}return null},getPosition:function(){var e,t,n=I.dl.from((null===(e=(t=this.el.root).getBoundingClientRect)||void 0===e?void 0:e.call(t))||[0,0]),r=n.x,o=n.y;return I.dl.from(a.getWorld({clientX:r,clientY:o})).precision(2)},getRadius:function(){return(0,D.PK)(this.el.root,E.vR.npcBoundsRadius)},getSpeed:function(){return t.speed},getSpriteDuration:function(e){var t=1/this.getSpeed()*1e3*(B.walk.totalDist*J),n=t,r=e-t/B.walk.frameCount*.5;return r<n/2?n:2*r/Math.ceil(r/n*2)},getTarget:function(){var e=this;if(this.isWalking()){var t=c.translate.currentTime,n=c.aux.sofars.findIndex((function(n){return n*e.getAnimScaleFactor()>t}));return-1===n?null:c.path[n].clone()}return null},getTargets:function(){if(this.isWalking()){var e=c.translate.currentTime,t=this.getAnimScaleFactor();return c.aux.sofars.map((function(n,r){return{point:c.path[r].clone(),arriveMs:n*t-e}})).filter((function(e){return e.arriveMs>=0}))}return[]},getWalkBounds:function(){return this.isWalking()?c.aux.bounds:this.getBounds()},isWalking:function(){return"walk"===c.spriteSheet&&"running"===c.translate.playState},lookAt:function(e){var t=this.getPosition(),n=I.dl.from(e).sub(t);if(0===n.length)return this.getAngle();for(var r=(0,D.PK)(this.el.root,E.vR.npcTargetLookAngle),o=Math.atan2(n.y,n.x);o-r>Math.PI;)o-=2*Math.PI;for(;r-o>Math.PI;)o+=2*Math.PI;return this.setLookTarget(o),o},nextWayTimeout:function(){if(null===c.translate.currentTime)return console.warn("nextWayTimeout: anim.root.currentTime is null");c.wayMetas[0]&&(c.wayTimeoutId=window.setTimeout(this.wayTimeout.bind(this),c.wayMetas[0].length*this.getAnimScaleFactor()-c.translate.currentTime))},npcRef:function(e){e&&!this.mounted&&(this.el.root=e,this.el.body=e.childNodes[0],this.el.root.style.transform="translate(".concat(this.def.position.x,"px, ").concat(this.def.position.y,"px)"),this.setLookTarget(t.angle),this.el.root.style.setProperty(E.vR.npcBoundsRadius,"".concat(q,"px")),this.mounted=!0)},pause:function(){console.log("pause: pausing ".concat(this.def.key)),c.translate.pause(),c.rotate.pause(),c.sprites.pause(),c.translate.commitStyles(),this.setLookTarget(this.getAngle()),window.clearTimeout(c.wayTimeoutId),this.def.key===s.playerKey&&s.getPanZoomApi().animationAction("pause")},play:function(){console.log("play: resuming ".concat(this.def.key)),c.translate.play(),c.rotate.play(),c.sprites.play(),this.nextWayTimeout(),this.def.key===s.playerKey&&s.getPanZoomApi().animationAction("play")},setLookTarget:function(e){this.el.root.style.setProperty(E.vR.npcTargetLookAngle,"".concat(e,"rad"))},setSpritesheet:function(e){e!==this.anim.spriteSheet&&(this.el.root.classList.remove(this.anim.spriteSheet),this.el.root.classList.add(e),this.anim.spriteSheet=e)},startAnimation:function(){if(this.everAnimated()&&(c.translate.commitStyles(),c.translate.cancel(),this.setLookTarget(this.getAngle()),c.rotate.cancel()),"walk"===c.spriteSheet){var e=this.getAnimDef(),t=e.translateKeyframes,n=e.rotateKeyframes,r=e.opts;c.translate=this.el.root.animate(t,r),c.rotate=this.el.body.animate(n,r);var o=this.getSpriteDuration(r.duration);c.sprites=this.el.body.animate([{offset:0,backgroundPosition:"0px"},{offset:1,backgroundPosition:"".concat(-B.walk.frameCount*B.walk.aabb.width,"px")}],{easing:"steps(".concat(B.walk.frameCount,")"),duration:o,iterations:1/0})}else"idle"===c.spriteSheet&&(this.clearWayMetas(),this.setLookTarget(this.getAngle()),c.translate=this.el.root.animate([],{duration:2e3,iterations:1/0}),c.rotate=this.el.body.animate([],{duration:2e3,iterations:1/0}),c.sprites=this.el.body.animate([],{duration:2e3,iterations:1/0}))},updateAnimAux:function(){var e=c.aux,t=this.getRadius();e.bounds=I.UL.fromPoints.apply(I.UL,(0,m.Z)(c.path)).outset(t),e.edges=c.path.map((function(e,t){return{p:e,q:c.path[t+1]}})).slice(0,-1),e.angs=e.edges.map((function(e){return Number(Math.atan2(e.q.y-e.p.y,e.q.x-e.p.x).toFixed(2))})),e.elens=e.edges.map((function(e){var t=e.p,n=e.q;return Number(t.distanceTo(n).toFixed(2))})),e.navPathPolys=e.edges.map((function(e){var t=e.q.clone().sub(e.p).rotate(Math.PI/2).normalize(.01);return new I.LA([e.p.clone().add(t),e.q.clone().add(t),e.q.clone().sub(t),e.p.clone().sub(t)])}));var n=e.elens.reduce((function(e,t){return e.total+=t,e.sofars.push(e.sofars[e.sofars.length-1]+t),e}),{sofars:[0],total:0});e.sofars=n.sofars,e.total=n.total},wayTimeout:function(){if(0===c.wayMetas.length||"idle"===c.spriteSheet||null===c.translate.currentTime||"paused"===c.translate.playState)return 0===c.wayMetas.length&&console.warn("wayTimeout: empty anim.wayMetas"),null===c.translate.currentTime&&console.warn("wayTimeout: anim.root.currentTime is null"),void("idle"===c.spriteSheet&&console.warn('wayTimeout: anim.spriteSheet is "idle"'));if(c.translate.currentTime>=c.wayMetas[0].length*this.getAnimScaleFactor()-1){var e=c.wayMetas.shift();console.log("WayMeta",this.key,e),s.events.next({key:"way-point",npcKey:this.def.key,meta:e})}this.nextWayTimeout()}}}(n.npcKey,{position:n.point,angle:0,speed:70},{disabled:e.disabled,panZoomApi:r,npcs:a}),t(),a.events.next({key:"spawned-npc",npcKey:n.npcKey})},trackNpc:function(e){var t=e.npcKey,n=e.process;if(!a.npc[t])throw Error('npc "'.concat(t,'" does not exist'));var s="no-track";return(0,w.T)((0,k.of)({key:"init-track"}),a.events,r.events).pipe((0,l.h)((function(e){return 1===n.status&&("init-track"===e.key||"ui-idle"===e.key||"resized-bounds"===e.key||"cancelled-panzoom-to"===e.key||"completed-panzoom-to"===e.key||"started-walking"===e.key&&e.npcKey===t||"stopped-walking"===e.key&&e.npcKey===t)}))).subscribe({next:function(e){return(0,o.Z)(i().mark((function n(){var o,c,l;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.isIdle()||"started-walking"===e.key){n.next=4;break}return s="no-track",console.warn("@",s),n.abrupt("return");case 4:if(o=a.npc[t],c=o.getPosition(),"idle"!==o.anim.spriteSheet||null!==r.anims[0]&&"finished"!==r.anims[0].playState||!(r.distanceTo(c)>10)){n.next=17;break}return s="panzoom-to",console.warn("@",s),n.prev=9,n.next=12,r.panZoomTo(2,c,2e3);case 12:n.next=16;break;case 14:n.prev=14,n.t0=n.catch(9);case 16:s="no-track";case 17:if("started-walking"!==e.key){n.next=28;break}return s="follow-walk",console.warn("@",s),n.prev=20,l=o.getTargets().map((function(e){return e.point})),n.next=24,r.followPath(l,{animScaleFactor:o.getAnimScaleFactor()});case 24:n.next=28;break;case 26:n.prev=26,n.t1=n.catch(20);case 28:case"end":return n.stop()}}),n,null,[[9,14],[20,26]])})))()}})},walkNpc:function(e){return(0,o.Z)(i().mark((function t(){var n,r,o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.getNpc(e.npcKey),L(e)){t.next=3;break}throw Error("invalid global navpath: ".concat(JSON.stringify(e)));case 3:return t.prev=3,o=(r=e).fullPath,console.log("global navMetas",r.navMetas),t.next=9,n.followNavPath(o,{globalNavMetas:r.navMetas});case 9:t.next=18;break;case 11:if(t.prev=11,t.t0=t.catch(3),!(t.t0 instanceof Error&&"cancelled"===t.t0.message)){t.next=17;break}console.info("".concat(e.npcKey,": walkNpc cancelled")),t.next=18;break;case 17:throw t.t0;case 18:case"end":return t.stop()}}),t,null,[[3,11]])})))()}}}),{deps:[n,e.worldApi]});return s.useEffect((function(){return(0,S.Zi)(e.npcsKey,a),e.onLoad(a),function(){return(0,S.lB)(e.npcsKey)}}),[]),(0,Q.jsxs)("div",{className:b()("npcs",oe),ref:a.rootRef,children:[Object.entries(a.decor).map((function(e){var t=(0,h.Z)(e,2),n=t[0],r=t[1];return(0,Q.jsx)(ae,{item:r},n)})),Object.values(a.npc).map((function(e){return(0,Q.jsx)($,{npc:e},"".concat(e.key,"@").concat(e.epochMs))}))]})}var oe=(0,c.iv)(Y||(Y=(0,r.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  div.debug-npc {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    border-radius: 30px;\n    border: 1px solid red;\n    transform: translate(-15px, -15px);\n  }\n  svg {\n    position: absolute;\n    pointer-events: none;\n\n    .debug-circle {\n      fill: #ff000035;\n    }\n  }\n"])));function ae(e){var t,n,r=e.item;switch(r.type){case"path":t=I.UL.fromPoints.apply(I.UL,(0,m.Z)(r.path)).outset(10),n=(0,Q.jsxs)("g",{className:"debug-path",children:[(0,Q.jsx)("polyline",{fill:"none",stroke:"#88f",strokeDasharray:"2 2",strokeWidth:1,points:r.path.map((function(e){return"".concat(e.x,",").concat(e.y)})).join(" ")}),r.path.map((function(e,t){return(0,Q.jsx)("circle",{fill:"none",stroke:"#ff444488",r:2,cx:e.x,cy:e.y},t)}))]});break;case"circle":t=new I.UL(r.center.x-r.radius,r.center.y-r.radius,2*r.radius,2*r.radius),n=(0,Q.jsx)("circle",{className:"debug-circle",cx:r.center.x,cy:r.center.y,r:r.radius});break;default:return console.error("unexpected decor",r),null}return(0,Q.jsx)("svg",{width:t.width,height:t.height,style:{left:t.x,top:t.y},children:(0,Q.jsx)("g",{style:{transform:"translate(".concat(-t.x,"px, ").concat(-t.y,"px)")},children:n})})}var ie=n(30245),se=n(91441);function ce(e){return(0,Q.jsx)(Q.Fragment,{children:e.gms.map((function(e,t){return(0,Q.jsx)("img",{className:"geomorph",src:(0,se.qX)(e.key),draggable:!1,width:e.pngRect.width,height:e.pngRect.height,style:{left:e.pngRect.x,top:e.pngRect.y,transform:e.transformStyle,transformOrigin:e.transformOrigin}},t)}))})}function le(e){var t=e.gmGraph,n=e.gmGraph.gms,r=((0,p.Z)(),(0,d.Z)((function(){return{gmId:0,roomId:9,clipPath:n.map((function(e){return"none"})),ready:!0,setRoom:function(t,n){return(r.gmId!==t||r.roomId!==n)&&(r.gmId=t,r.roomId=n,e.worldApi.updateAll(),!0)},updateClipPath:function(){var o=n[r.gmId],a=e.worldApi.doorsApi.getOpen(r.gmId),i=t.computeLightPolygons(r.gmId,r.roomId,a),s=n.map((function(e){return[]}));n.forEach((function(e,t){var n=i.filter((function(e){return t===e.gmIndex})).map((function(e){return e.poly.precision(2)}));if(e===o){var a=o.roomsWithDoors[r.roomId];s[t]=n.concat(a).reduce((function(e,t){return I.LA.cutOut([t],e)}),[e.hullOutline])}else s[t]=I.LA.cutOut(n,[e.hullOutline])})),s.forEach((function(e,t){e.forEach((function(e){return e.translate(-n[t].pngRect.x,-n[t].pngRect.y)}));var o=e.map((function(e){return"".concat(e.svgPath)})).join(" ");r.clipPath[t]=o.length?"path('".concat(o,"')"):"none"}))}}}),{overwrite:{gmId:!0,roomId:!0},deps:[n,t,e.worldApi]}));return s.useEffect((function(){e.onLoad(r)}),[]),(0,Q.jsx)(Q.Fragment,{children:n.map((function(e,t){return(0,Q.jsx)("img",{className:"geomorph-dark",src:(0,se.qX)(e.key),draggable:!1,width:e.pngRect.width,height:e.pngRect.height,style:{clipPath:r.clipPath[t],WebkitClipPath:r.clipPath[t],left:e.pngRect.x,top:e.pngRect.y,transform:e.transformStyle,transformOrigin:e.transformOrigin}},t)}))})}function ue(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pe(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function de(e){var t=e.worldApi.fovApi,n=t.gmId,r=t.roomId;if("number"!==typeof n)return null;var a=e.gms[n],c=e.worldApi.doorsApi.getVisible(n),l=a.lazy.roomNavPoly[r],p=l.rect,d=a.rooms[r].rect,f=a.rooms[r],g=a.point[r].labels.find((function(e){return e.tags.includes("room")})),m=s.useCallback(function(){var s=(0,o.Z)(i().mark((function o(s){var c,l,p,d,f,g,m,h,y,v,b,x;return i().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if("debug-door-arrow"!==(c=s.target).className){o.next=10;break}if(l=a.doors[Number(c.getAttribute("data-debug-door-id"))],!((p=a.getHullDoorId(l))>=0)){o.next=9;break}(d=e.gmGraph.getAdjacentRoomCtxt(n,p))?t.setRoom(d.adjGmId,d.adjRoomId):console.info("hull door is isolated",n,p),o.next=10;break;case 9:return o.abrupt("return",t.setRoom(n,a.getOtherRoomId(l,r)));case 10:if("debug-label-info"!==c.className){o.next=34;break}f=a.labels[Number(c.getAttribute("data-debug-label-id"))],g=a.roomGraph.getAdjacentDoors(r).length,m="\u2139\ufe0f  [".concat(j.ZD.Blue).concat(f.text).concat(j.ZD.Reset,"] with ").concat(g," door").concat(g>1?"s":""),h=Object.values(e.worldApi.npcsApi.session).filter((function(e){return e.receiveMsgs})),y=ue(h),o.prev=16,y.s();case 18:if((v=y.n()).done){o.next=26;break}return b=v.value.key,o.next=22,_.default.api.writeMsgCleanly(b,m);case 22:x=o.sent,e.worldApi.npcsApi.addTtyLineCtxts(b,x,[{lineNumber:x,lineText:m,linkText:f.text,linkStartIndex:(0,u.qW)("\u2139\ufe0f  ["),key:"room",gmId:n,roomId:r}]);case 24:o.next=18;break;case 26:o.next=31;break;case 28:o.prev=28,o.t0=o.catch(16),y.e(o.t0);case 31:return o.prev=31,y.f(),o.finish(31);case 34:case"end":return o.stop()}}),o,null,[[16,28,31,34]])})));return function(e){return s.apply(this,arguments)}}(),[a,e,n,r]);return(0,Q.jsxs)("div",{className:"debug-parent",onClick:m,children:[e.outlines&&e.gms.map((function(e,t){return(0,Q.jsx)("div",{style:{position:"absolute",left:e.gridRect.x,top:e.gridRect.y,width:e.gridRect.width,height:e.gridRect.height,border:"2px red solid"}},t)})),(0,Q.jsxs)("div",{className:"debug",style:{transform:a.transformStyle},children:[e.localNav&&(0,Q.jsx)("svg",{className:"debug-room-nav",width:p.width,height:p.height,style:{left:p.x,top:p.y},children:(0,Q.jsxs)("g",{style:{transform:"translate(".concat(-p.x,"px, ").concat(-p.y,"px)")},children:[(0,Q.jsx)("path",{className:"nav-poly",d:l.svgPath}),c.map((function(e){var t=(0,h.Z)(a.doors[e].seg,2),n=t[0],r=t[1];return(0,Q.jsx)("line",{stroke:"red",x1:n.x,y1:n.y,x2:r.x,y2:r.y},e)}))]})}),e.roomOutlines&&(0,Q.jsx)("svg",{className:"debug-room-outline",width:d.width,height:d.height,style:{left:d.x,top:d.y},children:(0,Q.jsx)("g",{style:{transform:"translate(".concat(-d.x,"px, ").concat(-d.y,"px)")},children:(0,Q.jsx)("path",{className:"room-outline",d:f.svgPath})})}),c.map((function(t){var n=a.doors[t],o=n.poly,i=n.normal,s=n.roomIds[0]===r?1:-1,c=I.dl.from(i).scale(-s).angle,l=o.center.addScaledVector(i,s*me),u=o.center.addScaledVector(i,-s*me);return[(0,Q.jsx)("div",{"data-debug-door-id":t,"data-tags":"debug door-arrow",className:"debug-door-arrow",style:{left:l.x-ge,top:l.y-ge,width:2*ge,height:2*ge,transform:"rotate(".concat(c,"rad)")}},t),e.showIds&&(0,Q.jsx)("div",{className:"debug-door-id-icon",style:{left:u.x,top:u.y-4},children:t},"icon"+t)]})),e.showIds&&(0,Q.jsx)("div",{className:"debug-room-id-icon",style:{left:p.x+p.width-35,top:p.y+25},children:r}),e.showLabels&&g&&(0,Q.jsx)("div",{"data-debug-label-id":g.index,"data-tags":"debug label-icon",className:"debug-label-info",title:g.text,style:{left:g.center.x-ge,top:g.center.y-ge,width:2*ge,height:2*ge,filter:"invert(100%)"}},g.index),e.windows&&a.windows.map((function(e,t){var n=e.baseRect,r=e.angle;return(0,Q.jsx)("div",{className:"debug-window",style:{left:n.x,top:n.y,width:n.width,height:n.height,transform:"rotate(".concat(r,"rad)")}},"window-".concat(t))}))]},a.itemKey)]})}var fe,ge=5,me=10;function he(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ve(e){var t=(0,p.Z)(),n=(0,f.Z)([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]},{layoutKey:"g-302--xboat-repair-bay",transform:[1,0,0,1,-1200,600]},{layoutKey:"g-303--passenger-deck",transform:[1,0,0,-1,-1200,1800]},{layoutKey:"g-302--xboat-repair-bay",transform:[-1,0,0,1,2400,600]},{layoutKey:"g-301--bridge",transform:[1,0,0,-1,0,2400]}]),r=n.gms,a=n.gmGraph,c=(0,d.Z)((function(){return{initOpen:{0:[24]},doorsApi:{ready:!1},panZoomApi:{ready:!1},npcsApi:{ready:!1},fovApi:{ready:!1},handleCollisions:function(e){switch(e.meta.key){case"pre-collide":var t=c.npcsApi.getNpc(e.npcKey),n=c.npcsApi.getNpc(e.meta.otherNpcKey);t.cancel(),n.cancel();break;case"start-seg":var r,o=c.npcsApi.getNpc(e.npcKey),a=he(Object.values(c.npcsApi.npc).filter((function(e){return e!==o})));try{for(a.s();!(r=a.n()).done;){var i=r.value,s=c.npcsApi.detectCollision(o,i);s&&function(){console.warn("".concat(o.key," will collide with ").concat(i.key),s);var t=e.meta.length+s.distA,n=o.anim.wayMetas.findIndex((function(e){return e.length>=t}));o.anim.wayMetas.splice(n,0,{key:"pre-collide",index:e.meta.index,otherNpcKey:i.key,gmId:e.meta.gmId,length:t})}()}}catch(l){a.e(l)}finally{a.f()}}},handlePlayerWayEvent:function(e){return(0,o.Z)(i().mark((function t(){var n,r;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e.meta.key,t.next="exit-room"===t.t0?3:"enter-room"===t.t0?6:"pre-exit-room"===t.t0||"pre-near-door"===t.t0?8:"start-seg"===t.t0||"pre-collide"===t.t0?13:14;break;case 3:return null!==e.meta.otherRoomId?c.fovApi.setRoom(e.meta.gmId,e.meta.otherRoomId):(n=a.getAdjacentRoomCtxt(e.meta.gmId,e.meta.hullDoorId))&&c.fovApi.setRoom(n.adjGmId,n.adjRoomId),c.updateAll(),t.abrupt("break",15);case 6:return c.fovApi.setRoom(e.meta.gmId,e.meta.enteredRoomId)&&c.updateAll(),t.abrupt("break",15);case 8:if(c.doorsApi.open[e.meta.gmId][e.meta.doorId]){t.next=12;break}return r=c.npcsApi.getNpc(e.npcKey),t.next=12,r.cancel();case 12:case 13:return t.abrupt("break",15);case 14:throw(0,u.Ql)(e.meta);case 15:case"end":return t.stop()}}),t)})))()},updateAll:function(){c.fovApi.updateClipPath(),c.doorsApi.updateVisibleDoors(),t()}}}),{deps:[r,a]});return s.useEffect((function(){if(r.length&&c.doorsApi.ready&&c.npcsApi.ready){c.updateAll();var e=c.doorsApi.events.pipe((0,l.h)((function(e){return"closed-door"===e.key||"opened-door"===e.key}))).subscribe((function(){return c.updateAll()})),t=c.npcsApi.events.subscribe((function(e){switch(e.key){case"decor":c.npcsApi.setDecor(e.meta.key,e.meta);break;case"set-player":c.npcsApi.playerKey=e.npcKey||null,e.npcKey&&c.npcsApi.setRoomByNpc(e.npcKey);break;case"spawned-npc":c.npcsApi.playerKey===e.npcKey&&c.npcsApi.setRoomByNpc(e.npcKey);break;case"started-walking":case"stopped-walking":break;case"way-point":e.npcKey===c.npcsApi.playerKey&&c.handlePlayerWayEvent(e),"start-seg"!==e.meta.key&&"pre-collide"!==e.meta.key||c.handleCollisions(e);break;default:throw(0,u.Ql)(e)}}));return function(){e.unsubscribe(),t.unsubscribe()}}}),[r,c.doorsApi.ready,c.npcsApi.ready]),r.length?(0,Q.jsxs)(g.Z,{className:xe,initZoom:1.5,initCenter:{x:300,y:300},dark:!0,onLoad:function(e){c.panZoomApi=e,t()},children:[(0,Q.jsx)(ce,{gms:r}),(0,Q.jsx)(de,{showIds:!0,showLabels:!0,gms:r,gmGraph:a,worldApi:c}),(0,Q.jsx)(re,{disabled:e.disabled,gmGraph:a,npcsKey:be,onLoad:function(e){c.npcsApi=e,t()},worldApi:c}),(0,Q.jsx)(le,{gmGraph:a,onLoad:function(e){c.fovApi=e,t()},worldApi:c}),(0,Q.jsx)(ie.Z,{gmGraph:a,initOpen:c.initOpen,onLoad:function(e){c.doorsApi=e,t()},worldApi:c})]}):null}var be="npcs-demo-1",xe=(0,c.iv)(fe||(fe=(0,r.Z)(["\n  img {\n    position: absolute;\n    transform-origin: top left;\n    pointer-events: none;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(34%);\n    /* filter: invert(100%) brightness(55%) contrast(200%) brightness(60%); */\n  }\n\n  div.debug {\n    position: absolute;\n\n    div.debug-door-arrow, div.debug-label-info {\n      cursor: pointer;\n      position: absolute;\n      border-radius: ","px;\n    }\n    div.debug-door-arrow {\n      background-image: url('/icon/solid_arrow-circle-right.svg');\n    }\n    div.debug-label-info {\n      background-image: url('/icon/info-icon.svg');\n    }\n\n    div.debug-door-id-icon, div.debug-room-id-icon {\n      position: absolute;\n      background: black;\n      color: white;\n      font-size: 8px;\n      line-height: 1;\n      border: 1px solid black;\n    }\n    div.debug-room-id-icon {\n      color: #4f4;\n    }\n    div.debug-window {\n      position: absolute;\n      background: #0000ff40;\n      border: 1px solid white;\n      pointer-events: none;\n      transform-origin: top left;\n    }\n    svg.debug-room-nav, svg.debug-room-outline {\n      position: absolute;\n      pointer-events: none;\n      path.nav-poly {\n        pointer-events: none;\n        fill: rgba(255, 0, 0, 0.1);\n        stroke: blue;\n      }\n      path.room-outline {\n        pointer-events: none;\n        fill: rgba(0, 0, 255, 0.1);\n        stroke: red;\n      }\n    }\n  }\n"])),5)},69862:function(){},40964:function(){},28949:function(){}}]);