"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947,3260],{87947:function(n,e,t){t.r(e),t.d(e,{default:function(){return R}});var r,o=t(52209),i=(t(59748),t(88269)),a=t(95090),s=t(36694),c=t(84175),d=t(91441),l=t(48103),u=t(27375),p=t(2074),f=t(35650),g=t(87079),h=t(30245),b=t(94184),m=t.n(b),y=t(43260),v=t(8311);function k(n,e){var t="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(n,e){if(!n)return;if("string"===typeof n)return w(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);"Object"===t&&n.constructor&&(t=n.constructor.name);if("Map"===t||"Set"===t)return Array.from(n);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return w(n,e)}(n))||e&&n&&"number"===typeof n.length){t&&(n=t);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return a=n.done,n},e:function(n){s=!0,i=n},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}function w(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function x(n){var e=(0,u.Z)(),t=(0,f.Z)((function(){var r={apis:[],background:{},root:{},npcRef:function(n){if(n){var e=t.apis.find((function(e){return n.classList.contains(e.key)}));e?(e.el={root:n},n.style.left="".concat(e.def.position.x,"px"),n.style.top="".concat(e.def.position.y,"px")):console.error("".concat(x.name,": npc not found for div.").concat(Array.from(n.classList.values()).join(".")))}},rootRef:function(e){if(e){t.root=e;var r=e.querySelector("canvas.background");r.width=n.gm.d.pngRect.width,r.height=n.gm.d.pngRect.height,t.background=r}},spawn:function(n){console.log("spawning",n);var r,o=k(n);try{for(o.s();!(r=o.n()).done;){var i=r.value;t.apis.push({key:i.key,def:i,el:{}})}}catch(a){o.e(a)}finally{o.f()}e()}};return n.onLoad(r),r}));return(0,v.BX)("div",{className:Z,ref:t.rootRef,children:[(0,v.tZ)("canvas",{className:"background"}),(0,v.tZ)("div",{className:m()("npcs",{disabled:n.disabled}),children:t.apis.map((function(e){return(0,v.tZ)("div",{className:"npc ".concat(e.key),ref:t.npcRef,children:(0,v.tZ)(y.default,{disabled:n.disabled})},e.key)}))})]})}var A,Z=(0,i.iv)(r||(r=(0,o.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"])));function R(n){var e=(0,u.Z)(),t=(0,p.Z)(n.layoutKey,{staleTime:1/0}).data,r=(0,f.Z)((function(){return{clipPath:"none",currentHoleId:0,doorsApi:{},get gm(){return(0,c.Nh)(t)},npcsApi:{},wire:new a.x,getAdjacentHoleIds:function(){var n=r.gm.d.roomGraph,e=r.doorsApi.getOpen();return n.getEnterableRooms(n.nodesArray[r.currentHoleId],e).map((function(n){return n.holeIndex}))},onChangeDeps:function(){if(t){r.updateClipPath(),r.updateObservableDoors(),e(),r.npcsApi.spawn([{key:"andros",position:{x:50,y:38}}]);var n=r.wire.pipe((0,s.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){r.updateClipPath(),e()}));return function(){return n.unsubscribe()}}},updateClipPath:function(){var n=r.gm.d,e=n.holesWithDoors,t=n.hullOutline,o=n.pngRect,i=[r.currentHoleId].concat(r.getAdjacentHoleIds()).map((function(n){return e[n]})),a=l.LA.cutOut(i,[t]).map((function(n){return n.translate(-o.x,-o.y)})).map((function(n){return"".concat(n.svgPath)})).join(" ");r.clipPath="path('".concat(a,"')")},updateObservableDoors:function(){var n=r.gm.d.roomGraph,e=n.nodesArray[r.currentHoleId],t=n.getAdjacentDoors([e]);this.doorsApi.setObservableDoors(t.map((function(n){return n.doorIndex})))}}}),[t],{equality:{currentHoleId:!0}});return t?(0,v.BX)(g.Z,{stageKey:"nav-demo-1",dark:!0,className:N(t),children:[(0,v.tZ)("img",{className:"geomorph",src:(0,d.qX)(n.layoutKey),draggable:!1,width:t.d.pngRect.width,height:t.d.pngRect.height}),(0,v.tZ)(x,{gm:t,onLoad:function(n){return r.npcsApi=n},disabled:n.disabled}),(0,v.tZ)("img",{className:"geomorph-dark",src:(0,d.qX)(n.layoutKey),draggable:!1,width:t.d.pngRect.width,height:t.d.pngRect.height,style:{clipPath:r.clipPath}}),(0,v.tZ)(h.Z,{gm:t,wire:r.wire,onLoad:function(n){return r.doorsApi=n}})]}):null}var N=function(n){return(0,i.iv)(A||(A=(0,o.Z)(["\n  img {\n    position: absolute;\n    left: ","px;\n    top: ","px;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])),n.d.pngRect.x,n.d.pngRect.y)}},43260:function(n,e,t){t.r(e),t.d(e,{default:function(){return d}});var r,o=t(52209),i=t(94184),a=t.n(i),s=t(88269),c=t(8311);function d(n){return(0,c.BX)("div",{className:a()(u,"idle",{disabled:n.disabled}),ref:function(n){if(n){var e=n.children[1],t=function(){n.classList.toggle("idle"),n.classList.toggle("walk")};e.addEventListener("pointerdown",t),e.addEventListener("pointerup",t)}},children:[(0,c.tZ)("div",{className:"shadow"}),(0,c.tZ)("div",{className:"body"})]})}var l=256,u=(0,s.iv)(r||(r=(0,o.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    transform: scale(0.18);\n    pointer-events: all;\n    filter: contrast(200%);\n  }\n  \n  &.walk .body {\n    animation: walk 1s steps(",") infinite;\n    background: url('/pics/spritesheet-walk-test-2.png');\n  }\n  &.idle .body {\n    animation: idle 2s steps(",") infinite;\n    background: url('/pics/spritesheet-idle-test-2.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n\n  .shadow {\n    position: absolute;\n    left: ","px;\n    top: ","px;\n    border-radius: ","px;\n    border: ","px solid rgba(0, 0, 0, 0.25);\n    pointer-events: none;\n  }\n  &.walk .shadow {\n    transform: scale(1.2);\n  }\n"])),l,l,-128,-128,16,13,-4096,-3328,-9,-9,9,9)}}]);