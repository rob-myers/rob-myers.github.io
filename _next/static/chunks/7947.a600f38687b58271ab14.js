"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{87947:function(n,e,t){t.r(e),t.d(e,{default:function(){return v}});var r=t(52209),o=(t(59748),t(88269)),a=t(95090),i=t(36694),u=t(84175),c=t(91441),s=t(48103),p=t(27375),d=t(2074),l=t(35650),g=t(87079),h=t(30245);function f(n){(0,l.Z)((function(){var e={apis:[],spawn:function(n){console.log("spawning",n)}};return n.onLoad(e),e}));return null}var m,b=t(8311);function v(n){var e=(0,p.Z)(),t=(0,d.Z)(n.layoutKey,{staleTime:1/0}).data,r=(0,l.Z)((function(){return{clipPath:"none",currentHoleId:0,doorsApi:{},get gm(){return(0,u.Nh)(t)},npcsApi:{},wire:new a.x,getAdjacentHoleIds:function(){var n=r.gm.d.roomGraph,e=r.doorsApi.getOpen();return n.getEnterableRooms(n.nodesArray[r.currentHoleId],e).map((function(n){return n.holeIndex}))},onChangeDeps:function(){if(t){r.updateClipPath(),r.updateObservableDoors(),e(),r.npcsApi.spawn([{key:"andros"}]);var n=r.wire.pipe((0,i.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){r.updateClipPath(),e()}));return function(){return n.unsubscribe()}}},updateClipPath:function(){var n=r.gm.d,e=n.holesWithDoors,t=n.hullOutline,o=n.pngRect,a=[r.currentHoleId].concat(r.getAdjacentHoleIds()).map((function(n){return e[n]})),i=s.LA.cutOut(a,[t]).map((function(n){return n.translate(-o.x,-o.y)})).map((function(n){return"".concat(n.svgPath)})).join(" ");r.clipPath="path('".concat(i,"')")},updateObservableDoors:function(){var n=r.gm.d.roomGraph,e=n.nodesArray[r.currentHoleId],t=n.getAdjacentDoors([e]);this.doorsApi.setObservableDoors(t.map((function(n){return n.doorIndex})))}}}),[t],{equality:{currentHoleId:!0}});return t?(0,b.BX)(g.Z,{dark:!0,className:y(t),children:[(0,b.tZ)("img",{className:"geomorph",src:(0,c.qX)(n.layoutKey),draggable:!1,width:t.d.pngRect.width,height:t.d.pngRect.height}),(0,b.tZ)(f,{onLoad:function(n){return r.npcsApi=n}}),(0,b.tZ)("img",{className:"geomorph-dark",src:(0,c.qX)(n.layoutKey),draggable:!1,width:t.d.pngRect.width,height:t.d.pngRect.height,style:{clipPath:r.clipPath}}),(0,b.tZ)(h.Z,{gm:t,wire:r.wire,onLoad:function(n){return r.doorsApi=n}})]}):null}var y=function(n){return(0,o.iv)(m||(m=(0,r.Z)(["\n  img {\n    position: absolute;\n    left: ","px;\n    top: ","px;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])),n.d.pngRect.x,n.d.pngRect.y)}}}]);