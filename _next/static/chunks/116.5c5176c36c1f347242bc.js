"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[116],{30245:function(t,e,n){n.d(e,{Z:function(){return b}});var r,o=n(52209),i=n(92809),a=n(59748),c=n(88269),s=n(94184),l=n.n(s),u=n(84175),p=n(50269),f=n(35650),d=n(27375),g=n(8311);function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){(0,i.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function b(t){var e=(0,d.Z)(),n=(0,f.Z)((function(){return{api:{get ready(){return!0},getObservable:function(t){return Object.keys(n.observable[t]).map(Number)},getOpen:function(t){return Object.keys(n.open[t]).map(Number)},setObservableDoors:function(t,r){n.observable[t]=r.reduce((function(t,e){return h(h({},t),{},(0,i.Z)({},e,!0))}),{}),n.renderUnobservables(t),e()}},canvas:[],open:t.gms.map((function(t){return{}})),observable:t.gms.map((function(t){return{}})),rootEl:{},onToggleDoor:function(e){var r=Number(e.target.getAttribute("data-gm-index")),o=Number(e.target.getAttribute("data-index"));n.observable[r][o]&&(n.open[r][o]?delete n.open[r][o]:n.open[r][o]=!0,t.wire.next({gmIndex:r,index:o,key:n.open[r][o]?"opened-door":"closed-door"}),n.renderUnobservables(r))},renderUnobservables:function(e){var r=n.canvas[e],o=(0,u.Cq)(r.getContext("2d"));o.clearRect(0,0,r.width,r.height),o.fillStyle="#555",o.strokeStyle="#00204b",t.gms[e].gm.doors.filter((function(t,r){return!n.observable[e][r]})).forEach((function(t){var e=t.poly;(0,p.Fx)(o,[e]),o.stroke()}))}}}),[t.gms]);return a.default.useLayoutEffect((function(){t.onLoad(n.api)}),[]),a.default.useEffect((function(){return t.gms.forEach((function(e,r){n.open[r]=n.open[r]||{},n.observable[r]=n.observable[r]||{},t.gms.forEach((function(t,e){return n.renderUnobservables(e)}))})),n.rootEl.addEventListener("pointerup",n.onToggleDoor),function(){n.rootEl.removeEventListener("pointerup",n.onToggleDoor)}}),[t.gms]),(0,g.tZ)("div",{ref:function(t){return t&&(n.rootEl=t)},className:l()("doors",m),children:t.gms.map((function(t,e){return(0,g.BX)("div",{style:{transform:t.transformStyle},children:[t.gm.doors.map((function(t,r){var o=t.rect,i=t.angle,a=t.tags;return n.observable[e][r]&&(0,g.tZ)("div",{"data-gm-index":e,"data-index":r,className:l()("door",{open:n.open[e][r],iris:a.includes("iris")}),style:{left:o.x,top:o.y,width:o.width,height:o.height,transform:"rotate(".concat(i,"rad)"),transformOrigin:"top left"}},r)})),(0,g.tZ)("canvas",{ref:function(t){return t&&(n.canvas[e]=t)},width:t.gm.d.pngRect.width,height:t.gm.d.pngRect.height})]},t.itemKey)}))})}var m=(0,c.iv)(r||(r=(0,o.Z)(["\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n\n  div.door {\n    position: absolute;\n    cursor: pointer;\n\n    &:not(.iris) {\n      background: #fff;\n      border: 1px solid #555;\n\n      transition: width 300ms ease-in;\n      &.open {\n        width: 10px !important;\n      }\n    }\n\n    &.iris {\n      background-image: linear-gradient(45deg, #888 33.33%, #333 33.33%, #333 50%, #888 50%, #888 83.33%, #333 83.33%, #333 100%);\n      background-size: 4.24px 4.24px;\n      border: 1px solid #fff;\n      \n      opacity: 1;\n      transition: opacity 300ms ease;\n      &.open {\n        opacity: 0.1;\n      }\n    }\n  }\n"])))},95814:function(t,e,n){n.d(e,{Z:function(){return v}});var r=n(92809),o=n(97131),i=n(30266),a=n(809),c=n.n(a),s=n(88767),l=n(91441),u=n(48103),p=n(49082),f=n(20720);function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){(0,r.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function v(t,e){return(0,s.useQuery)((0,l.tU)(t),(0,i.Z)(c().mark((function e(){var n,r,i,a,s,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch((0,l.tU)(t)).then((function(t){return t.json()})).then(p.Vn);case 2:return n=e.sent,r=f.G.fromJson(n.roomGraph),i=r.nodesArray.filter((function(t){return"room"===t.type})).map((function(t,e){var i=r.getEdgesFrom(t).flatMap((function(t){var e=t.dst;return"door"===e.type?n.doors[e.doorIndex].poly:[]}));return u.LA.union([n.holes[e]].concat((0,o.Z)(i)))[0]})),a=n.groups.singles.filter((function(t){return t.tags.includes("switch")})).map((function(t){return t.poly.center})),s=n.groups.singles.filter((function(t){return t.tags.includes("spawn")})).map((function(t){return t.poly.center})),d=g(g({},n),{},{d:{holesWithDoors:i,holeSwitches:n.holes.map((function(t){return a.find((function(e){return t.contains(e)}))||t.rect.center})),hullDoors:n.doors.filter((function(t){return t.tags.includes("hull")})),hullOutline:n.hullPoly[0].removeHoles(),pngRect:u.UL.fromJson(n.items[0].pngRect),roomGraph:r,spawnPoints:s}}),e.abrupt("return",d);case 9:case"end":return e.stop()}}),e)}))),g({cacheTime:1/0},e))}},35650:function(t,e,n){n.d(e,{Z:function(){return a}});var r=n(79056),o=n(59748),i=n(84175);function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o.default.useState(t),c=(0,r.Z)(a,1),s=c[0];return o.default.useEffect((function(){var e,o=t.toString()!==s._prevFn;if(s._prevFn)if(o){for(var a=t(),c=0,l=Object.entries(a);c<l.length;c++){var u,p,f,d=(0,r.Z)(l[c],2),g=d[0],v=d[1],h=g;if("function"===typeof v)s[h]=v;else if(null!==(u=Object.getOwnPropertyDescriptor(s,h))&&void 0!==u&&u.get||null!==(p=Object.getOwnPropertyDescriptor(s,h))&&void 0!==p&&p.set){var b,m;Object.defineProperty(s,h,{get:null===(b=Object.getOwnPropertyDescriptor(a,h))||void 0===b?void 0:b.get,set:null===(m=Object.getOwnPropertyDescriptor(a,h))||void 0===m?void 0:m.set})}else g in s?s._prevInit&&null!==(f=n.equality)&&void 0!==f&&f[h]&&!(0,i.fS)(s._prevInit[h],a[h])&&(s[h]=a[h]):s[h]=v}for(var y=0,w=Object.entries(s);y<w.length;y++){var O=(0,r.Z)(w[y],2),x=O[0];O[1];x in a||delete s[x]}s._prevFn=t.toString(),s._prevInit=a}else for(var j=t(),P=0,E=Object.entries(j);P<E.length;P++){var S,Z,D=(0,r.Z)(E[P],2),k=D[0],z=D[1];if("function"===typeof z)s[k]=z;else if(null!==(S=Object.getOwnPropertyDescriptor(s,k))&&void 0!==S&&S.get||null!==(Z=Object.getOwnPropertyDescriptor(s,k))&&void 0!==Z&&Z.set){var X,Y;Object.defineProperty(s,k,{get:null===(X=Object.getOwnPropertyDescriptor(j,k))||void 0===X?void 0:X.get,set:null===(Y=Object.getOwnPropertyDescriptor(j,k))||void 0===Y?void 0:Y.set})}}else s._prevFn=t.toString(),s._prevInit=t();var _=null===(e=s.onChangeDeps)||void 0===e?void 0:e.call(s);if("function"===typeof _)return _}),e),s}},77277:function(t,e,n){n.d(e,{Z:function(){return a},l:function(){return c}});var r=n(88767),o=n(95090),i=n(29120);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stage-default";return(0,r.useQuery)(t,(function(){return{key:t,npcEvent:new o.x,ptrEvent:new o.x}}),{keepPreviousData:!0,staleTime:1/0})}function c(t){return(0,i.q9)(t)}},87079:function(t,e,n){n.d(e,{Z:function(){return h}});var r,o,i=n(52209),a=n(59748),c=n(94184),s=n.n(c),l=n(88269),u=n(48103),p=n(35650),f=n(77277),d=n(8311);function g(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t){var e=(0,p.Z)((function(){return{root:{},parent:{},opts:{minScale:.05,maxScale:10,step:.1},pointers:[],isPanning:!1,x:0,y:0,scale:t.zoom||1,origin:void 0,start:{clientX:0,clientY:0,scale:t.zoom||1,distance:0},evt:{wheel:function(t){e.zoomWithWheel(t)},pointerdown:function(t){y(e.pointers,t),e.isPanning=!0,e.origin=new u.dl(e.x,e.y);var n=w(e.pointers);e.start={clientX:n.clientX,clientY:n.clientY,scale:e.scale,distance:O(e.pointers)}},pointermove:function(t){if(void 0!==e.origin&&void 0!==e.start.clientX&&void 0!==e.start.clientY){y(e.pointers,t);var n=w(e.pointers);if(e.pointers.length>1){0===e.start.distance&&(e.start.distance=O(e.pointers));var r=O(e.pointers)-e.start.distance,o=3*e.opts.step,i=Math.min(Math.max(r*o/80+e.start.scale,e.opts.minScale),e.opts.maxScale);e.zoomToPoint(i,n)}else e.pan(e.origin.x+(n.clientX-e.start.clientX)/e.scale,e.origin.y+(n.clientY-e.start.clientY)/e.scale)}},pointerup:function(n){if(function(t,e){if(e.touches){for(;t.length;)t.pop();return}var n=t.findIndex((function(t){return t.pointerId===e.pointerId}));n>-1&&t.splice(n,1)}(e.pointers,n),e.isPanning){if(t.stageKey){var r=x(e.root),o=new DOMMatrixReadOnly(window.getComputedStyle(e.root).transform).inverse().transformPoint({x:n.clientX-r.parent.left,y:n.clientY-r.parent.top}),i=(0,f.l)(t.stageKey);null===i||void 0===i||i.ptrEvent.next({key:"pointerup",point:{x:o.x,y:o.y}})}e.isPanning=!1,e.origin=e.start.clientX=e.start.clientY=void 0}}},pan:function(t,n){e.x===t&&e.y===n||(e.x=t,e.y=n,e.updateView())},rootRef:function(t){t&&(e.root=t,e.parent=t.parentElement,e.parent.addEventListener("wheel",e.evt.wheel),e.parent.addEventListener("pointerdown",e.evt.pointerdown),e.parent.addEventListener("pointermove",e.evt.pointermove),e.parent.addEventListener("pointerup",e.evt.pointerup),e.parent.addEventListener("pointerleave",e.evt.pointerup),e.parent.addEventListener("pointercancel",e.evt.pointerup))},updateView:function(){e.root.style.transform="scale(".concat(e.scale,") translate(").concat(e.x,"px, ").concat(e.y,"px)")},zoom:function(t,n){t=Math.min(Math.max(t,e.opts.minScale),e.opts.maxScale);var r=e.x,o=e.y;if(n.focal){var i=n.focal;r=(i.x/t-i.x/e.scale+e.x*t)/t,o=(i.y/t-i.y/e.scale+e.y*t)/t}e.x=r,e.y=o,e.scale=t,e.updateView()},zoomToPoint:function(t,n){var r=x(e.root),o=r.parent.width-r.parent.padding.left-r.parent.padding.right-r.parent.border.left-r.parent.border.right,i=r.parent.height-r.parent.padding.top-r.parent.padding.bottom-r.parent.border.top-r.parent.border.bottom,a={x:(n.clientX-r.parent.left-r.parent.padding.left-r.parent.border.left-r.elem.margin.left)/o*(o*t),y:(n.clientY-r.parent.top-r.parent.padding.top-r.parent.border.top-r.elem.margin.top)/i*(i*t)};return e.zoom(t,{focal:a})},zoomWithWheel:function(t){t.preventDefault();var n=(0===t.deltaY&&t.deltaX?t.deltaX:t.deltaY)<0?1:-1,r=Math.min(Math.max(e.scale*Math.exp(n*e.opts.step/3),e.opts.minScale),e.opts.maxScale);return e.zoomToPoint(r,t)}}}));return(0,f.Z)(t.stageKey),a.default.useLayoutEffect((function(){if(t.zoom){var n=e.root.children[0].getBoundingClientRect(),r=n.x,o=n.y;e.zoomToPoint(t.zoom,{clientX:r,clientY:o})}}),[t.zoom]),(0,d.tZ)("div",{className:s()("panzoom-parent",b,m(t)),children:(0,d.BX)("div",{ref:e.rootRef,className:s()("panzoom-root",t.className),children:[(0,d.tZ)("div",{className:"origin"}),(0,d.tZ)("div",{className:"small-grid"}),t.children,(0,d.tZ)("div",{className:"large-grid"})]})})}var b=(0,l.iv)(r||(r=(0,i.Z)(["\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  user-select: none;\n  /** This is important for mobile to prevent scrolling while panning */\n  touch-action: none;\n  cursor: auto;\n  \n  .panzoom-root {\n    width: 100%;\n    height: 100%;\n    user-select: none;\n    touch-action: none;\n    /** @panzoom/panzoom uses 50% 50% instead */\n    transform-origin: 0 0;\n    \n    .small-grid, .large-grid {\n      position: absolute;\n      pointer-events: none;\n      left: ","px;\n      top: ","px;\n      width: ","px;\n      height: ","px;\n      background-image:\n        linear-gradient(to right, rgba(200, 200, 200, 0.1) 1px, transparent 1px),\n        linear-gradient(to bottom, rgba(200, 200, 200, 0.15) 1px, transparent 1px);\n    }\n    .small-grid {\n      background-size: 10px 10px;\n    }\n    .large-grid {\n      background-size: 60px 60px;\n    }\n    .origin {\n      position: absolute;\n    }\n  }\n"])),-3600,-3600,7200,7200),m=function(t){return(0,l.iv)(o||(o=(0,i.Z)(["\n  background-color: ",";\n"])),t.dark?"#000":"#fff")};function y(t,e){var n;if(e.touches){n=0;var r,o=g(e.touches);try{for(o.s();!(r=o.n()).done;){var i=r.value;i.pointerId=n++,y(t,i)}}catch(a){o.e(a)}finally{o.f()}}else(n=t.findIndex((function(t){return t.pointerId===e.pointerId})))>-1&&t.splice(n,1),t.push(e)}function w(t){for(var e,n=(t=t.slice(0)).pop();e=t.pop();)n={clientX:(e.clientX-n.clientX)/2+n.clientX,clientY:(e.clientY-n.clientY)/2+n.clientY};return n}function O(t){if(t.length<2)return 0;var e=t[0],n=t[1];return Math.sqrt(Math.pow(Math.abs(n.clientX-e.clientX),2)+Math.pow(Math.abs(n.clientY-e.clientY),2))}function x(t){var e=t.parentNode,n=window.getComputedStyle(t),r=window.getComputedStyle(e),o=t.getBoundingClientRect(),i=e.getBoundingClientRect();return{elem:{style:n,width:o.width,height:o.height,top:o.top,bottom:o.bottom,left:o.left,right:o.right,margin:j(t,"margin",n),border:j(t,"border",n)},parent:{style:r,width:i.width,height:i.height,top:i.top,bottom:i.bottom,left:i.left,right:i.right,padding:j(e,"padding",r),border:j(e,"border",r)}}}function j(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.getComputedStyle(t),r="border"===e?"Width":"";return{left:P("".concat(e,"Left").concat(r),n),right:P("".concat(e,"Right").concat(r),n),top:P("".concat(e,"Top").concat(r),n),bottom:P("".concat(e,"Bottom").concat(r),n)}}function P(t,e){return parseFloat(e[t])||0}},36694:function(t,e,n){n.d(e,{h:function(){return c}});var r=n(58474);function o(t){return function(e){if(function(t){return(0,r.m)(null===t||void 0===t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}var i=n(70655),a=function(t){function e(e,n,r,o,i){var a=t.call(this,e)||this;return a.onUnsubscribe=i,a._next=n?function(t){try{n(t)}catch(e){this.destination.error(e)}}:t.prototype._next,a._error=r?function(t){try{r(t)}catch(t){this.destination.error(t)}this.unsubscribe()}:t.prototype._error,a._complete=o?function(){try{o()}catch(t){this.destination.error(t)}this.unsubscribe()}:t.prototype._complete,a}return(0,i.ZT)(e,t),e.prototype.unsubscribe=function(){var e;!this.closed&&(null===(e=this.onUnsubscribe)||void 0===e||e.call(this)),t.prototype.unsubscribe.call(this)},e}(n(7038).Lv);function c(t,e){return o((function(n,r){var o=0;n.subscribe(new a(r,(function(n){return t.call(e,n,o++)&&r.next(n)})))}))}}}]);