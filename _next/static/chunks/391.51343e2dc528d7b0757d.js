"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[391],{63391:function(t,n,e){e.r(n),e.d(n,{default:function(){return j}});var r,o=e(52209),a=e(79056),c=e(92809),l=e(30266),i=e(809),s=e.n(i),u=e(59748),f=e(88767),p=e(88269),g=e(43350),m=e(48103),y=e(84273),d=e(83159),b=e(91441),h=e(8311);function v(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"===typeof t)return w(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return w(t,n)}(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,l=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return c=t.done,t},e:function(t){l=!0,a=t},f:function(){try{c||null==e.return||e.return()}finally{if(l)throw a}}}}function w(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function x(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function O(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?x(Object(e),!0).forEach((function(n){(0,c.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):x(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function j(t){var n=(0,f.useQuery)("".concat(t.layoutKey,"-json"),(0,l.Z)(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",fetch("/geomorph/".concat(t.layoutKey,".json")).then((function(t){return t.json()})));case 1:case"end":return n.stop()}}),n)})))).data;return(0,h.tZ)(d.Z,{gridBounds:g.l,initViewBox:g.r,maxZoom:6,children:n&&(0,h.BX)(h.HY,{children:[(0,h.tZ)("image",O(O({},n.pngRect),{},{href:"/geomorph/".concat(t.layoutKey,".png")})),(0,h.tZ)(Z,{gm:n})]})})}function Z(t){var n=t.gm,e=function(){var t=(0,u.useRef)(null);return(0,u.useEffect)((function(){var n;if(null!==(n=t.current)&&void 0!==n&&n.ownerSVGElement){var e=t.current.ownerSVGElement,r=Array.from(t.current.children)[0],o=function(){var t=e.viewBox.baseVal,n=t.x,o=t.width,a=t.y,c=t.height,l=g.r.height/c;r.style.perspective="".concat(100+2e3/l,"px"),r.style.perspectiveOrigin="".concat(n+.5*o,"px ").concat(a+.5*c,"px")};o(),new MutationObserver((function(t){return t.forEach((function(t){return"attributes"===t.type&&"viewBox"===t.attributeName&&o()}))})).observe(e,{attributes:!0})}}),[]),t}(),r=function(t){return u.default.useMemo((function(){var n=document.createElement("canvas"),e=n.getContext("2d"),r=[t.pngRect.width,t.pngRect.height];n.width=r[0],n.height=r[1],e.translate(-t.pngRect.x,-t.pngRect.y);var o=t.walls.map((function(t){return m.LA.from(t)}));e.fillStyle=L,(0,y.Fx)(e,o);var a=n.toDataURL();e.clearRect(0,0,n.width,n.height);var c=t.obstacles.map((function(t){return m.LA.from(t)}));e.fillStyle=A,(0,y.Fx)(e,c);var l=n.toDataURL();e.clearRect(0,0,n.width,n.height),e.font=b.Dv.font,e.textBaseline="top";var i,s=v(t.labels);try{for(s.s();!(i=s.n()).done;){var u=i.value,f=u.text,p=u.rect,g=u.padded;e.fillStyle="#000",e.fillRect(g.x,g.y,g.width,g.height),e.fillStyle="#fff",e.fillText(f,p.x,p.y)}}catch(d){s.e(d)}finally{s.f()}return{wallsDataUrl:a,obstaclesDataUrl:l,labelsDataUrl:n.toDataURL()}}),[t.walls])}(n),o=r.wallsDataUrl,c=r.obstaclesDataUrl,l=r.labelsDataUrl,i=u.default.useMemo((function(){return{wallSegs:n.walls.flatMap((function(t){return m.LA.from(t).translate(-n.pngRect.x,-n.pngRect.y).lineSegs})),doorSegs:n.doors.map((function(t){var e=(0,a.Z)(t.seg,2);return[e[0],e[1]].map((function(t){return m.dl.from(t).translate(-n.pngRect.x,-n.pngRect.y)}))})),obstacleSegs:n.obstacles.flatMap((function(t){return m.LA.from(t).translate(-n.pngRect.x,-n.pngRect.y).lineSegs}))}}),[n.walls]),s=i.wallSegs,f=i.doorSegs,p=i.obstacleSegs;return(0,h.tZ)("foreignObject",O(O({ref:e,xmlns:"http://www.w3.org/1999/xhtml"},n.pngRect),{},{children:(0,h.BX)("div",{className:D,children:[s.map((function(t,n){var e=(0,a.Z)(t,2),r=e[0],o=e[1];return R.copy(o).sub(r),(0,h.tZ)("div",{className:"wall",style:{transform:"translate3d(".concat(r.x,"px, ").concat(r.y,"px, 0px) rotateZ(").concat(R.angle,"rad) rotateX(90deg)"),width:R.length}},"wall-".concat(n))})),p.map((function(t,n){var e=(0,a.Z)(t,2),r=e[0],o=e[1];return R.copy(o).sub(r),(0,h.tZ)("div",{className:"obstacle",style:{transform:"translate3d(".concat(r.x,"px, ").concat(r.y,"px, 0px) rotateZ(").concat(R.angle,"rad) rotateX(90deg)"),width:R.length}},"obstacle-".concat(n))})),f.map((function(t,n){var e=(0,a.Z)(t,2),r=e[0],o=e[1];return R.copy(r).sub(o),(0,h.tZ)("div",{className:"door",style:{transform:"translate3d(".concat(o.x,"px, ").concat(o.y,"px, 0px) rotateZ(").concat(R.angle,"rad) rotateX(90deg)"),width:R.length}},"door-".concat(n))})),(0,h.tZ)("img",{src:o,className:"wall-tops"}),(0,h.tZ)("img",{src:c,className:"obstacle-tops"}),(0,h.tZ)("img",{src:l,className:"labels"})]})}))}var R=m.dl.zero,A="#666",S="#444",L="#222",P="#000",k="#444",D=(0,p.iv)(r||(r=(0,o.Z)(["\n  pointer-events: none;\n  transform-style: preserve-3d;\n  \n  .door {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n  }\n  .obstacle {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n    backface-visibility: hidden;\n  }\n  .wall {\n    position: absolute;\n    transform-origin: top left;\n    height: ","px;\n    background: ",";\n    backface-visibility: hidden;\n  }\n  .obstacle-tops {\n    position: absolute;\n    transform-origin: top left;\n    transform: translateZ(","px);\n  }\n  .labels, .wall-tops {\n    position: absolute;\n    transform-origin: top left;\n    transform: translateZ(","px);\n  }\n"])),150,k,75,S,150,P,75,150)},91441:function(t,n,e){e.d(n,{te:function(){return s},Dv:function(){return u},LH:function(){return f},Mo:function(){return g}});var r=e(92809),o=e(97131),a=(e(77503),e(292)),c=e(48103);e(84273);function l(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function i(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?l(Object(e),!0).forEach((function(n){(0,r.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):l(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function s(t,n){var e=new c._3,r={singles:[],obstacles:[],walls:[]};t.items.forEach((function(t,a){var l,i,s;t.transform?e.feedFromArray(t.transform):e.setIdentity();var u=n[t.symbol],p=u.singles,g=u.obstacles,m=u.walls,y=u.hull;a&&(e.a*=.2,e.b*=.2,e.c*=.2,e.d*=.2);var d=p.map((function(t){return{tags:t.tags,poly:t.poly.clone().applyMatrix(e).precision(1)}})).filter((function(n){var e=n.tags;return t.doors&&e.includes("door")?e.some((function(n){return t.doors.includes(n)})):!t.walls||!e.includes("wall")||e.some((function(n){return t.walls.includes(n)}))}));(l=r.singles).push.apply(l,(0,o.Z)(d)),(i=r.obstacles).push.apply(i,(0,o.Z)(g.map((function(t){return t.clone().applyMatrix(e)})))),(s=r.walls).push.apply(s,(0,o.Z)(c.LA.union([].concat((0,o.Z)(m.map((function(t){return t.clone().applyMatrix(e)}))),(0,o.Z)(f(d,"wall")),(0,o.Z)(y.flatMap((function(t){return t.createOutset(2)})).map((function(t){return t.applyMatrix(e)})))))))})),r.obstacles.forEach((function(t){return t.fixOrientation()})),r.singles.forEach((function(t){return t.poly.fixOrientation()}));var l=f(r.singles,"door"),s=r.walls.flatMap((function(t){return c.LA.cutOut(l,[t])}));r.walls=c.LA.union(s),r.singles=r.singles.reduce((function(t,n){return t.concat(n.tags.includes("wall")?c.LA.cutOut(l,[n.poly]).map((function(t){return i(i({},n),{},{poly:t})})):n)}),[]);var g=t.items.map((function(t){return n[t.symbol]})),m=g[0],y=m.hull.map((function(t){return t.clone().removeHoles()})),d=f(r.singles,"window"),b=c.LA.cutOut([].concat(s.flatMap((function(t){return t.createOutset(12)})),r.obstacles.flatMap((function(t){return t.createOutset(8)}))),y).map((function(t){return t.cleanFinalReps().precision(1).fixOrientation()})),h=(0,a.vL)(0,0).getContext("2d");h.font=u.font;var v=p(r.singles,"label").map((function(t){var n=t.poly,e=t.tags,r=n.rect.center.json,o=e.filter((function(t){return"label"!==t})).join(" "),a=!o.match(/[gjpqy]/),l={x:h.measureText(o).width,y:a?u.noTailPx:u.sizePx},i={x:r.x-.5*l.x,y:r.y-.5*l.y,width:l.x,height:l.y};return{text:o,center:r,rect:i,padded:(new c.UL).copy(i).outset(u.padX,u.padY).json}}));return{def:t,groups:r,navPoly:b,walls:s,labels:v,hullTop:c.LA.cutOut(l.concat(d),m.hull),hullRect:c.UL.from.apply(c.UL,(0,o.Z)(m.hull.concat(l).map((function(t){return t.rect})))),items:g.map((function(n,e){return{key:n.key,pngHref:e?"/symbol/".concat(n.key,".png"):"/debug/".concat(t.key,".png"),pngRect:n.pngRect,transformArray:t.items[e].transform,transform:t.items[e].transform?"matrix(".concat(t.items[e].transform,")"):void 0}}))}}var u={sizePx:11,noTailPx:10,font:"".concat(11,"px sans-serif"),padX:4,padY:2};function f(t,n){return p(t,n).map((function(t){return t.poly}))}function p(t,n){return t.filter((function(t){return t.tags.includes(n)}))}function g(t){return Object.values(t).reduce((function(t,n){return(t[n.key]={key:(e=n).key,hull:e.hull.map(c.LA.from),obstacles:e.obstacles.map(c.LA.from),walls:e.walls.map(c.LA.from),singles:e.singles.map((function(t){var n=t.tags,e=t.poly;return{tags:n,poly:c.LA.from(e)}})),pngRect:e.pngRect})&&t;var e}),{})}}}]);