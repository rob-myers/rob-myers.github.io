"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{87947:function(n,t,e){e.r(t),e.d(t,{default:function(){return S}});var o,r,a=e(52209),i=(e(59748),e(88269)),s=e(95090),c=e(36694),u=e(84175),l=e(91441),p=e(48103),d=e(27375),f=e(2074),g=e(35650),h=e(87079),m=e(30245),y=e(94184),b=e.n(y),v=e(77277),k=e(8311);function w(n,t){var e="undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!e){if(Array.isArray(n)||(e=function(n,t){if(!n)return;if("string"===typeof n)return x(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);"Object"===e&&n.constructor&&(e=n.constructor.name);if("Map"===e||"Set"===e)return Array.from(n);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return x(n,t)}(n))||t&&n&&"number"===typeof n.length){e&&(n=e);var o=0,r=function(){};return{s:r,n:function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}},e:function(n){throw n},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){e=e.call(n)},n:function(){var n=e.next();return i=n.done,n},e:function(n){s=!0,a=n},f:function(){try{i||null==e.return||e.return()}finally{if(s)throw a}}}}function x(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,o=new Array(t);e<t;e++)o[e]=n[e];return o}function A(n){var t=(0,d.Z)(),e=(0,g.Z)((function(){var o={apis:[],background:{},root:{},npcRef:function(n){if(n){var t=e.apis.find((function(t){return n.classList.contains(t.key)}));t?(t.el={root:n},n.style.left="".concat(t.def.position.x,"px"),n.style.top="".concat(t.def.position.y,"px")):console.error("".concat(A.name,": npc not found for div.").concat(Array.from(n.classList.values()).join(".")))}},rootRef:function(t){if(t){e.root=t;var o=t.querySelector("canvas.background");o.width=n.gm.d.pngRect.width,o.height=n.gm.d.pngRect.height,e.background=o}},spawn:function(o){if((0,v.l)(n.stageKey)){console.log("spawning...",o),e.apis=e.apis.filter((function(n){return!o.some((function(t){return n.key===t.key}))}));var r,a=w(o);try{for(a.s();!(r=a.n()).done;){var i=r.value;e.apis.push({key:i.key,def:i,animState:"idle",el:{}})}}catch(s){a.e(s)}finally{a.f()}}else console.error("".concat(A.name,': cannot spawn into non-existent stage "').concat(n.stageKey,'"'));t()}};return n.onLoad(o),o}));return(0,k.BX)("div",{className:R,ref:e.rootRef,children:[(0,k.tZ)("canvas",{className:"background"}),(0,k.tZ)("div",{className:b()("npcs",{disabled:n.disabled}),onPointerDown:function(n){var o=n.target;(0,u.Nh)(e.apis.find((function(n){return o.classList.contains(n.key)}))).animState="walk",t()},onPointerUp:function(n){var o=n.target;(0,u.Nh)(e.apis.find((function(n){return o.classList.contains(n.key)}))).animState="idle",t()},children:e.apis.map((function(n){return(0,k.tZ)("div",{className:b()("npc",n.key,n.animState,P),ref:e.npcRef,children:(0,k.tZ)("div",{className:b()("body","no-select",n.key)})},n.key)}))})]})}var Z,R=(0,i.iv)(o||(o=(0,a.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"]))),N=new p.dl(51,26).scale(2),I=new p.dl(49,37).scale(2),P=(0,i.iv)(r||(r=(0,a.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    transform: scale(0.18);\n    pointer-events: all;\n    filter: grayscale(100%);\n  }\n  \n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 300ms steps(",") infinite;\n    background: url('/npc/first-npc--walk.png');\n  }\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: idle 2s steps(",") infinite;\n    background: url('/npc/first-npc--idle.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n"])),I.x,I.y,-I.x/2,-I.y/2,3,N.x,N.y,-N.x/2,-N.y/2,1,-3*I.x,-1*N.x);function S(n){var t=(0,d.Z)(),e=(0,f.Z)(n.layoutKey,{staleTime:1/0}).data,o=(0,g.Z)((function(){return{clipPath:"none",currentHoleId:0,doorsApi:{},get gm(){return(0,u.Nh)(e)},npcsApi:{},wire:new s.x,getAdjacentHoleIds:function(){var n=o.gm.d.roomGraph,t=o.doorsApi.getOpen();return n.getEnterableRooms(n.nodesArray[o.currentHoleId],t).map((function(n){return n.holeIndex}))},onChangeDeps:function(){if(e){o.updateClipPath(),o.updateObservableDoors(),t();var n=o.wire.pipe((0,c.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){o.updateClipPath(),t()}));return function(){return n.unsubscribe()}}},updateClipPath:function(){var n=o.gm.d,t=n.holesWithDoors,e=n.hullOutline,r=n.pngRect,a=[o.currentHoleId].concat(o.getAdjacentHoleIds()).map((function(n){return t[n]})),i=p.LA.cutOut(a,[e]).map((function(n){return n.translate(-r.x,-r.y)})).map((function(n){return"".concat(n.svgPath)})).join(" ");o.clipPath="path('".concat(i,"')")},updateObservableDoors:function(){var n=o.gm.d.roomGraph,t=n.nodesArray[o.currentHoleId],e=n.getAdjacentDoors([t]);this.doorsApi.setObservableDoors(e.map((function(n){return n.doorIndex})))}}}),[e],{equality:{currentHoleId:!0}});return e?(0,k.BX)(h.Z,{stageKey:"stage-nav-demo-1",dark:!0,className:j(e),children:[(0,k.tZ)("img",{className:"geomorph",src:(0,l.qX)(n.layoutKey),draggable:!1,width:e.d.pngRect.width,height:e.d.pngRect.height}),(0,k.tZ)(A,{gm:e,onLoad:function(n){o.npcsApi=n,t()},disabled:n.disabled,stageKey:"stage-nav-demo-1"}),(0,k.tZ)("img",{className:"geomorph-dark",src:(0,l.qX)(n.layoutKey),draggable:!1,width:e.d.pngRect.width,height:e.d.pngRect.height,style:{clipPath:o.clipPath,WebkitClipPath:o.clipPath}}),(0,k.tZ)(m.Z,{gm:e,wire:o.wire,onLoad:function(n){return o.doorsApi=n}})]}):null}var j=function(n){return(0,i.iv)(Z||(Z=(0,a.Z)(["\n  img {\n    position: absolute;\n    left: ","px;\n    top: ","px;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])),n.d.pngRect.x,n.d.pngRect.y)}}}]);