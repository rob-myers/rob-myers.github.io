"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7947],{87947:function(n,e,t){t.r(e),t.d(e,{default:function(){return E}});var o,r,i=t(79056),a=t(52209),s=t(59748),d=t(88269),c=t(95090),l=t(36694),p=t(91441),u=t(48103),g=t(27375),f=t(44275),m=t(97301),h=t(87079),y=t(30245),b=t(94184),v=t.n(b),I=t(46208),x=t(8311);function k(n){var e=(0,g.Z)(),t=(0,f.Z)((function(){return{npc:{},npcRef:function(n){if(n){var e=n.getAttribute("data-npc-key"),o=t.npc[e];o.el.root=n,n.style.left="".concat(o.def.position.x,"px"),n.style.top="".concat(o.def.position.y,"px")}}}}));return s.default.useEffect((function(){var o=(0,I.f)(n.wireKey).subscribe((function(n){"spawn"===n.key&&(t.npc[n.npcKey]={key:n.npcKey,instanceKey:"".concat(n.npcKey,"-").concat(++O),def:{key:n.npcKey,position:n.at},spriteSheetState:"idle",el:{root:{}}},e())}));return function(){return o.unsubscribe()}}),[]),(0,x.tZ)("div",{className:v()("npcs",A),children:Object.values(t.npc).map((function(n){return(0,x.tZ)("div",{"data-npc-key":n.key,className:v()("npc",n.key,n.spriteSheetState,K),ref:t.npcRef,children:(0,x.tZ)("div",{className:v()("body",n.key,"no-select")})},n.instanceKey)}))})}var w,A=(0,d.iv)(o||(o=(0,a.Z)(["\n  position: absolute;\n  canvas {\n    position: absolute;\n    pointer-events: none;\n  }\n  .npc {\n    position: absolute;\n  }\n"]))),Z=new u.dl(51,26).scale(2),R=new u.dl(49,37).scale(2),K=(0,d.iv)(r||(r=(0,a.Z)(["\n  .body {\n    cursor: pointer;\n    position: absolute;\n    transform: scale(0.18);\n    pointer-events: all;\n    filter: grayscale(100%);\n  }\n  \n  &.walk .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: walk 300ms steps(",") infinite;\n    background: url('/npc/first-npc--walk.png');\n  }\n  &.idle .body {\n    width: ","px;\n    height: ","px;\n    left: ","px;\n    top: ","px;\n    animation: idle 2s steps(",") infinite;\n    background: url('/npc/first-npc--idle.png');\n  }\n\n  &.disabled .body {\n    animation-play-state: paused;\n  }\n\n  @keyframes walk {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n  @keyframes idle {\n    from { background-position: 0px; }\n    to { background-position: ","px; }\n  }\n"])),R.x,R.y,-R.x/2,-R.y/2,3,Z.x,Z.y,-Z.x/2,-Z.y/2,1,-3*R.x,-1*Z.x),O=0;function E(n){var e=(0,g.Z)(),t=(0,m.Z)([{layoutKey:"g-301--bridge"},{layoutKey:"g-101--multipurpose",transform:[1,0,0,1,0,600]},{layoutKey:"g-302--xboat-repair-bay",transform:[1,0,0,1,-1200,600]},{layoutKey:"g-303--passenger-deck",transform:[1,0,0,-1,-1200,1800]},{layoutKey:"g-302--xboat-repair-bay",transform:[-1,0,0,1,2400,600]},{layoutKey:"g-301--bridge",transform:[1,0,0,-1,0,2400]}]),o=t.gms,r=t.gmGraph,i=(0,f.Z)((function(){return{gmId:0,holeId:2,clipPath:o.map((function(n){return"none"})),doorsApi:{ready:!1},npcsApi:{},wire:new c.x,getEnterableHoleIds:function(){var n=i.gmId,e=o[n].roomGraph,t=i.doorsApi.getOpen(n),r=e.nodesArray[i.holeId];return e.getEnterableRooms(r,t).map((function(n){return n.holeIndex}))},update:function(){i.updateClipPath(),i.updateObservableDoors(),e()},updateClipPath:function(){var n=o[i.gmId],e=o.map((function(n){return[]})),t=i.doorsApi.getOpen(i.gmId),a=r.computeLightPolygons(i.gmId,i.holeId,t);o.forEach((function(t,o){var r=a.filter((function(n){return o===n.gmIndex})).map((function(n){return n.poly.precision(3)}));e[o]=u.LA.cutOut(r.concat(t===n?n.holesWithDoors[i.holeId]:[]),[t.hullOutline])})),e.forEach((function(n,e){n.forEach((function(n){return n.translate(-o[e].pngRect.x,-o[e].pngRect.y)}));var t=n.map((function(n){return"".concat(n.svgPath)})).join(" ");i.clipPath[e]=t.length?"path('".concat(t,"')"):"none"}))},updateObservableDoors:function(){var n=this,e=o[i.gmId],t=e.roomGraph.nodesArray[i.holeId],a=o.map((function(n){return[]}));a[i.gmId]=e.roomGraph.getAdjacentDoors(t).map((function(n){return n.doorIndex})),e.roomGraph.getAdjacentHullDoorIds(e,t).flatMap((function(n){var e=n.hullDoorIndex;return r.getAdjacentHoleCtxt(i.gmId,e)||[]})).forEach((function(n){var e=n.adjGmId,t=n.adjDoorId;return a[e]=[t]})),o.forEach((function(e,t){return n.doorsApi.setVisible(t,a[t])}))}}}),{overwrite:{gmId:!0,holeId:!0},deps:[o,r]});return s.default.useEffect((function(){if(o.length&&i.doorsApi.ready){i.update();var n=i.wire.pipe((0,l.h)((function(n){return"closed-door"===n.key||"opened-door"===n.key}))).subscribe((function(n){i.update()}));return function(){return n.unsubscribe()}}}),[o.length,i.doorsApi.ready]),o.length?(0,x.BX)(h.Z,{wireKey:"wire-demo-1",dark:!0,className:j,zoom:.4,children:[o.map((function(n){return(0,x.tZ)("img",{className:"geomorph",src:(0,p.qX)(n.key),draggable:!1,width:n.pngRect.width,height:n.pngRect.height,style:{left:n.pngRect.x,top:n.pngRect.y,transform:n.transformStyle,transformOrigin:n.transformOrigin}})})),(0,x.tZ)(k,{onLoad:function(n){i.npcsApi=n,e()},disabled:n.disabled,wireKey:"wire-demo-1"}),o.map((function(n,e){return(0,x.tZ)("img",{className:"geomorph-dark",src:(0,p.qX)(n.key),draggable:!1,width:n.pngRect.width,height:n.pngRect.height,style:{clipPath:i.clipPath[e],WebkitClipPath:i.clipPath[e],left:n.pngRect.x,top:n.pngRect.y,transform:n.transformStyle,transformOrigin:n.transformOrigin}},e)})),i.doorsApi.ready&&(0,x.tZ)(G,{gms:o,gmGraph:r,doorsApi:i.doorsApi,gmId:i.gmId,holeId:i.holeId,setHole:function(n,e){var t=[n,e];i.gmId=t[0],i.holeId=t[1],i.update()}}),(0,x.tZ)(y.Z,{gms:o,gmGraph:r,wire:i.wire,onLoad:function(n){return i.doorsApi=n}})]}):null}var j=(0,d.iv)(w||(w=(0,a.Z)(["\n  img {\n    position: absolute;\n    transform-origin: top left;\n  }\n  img.geomorph {\n    filter: brightness(80%);\n  }\n  img.geomorph-dark {\n    filter: invert(100%) brightness(55%) contrast(200%) sepia(0%);\n  }\n"])));function G(n){var e=n.gms[n.gmId],t=n.doorsApi.getVisible(n.gmId);return(0,x.BX)("div",{onClick:function(t){var o=t.target,r=Number(o.getAttribute("data-door-index")),a=e.doors[r],s=a.holeIds.filter((function(e){return e!==n.holeId})),d=(0,i.Z)(s,1)[0];if(null!==d)return n.setHole(n.gmId,d);var c=e.hullDoors.indexOf(a),l=n.gmGraph.getAdjacentHoleCtxt(n.gmId,c);l?n.setHole(l.adjGmId,l.adjHoleId):console.info("hull door is isolated",n.gmId,c)},children:[n.outlines&&n.gms.map((function(n,e){return(0,x.tZ)("div",{style:{position:"absolute",left:n.gridRect.x,top:n.gridRect.y,width:n.gridRect.width,height:n.gridRect.height,border:"2px red solid"}},e)})),(0,x.tZ)("div",{className:"debug",style:{transform:e.transformStyle,position:"absolute"},children:t.map((function(t){var o=e.doors[t],r=o.poly,i=o.normal,a=o.holeIds[0]===n.holeId?1:-1,s=u.dl.from(i).scale(-a).angle,d=r.center.addScaledVector(i,a*P);return(0,x.tZ)("div",{"data-door-index":t,style:{width:2*N,height:2*N,borderRadius:N,position:"absolute",left:d.x-N,top:d.y-N,transform:"rotate(".concat(s,"rad)"),backgroundImage:"url('/icon/solid_arrow-circle-right.svg')",cursor:"pointer"}},t)}))},e.itemKey)]})}var N=5,P=18}}]);