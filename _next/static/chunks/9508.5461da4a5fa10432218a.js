"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9508],{73481:function(t,n,e){e.r(n),e.d(n,{default:function(){return P}});var r,o=e(52209),i=e(97131),u=e(59748),a=e(88269),s=e(95090),c=e(36694),l=e(48103),p=e(91441),f=e(84175),d=e(44275),h=e(27375),m=e(97301),g=e(87079),y=e(30245),b=e(8311);function v(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"===typeof t)return w(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return w(t,n)}(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,u=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return u=t.done,t},e:function(t){a=!0,i=t},f:function(){try{u||null==e.return||e.return()}finally{if(a)throw i}}}}function w(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function P(t){var n=(0,h.Z)(),e=(0,m.Z)([{layoutKey:"g-101--multipurpose"}]),r=e.gms,o=e.gmGraph,a=r[0],w=(0,d.Z)((function(){return{clipPath:"none",doorsApi:{},roomShown:{0:!0,2:!0},wire:new s.x,onToggleLight:function(t){var n=t.target,e=Number(n.getAttribute("data-index"));e in w.roomShown?delete w.roomShown[e]:w.roomShown[e]=!0,w.updateMasks()},updateMasks:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=(0,f.Nh)(a),r=e.pngRect,u=e.hullOutline,s=e.roomsWithDoors,c=e.roomGraph,p=Object.keys(w.roomShown).map(Number),d=w.doorsApi.getOpen(0),h=p.flatMap((function(t){return o.computeLightPolygons(0,t,d)})),m=p.map((function(t){return s[t]})).concat(h.map((function(t){return t.poly}))).map((function(t){return t.precision(2)})),g=c.getAdjacentDoors.apply(c,(0,i.Z)(p.map((function(t){return c.nodesArray[t]}))));this.doorsApi.setVisible(0,g.map((function(t){return t.doorId})));var y=l.LA.cutOut(m,[u]).map((function(t){return t.translate(-r.x,-r.y)})),b=y.map((function(t){return"".concat(t.svgPath)})).join(" ");n(),setTimeout((function(){w.clipPath="path('".concat(b,"')"),n()}),t)}}}),{overwrite:{roomShown:!0},deps:[a]});return u.default.useEffect((function(){if(a){var t,n=v(Object.keys(w.roomShown).map(Number));try{for(n.s();!(t=n.n()).done;){var e=t.value;a.rooms[e]||delete w.roomShown[e]}}catch(o){n.e(o)}finally{n.f()}w.updateMasks();var r=w.wire.pipe((0,c.h)((function(t){return"closed-door"===t.key||"opened-door"===t.key}))).subscribe((function(t){return w.updateMasks("closed-door"===t.key?300:0)}));return function(){return r.unsubscribe()}}}),[a]),(0,b.tZ)(g.Z,{dark:!0,className:O,children:a&&(0,b.BX)(b.HY,{children:[(0,b.tZ)("img",{className:"geomorph",src:(0,p.qX)(a.key),draggable:!1,style:{left:a.pngRect.x,top:a.pngRect.y,width:a.pngRect.width,height:a.pngRect.height}}),(0,b.tZ)("img",{className:"geomorph-dark",src:(0,p.qX)(a.key),draggable:!1,style:{left:a.pngRect.x,top:a.pngRect.y,width:a.pngRect.width,height:a.pngRect.height,clipPath:w.clipPath,WebkitClipPath:w.clipPath}}),(0,b.tZ)("div",{className:"light-toggles",onClick:w.onToggleLight,children:a.roomsSwitch.map((function(t,n){return(0,b.tZ)("div",{"data-index":n,className:"toggle",style:{left:t.x-5,top:t.y-5,borderColor:w.roomShown[n]?"#5f5":"rgba(200, 0, 0, 0.3)",outline:w.roomShown[n]?"1px solid black":"1px solid rgba(255, 255, 255, 0.5)"}},n)}))}),(0,b.tZ)(y.Z,{gms:r,gmGraph:o,wire:w.wire,onLoad:function(t){return w.doorsApi=t}})]})})}var O=(0,a.iv)(r||(r=(0,o.Z)(["\n  img.geomorph-dark {\n    position: absolute;\n    filter: invert(100%) brightness(45%) contrast(200%) sepia(0%) hue-rotate(0deg) blur(0px);\n  }\n  img.geomorph {\n    position: absolute;\n    filter: brightness(65%) sepia(50%) hue-rotate(180deg);\n  }\n  div.light-toggles {\n    position: absolute;\n\n    div.toggle {\n      border-radius: 5px;\n      border: 5px solid white;\n      position: absolute;\n      cursor: pointer;\n    }\n  }\n  svg.room-graph {\n    position: absolute;\n    pointer-events: none;\n    circle, line {\n      pointer-events: none;\n    }\n  }\n"])))},95814:function(t,n,e){e.d(n,{Z:function(){return m}});var r=e(92809),o=e(97131),i=e(30266),u=e(809),a=e.n(u),s=e(88767),c=e(91441),l=e(48103),p=e(2026),f=e(5524);function d(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function h(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?d(Object(e),!0).forEach((function(n){(0,r.Z)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):d(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function m(t,n){return(0,s.useQuery)((0,c.tU)(t),(0,i.Z)(a().mark((function n(){var e,r,i,u,s,p;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch((0,c.tU)(t)).then((function(t){return t.json()})).then(f.Vn);case 2:return e=n.sent,r=e.roomGraph,i=r.nodesArray.filter((function(t){return"room"===t.type})).map((function(t,n){var i=r.getEdgesFrom(t).flatMap((function(t){var n=t.dst;return"door"===n.type?e.doors[n.doorId].poly:[]}));return l.LA.union([e.rooms[n]].concat((0,o.Z)(i)))[0]})),u=e.groups.singles.filter((function(t){return t.tags.includes("switch")})).map((function(t){return t.poly.center})),s=e.groups.singles.filter((function(t){return t.tags.includes("spawn")})).map((function(t){return t.poly.center})),(p=h(h({},e),{},{roomsWithDoors:i,roomsSwitch:e.rooms.map((function(t){return u.find((function(n){return t.contains(n)}))||t.rect.center})),hullDoors:e.doors.filter((function(t){return t.tags.includes("hull")})),hullOutline:e.hullPoly[0].removeHoles(),pngRect:l.UL.fromJson(e.items[0].pngRect),spawnPoints:s,lazy:null})).lazy=g(p),y(p),n.abrupt("return",p);case 11:case"end":return n.stop()}}),n)}))),h({cacheTime:1/0},n))}function g(t){var n={roomNavPoly:{}},e=new Proxy({},{get:function(e,r){if("string"===typeof r){var o=Number(r);return t.roomsWithDoors[o]&&!n.roomNavPoly[o]&&(n.roomNavPoly[o]=l.LA.intersect(t.navPoly,[t.roomsWithDoors[o]])),n.roomNavPoly[o]}}});return new Proxy(n,{get:function(t,n){if("roomNavPoly"===n)return e}})}function y(t){t.navZone.doorNodeIds.forEach((function(n,e){var r=t.doors[e];if(t.hullDoors.includes(r)){var i,u=r.roomIds.find(Boolean);if(Number.isFinite(u))(i=t.navZone.roomNodeIds[u]).push.apply(i,(0,o.Z)(n));else(0,p.ZK)("extendRoomNodeIds: ".concat(t.key," (hull) door ").concat(e," has empty roomIds"))}}))}}}]);