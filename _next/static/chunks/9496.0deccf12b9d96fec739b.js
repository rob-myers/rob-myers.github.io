"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9496],{9496:function(e,t,n){n.r(t),n.d(t,{default:function(){return A}});var r,o=n(52209),c=n(92809),i=n(88269),a=n(24790),u=n(84175),f=n(91441),s=n(49345),l=n(35650),p=n(21225),d=n(35490),h=n(83159),g=n(59748),y=n(94184),b=n.n(y),v=n(8311);function O(e){var t=e.json,n=(0,l.Z)((function(){return{api:{evt:new a.x},open:{},onClick:function(t){var r=t.target,o=Number(r.getAttribute("data-index")),c=r.classList.toggle("open");n.open[o]=c,e.wire.next({key:c?"opened-door":"closed-door",index:o})}}}));return(0,v.tZ)("g",{className:w,onPointerUp:n.onClick,children:t.doors.map((function(e,t){var r=e.rect,o=e.angle;return(0,v.tZ)("rect",{"data-index":t,className:b()("door",{open:n.open[t]}),x:r.x,y:r.y,width:r.width,height:r.height,style:{transform:"rotate(".concat(o,"rad)"),transformOrigin:"".concat(r.x,"px ").concat(r.y,"px")}},t)}))})}var w=(0,i.iv)(r||(r=(0,o.Z)(["\n  rect.door {\n    cursor: pointer;\n    fill: #000;\n    opacity: 1;\n    transition: opacity 100ms linear;\n    &.open {\n      opacity: 0;\n    }\n  }\n"]))),m=n(79056),j=n(48103),P=n(68451),k=n(27375);function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e){var t=(0,k.Z)(),n=(0,l.Z)((function(){return{key:"Lights_".concat(e.json.id),lights:[],doors:{},computeLights:function(e){var t=e.json,r=e.defs,o=j.LA.from(t.hull.poly[0]).removeHoles(),c=t.walls.concat(t.doors.filter((function(e,t){return"open"!==n.doors[t]})).map((function(e){return e.poly}))).map((function(e){return j.LA.from(e)})).flatMap((function(e){return P.J.triangulationToPolys(e.fastTriangulate())})),i=r.filter((function(e){var t=(0,m.Z)(e.def,1)[0];return o.contains(t)}));n.lights=i.map((function(e,t){var n=(0,m.Z)(e.def,4),r=n[0],o=n[1],i=n[2],a=n[3],u=P.J.lightPolygon(r,o,c),f=u.rect,s=new j.dl((r.x-f.x)/f.width,(r.y-f.y)/f.height),l=f.width>=f.height?new j.dl(1,f.width/f.height):new j.dl(f.height/f.width,1);return{key:"light",index:t,maskId:a,intensity:i,position:r,poly:u,ratio:s,r:o/(Math.max(f.width,f.height)/2)*.5,scale:l}}))}}}));return g.default.useEffect((function(){n.computeLights(e);var r=e.wire.subscribe((function(r){switch(r.key){case"opened-door":n.doors[r.index]="open",n.computeLights(e),t();break;case"closed-door":n.doors[r.index]="closed",n.computeLights(e),t()}}));return function(){return r.unsubscribe()}}),[e.defs]),(0,v.BX)(v.HY,{children:[(0,v.BX)("defs",{children:[n.lights.map((function(e,t){var r=e.ratio,o=e.scale,c=e.r,i=e.intensity;return(0,v.BX)("radialGradient",{id:"radial-".concat(n.key,"-").concat(t),cx:r.x,cy:r.y,r:c,gradientTransform:"translate(".concat(r.x,", ").concat(r.y,") scale(").concat(o.x,", ").concat(o.y,") translate(").concat(-r.x,", ").concat(-r.y,")"),children:[(0,v.tZ)("stop",{offset:"0%","stop-color":"rgb(".concat(255*i>>0,", ").concat(255*i>>0,", ").concat(255*i>>0,")")}),(0,v.tZ)("stop",{offset:"90%","stop-color":"#000"}),(0,v.tZ)("stop",{offset:"100%","stop-color":"#000"})]})})),[0,1].map((function(e){return(0,v.tZ)("mask",{id:"mask-".concat(n.key,"-").concat(e),children:n.lights.filter((function(t){return t.maskId===e})).map((function(e){var t=e.poly,r=e.index;return(0,v.tZ)("path",{d:t.svgPath,fill:"url(#radial-".concat(n.key,"-").concat(r,")")})}))})}))]}),[0,1].map((function(t){return(0,v.tZ)("image",x(x({},e.json.pngRect),{},{className:"geomorph-light",href:(0,f.qX)(e.json.key),mask:"url(#mask-".concat(n.key,"-").concat(t,")")}))})),n.lights.map((function(e){var t=e.position;return(0,v.tZ)(v.HY,{children:(0,v.tZ)("image",{href:"/icon/Simple_Icon_Eye.svg",width:"20",height:"20",x:t.x-10,y:t.y-10})})}))]})}var E,S=n(30266),_=n(809),I=n.n(_),L=n(88767);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e){var t=(0,L.useQuery)("Image:".concat(e.href,"(").concat(e.darken||0,")"),(0,S.Z)(I().mark((function t(){var n,r,o,c;return I().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Image,r=document.createElement("canvas"),t.next=4,new Promise((function(t,r){n.src=e.href,n.onload=function(){return t(n)},n.onerror=function(){return r(new Error("failed to load image: ".concat(e.href)))}}));case 4:return o=[n.width,n.height],r.width=o[0],r.height=o[1],(c=(0,u.Cq)(r.getContext("2d"))).drawImage(n,0,0),c.fillStyle="rgba(0, 0, 0, ".concat(e.darken,")"),c.fillRect(0,0,r.width,r.height),t.abrupt("return",r.toDataURL());case 12:case"end":return t.stop()}}),t)})))).data;return(0,v.tZ)("image",q(q({},e),{},{href:t}))}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e){var t=(0,p.Z)(F).data,n=(0,l.Z)((function(){return{lightDefs:[{key:"light-def",def:[new s.d(205,385),170,1,0]},{key:"light-def",def:[new s.d(620,430),250,.8,0]},{key:"light-def",def:[new s.d(420,400),250,.4,1]},{key:"light-def",def:[new s.d(620,315),250,1,1]}],wire:new a.x}}),{lightDefs:function(e,t){return(0,u.fS)(e,t)}});return(0,v.tZ)(h.Z,{dark:!0,gridBounds:d.l,initViewBox:d.r,maxZoom:6,className:H,children:t&&(0,v.BX)(v.HY,{children:[(0,v.tZ)(C,X(X({},t.pngRect),{},{className:"geomorph",href:(0,f.qX)(F),darken:.95})),(0,v.tZ)(D,{json:t,defs:n.lightDefs,wire:n.wire}),(0,v.tZ)(O,{json:t,wire:n.wire})]})})}var F="g-301--bridge",H=(0,i.iv)(E||(E=(0,o.Z)(["\n  path.shadow {\n    fill: #00000066;\n    pointer-events: none;\n  }\n"])))},21225:function(e,t,n){n.d(t,{Z:function(){return p}});var r=n(92809),o=n(30266),c=n(809),i=n.n(c),a=n(88767),u=n(18264),f=n(91441);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e){return(0,a.useQuery)((0,f.tU)(e),(0,o.Z)(i().mark((function t(){var n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch((0,f.tU)(e)).then((function(e){return e.json()}));case 2:return n=t.sent,t.abrupt("return",l(l({},n),{},{d:{navPoly:n.navPoly.map(u.L.from)}}));case 4:case"end":return t.stop()}}),t)}))),{keepPreviousData:!0,cacheTime:1/0})}},35650:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(79056),o=n(59748);function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.default.useState(e),c=(0,r.Z)(n,1),i=c[0];return o.default.useEffect((function(){var n=e.toString()!==i._prevFn;if(i._prevFn){if(n){for(var o=e(),c=0,a=Object.entries(o);c<a.length;c++){var u,f=(0,r.Z)(a[c],2),s=f[0],l=f[1];"function"===typeof l?i[s]=l:s in i?i._prevInit&&!1===(null===(u=t[s])||void 0===u?void 0:u.call(t,i._prevInit[s],o[s]))&&(i[s]=o[s]):i[s]=l}for(var p=0,d=Object.entries(i);p<d.length;p++){var h=(0,r.Z)(d[p],2),g=h[0];h[1];g in o||delete i[g]}i._prevFn=e.toString(),i._prevInit=o}}else i._prevFn=e.toString(),i._prevInit=e()}),[]),i}},84175:function(e,t,n){function r(e,t){if(void 0===e)throw new Error("Encountered unexpected undefined value".concat(t?" for '".concat(t,"'"):""));return e}function o(e,t){if(null==e)throw new Error("Encountered unexpected null or undefined value".concat(t?" for '".concat(t,"'"):""));return e}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n>10)throw Error("equals: recursive depth exceeded 10");return(void 0===e||void 0!==t)&&("function"===typeof(null===e||void 0===e?void 0:e.equals)?!0===e.equals(t):Array.isArray(e)?e.every((function(e,n){return c(e,t[n])}),n+1)&&e.length===t.length:i(e)?Object.keys(e).every((function(n){return c(e[n],t[n])}),n+1)&&Object.keys(e).length===Object.keys(t).length:e===t)}function i(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}n.d(t,{Nh:function(){return r},Cq:function(){return o},fS:function(){return c}})}}]);