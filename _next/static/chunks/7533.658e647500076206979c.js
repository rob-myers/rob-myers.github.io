"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7533],{87267:function(e,t,s){s.r(t),s.d(t,{default:function(){return T}});var r=s(52209),n=s(30266),i=s(809),o=s.n(i),a=s(67294),u=s(88269),c=s(20296),l=s(79056),h=s(68216),d=s(25997),f=s(92809),p=s(84175),m=s(98379),v=s(23921);function y(e,t){var s="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!s){if(Array.isArray(e)||(s=function(e,t){if(!e)return;if("string"===typeof e)return w(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return w(e,t)}(e))||t&&e&&"number"===typeof e.length){s&&(e=s);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,a=!1;return{s:function(){s=s.call(e)},n:function(){var e=s.next();return o=e.done,e},e:function(e){a=!0,i=e},f:function(){try{o||null==s.return||s.return()}finally{if(a)throw i}}}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}var k=function(){function e(t,s){var r=this;(0,h.Z)(this,e),this.xterm=t,this.session=s,(0,f.Z)(this,"commandBuffer",void 0),(0,f.Z)(this,"cursor",void 0),(0,f.Z)(this,"cursorRow",void 0),(0,f.Z)(this,"input",void 0),(0,f.Z)(this,"readyForInput",void 0),(0,f.Z)(this,"promptReady",void 0),(0,f.Z)(this,"nextPrintId",void 0),(0,f.Z)(this,"prompt",void 0),(0,f.Z)(this,"historyIndex",-1),(0,f.Z)(this,"preHistory",void 0),(0,f.Z)(this,"linesPerUpdate",500),(0,f.Z)(this,"refreshMs",0),(0,f.Z)(this,"forceLowerCase",!1),(0,f.Z)(this,"runCommands",(function(){var e,t=0;for(r.nextPrintId=null;(e=r.commandBuffer.shift())&&t<=r.linesPerUpdate;)switch(e.key){case"await-prompt":return void r.commandBuffer.unshift(e);case"clear":r.clearScreen();break;case"line":r.xterm.writeln(e.line),r.trackCursorRow(1),t++;break;case"newline":for(var s=r.offsetToColRow(r.input,r.cursor).row,n=r.offsetToColRow(r.input,r.input.length).row;s++<n;)r.xterm.write("\r\n");return r.xterm.write("\r\n"),r.trackCursorRow(1),void r.sendLine();case"paste-line":return r.xterm.writeln(e.line),r.trackCursorRow(1),r.input=e.line,void r.sendLine();case"resolve":e.resolve();break;case"prompt":r.xterm.write(e.prompt),r.promptReady=!0;break;default:throw(0,p.Ql)(e)}r.printPending()})),this.input="",this.cursor=0,this.prompt="",this.readyForInput=!0,this.promptReady=!1,this.commandBuffer=[],this.nextPrintId=null,this.cursorRow=0,this.historyIndex=-1,this.preHistory=this.input}return(0,d.Z)(e,[{key:"initialise",value:function(){this.xterm.onData(this.handleXtermInput.bind(this)),this.session.io.handleWriters(this.onMessage.bind(this)),this.xterm.writeln("".concat(v.ZD.White,"Connected to session ").concat(v.ZD.Blue).concat(this.session.key).concat(v.ZD.Reset)),this.clearInput(),this.cursorRow=2}},{key:"actualCursor",value:function(e,t){return this.actualLine(e.slice(0,t)).length}},{key:"actualLine",value:function(e){return this.prompt+e}},{key:"autoSendCode",value:function(e){this.promptReady?(this.clearInput(),this.input=e,this.sendLine()):this.onMessage({key:"warn",msg:"not ready, ignored code: ".concat(e)})}},{key:"clearInput",value:function(){this.setCursor(0);var e=Math.min(this.numLines(),this.xterm.rows+1-this.cursorRow);e>1?(this.xterm.write("\r\x1b[K\x1b[E".repeat(e)),this.xterm.write("\x1b[F".repeat(e))):this.xterm.write("\r\x1b[K"),this.input=""}},{key:"clearScreen",value:function(){for(var e=0;e<this.xterm.rows;e++)this.xterm.writeln("");this.xterm.write("\x1b[F".repeat(this.xterm.rows)),this.xterm.scrollToBottom(),this.cursorRow=1,this.showPendingInput()}},{key:"closestLeftBoundary",value:function(e,t){return this.wordBoundaries(e,!0).reverse().find((function(e){return e<t}))||0}},{key:"closestRightBoundary",value:function(e,t){return this.wordBoundaries(e,!1).find((function(e){return e>t}))||e.length}},{key:"deletePreviousWord",value:function(){var e=this.closestLeftBoundary(this.input,this.cursor);if(null!=e){var t=this.input.slice(0,e)+this.input.slice(this.cursor);this.clearInput(),this.setInput(t),this.setCursor(e)}}},{key:"handleCursorErase",value:function(e){var t=this.cursor,s=this.input;if(e){if(t<=0)return;var r=-1;"\n"===this.input.charAt(this.cursor+r)&&(r=-2);var n=s.slice(0,t+r)+s.slice(t);this.clearInput(),this.setInput(n),this.setCursor(t+r)}else{var i=s.slice(0,t)+s.slice(t+1);this.clearInput(),this.setInput(i),this.setCursor(t)}}},{key:"handleCursorInsert",value:function(e){var t=this.input,s=this.cursor,r=t.slice(0,s)+e+t.slice(s),n=this.cursor+e.length;this.clearInput(),this.setInput(r),this.setCursor(n)}},{key:"handleCursorMove",value:function(e){var t=1===e?Math.min(e,this.input.length-this.cursor):Math.max(e,-this.cursor),s=this.input.charAt(this.cursor+t);1===e?"\r"===s?t+=2:"\n"===s&&(t+=1):"\n"===s&&(t-=1),this.setCursor(this.cursor+t)}},{key:"handleXtermInput",value:function(){var e=(0,n.Z)(o().mark((function e(t){var s,r,n,i,a,u,c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.readyForInput||"\x03"===t){e.next=2;break}return e.abrupt("return");case 2:if(!(t.length>1&&t.includes("\r"))){e.next=26;break}s=t.replace(/[\r\n]+/g,"\n"),(r=s.split("\n"))[0]="".concat(this.input).concat(r[0]),n=!s.endsWith("\n")&&r.pop(),i=y(r),e.prev=8,u=o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.value,e.next=3,new Promise((function(e){c.queueCommands([{key:"paste-line",line:t},{key:"await-prompt"},{key:"resolve",resolve:e}])}));case 3:case"end":return e.stop()}}),e)})),i.s();case 11:if((a=i.n()).done){e.next=15;break}return e.delegateYield(u(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),i.e(e.t1);case 20:return e.prev=20,i.f(),e.finish(20);case 23:n&&this.queueCommands([{key:"resolve",resolve:function(){c.clearInput(),c.setInput(n)}}]),e.next=27;break;case 26:this.handleXtermKeypresses(t);case 27:case"end":return e.stop()}}),e,this,[[8,17,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleXtermKeypresses",value:function(e){var t,s=e.charCodeAt(0);if(!(e.length>1&&this.input.startsWith(e)))if(27==s)switch(e.slice(1)){case"[A":this.promptReady&&this.reqHistoryLine(1);break;case"[B":this.promptReady&&this.reqHistoryLine(-1);break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this.input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(t=this.closestLeftBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"f":null!=(t=this.closestRightBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"\x7f":this.deletePreviousWord()}else if(s<32||127===s)switch(e){case"\r":this.queueCommands([{key:"newline"}]);break;case"\x7f":this.handleCursorErase(!0);break;case"\t":this.handleCursorInsert("  ");break;case"\x03":this.sendSigKill();break;case"\x17":this.deletePreviousWord();break;case"\x01":this.setCursor(0);break;case"\x05":this.setCursor(this.input.length);break;case"\f":this.clearScreen();break;case"\v":var r=this.input.slice(0,this.cursor);this.clearInput(),this.setInput(r);break;case"\x15":var n=this.input.slice(this.cursor);this.clearInput(),this.setInput(n),this.setCursor(0)}else this.forceLowerCase&&1===e.length&&!this.input.includes("/")&&(e=e.toLowerCase()),this.handleCursorInsert(e)}},{key:"inputEndsAtEdge",value:function(e){var t=this.actualLine(e),s=this.actualCursor(e,e.length);return 0===this.offsetToColRow(t,s).col}},{key:"offsetToColRow",value:function(e,t){for(var s=this.xterm.cols,r=0,n=0,i=0;i<t;++i){("\n"===e.charAt(i)||(n+=1)>=s)&&(n=0,r+=1)}return{row:r,col:n}}},{key:"onMessage",value:function(e){var t=this;if("string"===typeof e){var s=e.split("\n").map((function(e){return{key:"line",line:"".concat(v.ZD.White).concat(e).concat(v.ZD.Reset)}}));return this.queueCommands(s)}if(null===e)return this.session.rememberLastValue(null),this.queueCommands([{key:"line",line:"".concat(v.ZD.Yellow,"null").concat(v.ZD.Reset)}]);if(void 0!==e)switch(e.key){case"send-xterm-prompt":return void this.setPrompt(e.prompt);case"clear-xterm":return void this.clearScreen();case"tty-received-line":return this.input="",void(this.readyForInput=!0);case"send-history-line":if(e.line){var r=e.line.split(/\r?\n/).join("\r\n");-1===this.historyIndex&&(this.preHistory=this.input),this.clearInput(),this.setInput(r),this.historyIndex=e.nextIndex}else 0===e.nextIndex&&(this.clearInput(),this.setInput(this.input!==this.preHistory?this.preHistory:""),this.historyIndex=-1,this.preHistory="");return;case"error":this.queueCommands([{key:"line",line:"".concat(v.ZD.Red).concat(e.msg).concat(v.ZD.Reset)}]);break;case"warn":this.queueCommands([{key:"line",line:"\u2139\ufe0f  ".concat(e.msg).concat(v.ZD.Reset)}]);break;default:(0,m.jO)(e)?e.items.slice(-2*m.bt).forEach((function(e){return t.onMessage(e)})):(this.queueCommands([{key:"line",line:"".concat(v.ZD.Yellow).concat((0,p.or)(e)).concat(v.ZD.Reset)}]),"string"!==typeof e&&this.session.rememberLastValue(e))}}},{key:"numLines",value:function(){return 1+this.offsetToColRow(this.input,this.input.length+2).row}},{key:"prepareForCleanMsg",value:function(){this.promptReady&&this.input.length>0?this.xterm.buffer.active.cursorX>0&&this.queueCommands([{key:"line",line:""}]):this.clearInput()}},{key:"printPending",value:function(){this.commandBuffer.length&&!this.nextPrintId&&(this.nextPrintId=window.setTimeout(this.runCommands,this.refreshMs))}},{key:"queueCommands",value:function(e){var t,s=y(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;this.commandBuffer.push(r)}}catch(n){s.e(n)}finally{s.f()}this.printPending()}},{key:"reqHistoryLine",value:function(e){this.session.io.writeToReaders({key:"req-history-line",historyIndex:this.historyIndex+e})}},{key:"sendLine",value:function(){this.prompt="",this.readyForInput=this.promptReady=!1,this.historyIndex=-1,this.preHistory="",this.session.io.writeToReaders({key:"send-line",line:this.input})}},{key:"sendSigKill",value:function(){this.input="",this.setCursor(0),this.xterm.write("^C\r\n"),this.trackCursorRow(1),this.cursor=0,this.commandBuffer.length=0,this.session.io.writeToReaders({key:"send-kill-sig"})}},{key:"setCursor",value:function(e){e<0?e=0:e>this.input.length&&(e=this.input.length);var t=this.actualLine(this.input),s=this.actualCursor(this.input,this.cursor),r=this.offsetToColRow(t,s),n=r.col,i=r.row,o=this.actualCursor(this.input,e),a=this.offsetToColRow(t,o),u=a.col,c=a.row;if(c>i)for(var l=i;l<c;++l)this.xterm.write("\x1b[B");else for(var h=c;h<i;++h)this.xterm.write("\x1b[A");if(this.trackCursorRow(c-i),u>n)for(var d=n;d<u;++d)this.xterm.write("\x1b[C");else for(var f=u;f<n;++f)this.xterm.write("\x1b[D");this.cursor=e}},{key:"setInput",value:function(e){this.setCursor(0);var t=this.actualLine(e);this.xterm.write(t),t&&this.inputEndsAtEdge(e)&&(this.xterm.write("\r\n"),this.trackCursorRow(1)),this.input=e,this.cursor=e.length}},{key:"setPrompt",value:function(e){this.prompt=e;var t=(0,l.Z)(this.commandBuffer,1)[0];t&&"await-prompt"===t.key&&this.commandBuffer.shift(),this.queueCommands([{key:"prompt",prompt:e}])}},{key:"showPendingInput",value:function(){this.promptReady&&this.setInput(this.input)}},{key:"trackCursorRow",value:function(e){this.cursorRow+=e,this.cursorRow<1?this.cursorRow=1:this.cursorRow>this.xterm.rows&&(this.cursorRow=this.xterm.rows)}},{key:"wordBoundaries",value:function(e){for(var t,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[],n=/\w+/g;t=n.exec(e);)r.push(s?t.index:t.index+t[0].length);return r}}]),e}(),x=s(50269),C=s(34735);var g,b=s(59885),I=s(94184),R=s.n(I),Z=s(44275),L=s(85893);function S(e){var t=(0,Z.Z)((function(){return{onClick:function(t){var s=t.target,r=e.session.ttyShell.xterm;if(r.xterm.scrollToBottom(),s.classList.contains("lowercase")){var n=r.forceLowerCase=!r.forceLowerCase,i="\u26a0\ufe0f  input ".concat(n?"forced as":"not forced as"," lowercase");C.default.api.writeMsgCleanly(e.session.key,i),s.classList.toggle("enabled"),(0,p.xd)(P,"".concat(n))}else s.classList.contains("ctrl-c")?r.sendSigKill():s.classList.contains("clear")?r.clearScreen():s.classList.contains("up")?r.reqHistoryLine(1):s.classList.contains("down")&&r.reqHistoryLine(-1);r.xterm.focus()}}}));return a.useEffect((function(){var t=e.session.ttyShell.xterm;return(0,p.Lk)(P)||(0,p.xd)(P,"true"),t.forceLowerCase="true"===(0,p.Lk)(P),function(){t.forceLowerCase=!1}}),[]),(0,L.jsxs)("div",{className:B,onClick:t.onClick,style:{top:"".concat(e.offset,"px")},children:[(0,L.jsx)("div",{className:R()("icon lowercase",{enabled:e.session.ttyShell.xterm.forceLowerCase}),children:"abc"}),(0,L.jsx)("div",{className:"icon ctrl-c",children:"\ud83d\udc80"}),(0,L.jsx)("div",{className:"icon clear",children:"\u2205"}),(0,L.jsx)("div",{className:"icon up",children:"\u2b06\ufe0f"}),(0,L.jsx)("div",{className:"icon down",children:"\u2b07\ufe0f"})]})}var D,P="touch-tty-force-lowercase",B=(0,u.iv)(g||(g=(0,r.Z)(["\n  position: absolute;\n  z-index: 100000;\n  top: 0;\n  right: 16px;\n  width: 32px;\n  height: 128px;\n\n  line-height: 1; /** Needed for mobile viewing 'Desktop site' */\n  background-color: rgba(0, 0, 0, 0.7);\n  font-size: 0.75rem;\n  border: 1px solid #555;\n  border-width: 1px 1px 1px 1px;\n  color: white;\n\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  transition: top 500ms ease;\n\n  .lowercase {\n    color: #999;\n    &.enabled {\n      color: white;\n    }\n  }\n\n  .icon {\n    cursor: pointer;\n    width: 100%;\n    text-align: center;\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n  }\n"]))),E=s(27375);function T(e){var t=(0,E.Z)(),s=(0,Z.Z)((function(){return{isTouchDevice:(0,x.us)(),offset:0,session:null,wasDisabled:!1,xtermReady:!1}}));return function(e){var t=a.useState((function(){return e()})),s=(0,l.Z)(t,2),r=s[0],n=s[1];a.useEffect((function(){function t(){n(e())}return window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}}),[])}((function(){return s.isTouchDevice=(0,x.us)()})),a.useEffect((function(){return s.session=C.default.api.createSession(e.sessionKey,e.env),t(),function(){C.default.api.removeSession(e.sessionKey),s.xtermReady=!1}}),[e.sessionKey]),a.useEffect((function(){var t,r;if(e.disabled)s.wasDisabled=!0,C.default.api.writeMsgCleanly(e.sessionKey,"Paused session",{prompt:!1}),Object.values(null!==(t=null===(r=s.session)||void 0===r?void 0:r.process)&&void 0!==t?t:{}).filter((function(e){return e.status===C.ProcessStatus.Running})).forEach((function(e){e.onSuspends=e.onSuspends.filter((function(e){return e()})),e.status=C.ProcessStatus.Suspended}));else if(!e.disabled&&s.wasDisabled&&s.xtermReady){var n,i;C.default.api.writeMsgCleanly(e.sessionKey,"Resumed session"),Object.values(null!==(n=null===(i=s.session)||void 0===i?void 0:i.process)&&void 0!==n?n:{}).filter((function(e){return e.status===C.ProcessStatus.Suspended})).forEach((function(e){e.onResumes=e.onResumes.filter((function(e){return e()})),e.status=C.ProcessStatus.Running}))}}),[e.disabled]),(0,L.jsxs)(q,{children:[s.session&&(0,L.jsx)(b.Od,{onMount:function(e){var r=(0,p.Cq)(s.session),n=new k(e,{key:r.key,io:r.ttyIo,rememberLastValue:function(e){return r.var._=e}});n.initialise(),r.ttyShell.initialise(n),s.xtermReady=!0,t(),n.xterm.onLineFeed((0,c.debounce)((function(){s.isTouchDevice&&(s.offset=Math.max(1,parseInt(e.textarea.style.top)-100),t())}),100))},options:M,linkProviderDef:{regex:/(\ud83d\udd0e [^;]+);/g,callback:function(e,t){return(0,n.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,p.Cq)(s.session).ttyShell.xterm.autoSendCode(t);case 2:case"end":return e.stop()}}),e)})))()}}}),s.isTouchDevice&&s.session&&s.xtermReady&&(0,L.jsx)(S,{session:s.session,offset:s.offset})]})}var q=(0,u.zo)("div")(D||(D=(0,r.Z)(["\n  grid-area: terminal;\n  background: black;\n  height: 100%;\n  padding: 4px;\n  /** TODO fix padding without scrollbar offset */\n"]))),M={allowProposedApi:!0,fontSize:16,cursorBlink:!0,rendererType:"canvas",rightClickSelectsWord:!0,theme:{background:"black",foreground:"#41FF00"},convertEol:!1,scrollback:250,rows:50}},17120:function(e,t,s){s.d(t,{Z:function(){return a}});var r=s(32296),n=s(99846),i=s(16988),o=s(95243);function a(e){return(0,r.Z)(e)||(0,n.Z)(e)||(0,i.Z)(e)||(0,o.Z)()}}}]);