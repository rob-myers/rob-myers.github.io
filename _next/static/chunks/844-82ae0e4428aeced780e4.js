"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[844],{55125:function(e,t,n){n.d(t,{m:function(){return r}});var r={test:{key:"test",label:"test",markdown:"## Test page\n\n<div\n    className=\"tabs\"\n    enabled=\"true\"\n    height=\"600\"\n    tabs=\"[\n      { key: 'component', filepath: 'geomorph/GeomorphDemo' },\n      // { key: 'terminal', session: 'test' },\n      // { key: 'terminal', session: 'other' },\n    ]\"\n>\n</div>\n",timestamp:"2021-07-19",page:-1,href:""},"coming-soon":{key:"coming-soon",label:"coming-soon",markdown:"## Coming soon...\n",timestamp:"2021-07-19",page:-1,href:""},objective:{key:"objective",label:"Objective",markdown:'## Objective\n\nWe\'ll create a _Game AI focused_ roguelike, set in the [Traveller universe](https://travellermap.com/?p=-1.329!-23.768!3).\n\n_Why?_\n\nBecause [NPC](https://tvtropes.org/pmwiki/pmwiki.php/Main/NonPlayerCharacter) behaviour is more interesting than any particular game.\nAn environment is needed to make it meaningful, fixed narratives/missions are not.\n\nWe\'ll focus on combining navigation-based behaviours in a flexible manner.\nGame AI should be compositional, not forced into a narrative straight-jacket.\nAs for the environment, it will be driven by thousands of Traveller-based assets.\n\n<div\n  class="tabs"\n  height="400"\n  tabs="[{ key: \'component\', filepath: \'images/Gm301Debug\' }]"\n></div>\n\nAbove we\'ve recreated Geomorph 301 (a.k.a. _Bridge_) from [Starship Geomorphs 2.0](http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html),\nusing 8 assets from [Starship Symbols](http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html).\nA larger version is [available](/pics/g-301--bridge.debug.x2.png "@new-tab").\nRoughly speaking, a "Starship Geomorph" is a rectangular slice of a starship designed to be cut out and glued to others.\nThey were created by Robert Pearce, and distributed as PDFs on his [blog](http://travellerrpgblog.blogspot.com/).\nTheir 2nd version was released in 2020, and soon afterwards Eric B. Smith transformed them into [transparent PNGs](http://gurpsland.no-ip.org/geomorphs/).\nThe latter 2000+ symbols will form the underlying basis of _Rogue Markup_.\n',timestamp:"2021-07-19",page:1,href:"/blog/1"},constraints:{key:"constraints",label:"Constraints",markdown:'## Constraints\n\nThis project needs a backbone.\nWe\'ve chosen the underlying technology, low-level game mechanics, and where events take place.\n\n### Technology\n\n- Use CSS/SVG/PNGs, not HTMLCanvas/WebGL.\n- Use [React function components](https://reactjs.org/docs/components-and-props.html#function-and-class-components) and CSS-in-JS.\n- Use [Preact](https://www.npmjs.com/package/preact) (like React), and [Goober](https://www.npmjs.com/package/goober) (like [Emotion](https://www.npmjs.com/package/@emotion/styled)).\n- Use [Web Components](https://developer.mozilla.org/en-US/docs/Web/Web_Components) to avoid React renders.\n- Use [NextJS](https://nextjs.org/) as our dev env.\n- Use [CodeSandbox](https://codesandbox.io) to share editable code.\n- Support mobile/desktop devices.\n\nFor example, here\'s a [CodeSandbox](https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx  "@new-tab").\nIf you peruse the files, you\'ll find the rectangle class _Rect_ and a Geomorph PNG.\nOur CodeSandboxes use React, whereas this site uses _Preact_.\nMore on that later.\n\n### Game mechanics\n\n- Use [Starship Geomorphs 2.0](http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html) for graphics.\n- Use a realtime birdseye camera.\n- Use the [Web Animations API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API/Using_the_Web_Animations_API).\n- Use navigation & raycasting algorithms.\n- Use an in-browser terminal.\n- Do not use a Physics engine.\n\nTo debug and illustrate Game AI, we\'ll use a terminal.\nTry entering (or copy-pasting) the commands below.\n\n  | Category | Examples  |\n  | ------- | ---------- |\n  | Nav | <span class="cmd">ls</span>, <span class="cmd">pwd</span>, <span class="cmd">cd /home/test</span>, <span class="cmd">cd ..</span> |\n  | CRUD | <span class="cmd">echo foo >/home/bar</span>, <span class="cmd">/home/bar</span>, <span class="cmd">cd; rm bar</span> |\n  | Out | <span class="cmd">seq 10</span>, <span class="cmd">echo foo{1..5}</span>, <span class="cmd">expr \'2**10\'</span> |\n  | Meta | <span class="cmd">history</span>, <span class="cmd"> declare</span>, <span class="cmd">help</span>, <span class="cmd"> ps</span> |\n\n  <div\n    class="tabs"\n    height="300"\n    tabs="[ { key: \'terminal\', session: \'test\' } ]"\n  ></div>\n\nAs usual, [Ctrl+C](#command "sigkill test") terminates the "foreground process".\nTry terminating <span class="cmd">sleep 5</span>.\n\n### Setting\n\n- The [Traveller Universe](https://travellermap.com/?p=-1.329!-23.768!3).\n- Space vehicles, stations, and docks.\n- Buddhist backdrop via [Bardo Thodol](https://en.wikipedia.org/wiki/Bardo_Thodol).\n- Horror backdrop via [The Night Land](https://en.wikipedia.org/wiki/The_Night_Land).\n\n\nTraveller is a Futuristic pen-and-paper Role-playing Game, created in the late 70s.\nIt permits faster than light travel, at \u2264 6 parsecs per week.\nLearn more on the [wiki](https://wiki.travellerrpg.com/Jump_Drive), the [official site](https://www.farfuture.net/) or explore [Traveller Map](https://travellermap.com/).\nIt directly motivated Robert Pearce\'s Starship Geomorphs, and provides considerable depth.\n\n<div style="font-size:smaller; padding-bottom: 6px">\n\n_The Traveller game in all forms is owned by [Far Future Enterprises](https://www.farfuture.net/). Copyright \xa9 1977 \u2013 2021 Far Future Enterprises._\n</div>\n\n---\n\nOver time we\'ll clarify the above constraints, but first we emphasise:\n> _creating a video game is really fucking hard_.\n\nSpelunky\'s creator suggested [three important requirements](https://makegames.tumblr.com/post/1136623767/finishing-a-game).\nWe\'ll address them.\n\n### 1. Fun to develop\n\n_Games I want to make_. My underlying motivation is the lack of Game AI resources available on the web.\nIt is hard to discuss the subject without actually building a game, so I chose a setting and game mechanics which felt fun for me.\nI am particularly interested in navigation i.e. combining the movement of many characters in a flexible manner.\n\n### 2. The Result\n\n_Games I want to have made_. As an end result I want a highly replayable tactical/action game sandbox.\nProcedurally generated missions will involve going from A to B and doing C (ever was it so).\nMonotony will be overcome via encountered NPC behaviours and e.g. ship building.\nFunctionally, think [Teleglitch](https://www.youtube.com/results?search_query=Teleglitch) with richer NPCs and the ability to _place_ [room modules](https://steamcommunity.com/sharedfiles/filedetails/?id=175359117) when upgrading/docking.\nGraphically, see Starship Geomorphs 2.0.\n\nRogue Markup will be easy to extend.\nWe\'ll achieve this via compositional code, escape hatches to CodeSandbox, clear explanations, and [GitHub](https://github.com/) comments.\n\n### 3. Experience\n\n_Games I\u2019m good at making_. I work as a web developer, using React and CSS-in-JS on a daily basis. \nI have a [strong background](https://dblp.org/pid/81/8748.html) in Theoretical Computer Science,\nso won\'t confuse Game AI with AI, nor fall prey to the Deep Learning hype.\nI have also created similar game mechanics _many_ times over the years.\nHere\'s hoping my chain of unfinished projects is coming to a close!',timestamp:"2021-07-19",page:1,href:"/blog/1"},technology:{key:"technology",label:"Technology",markdown:'## Technology\n\nSo, we\'re building a roguelike, directly on this website.\nIt will start to get fun once things are moving about.\nLet us describe the underlying technologies.\n\n| Concept | Technology |\n| ------- | ---------- |\n| Component | [React function components](https://reactjs.org/docs/components-and-props.html#function-and-class-components), and [Web Components](https://reactjs.org/docs/web-components.html). |\n| Styles | CSS-in-JS via [Goober](https://www.npmjs.com/package/goober). |\n| Component framework | [Preact](https://preactjs.com/), a DOM-diffing alternative to React. |\n| Pathfinding | Based on [three-pathfinding](https://www.npmjs.com/package/three-pathfinding).  |\n| Raycasting | Basic geometry and spacial partitions.  |\n| Static analysis | TypeScript via [JSDoc](https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html); also [ESLint](https://www.npmjs.com/package/eslint). |\n| Live analysis | In-browser terminal, via [xterm.js](https://www.npmjs.com/package/xterm) and [mvdan-sh](https://www.npmjs.com/package/mvdan-sh). |\n| Scripting | [TS Node](https://www.npmjs.com/package/ts-node) i.e. Node.js with types. |\n| Code viewing | [CodeMirror](https://codemirror.net/) to view JS. |\n| Code editing | External [CodeSandbox](https://codesandbox.io/) links, using React. |\n| Code sharing | Show [GitHub](https://github.com/) comments, provide GitHub [repo](https://github.com/rob-myers/rob-myers.github.io). |\n\n\x3c!-- Our in-browser terminal is built using [Xterm.js](https://xtermjs.org/) and the shell parser [mvdan-sh](https://github.com/mvdan/sh/tree/master/_js). --\x3e\n\nThe early 90s brought three pillars: HTML, CSS and JavaScript.\nWhenever we visit a website we receive an HTML response, referencing or embedding CSS and JS.\nOur web browser renders the HTML and CSS immediately, and runs the JS to provide interactivity (beyond links, hovers and CSS animations).\nMore precisely, all subsequent DOM mutations are performed by JavaScript.\nIt is now common to generate the initial HTML using JS too,\neither during a build-step or on a Node.js server.\nIn particular, JavaScript has become the central web technology.\n\n> \u2139\ufe0f _We\'ll spend the next two sections describing how we use JS._\n> _The discussion is full of jargon, but the details can be picked up later on._\n\n### React and Preact\n\nCompeting JavaScript frameworks exist, often with their own notion of component.\nOne popular approach uses _React function components_, which are just JavaScript functions with constraints on their parameters and return value.\n\n- They have a single parameter, conventionally called _props_.\n\n  It is a JavaScript object defining the component\'s named inputs,\n  and possibly special properties like _children_, _key_ and _ref_.\n\n- They must return either null or a virtual [DOM node](https://developer.mozilla.org/en-US/docs/Web/API/Node).\n\n  This returned value ultimately amounts to an HTML fragment to be rendered,\n  and may depend on the component\'s props and internal state (via [hooks](https://reactjs.org/docs/hooks-intro.html)).\n\nReact developers use a grammatical extension of JavaScript called JSX.\nIt permits composing components using an XML-like syntax, to obtain the desired dynamic DOM tree.\nLet\'s consider an example, a pannable and zoomable grid (also [on CodeSandbox](https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx "@new-tab")).\n\n<div\n  class="tabs"\n  height="400"\n  store-key="panzoom"\n  tabs="[\n    { key: \'component\', filepath: \'panzoom/PanZoomDemo\' },\n    { key: \'code\', filepath: \'panzoom/PanZoom.jsx\', folds: [{ line: 8, ch: 0 }] },\n    { key: \'code\', filepath: \'panzoom/PanZoomDemo.jsx\' },\n  ]"\n></div>\n\nThe file _panzoom/PanZoom.jsx_ (see [tab above](#command "open-tab panzoom code--panzoom/PanZoom.jsx")) defines two React function components, _PanZoom_ and _Grid_.\nBehaviourally:\n\n- _PanZoom_ renders an SVG consisting of its children (the Geomorph image provided in _PanZoomDemo_) and _Grid_. It adjusts the [SVG viewBox](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox) in response to mouse/pointer events.\n\n- _Grid_ renders part of an SVG i.e. two grid patterns.\n  They repeat squares of size 10x10 and 60x60 in abstract [SVG user units](https://www.w3.org/TR/SVG2/coords.html#TermUserUnits "@new-tab").\n\n  <aside>\n  \n  SVG user units become concrete via the `<svg>`\'s viewBox attribute and its width/height within the DOM.\n  We\'ll follow a convention based on the work of Robert Pearce and Eric B. Smith. That is, 60 abstract user units (one large grid square) correspond to 1.5 meters.\n  </aside>\n\nThe above two JS functions each have a single parameter `props`, and return something which looks like HTML (but isn\'t).\nFor example, _PanZoom_ renders _Grid_ by using the XML tag `<Grid/>`.\nThen although React function components are functions, syntactically they are not invoked like functions i.e. we do not write `Grid(props)`.\nBut what are React function components actually returning?\nHere\'s a whirlwind overview.\n\n- React devs use a grammatical extension of JS with XML called [JSX](https://en.wikipedia.org/wiki/JSX_(JavaScript)).\n- React applications are built by composing React function components, using the XML syntax for their return value.\n- Dev tools convert JSX into JS by replacing XML tags with invocations of `React.createElement` ([example/jsx-to-js.jsx](#command "open-tab jsx-to-js")).\n- This website actually uses _Preact_, a React alternative with the same API.\n  Then `React.createElement` is [this function](https://github.com/preactjs/preact/blob/master/src/create-element.js "@new-tab"),\n  and creates Preact virtual DOM nodes.\n- The root component is usually called _App_.\n  Running a React application means [invoking `ReactDOM.render`](https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/index.js "@new-tab")\n  with 2 arguments: `<App/>` and a DOM node _el_.\n\n- [`ReactDOM.render`](https://github.com/preactjs/preact/blob/master/src/render.js "@new-tab") initially converts `<App/>` into a DOM node mounted at _el_.\n  A subcomponent may re-render, recursively recreating a virtual DOM node.\n  It is [diffed](https://github.com/preactjs/preact/blob/master/src/diff/index.js "@new-tab") and only the difference is applied to the DOM.\n\n<div\n  class="tabs"\n  height="340"\n  store-key="jsx-to-js"\n  tabs="[ { key: \'code\', filepath: \'example/jsx-to-js.jsx\' } ]"\n></div>\n\n### Avoiding React Renders\n\n\x3c!--\nWebsites respond to interaction, sometimes without changing the DOM.\nWhen they do mutate the DOM, they usually don\'t continually do so.\nFor example, zooming a map can be done with a CSS transform and a pre-existing CSS transition.\nAs another example, showing additional search results amounts to a single mutation.\n--\x3e\n\nWhen React renders a component, it computes a rooted subtree of the virtual DOM,\ncompares the previous one, and patches the DOM.\nIf many components change in a small amount of time, [some renders are automatically avoided](https://github.com/preactjs/preact/blob/ebd87f3005d9558bfd3c5f38e0496a5d19553441/src/component.js#L221 "@new-tab") via the ancestral relationship.\nDevelopers can also avoid recreating an entire rooted subtree using [`React.memo`](https://github.com/preactjs/preact/blob/master/compat/src/memo.js "@new-tab").\nBut for many websites, the virtual DOM manipulations are neither too large nor too frequent, and React developers may simply ignore their overhead.\n\nHowever, we are making a realtime video game.\nWe want to control the rendering as much as possible, to ensure good performance and aid debugging e.g. when many objects are onscreen.\nIf we allowed React (actually, Preact) to render in response to user interaction, we\'d lose this control.\nTake another look at _panzoom/PanZoom.jsx_.\n\n<div\n  class="tabs"\n  height="360"\n  store-key="panzoom-again"\n  tabs="[\n    { key: \'code\', filepath: \'panzoom/PanZoom.jsx\' },\n    { key: \'code\', filepath: \'geom/rect.js\' },\n  ]"\n></div>\n\n_PanZoom_ returns an `<svg/>` with a viewBox attribute determined by `state.viewBox`.\nWhen a user zooms via mousewheel, the event handler `state.onWheel` updates `state.viewBox`.\nBut updating this variable does not automatically update the virtual DOM.\nUsually one would _trigger a re-render_, so that _PanZoom_ returns `<svg/>` with the updated viewBox, and the DOM-diffing algorithm does the update.\nBut how do we trigger a re-render?\n\nA React function component is rendered if an ancestor is (modulo React.memo), or if its internal state changes. Internal state is represented using the [React.useState hook](https://reactjs.org/docs/hooks-state.html) e.g.\n\n> `const [value, setValue] = React.useState(() => initialValue)`\n\nThese declarations cannot be nested, must occur at the "top-level" of the React function component, and must always execute in the same order.\nThis induces a [well-defined association](https://github.com/preactjs/preact/blob/98f130ee8695c2b4f7535205ddf02168192cdcac/hooks/src/index.js#L109 "@new-tab") with their enclosing component.\nTo change state we execute `setValue(nextValue)` e.g. in response to a click. If `nextValue` differs from `value`, the function `setValue` causes the component to re-render where now `React.setState(...)[0]` has the new value.\nThis propagation of internal state is possible because hooks must always execute in the same order.\n\nIn _panzoom/PanZoom.jsx_, `value` corresponds to `state` but there is no correspondent of `setValue`.\nWhy?\nBecause we never inform React we\'ve changed `state`, despite mutating it on mouse and pointer events.\nInstead we directly mutate the DOM via:\n\n> ``state.root.setAttribute(\'viewBox\', `${state.viewBox}`);``\n\n\x3c!-- By the way, `` `${state.viewBox}` `` amounts to `state.viewBox.toString()` which is defined in [geom/rect.js](#command "open-tab panzoom-again code--geom/rect.js"). --\x3e\n\nAs far as React is concerned nothing has changed.\nAlso, if React renders for another reason (e.g. an ancestral render), it\'ll use the mutated `state` to set the viewBox attribute (so, no change).\nWhy bother though?\nTo avoid needlessly recomputing `<Grid />` and `children` whenever we pan or zoom.\nOur game may contain many elements, and we\'d rather not recompute their virtual DOM many times per second.\n\nThe above situation is handled by a single DOM mutation.\nIn more complex situations we\'ll integrate [Web Components](https://developer.mozilla.org/en-US/docs/Web/Web_Components).\nMore on that later.\n\n\x3c!-- ### CSS inside JS\n\nTraditionally, CSS is provided in separate files,\nlinked in the `<head/>` and referenced by DOM elements via their space-separated attribute `class`.\nBoth _PanZoom_ and _PanZoomDemo_ above are styled using CSS-in-JS.\nThis means the CSS is written inside JS or JSX files, often together with the React component it applies to.\nThe npm module [Goober](https://www.npmjs.com/package/goober) handles this for us. --\x3e\n',timestamp:"2021-07-19",page:2,href:"/blog/2"},"tech-2":{key:"tech-2",label:"Technology (2)",markdown:'## Technology (2)\n\nThus far we\'ve described our objective, constrained our approach, and listed the technologies we\'ll use.\nHaving outlined our chosen notion of JavaScript component,\nwe turn to Game AI related technology i.e. _navigation_ and _raycasting_.\n\n### Navigation\n\n\x3c!-- __TODO__\n- Rodney Brooks layers.\n- Navigation based Game AI.\n- Corner-wrapped Pathfinding only provides part of the \n- No physics engine\n- Geomorph 101\n--\x3e\n\n_Rogue Markup_ will present a birdseye viewpoint of the interior of starships.\nThe [crew](https://wiki.travellerrpg.com/Crew "@new-tab") will have tasks e.g. manning the bridge, patrolling the decks, monitoring [low berths](https://wiki.travellerrpg.com/Low_Passage "@new-tab").\nThese behaviours will be constrained by e.g. sleep patterns, the behaviour of others, and hardware failures.\nBut how do video games simulate these behaviours?\n\nThree systems are often used: navigation, animation and physics.\nNavigation does high-level planning e.g. find a route from A to B.\nAnimation provides realism (such as limb movement) and also information indicating NPC actions.\nPhysics provides collision detection and permits moving characters around via forces.\n\nNow, we chose not to use a physics engine.\n\n[Constraints]()\n\n\x3c!-- TODO can link to other blogs --\x3e\n\n\x3c!-- Pathfinding is central to Game AI.\nOur NPCs need to move realistically e.g. they cannot move through walls, windows or locked doors. --\x3e\n\n<div\n  class="tabs"\n  height="400"\n  enabled="false"\n  tabs="[\n     { key: \'component\', filepath: \'nav/NavDemo\' },\n   ]"\n></div>\n\n### Raycasting\n\n...',timestamp:"2021-07-19",page:2,href:"/blog/2"},"tech-3":{key:"tech-3",label:"Technology (3)",markdown:"## Technology (3)\n\n### Static Analysis\n\n- Typescript via JSDoc, referring to CodeSandbox.\n\n### Runtime Analysis\n\n- Terminal + Game AI\n\n### Comments\n\n- Display GitHub comments from Issue (build-time)\n- Can use anonymous credits to get recent",timestamp:"2021-07-19",page:2,href:"/blog/2"},geomorphs:{key:"geomorphs",label:"Geomorphs",markdown:'## Geomorphs\n\n### Filesystem structure\n\nmedia\n- Starship Geomorphs 2.0.pdf (Original source)\n- Starship Symbols.pdf (Original source)\n- Geomorphs.zip (Transparent PNGs obtained from Starship Geomorphs 2.0)\n- SymbolsHighRes.zip (Transparent PNGs obtained from Starship Symbols)\n\nmedia/Geomorph\n- PNGs of lower quality (relatively).\n- Extracted from "Starship Geomorphs 2.0.pdf" by ... \n\nmedia/Symbols\n- PNGs of higher quality.\n- Extracted from "Starship Symbols.pdf" by ... \n\nmedia/scripts\n- ts-node scripts launched via npm scripts\n- Directories generated by scripts\n- media/geomorph-edge (Edge Geomorphs)\n- media/symbol-bridge\n- media/symbol-dock-small-craft\n- media/symbol-staterooms\n- media/symbol-lounge\n- media/symbol-root\n\npublic/png\n- PNGs from media/symbol-* with labels removed\n\npublic/svg\n- Enriched symbols\n- Geomorph hulls\n\n<div\n  class="tabs"\n  enabled="false"\n  height="400"\n  tabs="[\n    { key: \'component\', filepath: \'geomorph/GeomorphDemo\' },\n  ]"\n></div>\n',timestamp:"2021-07-19",page:3,href:"/blog/3"}}},59885:function(e,t,n){n.d(t,{pq:function(){return a},Od:function(){return i},Ar:function(){return s}});var r=n(5152),a=(0,r.default)((function(){return Promise.all([n.e(126),n.e(135),n.e(209)]).then(n.bind(n,35209))}),{ssr:!1,loadableGenerated:{webpack:function(){return[35209]},modules:["../components/dynamic.tsx -> ./code/CodeEditor"]}}),i=(0,r.default)((function(){return Promise.all([n.e(142),n.e(452)]).then(n.bind(n,26452))}),{ssr:!1,loadableGenerated:{webpack:function(){return[26452]},modules:["../components/dynamic.tsx -> ./sh/XTerm"]}}),s=(0,r.default)((function(){return Promise.all([n.e(658),n.e(42)]).then(n.bind(n,31042))}),{ssr:!1,loadableGenerated:{webpack:function(){return[31042]},modules:["../components/dynamic.tsx -> ./page/Layout"]}})},24009:function(e,t,n){n.d(t,{Z:function(){return G}});var r,a=n(59748),i=n(55125),s=n(11455),o=n(20437),c=n(92809),u=n(79056),l=n(17120),p=n(10219),h=n(52209),f=n(94184),d=n.n(f),m=n(88269),v=n(56127),y=n(8311);function g(){return(0,y.tZ)("hr",{className:k})}var b,x,k=(0,m.iv)(r||(r=(0,h.Z)(["\n  margin: 0;\n  border-color: var(--focus-bg);\n\n  @media(min-width: 800px) {\n    padding-bottom: 80px;\n    border: 0;\n  }\n"]))),w=n(52542),S=n(59885);function Z(e){var t=e.enabled,n=e.toggleEnabled;return(0,y.BX)("div",{className:C,children:[(0,y.tZ)("div",{className:d()("top-right",t&&"enabled"),onClick:t?n:void 0,children:"disable"}),!t&&(0,y.tZ)("div",{className:d()("central",t&&"enabled"),onClick:n,children:"interact"})]})}var C=(0,m.iv)(b||(b=(0,h.Z)(["\n  font-family: Roboto, Arial, sans-serif;\n\n  > .top-right {\n    position: absolute;\n    right: -10px;\n    top: calc(-32px + 6px);\n    z-index: 10;\n    border-radius: 4px 4px 0 0;\n    padding: 2px 16px;\n    \n    cursor: pointer;\n    background: #333;\n    color: #777;\n    font-size: 14px;\n    font-weight: 300;\n    \n    &.enabled {\n      color: #fff;\n    }\n  }\n\n  > .central {\n    position: absolute;\n    z-index: 11;\n    left: calc(50% - 56px);\n    top: calc(50% - 20px);\n    \n    cursor: pointer;\n    color: #ddd;\n    background: #000;\n    padding: 12px 32px;\n    border-radius: 4px;\n    border: 1px solid #ddd;\n    font-size: 1.2rem;\n\n    opacity: 1;\n    transition: 300ms opacity ease;\n    &.enabled {\n      opacity: 0;\n    }\n  }\n"])));function P(e){var t=e.colour;return(0,y.tZ)("div",{className:d()(_,{clear:"clear"===t,faded:"faded"===t})})}var O,j,_=(0,m.iv)(x||(x=(0,h.Z)(["\n  &:not(.faded) {\n    pointer-events: none;\n  }\n\n  position: absolute;\n  z-index: 10;\n  width: inherit;\n  height: inherit;\n  background: #000;\n  font-family: sans-serif;\n\n  opacity: 1;\n  transition: opacity 1s ease-in;\n  &.clear {\n    opacity: 0;\n    transition: opacity 0.5s ease-in;\n  }\n  &.faded {\n    opacity: 0.5;\n    transition: opacity 0.5s ease-in;\n  }\n"])));function I(e){var t=a.default.useRef(null),n=a.default.useState("black"),r=(0,u.Z)(n,2),i=r[0],s=r[1],o=a.default.useState(!!e.enabled),c=(0,u.Z)(o,2),l=c[0],p=c[1];return a.default.useEffect((function(){s(l?"clear":"faded")}),[]),(0,y.tZ)("figure",{ref:t,className:d()("tabs","scrollable",R(e.height)),children:(0,y.BX)("div",{className:E(e.height),children:["black"!==i&&(0,y.tZ)(S.Ar,{storeKey:e.storeKey,tabs:e.tabs,rootRef:t}),(0,y.tZ)(Z,{enabled:l,toggleEnabled:function(){p(!l),s("clear"===i?"faded":"clear")}}),(0,y.tZ)(P,{colour:i})]})})}var T,R=function(e){return(0,m.iv)(O||(O=(0,h.Z)(["\n  background: var(--focus-bg);\n\n  @keyframes fadein {\n    from { opacity: 0; }\n    to   { opacity: 1; }\n  }\n\n  .flexlayout__tabset {\n    animation: fadein 1s;\n  }\n\n  .flexlayout__tabset, .flexlayout__tab {\n    background: white;\n  }\n\n  > .flexlayout__layout {\n    background: #444;\n    position: relative;\n    height: ","px;\n  }\n  .flexlayout__tab {\n    border-top: 6px solid #444;\n    position: relative;\n    /** Handle svg overflow */\n    overflow: hidden;\n  }\n  .flexlayout__tabset_tabbar_outer {\n    background: #222;\n    border-bottom: 1px solid #555;\n  }\n  .flexlayout__tab_button--selected, .flexlayout__tab_button:hover {\n    background: #444;\n  }\n  .flexlayout__tab_button_content {\n    user-select: none;\n    font-size: 13px;\n    color: #aaa;\n  }\n  .flexlayout__tab_button--selected .flexlayout__tab_button_content {\n    color: #fff;\n  }\n  .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content {\n    color: #ddd;\n  }\n  .flexlayout__splitter_vert, .flexlayout__splitter_horz {\n    background: #827575;\n  }\n"])),e)},E=function(e){return(0,m.iv)(j||(j=(0,h.Z)(["\n  width: 100%;\n  height: ","px;\n  position: relative;\n"])),e)},A=["node","href","title","children"];function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function L(e){var t=a.default.useMemo((function(){var t=new Date(e.dateTime);return"".concat(t.getDate()).concat(function(e){if(e>3)return"th";if(1===e)return"st";if(2===e)return"nd";if(3===e)return"rd"}(t.getDate())," ").concat(V[t.getMonth()]," ").concat(t.getFullYear())}),[e.dateTime]);return(0,y.BX)(y.HY,{children:[(0,y.BX)("article",{className:d()(N,e.className,K),children:[(0,y.tZ)("time",{dateTime:e.dateTime,children:t}),(0,y.tZ)(w.Z,{children:e.children,components:B})]}),(0,y.tZ)(g,{})]})}var N="article",K=(0,m.iv)(T||(T=(0,h.Z)(["\n\n  line-height: 1.55;\n  background: var(--focus-bg);\n\n  padding: 64px 128px 96px 128px;\n  font-size: 1.2rem;\n  border: var(--blog-border-width) solid var(--border-bg);\n\n  @media(max-width: 800px) {\n    padding: 32px 64px 48px 64px;\n  }\n  @media(max-width: 500px) {\n    padding: 8px 12px;\n    font-size: 1.1rem;\n    border: none;\n  }\n\n  a code {\n    color: unset;\n  }\n  a.new-tab-link::after {\n    display: inline-block;\n    content: '';\n    background-image: url('/icon/ext-link-icon.svg');\n    background-size: 13px 13px;\n    height: 13px;\n    width: 13px;\n    margin-left: 4px;\n  }\n\n  span.cmd {\n    color: #555;\n    background: #ddd;\n    font-family: monospace;\n    letter-spacing: 1px;\n    font-size: smaller;\n    padding: 2px 4px;\n    @media(max-width: 500px) {\n      user-select: all;\n    }\n  }\n\n  aside {\n    margin: 32px 0;\n    padding: 8px 32px;\n    border-radius: 8px;\n    border: 2px dashed #ccc;\n    font-size: 1.1rem;\n    @media(max-width: 500px) {\n      font-size: 1rem;\n      margin: 8px 0;\n      padding: 0 16px;\n    }\n\n    > figure.tabs {\n      padding: 8px 0;\n      @media(max-width: 500px) {\n        padding: 8px 0 12px;\n      }\n    }\n  }\n\n  blockquote {\n    margin: 32px 0;\n    border-left: 10px solid #ddd;\n    padding-left: 30px;\n    \n    @media(max-width: 500px) {\n      margin: 20px 0;\n      padding-left: 20px;\n    }\n  }\n\n  code {\n    font-family: sans-serif;\n    letter-spacing: 1px;\n    color: #444;\n    font-size: smaller;\n    letter-spacing: 2px;\n    padding: 0 2px;\n  }\n\n  figure {\n    margin: 0;\n  }\n  \n  figure.tabs {\n    border: 10px solid #333;\n    border-radius: 8px;\n    margin: 40px 0;\n    @media(max-width: 500px) {\n      margin: 24px 0 16px;\n    }\n  }\n\n  h1, h2, h3, h4 {\n    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;\n    font-weight: 400;\n  }\n  h2 {\n    font-size: 2.8rem;\n    @media(max-width: 500px) {\n      margin: 16px 0 0 0;\n      font-size: 1.7rem;\n    }\n  }\n  h3 {\n    font-size: 1.8rem;\n    @media(max-width: 500px) {\n      font-size: 1.3em;\n    }\n  }\n\n  table {\n    padding: 8px;\n    border: 1px solid #bbb;\n    width: 100%;\n    margin: 16px 0;\n\n    th, td {\n      text-align: left;\n      vertical-align: top;\n      padding: 8px;\n      @media(max-width: 540px) {\n        padding: 4px 2px;\n      }\n    }\n  }\n\n  position: relative;\n  > time {\n    position: absolute;\n    right: -10px;\n    top: -50px;\n    background: var(--border-bg);\n    color: #555;\n    border-radius: 6px 6px 0 0;\n    padding: 12px;\n    font-size: 1rem;\n    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;\n\n    @media(max-width: 500px) {\n      top: 16px;\n      right: 0;\n      border-radius: 0 0 0 4px;\n      background: none;\n      font-size: 1.1rem;\n    }\n  }\n\n  ul, ol {\n    @media(max-width: 500px) {\n      padding-left: 20px;\n    }\n    + p {\n      padding-top: 6px;\n    }\n  }\n\n  ul li, ol li {\n    margin: 4px 0;\n  }\n\n"]))),B={a:function(e){e.node;var t=e.href,n=e.title,r=e.children,a=(0,p.Z)(e,A);return(0,y.tZ)("a",M(M(M(M({href:t,title:n},["@new-tab"].includes(n)&&{className:"new-tab-link",target:"_blank",rel:"noopener"}),"#command"===t&&{onClick:function(e){e.preventDefault();var t=n.split(" "),r=(0,l.Z)(t),a=r[0],i=r.slice(1);switch(a){case"open-tab":var o=(0,u.Z)(i,2),c=o[0],p=o[1],h=s.Z.getState().tabs[c];h&&(h.selectTab(p),h.scrollIntoView());break;case"sigkill":v.Z.api.getSession(i[0]).ttyShell.xterm.sendSigKill();break;default:console.warn("link triggered unrecognised command:",n)}}}),a),{},{children:r}))},div:function(e){switch(e.class){case"tabs":var t=Number(e.height||100),n=a.default.useMemo((function(){return Function("return ".concat(e.tabs||"[]"))()}),[e.tabs]);return(0,y.tZ)(I,{height:t,tabs:n,enabled:"true"===e.enabled,storeKey:e["store-key"]});default:return(0,y.tZ)("div",M({},e))}}},V=["Jan","Feb","March","April","May","June","July","Aug","Sept","Oct","Nov","Dec"];function G(e){var t=e.keys,n=(0,a.useRef)(null);return(0,a.useEffect)((function(){var e=function(){Array.from(n.current.children).filter((function(e){return e.classList.contains(N)})).forEach((function(e,n){return s.Z.getState().articles[t[n]]={key:t[n],rect:o.UL.fromJson(e.getBoundingClientRect()).delta(window.scrollX,window.scrollY)}})),s.Z.setState({})};return window.addEventListener("resize",e),e(),s.Z.api.updateArticleKey(),function(){window.removeEventListener("resize",e),t.forEach((function(e){return delete s.Z.getState().articles[e]}))}}),[]),(0,y.tZ)("div",{ref:n,children:t.map((function(e){return(0,y.tZ)(L,{articleKey:e,dateTime:i.m[e].timestamp,children:i.m[e].markdown})}))})}},30829:function(e,t,n){n.d(t,{Z:function(){return I}});var r,a=n(52209),i=n(79056),s=n(59748),o=n(94184),c=n.n(o),u=n(88269),l=n(92809),p=n(10219),h=n(11163),f=n(52542),d=n(8311),m=["children"];function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(){return(0,d.BX)("header",{className:c()("title",k),children:[(0,d.tZ)("div",{className:"top-block"}),(0,d.tZ)(f.Z,{components:x,children:"\n# Rogue Markup\n\n$( game ai | roguelike | web dev )\n      "})]})}var b,x={h1:function(e){var t=e.children,n=(0,p.Z)(e,m),r=(0,h.useRouter)();return(0,d.tZ)("h1",y(y({onClick:function(){return r.push("/")}},n),{},{children:t}))}},k=(0,u.iv)(r||(r=(0,a.Z)(["\n  font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;\n  \n  @media(max-width: 500px) {\n    padding-left: 8px;\n    border-bottom: 2px solid #999;\n    border: 0 solid #000;\n  }\n  padding-top: 40px;\n\n  h1 {\n    margin: 0;\n    font-size: 6rem;\n    font-weight: 300;\n    cursor: pointer;\n    color: #333;\n    display: inline-block;\n    \n    @media(max-width: 800px) {\n      font-size: 5rem;\n    }\n    @media(max-width: 500px) {\n      font-size: 3rem;\n    }\n  }\n  \n  /** Site subtitle */\n  p {\n    color: #444;\n    letter-spacing: 2px;\n    font-size: 1.4rem;\n    margin: 0;\n    padding: 40px 0 48px;\n    font-weight: 300;\n    \n    @media(max-width: 500px) {\n      font-size: 1rem;\n      padding: 20px 0 20px 8px;\n      color: #222;\n    }\n  }\n\n"]))),w=n(41664),S=n(55125),Z=n(11455),C=Object.values(S.m).filter((function(e){return e.page>0&&e.href}));function P(){var e=(0,Z.Z)((function(e){return e.articleKey}));return(0,d.BX)("section",{className:_,children:[(0,d.tZ)("h3",{children:(0,d.tZ)(w.default,{href:"/",scroll:!1,children:(0,d.tZ)("a",{children:"Rogue Markup"})})}),(0,d.tZ)("ul",{children:C.map((function(t){var n=t.key,r=t.label,a=t.href;return(0,d.tZ)("li",{className:n===e?"current":void 0,children:(0,d.tZ)(w.default,{href:a,scroll:!1,children:(0,d.tZ)("a",{onClick:function(){setTimeout((function(){return Z.Z.setState({lastNavKey:n})}))},children:r})})})}))})]})}var O,j,_=(0,u.iv)(b||(b=(0,a.Z)(["\n  padding: 0 0 0 20px;\n  color: #aaa;\n  \n  h3 {\n    font-size: 1.5rem;\n    font-weight: 400;\n    margin: 16px 0;\n    a {\n      color: #aaa;\n    }\n  }\n  \n  ul {\n    font-size: 1.2rem;\n    padding: 0;\n    margin: 0;\n    a {\n      color: #888;\n      &:hover {\n        color: #ccc;\n      }\n    }\n    li {\n      list-style: none;\n      list-style-position: inside;\n      padding: 6px 0;\n    }\n    li.current {\n      a {\n        color: white;\n      }\n    }\n  }\n"])));function I(e){var t=e.children,n=s.default.useState(!0),r=(0,i.Z)(n,2),a=r[0],o=r[1];(0,s.useLayoutEffect)((function(){o("true"===localStorage.getItem("nav-open"));var e=function(){return Z.Z.api.updateArticleKey()};return window.addEventListener("scroll",e),function(){return window.removeEventListener("scroll",e)}}),[]);var u=(0,Z.Z)((function(e){return e.lastNavKey}));return(0,s.useEffect)((function(){var e=Z.Z.getState().articles[u||""];e&&window.scrollTo({top:e.rect.y,behavior:"smooth"})}),[u]),(0,d.BX)(d.HY,{children:[(0,d.BX)("nav",{className:c()(E,!a&&"closed"),onClick:function(e){e.stopPropagation(),e.target instanceof HTMLAnchorElement||(o(!a),localStorage.setItem("nav-open",a?"false":"true"))},children:[(0,d.tZ)("div",{className:"handle-bg"}),(0,d.tZ)("div",{className:"handle",children:a?"<":">"}),(0,d.tZ)(P,{})]}),(0,d.BX)("section",{className:T,children:[(0,d.tZ)(g,{}),(0,d.tZ)("main",{children:t})]})]})}var T=(0,u.iv)(O||(O=(0,a.Z)(["\n  max-width: 1024px;\n  width: 100%;\n\n  padding: 48px 64px;\n  @media(max-width: 1024px) {\n    padding: 32px 64px;\n    margin: 0;\n  }\n  @media(max-width: 800px) {\n    padding: 32px 8px;\n  }\n  @media(max-width: 500px) {\n    padding: 0;\n  }\n"]))),R=256,E=(0,u.iv)(j||(j=(0,a.Z)(["\n  width: ","px;\n\n  font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;\n  font-weight: 300;\n\n  color: white;\n  background-color: black;\n  cursor: pointer;\n  opacity: 0.9;\n  \n  position: fixed;\n  z-index: 20;\n  height: 100%;\n  left: 0;\n  \n  transition: left 500ms ease;\n  &.closed {\n    left: -","px;\n  }\n\n  > .handle-bg {\n    position: absolute;\n    top: 0;\n    left: ","px;\n    width: ","px;\n    height: 32px;\n    background: rgba(0, 0, 0, .1);\n  }\n  \n  > .handle {\n    background: rgba(120, 0, 0, 1);\n    position: absolute;\n    z-index: 19;\n    width: ","px;\n    top: 0;\n    right: -","px;\n    text-align: center;\n    padding: 7px 0;\n    user-select: none;\n  }\n"])),R,R,R,2256,30,30)},52542:function(e,t,n){n.d(t,{Z:function(){return h}});var r=n(92809),a=n(38456),i=n.n(a),s=n(76388),o=n.n(s),c=n(10043),u=n.n(c),l=n(8311);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){return(0,l.tZ)(i(),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({rehypePlugins:[o()],remarkPlugins:[u()]},e))}},86576:function(e,t,n){n.d(t,{I8:function(){return h},IC:function(){return f},Ql:function(){return d},Z$:function(){return m},wO:function(){return v},or:function(){return y},$G:function(){return g},Q8:function(){return b},BH:function(){return x},RT:function(){return k}});var r=n(79056),a=n(68216),i=n(92809),s=n(97131),o=n(809),c=n.n(o),u=n(87668),l=n.n(u),p=c().mark(w);function h(e){return JSON.parse(JSON.stringify(e))}function f(e){return JSON.stringify(e,null,"\t")}function d(e){return"testNever: ".concat(f(e)," not implemented.")}function m(e){return e[e.length-1]}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t){return setTimeout((function(){return t()}),e)}))}function y(e){return"function"===typeof e?function(e){return e.trim().replace(/\s\s+/g," ").trim()}("".concat(e)):function(e){try{var t=[];return JSON.stringify(e,(function(e,n){return"function"===typeof n?"[Function]".concat((t=Object.keys(n)).length?" ...{".concat(t,"} "):""):n}))}catch(n){}}(e)||l()(e,(function(e,t){return t instanceof HTMLElement?"HTMLElement[".concat(t.nodeName,"]"):t}))}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;return e.length<=t?e:"".concat(e.slice(0,t)," ...")}function b(e,t){var n,r={};return(n=e,Object.keys(n)).forEach((function(n){return r[n]=t(e[n])})),r}var x=function e(){var t=this;(0,a.Z)(this,e),(0,i.Z)(this,"resolve",null),(0,i.Z)(this,"reject",null),(0,i.Z)(this,"promise",new Promise((function(e,n){t.resolve=e,t.reject=n})))};function k(e){return Array.from(w(e))}function w(e){var t,n,a,i,o,u,l=arguments;return c().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:t=l.length>1&&void 0!==l[1]?l[1]:[],c.t0=null===e||void 0===e?void 0:e.constructor,c.next=c.t0===Object?4:12;break;case 4:n=0,a=Object.entries(e);case 5:if(!(n<a.length)){c.next=11;break}return i=(0,r.Z)(a[n],2),o=i[0],u=i[1],c.delegateYield(w(u,[].concat((0,s.Z)(t),[o])),"t1",8);case 8:n++,c.next=5;break;case 11:return c.abrupt("break",14);case 12:return c.next=14,t.join("/");case 14:case"end":return c.stop()}}),p)}},1472:function(e,t,n){n.d(t,{bt:function(){return d},OF:function(){return m},KI:function(){return v},z:function(){return b},pm:function(){return x},g0:function(){return w},us:function(){return Z},jO:function(){return C}});var r=n(30266),a=n(92809),i=n(68216),s=n(25997),o=n(809),c=n.n(o),u=n(24790),l=n(56127),p=n(29950),h=n(97468),f=n(86576),d=200;function m(){return new y(new g,new g)}var v,y=function(){function e(t,n){(0,i.Z)(this,e),this.readable=t,this.writable=n}return(0,s.Z)(e,[{key:"handleWriters",value:function(e){var t=this;return this.writable.registerCallback(e),function(){return t.writable.unregisterCallback(e)}}},{key:"read",value:function(e){var t=this;return this.readable.registerCallback(e),function(){return t.readable.unregisterCallback(e)}}},{key:"write",value:function(e){this.writable.write(e)}},{key:"writeToReaders",value:function(e){this.readable.write(e)}}]),e}(),g=function(){function e(){(0,i.Z)(this,e),(0,a.Z)(this,"internal",void 0),(0,a.Z)(this,"cbToSub",void 0),this.internal=new u.x,this.internal.subscribe(),this.cbToSub=new Map}return(0,s.Z)(e,[{key:"registerCallback",value:function(e){this.cbToSub.set(e,this.internal.subscribe(e))}},{key:"unregisterCallback",value:function(e){var t;null===(t=this.cbToSub.get(e))||void 0===t||t.unsubscribe(),this.cbToSub.delete(e)}},{key:"write",value:function(e){this.internal.next(e)}}]),e}();function b(e,t){var n=(0,f.I8)(e.meta);Object.assign(n.fd,t),(0,p.ww)(e,(function(e){return e.meta=n}))}function x(e,t){return k.apply(this,arguments)}function k(){return(k=(0,r.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.status!==l.N.Killed&&!n.finishedReading(!0)){e.next=4;break}throw new h.lw(v.SIGKILL,t.key,t.sessionKey);case 4:if(t.status!==l.N.Suspended){e.next=7;break}return e.next=7,new Promise((function(e){return t.onResume=e}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e,t){return S.apply(this,arguments)}function S(){return(S=(0,r.Z)(c().mark((function e(t,n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.status!==l.N.Killed){e.next=4;break}throw new h.lw(v.SIGKILL,t.key,t.sessionKey);case 4:if(t.status!==l.N.Suspended){e.next=7;break}return e.next=7,new Promise((function(e){return t.onResume=e}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){switch(e){case l.N.Killed:return"\u2620";case l.N.Running:return"\u25b6\ufe0f";case l.N.Suspended:return"\u23f8\ufe0f"}}!function(e){e.SIGKILL="SIGKILL"}(v||(v={}));function C(e){return void 0!==e&&null!==e&&e.__chunk__}},29950:function(e,t,n){n.d(t,{VN:function(){return c},v8:function(){return l},ww:function(){return h},$r:function(){return f},nL:function(){return d},Wc:function(){return m}});var r=n(97131),a=n(83465),i=n.n(a),s=n(17473),o=n(86576);function c(e){return i()(e)}function u(e){var t,n,a;switch(e.type){case"ArithmCmd":case"ArithmExp":return[e.X];case"ArrayElem":return[].concat((0,r.Z)(e.Index?[e.Index]:[]),[e.Value]);case"ArrayExpr":return e.Elems;case"Assign":return[].concat((0,r.Z)(e.Array?[e.Array]:[]),(0,r.Z)(e.Index?[e.Index]:[]),(0,r.Z)(e.Value?[e.Value]:[]));case"BinaryArithm":case"BinaryCmd":case"BinaryTest":return[e.X,e.Y];case"Block":return e.Stmts;case"CStyleLoop":return[e.Cond,e.Init,e.Post];case"CallExpr":return[].concat(e.Args,e.Assigns);case"CaseClause":return[].concat(e.Items,e.Word);case"CaseItem":return[].concat(e.Patterns,e.Stmts);case"CmdSubst":return e.Stmts;case"Comment":return[];case"CoprocClause":return[e.Stmt];case"DblQuoted":return e.Parts;case"DeclClause":return[].concat(e.Args,e.Variant);case"ExtGlob":return[];case"File":return e.Stmts;case"ForClause":return[].concat((0,r.Z)(e.Do),[e.Loop]);case"FuncDecl":return[e.Body,e.Name];case"IfClause":return[].concat((0,r.Z)(e.Cond),(0,r.Z)(e.Then),(0,r.Z)(e.Else?[e.Else]:[]));case"LetClause":return e.Exprs;case"Lit":return[];case"ParamExp":return[].concat((0,r.Z)(null!==(t=e.Exp)&&void 0!==t&&t.Word?[e.Exp.Word]:[]),(0,r.Z)(e.Index?[e.Index]:[]),[e.Param],(0,r.Z)(e.Repl?[e.Repl.Orig]:[]),(0,r.Z)(null!==(n=e.Repl)&&void 0!==n&&n.With?[e.Repl.With]:[]),(0,r.Z)(e.Slice?[e.Slice.Offset]:[]),(0,r.Z)(null!==(a=e.Slice)&&void 0!==a&&a.Length?[e.Slice.Length]:[]));case"ParenArithm":case"ParenTest":return[e.X];case"ProcSubst":return e.Stmts;case"Redirect":return[].concat((0,r.Z)(e.Hdoc?[e.Hdoc]:[]),(0,r.Z)(e.N?[e.N]:[]),[e.Word]);case"SglQuoted":return[];case"Stmt":return[].concat((0,r.Z)(e.Cmd?[e.Cmd]:[]),(0,r.Z)(e.Redirs));case"Subshell":return e.Stmts;case"TestClause":return[e.X];case"TimeClause":return(0,r.Z)(e.Stmt?[e.Stmt]:[]);case"UnaryArithm":case"UnaryTest":return[e.X];case"WhileClause":return e.Cond.concat(e.Do);case"Word":return e.Parts;case"WordIter":return e.Items;default:throw(0,o.Ql)(e)}}function l(e,t){return{opts:p((0,s.Z)(e,t)),operands:e.filter((function(e){return"-"!==e[0]}))}}function p(e){var t=e;return Object.keys(e).forEach((function(n){t.__optKeys=[],"_"!==n&&(Array.isArray(e[n])&&(t[n]=(0,o.Z$)(e[n])),t.__optKeys.push(n))})),t}function h(e,t){t(e),u(e).forEach((function(e){return h(e,t)}))}function f(e){return h(e,(function(e){u(e).forEach((function(t){return t.parent=e}))})),e}function d(e){return{type:"File",Stmts:"Stmt"===e.type?[e]:e.Stmts,meta:e.meta}}function m(e){return e.Else?[e].concat((0,r.Z)(m(e.Else))):[e]}},97468:function(e,t,n){n.d(t,{qz:function(){return d},jn:function(){return m},i0:function(){return y},Rk:function(){return g},nl:function(){return b},lw:function(){return x},mq:function(){return k},i3:function(){return w},$R:function(){return S},_Z:function(){return Z},Hn:function(){return C}});var r=n(68216),a=n(14695),i=n(91077),s=n(30268),o=n(92953),c=n(63207),u=n(86744),l=n.n(u),p=n(86576),h=n(1472);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,o.Z)(e);if(t){var a=(0,o.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}function d(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.trim())return[];if(t)return e.trim().replace(/[\s]+/g," ").split(" ");var n=e.replace(/[\s]+/g," ").split(" ");return n[0]||(n.shift(),n[0]=" "+n[0]),(0,p.Z$)(n)||(n.pop(),n.push(n.pop()+" ")),n}function m(e){return{key:"expanded",values:e instanceof Array?e:[e],value:e instanceof Array?e.join(" "):e}}var v={expand:!0,rangeLimit:1/0};function y(e){var t=e.Value,n=e.parent;if(!n)throw Error("Literal must have parent");var r=t.replace(/\\\n/,"").replace(/\[/g,"\\[").replace(/\]/g,"\\]");return"DblQuoted"===n.type?[r.replace(/\\(["\\$`])/g,"$1")]:"TestClause"===n.type||"Redirect"===n.type?[r.replace(/\\(.|$)/g,"$1")]:l()(r,v)}function g(e){var t,n=e.Dollar,r=e.Value;return[n?(t=r,JSON.parse(JSON.stringify(t).replace(/\\\\e/g,"\\u001b").replace(/\\\\x([0-9a-f]{2})/g,"\\u00$1").replace(/\\\\([bfnrt])/g,"\\$1"))):r]}var b=function(e){(0,i.Z)(n,e);var t=f(n);function n(e,i,s){var o;return(0,r.Z)(this,n),(o=t.call(this,e)).exitCode=i,o.original=s,Object.setPrototypeOf((0,a.Z)(o),n.prototype),o}return n}((0,c.Z)(Error)),x=function(e){(0,i.Z)(n,e);var t=f(n);function n(e,i,s){var o;return(0,r.Z)(this,n),(o=t.call(this,e)).code=e,o.pid=i,o.sessionKey=s,Object.setPrototypeOf((0,a.Z)(o),n.prototype),o}return n}((0,c.Z)(Error));function k(e){return new x(h.KI.SIGKILL,e.pid,e.sessionKey)}function w(e,t,n){return function(e,t){return C(Z(e),t)}(e.startsWith("/")?e.split("/"):n.split("/").concat(e.split("/")),t)}function S(e,t,n){return Z(e.startsWith("/")?e.split("/"):n.split("/").concat(e.split("/")))}function Z(e){return e.reduce((function(e,t){return t&&"."!==t?".."===t?e.slice(0,-1):e.concat(t):e}),[])}function C(e,t){return e.reduce((function(e,t){return e[t]}),t)}},6320:function(e,t,n){n.d(t,{eI:function(){return d},D2:function(){return m},Sv:function(){return v},Dx:function(){return y},q5:function(){return g}});var r=n(79056),a=n(30266),i=n(68216),s=n(25997),o=n(92809),c=n(809),u=n.n(c),l=n(86576),p=n(1472);function h(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var d="\x1b[0m",m="\x1b[93m",v="\x1b[1;34m",y="\x1b[0;37m",g=function(){function e(t,n,r){var a=this;(0,i.Z)(this,e),this.xterm=t,this.sessionKey=n,this.io=r,(0,o.Z)(this,"commandBuffer",void 0),(0,o.Z)(this,"cursor",void 0),(0,o.Z)(this,"cursorRow",void 0),(0,o.Z)(this,"input",void 0),(0,o.Z)(this,"readyForInput",void 0),(0,o.Z)(this,"promptReady",void 0),(0,o.Z)(this,"nextPrintId",void 0),(0,o.Z)(this,"prompt",void 0),(0,o.Z)(this,"historyIndex",-1),(0,o.Z)(this,"preHistory",void 0),(0,o.Z)(this,"linesPerUpdate",500),(0,o.Z)(this,"refreshMs",0),(0,o.Z)(this,"runCommands",(function(){var e,t=0;for(a.nextPrintId=null;(e=a.commandBuffer.shift())&&t<=a.linesPerUpdate;)switch(e.key){case"await-prompt":return void a.commandBuffer.unshift(e);case"clear":a.clearScreen();break;case"line":a.xterm.writeln(e.line),a.trackCursorRow(1),t++;break;case"newline":for(var n=a.offsetToColRow(a.input,a.cursor).row,r=a.offsetToColRow(a.input,a.input.length).row;n++<r;)a.xterm.write("\r\n");return a.xterm.write("\r\n"),a.trackCursorRow(1),void a.sendLine();case"paste-line":return a.xterm.writeln(e.line),a.trackCursorRow(1),a.input=e.line,void a.sendLine();case"resolve":e.resolve();break;case"prompt":a.xterm.write(e.prompt),a.promptReady=!0;break;default:throw(0,l.Ql)(e)}a.printPending()})),this.input="",this.cursor=0,this.prompt="",this.readyForInput=!0,this.promptReady=!1,this.commandBuffer=[],this.nextPrintId=null,this.cursorRow=0,this.historyIndex=-1,this.preHistory=this.input}return(0,s.Z)(e,[{key:"initialise",value:function(){this.xterm.onData(this.handleXtermInput.bind(this)),this.io.handleWriters(this.onMessage.bind(this)),this.xterm.writeln("".concat(y,"Connected to session ").concat(v).concat(this.sessionKey).concat(d)),this.clearInput(),this.cursorRow=2}},{key:"actualCursor",value:function(e,t){return this.actualLine(e.slice(0,t)).length}},{key:"actualLine",value:function(e){return this.prompt+e}},{key:"clearInput",value:function(){this.setCursor(0);var e=Math.min(this.numLines(),this.xterm.rows+1-this.cursorRow);e>1?(this.xterm.write("\r\x1b[K\x1b[E".repeat(e)),this.xterm.write("\x1b[F".repeat(e))):this.xterm.write("\r\x1b[K"),this.input=""}},{key:"clearScreen",value:function(){for(var e=0;e<this.xterm.rows;e++)this.xterm.writeln("");this.xterm.write("\x1b[F".repeat(this.xterm.rows)),this.xterm.scrollToBottom(),this.cursorRow=1}},{key:"closestLeftBoundary",value:function(e,t){return this.wordBoundaries(e,!0).reverse().find((function(e){return e<t}))||0}},{key:"closestRightBoundary",value:function(e,t){return this.wordBoundaries(e,!1).find((function(e){return e>t}))||e.length}},{key:"deletePreviousWord",value:function(){var e=this.closestLeftBoundary(this.input,this.cursor);if(null!=e){var t=this.input.slice(0,e)+this.input.slice(this.cursor);this.clearInput(),this.setInput(t),this.setCursor(e)}}},{key:"handleCursorErase",value:function(e){var t=this.cursor,n=this.input;if(e){if(t<=0)return;var r=-1;"\n"===this.input.charAt(this.cursor+r)&&(r=-2);var a=n.slice(0,t+r)+n.slice(t);this.clearInput(),this.setInput(a),this.setCursor(t+r)}else{var i=n.slice(0,t)+n.slice(t+1);this.clearInput(),this.setInput(i),this.setCursor(t)}}},{key:"handleCursorInsert",value:function(e){var t=this.input,n=this.cursor,r=t.slice(0,n)+e+t.slice(n),a=this.cursor+e.length;this.clearInput(),this.setInput(r),this.setCursor(a)}},{key:"handleCursorMove",value:function(e){var t=1===e?Math.min(e,this.input.length-this.cursor):Math.max(e,-this.cursor),n=this.input.charAt(this.cursor+t);1===e?"\r"===n?t+=2:"\n"===n&&(t+=1):"\n"===n&&(t-=1),this.setCursor(this.cursor+t)}},{key:"handleXtermInput",value:function(){var e=(0,a.Z)(u().mark((function e(t){var n,r,a,i,s,o,c=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.readyForInput||"\x03"===t){e.next=2;break}return e.abrupt("return");case 2:if(!(t.length>1&&t.includes("\r"))){e.next=26;break}n=t.replace(/[\r\n]+/g,"\n"),(r=n.split("\n"))[0]="".concat(this.input).concat(r[0]),a=!n.endsWith("\n")&&r.pop(),i=h(r),e.prev=8,o=u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.value,e.next=3,new Promise((function(e){c.queueCommands([{key:"paste-line",line:t},{key:"await-prompt"},{key:"resolve",resolve:e}])}));case 3:case"end":return e.stop()}}),e)})),i.s();case 11:if((s=i.n()).done){e.next=15;break}return e.delegateYield(o(),"t0",13);case 13:e.next=11;break;case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),i.e(e.t1);case 20:return e.prev=20,i.f(),e.finish(20);case 23:a&&this.queueCommands([{key:"resolve",resolve:function(){c.clearInput(),c.setInput(a)}}]),e.next=27;break;case 26:this.handleXtermKeypresses(t);case 27:case"end":return e.stop()}}),e,this,[[8,17,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"handleXtermKeypresses",value:function(e){var t,n=e.charCodeAt(0);if(27==n)switch(e.slice(1)){case"[A":this.promptReady&&this.io.writeToReaders({key:"req-history-line",historyIndex:this.historyIndex+1});break;case"[B":this.promptReady&&this.io.writeToReaders({key:"req-history-line",historyIndex:this.historyIndex-1});break;case"[D":this.handleCursorMove(-1);break;case"[C":this.handleCursorMove(1);break;case"[3~":this.handleCursorErase(!1);break;case"[F":this.setCursor(this.input.length);break;case"[H":this.setCursor(0);break;case"b":null!=(t=this.closestLeftBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"f":null!=(t=this.closestRightBoundary(this.input,this.cursor))&&this.setCursor(t);break;case"\x7f":this.deletePreviousWord()}else if(n<32||127===n)switch(e){case"\r":this.queueCommands([{key:"newline"}]);break;case"\x7f":this.handleCursorErase(!0);break;case"\t":this.handleCursorInsert("  ");break;case"\x03":this.sendSigKill();break;case"\x17":this.deletePreviousWord();break;case"\x01":this.setCursor(0);break;case"\x05":this.setCursor(this.input.length);break;case"\f":this.clearScreen(),this.setInput(this.input);break;case"\v":var r=this.input.slice(0,this.cursor);this.clearInput(),this.setInput(r);break;case"\x15":var a=this.input.slice(this.cursor);this.clearInput(),this.setInput(a),this.setCursor(0)}else this.handleCursorInsert(e)}},{key:"inputEndsAtEdge",value:function(e){var t=this.actualLine(e),n=this.actualCursor(e,e.length);return 0===this.offsetToColRow(t,n).col}},{key:"offsetToColRow",value:function(e,t){for(var n=this.xterm.cols,r=0,a=0,i=0;i<t;++i){("\n"===e.charAt(i)||(a+=1)>=n)&&(a=0,r+=1)}return{row:r,col:a}}},{key:"onMessage",value:function(e){var t=this;if("string"===typeof e)return this.queueCommands(e.split("\n").map((function(e){return{key:"line",line:"".concat(y).concat(e).concat(d)}})));if(null===e)return this.queueCommands([{key:"line",line:"".concat(m,"null").concat(d)}]);if(void 0!==e)switch(e.key){case"send-xterm-prompt":return void this.setPrompt(e.prompt);case"clear-xterm":return void this.clearScreen();case"tty-received-line":return this.input="",void(this.readyForInput=!0);case"send-history-line":if(e.line){var n=e.line.split(/\r?\n/).join("\r\n");-1===this.historyIndex&&(this.preHistory=this.input),this.clearInput(),this.setInput(n),this.historyIndex=e.nextIndex}else 0===e.nextIndex&&(this.clearInput(),this.setInput(this.input!==this.preHistory?this.preHistory:""),this.historyIndex=-1,this.preHistory="");return;case"error":this.queueCommands([{key:"line",line:"".concat("\x1b[41;37m").concat(e.msg).concat(d)}]);break;default:(0,p.jO)(e)?e.items.slice(-2*p.bt).forEach((function(e){return t.onMessage(e)})):this.queueCommands([{key:"line",line:"".concat(m).concat((0,l.or)(e)).concat(d)}])}}},{key:"numLines",value:function(){return 1+this.offsetToColRow(this.input,this.input.length+2).row}},{key:"queueCommands",value:function(e){var t,n=h(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.commandBuffer.push(r)}}catch(a){n.e(a)}finally{n.f()}this.printPending()}},{key:"printPending",value:function(){this.commandBuffer.length&&!this.nextPrintId&&(this.nextPrintId=window.setTimeout(this.runCommands,this.refreshMs))}},{key:"sendLine",value:function(){this.prompt="",this.readyForInput=this.promptReady=!1,this.historyIndex=-1,this.preHistory="",this.io.writeToReaders({key:"send-line",line:this.input})}},{key:"sendSigKill",value:function(){this.input="",this.setCursor(0),this.xterm.write("^C\r\n"),this.trackCursorRow(1),this.cursor=0,this.commandBuffer.length=0,this.io.writeToReaders({key:"send-kill-sig"})}},{key:"setCursor",value:function(e){e<0?e=0:e>this.input.length&&(e=this.input.length);var t=this.actualLine(this.input),n=this.actualCursor(this.input,this.cursor),r=this.offsetToColRow(t,n),a=r.col,i=r.row,s=this.actualCursor(this.input,e),o=this.offsetToColRow(t,s),c=o.col,u=o.row;if(u>i)for(var l=i;l<u;++l)this.xterm.write("\x1b[B");else for(var p=u;p<i;++p)this.xterm.write("\x1b[A");if(this.trackCursorRow(u-i),c>a)for(var h=a;h<c;++h)this.xterm.write("\x1b[C");else for(var f=c;f<a;++f)this.xterm.write("\x1b[D");this.cursor=e}},{key:"setInput",value:function(e){this.setCursor(0);var t=this.actualLine(e);this.xterm.write(t),t&&this.inputEndsAtEdge(e)&&(this.xterm.write("\r\n"),this.trackCursorRow(1)),this.input=e,this.cursor=e.length}},{key:"setPrompt",value:function(e){this.prompt=e;var t=(0,r.Z)(this.commandBuffer,1)[0];t&&"await-prompt"===t.key&&this.commandBuffer.shift(),this.queueCommands([{key:"prompt",prompt:e}])}},{key:"trackCursorRow",value:function(e){this.cursorRow+=e,this.cursorRow<1?this.cursorRow=1:this.cursorRow>this.xterm.rows&&(this.cursorRow=this.xterm.rows)}},{key:"wordBoundaries",value:function(e){for(var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=[],a=/\w+/g;t=a.exec(e);)r.push(n?t.index:t.index+t[0].length);return r}}]),e}()},20437:function(e,t,n){n.d(t,{_3:function(){return u},LA:function(){return i.L},UL:function(){return r.U},dl:function(){return a.d}});var r=n(72328),a=n(49345),i=n(18264),s=n(79056),o=n(68216),c=n(25997),u=function(){function e(t){return(0,o.Z)(this,e),this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this.setMatrixValue(t)}return(0,c.Z)(e,[{key:"isIdentity",get:function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f}},{key:"setIdentity",value:function(){this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0}},{key:"setMatrixValue",value:function(e){if("string"===typeof e){var t=e.slice("matrix(".length,-")".length).split(",").map(Number);return this.feedFromArray(t)}return e?Array.isArray(e)?this.feedFromArray([this.a,this.b,this.c,this.d,this.e,this.f]):this.feedFromArray([e.a,e.b,e.c,e.d,e.e,e.f]):this}},{key:"transformPoint",value:function(e){var t=this.a*e.x+this.c*e.y+this.e,n=this.b*e.x+this.d*e.y+this.f;return e.x=t,e.y=n,e}},{key:"feedFromArray",value:function(e){var t=(0,s.Z)(e,6),n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],c=t[5];return this.a=n,this.b=r,this.c=a,this.d=i,this.e=o,this.f=c,this}}]),e}()},18264:function(e,t,n){n.d(t,{L:function(){return y}});var r=n(79056),a=n(17120),i=n(92809),s=n(97131),o=n(68216),c=n(25997),u=n(90831),l=n(32676),p=n(9187),h=n.n(p),f=n(72328),d=n(49345),m=n(84273);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,o.Z)(this,e),this.outline=t,this.holes=n}return(0,c.Z)(e,[{key:"allPoints",get:function(){var e;return(e=this.outline).concat.apply(e,(0,s.Z)(this.holes))}},{key:"geoJson",get:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"Polygon",coordinates:[this.outline.map((function(e){return[e.x,e.y]}))].concat(this.holes.map((function(e){return e.map((function(e){return[e.x,e.y]}))})))},this.meta&&{meta:this.meta})}},{key:"rect",get:function(){return f.U.from.apply(f.U,(0,s.Z)(this.outline))}},{key:"svgPath",get:function(){return[this.outline].concat((0,s.Z)(this.holes)).map((function(e){return"M".concat(e,"Z")})).join(" ")}},{key:"tangents",get:function(){var e=[this.outline].concat((0,s.Z)(this.holes)).map((function(e){return e.concat(e[0]).reduce((function(e,t,n,r){if(n){var a=t.clone().sub(r[n-1]).length;a<.01&&console.log("saw point length",a)}return n>0?e.concat(t.clone().sub(r[n-1]).normalize()):[]}),[])})),t=(0,a.Z)(e);return{outer:t[0],inner:t.slice(1)}}},{key:"add",value:function(e){return this.translate(e.x,e.y)}},{key:"addMeta",value:function(e){return this.meta=Object.assign(this.meta||{},e),this}},{key:"anticlockwise",value:function(){this.outline.push(this.outline[0]);var e=this.outline.reduce((function(e,t,n,r){return e+(n<r.length-1?(r[n+1].x-t.x)*(r[n+1].y+t.y):0)}),0);return this.outline.pop(),e>0}},{key:"applyMatrix",value:function(e){return e.isIdentity||(this.outline=this.outline.map((function(t){return e.transformPoint(t)})),this.holes.forEach((function(t){return t.map((function(t){return e.transformPoint(t)}))}))),this}},{key:"cleanFinalReps",value:function(){for(var e=0,t=[this.outline].concat((0,s.Z)(this.holes));e<t.length;e++){var n=t[e],r=n.pop();r&&!r.equals(n[0])&&n.push(r)}return this}},{key:"clone",value:function(){return new e(this.outline.map((function(e){return e.clone()})),this.holes.map((function(e){return e.map((function(e){return e.clone()}))})))}},{key:"createInset",value:function(t){if(0===t)return[this.clone()];this.cleanFinalReps();var n,r=[{ring:this.outline,inset:e.insetRing(this.outline,t)}].concat((0,s.Z)(this.holes.map((function(n){return{ring:n,inset:e.insetRing(n,t)}})))).map((function(t){var n=t.ring,r=t.inset;return n.map((function(t,a){return new e([n[a].clone(),r[a],r[(a+1)%n.length],n[(a+1)%n.length].clone()])}))})),i=(0,a.Z)(r),o=i[0],c=i.slice(1);return t>0?e.cutOut(o.concat.apply(o,(0,s.Z)(c)),[this.clone()]):e.union((n=[this.clone()]).concat.apply(n,[o].concat((0,s.Z)(c))))}},{key:"createOutset",value:function(e){return this.createInset(-e)}},{key:"fastTriangulate",value:function(){var e=this.geoJson.coordinates,t=h().flatten(e),n=h()(t.vertices,t.holes,2),r=n.reduce((function(e,t,r){return r%3===2?e.concat([[n[r-2],n[r-1],t]]):e}),[]);return{vs:this.allPoints,tris:r}}},{key:"fixOrientation",value:function(){return this.anticlockwise()&&this.reverse(),this}},{key:"qualityTriangulate",value:function(){try{var e=this.outline.map((function(e,t){return{x:e.x,y:e.y,id:t}})),t=e.length,n=this.holes.map((function(e){return e.map((function(e){return{x:e.x,y:e.y,id:t++}}))})),a=new u.SweepContext(e).addHoles(n).triangulate().getTriangles().map((function(e){return[e.getPoint(0),e.getPoint(1),e.getPoint(2)]})).map((function(e){var t=(0,r.Z)(e,3),n=t[0],a=t[1],i=t[2];return[n.id,a.id,i.id]}));return{vs:this.allPoints,tris:a}}catch(i){return console.error("Quality triangulation failed, falling back to earcut"),console.error(i),this.fastTriangulate()}}},{key:"precision",value:function(e){return this.outline.forEach((function(t){return t.precision(e)})),this.holes.forEach((function(t){return t.forEach((function(t){return t.precision(e)}))})),this}},{key:"removeHoles",value:function(){return this.holes=[],this}},{key:"reverse",value:function(){return this.outline.reverse(),this.holes.forEach((function(e){return e.reverse()})),this}},{key:"round",value:function(){return this.outline.forEach((function(e){return e.round()})),this.holes.forEach((function(e){return e.forEach((function(e){return e.round()}))})),this}},{key:"scale",value:function(e){return this.outline.forEach((function(t){return t.scale(e)})),this.holes.forEach((function(t){return t.forEach((function(t){return t.scale(e)}))})),this}},{key:"translate",value:function(e,t){return this.outline.forEach((function(n){return n.translate(e,t)})),this.holes.forEach((function(n){return n.forEach((function(n){return n.translate(e,t)}))})),this}}],[{key:"cutOut",value:function(t,n){return l.difference.apply(l,[n.map((function(e){return e.geoJson.coordinates}))].concat((0,s.Z)(t.map((function(e){return e.geoJson.coordinates}))))).map((function(t){return e.from(t)}))}},{key:"from",value:function(t){return t instanceof Array?new e(t[0].map((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];return new d.d(n,a)})),t.slice(1).map((function(e){return e.map((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];return new d.d(n,a)}))}))):new e(t.coordinates[0].map((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];return new d.d(n,a)})),t.coordinates.slice(1).map((function(e){return e.map((function(e){var t=(0,r.Z)(e,2),n=t[0],a=t[1];return new d.d(n,a)}))})))}},{key:"fromRect",value:function(t){return new e(t.points)}},{key:"insetRing",value:function(t,n){var r=new e(t).tangents.outer,a=t.map((function(e,a){return[e.clone().translate(n*-r[a].y,n*r[a].x),t[(a+1)%t.length].clone().translate(n*-r[a].y,n*r[a].x)]}));return a.map((function(e,t){var n=(t+1)%a.length,i=a[n],s=m.J7.getLinesIntersect(e[1],r[t],i[0],r[n]);return s?e[1].translate(s*r[t].x,s*r[t].y):d.d.average([e[1],i[0]])}))}},{key:"pointInTriangle",value:function(t,n,r,a){var i=e.sign(t,n,r),s=e.sign(t,r,a),o=e.sign(t,a,n);return!((i<0||s<0||o<0)&&(i>0||s>0||o>0))}},{key:"sign",value:function(e,t,n){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}},{key:"union",value:function(t){return l.union.apply(l,[[]].concat((0,s.Z)(t.map((function(e){return e.geoJson.coordinates}))))).map((function(t){return e.from(t)}))}}]),e}()},72328:function(e,t,n){n.d(t,{U:function(){return o}});var r=n(97131),a=n(68216),i=n(25997),s=n(49345),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,a.Z)(this,e),this.x=t,this.y=n,this.width=r,this.height=i}return(0,i.Z)(e,[{key:"area",get:function(){return this.width*this.height}},{key:"bottom",get:function(){return this.y+this.height}},{key:"bottomLeft",get:function(){return new s.d(this.x,this.y+this.height)}},{key:"bottomRight",get:function(){return new s.d(this.x+this.width,this.y+this.height)}},{key:"center",get:function(){return new s.d(this.cx,this.cy)}},{key:"cx",get:function(){return this.x+.5*this.width}},{key:"cy",get:function(){return this.y+.5*this.height}},{key:"geoJson",get:function(){return{type:"Polygon",coordinates:[[[this.x,this.y],[this.x+this.width,this.y],[this.x+this.width,this.y+this.height],[this.x,this.y+this.height]]]}}},{key:"json",get:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},{key:"key",get:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.width,",").concat(this.height)}},{key:"dimension",get:function(){return Math.max(this.width,this.height)}},{key:"points",get:function(){return[new s.d(this.x,this.y),new s.d(this.x,this.y+this.height),new s.d(this.x+this.width,this.y+this.height),new s.d(this.x+this.width,this.y)]}},{key:"right",get:function(){return this.x+this.width}},{key:"topLeft",get:function(){return new s.d(this.x,this.y)}},{key:"topRight",get:function(){return new s.d(this.x+this.width,this.y)}},{key:"applyMatrix",value:function(e){if(!e.isIdentity){var t=e.transformPoint(this.topLeft),n=e.transformPoint(this.bottomRight);this.x=Math.min(t.x,n.x),this.y=Math.min(t.y,n.y),this.width=Math.max(t.x,n.x)-this.x,this.height=Math.max(t.y,n.y)-this.y}return this}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"contains",value:function(e){var t=e.x,n=e.y;return this.x<=t&&t<=this.x+this.width&&this.y<=n&&n<=this.y+this.height}},{key:"copy",value:function(e){var t=e.x,n=e.y,r=e.width,a=e.height;return this.x=t,this.y=n,this.width=r,this.height=a,this}},{key:"covers",value:function(e){var t=e.x,n=e.y,r=e.width,a=e.height;return this.x<=t&&t+r<=this.x+this.width&&this.y<=n&&n+a<=this.y+this.height}},{key:"delta",value:function(e,t){return this.x+=e,this.y+=t,this}},{key:"inset",value:function(e){var t=[this.cx,this.cy],n=t[0],r=t[1];return this.outset(-e),this.width<0&&(this.x=n,this.width=0),this.height<0&&(this.y=r,this.height=0),this}},{key:"intersects",value:function(e){return 2*Math.abs(this.cx-e.cx)<=this.width+e.width&&2*Math.abs(this.cy-e.cy)<=this.height+e.height}},{key:"offset",value:function(e){var t=e.x,n=e.y;return this.x+=t,this.y+=n,this}},{key:"outset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t,this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this.width*=e,this.height*=e,this}},{key:"setPosition",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y,",").concat(this.width,",").concat(this.height)}}],[{key:"zero",get:function(){return new e(0,0,0,0)}},{key:"from",value:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];if(n.length){if(n[0]instanceof s.d){var i=n,o=Math.min.apply(Math,(0,r.Z)(i.map((function(e){return e.x})))),c=Math.min.apply(Math,(0,r.Z)(i.map((function(e){return e.y})))),u=Math.max.apply(Math,(0,r.Z)(i.map((function(e){return e.x})))),l=Math.max.apply(Math,(0,r.Z)(i.map((function(e){return e.y}))));return new e(o,c,u-o,l-c)}var p=n,h=Math.min.apply(Math,(0,r.Z)(p.map((function(e){return e.x})))),f=Math.min.apply(Math,(0,r.Z)(p.map((function(e){return e.y})))),d=Math.max.apply(Math,(0,r.Z)(p.map((function(e){return e.x+e.width})))),m=Math.max.apply(Math,(0,r.Z)(p.map((function(e){return e.y+e.height}))));return new e(h,f,d-h,m-f)}return e.zero}},{key:"fromJson",value:function(t){return new e(t.x,t.y,t.width,t.height)}}]),e}()},49345:function(e,t,n){n.d(t,{d:function(){return i}});var r=n(68216),a=n(25997),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,r.Z)(this,e),this.x=t,this.y=n}return(0,a.Z)(e,[{key:"angle",get:function(){return Math.atan2(this.y,this.x)}},{key:"coord",get:function(){return[this.x,this.y]}},{key:"json",get:function(){return{x:this.x,y:this.y}}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthSquared",get:function(){return this.x*this.x+this.y*this.y}},{key:"add",value:function(e){var t=e.x,n=e.y;return this.translate(t,n)}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"copy",value:function(e){return this.set(e.x,e.y)}},{key:"distanceTo",value:function(e){return Math.hypot(e.x-this.x,e.y-this.y)}},{key:"distanceToSquared",value:function(e){return Math.pow(e.x-this.x,2)+Math.pow(e.y-this.y,2)}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"dotArgs",value:function(e,t){return this.x*e+this.y*t}},{key:"equals",value:function(e){var t=e.x,n=e.y;return this.x===t&&this.y===n}},{key:"normalize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.length?this.scale(e/this.length):(console.error("Cannot normalize Vect '".concat(this,"' to length '").concat(e,"'")),this)}},{key:"precision",value:function(e){return this.set(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}},{key:"rotate",value:function(e){var t=[this.x,this.y],n=t[0],r=t[1];return this.x=Math.cos(e)*n-Math.sin(e)*r,this.y=Math.sin(e)*n+Math.cos(e)*r,this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"scale",value:function(e){return this.x*=e,this.y*=e,this}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"sub",value:function(e){var t=e.x,n=e.y;return this.translate(-t,-n)}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"toString",value:function(){return"".concat(this.x,",").concat(this.y)}},{key:"translate",value:function(e,t){return this.x+=e,this.y+=t,this}}],[{key:"zero",get:function(){return new e(0,0)}},{key:"average",value:function(t){return t.length?t.reduce((function(e,t){return e.add(t)}),e.zero).scale(1/t.length):e.zero}},{key:"from",value:function(t){return Array.isArray(t)?new e(t[0],t[1]):new e(t.x,t.y)}}]),e}()},84273:function(e,t,n){n.d(t,{us:function(){return u},pS:function(){return h},w5:function(){return d},Fx:function(){return p},C1:function(){return l},J7:function(){return k},_Y:function(){return c},zk:function(){return o},po:function(){return m},Xs:function(){return s},A_:function(){return f}});var r;n(70956),n(18264);function a(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw s}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e){var t;return{pointerId:e instanceof PointerEvent?e.pointerId:null,clientX:e.clientX,clientY:e.clientY,ownerSvg:(null===(t=e.currentTarget)||void 0===t?void 0:t.ownerSVGElement)||e.currentTarget}}function o(e){var t;return(r=r||e.ownerSvg.createSVGPoint()).x=e.clientX,r.y=e.clientY,r.matrixTransform(null===(t=e.ownerSvg.getScreenCTM())||void 0===t?void 0:t.inverse())}function c(e){var t;return(r=r||e[0].ownerSvg.createSVGPoint()).x=r.y=0,e.forEach((function(e){r.x+=e.clientX,r.y+=e.clientY})),r.x/=e.length||1,r.y/=e.length||1,r.matrixTransform(null===(t=e[0].ownerSvg.getScreenCTM())||void 0===t?void 0:t.inverse())}var u="ontouchstart"in window||navigator.maxTouchPoints>0;function l(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.length&&(e.moveTo(t[0].x,t[0].y),t.forEach((function(t){return e.lineTo(t.x,t.y)})),n&&e.fill(),e.closePath())}function p(e,t){var n,r=a(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.beginPath(),l(e,i.outline,!1);var s,o=a(i.holes);try{for(o.s();!(s=o.n()).done;){l(e,s.value,!1)}}catch(c){o.e(c)}finally{o.f()}e.fill()}}catch(c){r.e(c)}finally{r.f()}}function h(e,t,n){e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke()}function f(e,t,n,r){e.fillStyle=t,n&&(e.strokeStyle=n),void 0!==r&&(e.lineWidth=r)}function d(e,t){var n,r=a(t.tris);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.beginPath(),l(e,i.map((function(e){return t.vs[e]})),!1),e.stroke()}}catch(s){r.e(s)}finally{r.f()}}function m(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.src=e}))}var v=n(97131),y=n(68216),g=n(25997);n(20437);function b(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k=new(function(){function e(){(0,y.Z)(this,e)}return(0,g.Z)(e,[{key:"getLinesIntersect",value:function(e,t,n,r){return Math.abs(-t.y*r.x+t.x*r.y)<1e-4?null:(r.x*(n.y-e.y)-r.y*(n.x-e.x))/(t.y*r.x-r.y*t.x)}},{key:"getLineSegsIntersection",value:function(e,t,n,r){var a,i,s=t.x-e.x,o=t.y-e.y,c=r.x-n.x,u=r.y-n.y,l=-c*o+s*u;if(0===l){if(e.x*-o+e.y*s===n.x*-o+n.y*s){if(i=c*c+u*u,0<=(a=(e.x-n.x)*c+(e.y-n.y)*u)&&a<=i)return a/i;if(0<=(a=(t.x-n.x)*c+(t.y-n.y)*u)&&a<=i)return a/i}return null}return a=(-o*(e.x-n.x)+s*(e.y-n.y))/l,i=(c*(e.y-n.y)-u*(e.x-n.x))/l,a>=0&&a<=1&&i>=0&&i<=1?i:null}},{key:"joinTriangulations",value:function(e){if(1===e.length)return e[0];var t,n=[],r=[],a=0,i=b(e);try{for(i.s();!(t=i.n()).done;){var s=t.value;n.push.apply(n,(0,v.Z)(s.vs)),r.push.apply(r,(0,v.Z)(s.tris.map((function(e){return e.map((function(e){return e+a}))})))),a+=s.vs.length}}catch(o){i.e(o)}finally{i.f()}return{vs:n,tris:r}}},{key:"polysToTriangulation",value:function(e){var t=e.map((function(e){return e.qualityTriangulate()}));return this.joinTriangulations(t)}},{key:"removePathReps",value:function(e){var t;return e.reduce((function(e,n){return t&&n.x===t.x&&n.y===t.y||e.push(t=n),e}),[])}}]),e}())},56127:function(e,t,n){n.d(t,{N:function(){return X},Z:function(){return ae}});var r=n(92809),a=n(97131),i=n(14671),s=n(38597),o=n(86576),c=n(1472),u=n(10219);function l(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t){t[e];return(0,u.Z)(t,[e].map(l))}var d=n(79056),m=n(30266),v=n(68216),y=n(25997),g=n(8068),b=n(809),x=n.n(b),k=n(29950),w=new(function(){function e(){var t=this;(0,v.Z)(this,e),(0,r.Z)(this,"onOneLine",!0),(0,r.Z)(this,"multilineSrc",(function(e){t.onOneLine=!1;var n=t.src(e);return t.onOneLine=!0,n})),(0,r.Z)(this,"seqSrc",(function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.onOneLine){var r=[];return e.forEach((function(e){return r.push(t.src(e),t.isBackgroundNode(e)?" ":"; ")})),(n?r:r.slice(0,-1)).join("")}return e.map((function(e){return t.src(e)})).join("\n")})),(0,r.Z)(this,"src",(function(e){var n,r;if(!e)return"";switch(e.type){case"ArithmCmd":return"(( ".concat(t.src(e.X)," ))");case"BinaryCmd":var a=t.binaryCmds(e);return[a[0].X].concat(a.map((function(e){return e.Y}))).map((function(e){return t.src(e)})).join(" ".concat(e.Op).concat(t.onOneLine||"|"===e.Op?"":"\n"," "));case"BinaryArithm":return[e.X,e.Y].map((function(e){return t.src(e)})).join("".concat(e.Op));case"UnaryArithm":return e.Post?"".concat(t.src(e.X)).concat(e.Op):"".concat(e.Op).concat(t.src(e.X));case"ParenArithm":return"(".concat(t.src(e.X),")");case"Word":return"string"===typeof e.string?e.string:e.Parts.map((function(e){return t.src(e)})).join("");case"ArrayExpr":var i=e.Elems.map((function(e){var n=e.Index,r=e.Value;return n?"[".concat(t.src(n),"]=").concat(t.src(r)):t.src(r)}));return"(".concat(i.join(" "),")");case"Assign":var s=e.Name.Value;return e.Array?"".concat(s,"=").concat(t.src(e.Array)):e.Index?"".concat(s,"[").concat(t.src(e.Index),"]").concat(e.Append?"+":"","=").concat(t.src(e.Value)):"".concat(s).concat(e.Append?"+":"","=").concat(t.src(e.Value||null));case"Block":var c=e.Stmts,u=c.length&&t.isBackgroundNode((0,o.Z$)(c))?"":";";if(t.onOneLine)return"{ ".concat(t.seqSrc(c)).concat(u," }");var l=t.seqSrc(c).split("\n");return 1===l.length&&!l[0]&&l.pop(),"{\n".concat(l.map((function(e){return"  ".concat(e)})).concat(e.Last.map((function(e){return"  #".concat(e.Text)}))).join("\n"),"\n}");case"CallExpr":return[e.Assigns.map((function(e){return t.src(e)})).join(" "),e.Args.map((function(e){return t.src(e)})).join(" ")].filter(Boolean).join(" ");case"Stmt":var p=[e.Negated&&"!",t.src(e.Cmd),e.Redirs.map((function(e){return t.src(e)})).join(" "),e.Background&&"&"].filter(Boolean).join(" ");if(!t.onOneLine&&e.Comments.length){var h=[];e.Comments.forEach((function(t){return t.Hash.Offset<e.Position.Offset?h.push("#".concat(t.Text)):p+=" #".concat(t.Text)})),p=h.concat(p).join("\n")}return p;case"CaseClause":var f=e.Items.map((function(e){return{globs:e.Patterns,terminal:e.Op,child:e.Stmts}}));return["case",t.src(e.Word),"in",f.flatMap((function(e){var n=e.child,r=e.globs,a=e.terminal;return["".concat(r.map((function(e){return t.src(e)})).join(" | "),")"),t.seqSrc(n),a]})).join(" "),"esac"].filter(Boolean).join(" ");case"CoprocClause":return["coproc",null===(n=e.Name)||void 0===n?void 0:n.Value,t.src(e.Stmt)].filter(Boolean).join(" ");case"DeclClause":return[e.Variant.Value,e.Args.map((function(e){return t.src(e)})).join(" ")].filter(Boolean).join(" ");case"ArithmExp":return"".concat("Stmt"===(null===(r=e.parent)||void 0===r?void 0:r.type)?"":"$","(( ").concat(t.src(e.X)," ))");case"CmdSubst":return"$( ".concat(t.seqSrc(e.Stmts)," )");case"DblQuoted":return'"'.concat(e.Parts.map((function(e){return t.src(e)})).join(""),'"');case"ExtGlob":return e.Pattern.Value.replace(/\n/g,"");case"Lit":return e.Value;case"ParamExp":var m;return":-"===(null===(m=e.Exp)||void 0===m?void 0:m.Op)?"${".concat(e.Param.Value,":-").concat(t.src(e.Exp.Word),"}"):"${".concat(e.Param.Value,"}");case"ProcSubst":var v="<("===e.Op?"<":">";return"".concat(v,"( ").concat(t.seqSrc(e.Stmts)," )");case"SglQuoted":var y=e.Value;return"".concat(e.Dollar?"$":"","'").concat(y,"'");case"FuncDecl":return"".concat(e.Name.Value,"() ").concat(t.src(e.Body));case"IfClause":return(0,k.Wc)(e).map((function(e,n){var r=e.Cond,a=e.Then;return r.length?"".concat(n?"elif":"if"," ").concat(t.seqSrc(r),"; then ").concat(t.seqSrc(a),"; "):"else ".concat(t.seqSrc(a),"; ")})).concat("fi").join("");case"LetClause":return"let ".concat(e.Exprs.map((function(e){return t.src(e)})).join(" "));case"Redirect":var g=e.N?Number(e.N.Value):"";switch(e.Op){case">":case">>":var b=(0,d.Z)(e.Word.Parts,1)[0],x="Lit"===(null===b||void 0===b?void 0:b.type)&&b.Value.endsWith("-");return"".concat(g).concat(e.Op).concat(t.src(e.Word)).concat(x?"-":"");default:return""}case"File":return t.seqSrc(e.Stmts);case"Subshell":return"( ".concat(e.Stmts.map((function(e){return t.src(e)})).join("; ")," )");case"TestClause":return"[[ ".concat(t.src(e.X)," ]]");case"BinaryTest":return[e.X,e.Y].map((function(e){return t.src(e)})).join(" ".concat(e.Op," "));case"UnaryTest":return"".concat(e.Op," ").concat(t.src(e.X));case"ParenTest":return"(".concat(t.src(e.X),")");case"TimeClause":return"time ".concat(e.PosixFormat?"-p ":"").concat(t.src(e.Stmt));case"ForClause":var w=e.Do,S=e.Loop;return"CStyleLoop"===S.type?"for (( ".concat(t.src(S.Init),"; ").concat(t.src(S.Cond),"; ").concat(t.src(S.Post)," )); do ").concat(t.seqSrc(w,!0),"done"):"for ".concat(S.Name.Value," in ").concat(S.Items.map((function(e){return t.src(e)})).join(" "),"; do ").concat(t.seqSrc(w,!0),"done");case"WhileClause":return"".concat(e.Until?"until":"while"," ").concat(t.seqSrc(e.Cond,!0),"do ").concat(t.seqSrc(e.Do,!0),"done");case"CStyleLoop":case"Comment":case"WordIter":case"ArrayElem":case"CaseItem":return"";default:throw(0,o.Ql)(e)}}))}return(0,y.Z)(e,[{key:"binaryCmds",value:function(e){var t=e.X,n=e.Y,r=e.Op;return t.Cmd&&"BinaryCmd"===t.Cmd.type&&t.Cmd.Op===r?[].concat((0,a.Z)(this.binaryCmds(t.Cmd)),[e]):n.Cmd&&"BinaryCmd"===n.Cmd.type&&n.Cmd.Op===r?[e].concat((0,a.Z)(this.binaryCmds(n.Cmd))):[e]}},{key:"isBackgroundNode",value:function(e){return"Stmt"===e.type&&e.Background}}]),e}()),S=n(17120),Z=n(99763),C=n(29998),P=n(36375),O=n(47480),j=n(95775),_=n.n(j),I=n(97468),T=n(30023),R=n.n(T),E=n(6320);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var N={cd:!0,declare:!0,echo:!0,false:!0,get:!0,help:!0,history:!0,kill:!0,ls:!0,ps:!0,pwd:!0,return:!0,rm:!0,run:!0,session:!0,set:!0,sleep:!0,true:!0,unset:!0},K=new(function(){function e(){(0,v.Z)(this,e)}return(0,y.Z)(e,[{key:"isCmd",value:function(e){return e in N}},{key:"runCmd",value:function(e,t,n){var r=this;return(0,Z.Z)(x().mark((function i(){var s,u,l,p,h,f,m,v,y,b,w,S,Z,O,j,_,T,A,D,L,K,B,V,G,W,z,F,J,q,$,H,U,Y,Q,ee,te,ne,re,ie,se,oe,ce,ue,le,pe,he,fe,de,me,ve,ye,ge,be,xe,ke,we,Se,Ze,Ce,Pe,Oe,je,_e,Ie,Te,Re,Ee,Ae,De,Me,Le,Ne,Ke,Be,Ve,Ge,We,ze,Fe,Je,qe,$e,He,Xe,Ue,Ye,Qe,et;return x().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:s=e.meta,i.t0=t,i.next="cd"===i.t0?4:"declare"===i.t0?36:"echo"===i.t0?73:"false"===i.t0?102:"get"===i.t0?104:"help"===i.t0?106:"history"===i.t0?130:"kill"===i.t0?150:"ls"===i.t0?153:"ps"===i.t0?179:"pwd"===i.t0?230:"return"===i.t0?233:"rm"===i.t0?238:"run"===i.t0?263:"session"===i.t0?266:"set"===i.t0?269:"sleep"===i.t0?273:"true"===i.t0?277:"unset"===i.t0?279:283;break;case 4:if(!(n.length>1)){i.next=6;break}throw new I.nl("usage: `cd /`, `cd`, `cd foo/bar`, `cd /foo/bar`, `cd ..` and `cd -`",1);case 6:if(u=ae.api.getVar(s.sessionKey,"OLDPWD"),l=ae.api.getVar(s.sessionKey,"PWD"),ae.api.setVar(s.sessionKey,"OLDPWD",l),i.prev=9,n[0]){i.next=14;break}ae.api.setVar(s.sessionKey,"PWD","home"),i.next=29;break;case 14:if("-"!==n[0]){i.next=18;break}ae.api.setVar(s.sessionKey,"PWD",u),i.next=29;break;case 18:if(!n[0].startsWith("/")){i.next=25;break}if(p=(0,I._Z)(n[0].split("/")),void 0!==(0,I.Hn)(p,r.provideProcessCtxt(e.meta))){i.next=22;break}throw Error;case 22:ae.api.setVar(s.sessionKey,"PWD",p.join("/")),i.next=29;break;case 25:if(h=(0,I._Z)(l.split("/").concat(n[0].split("/"))),void 0!==(0,I.Hn)(h,r.provideProcessCtxt(e.meta))){i.next=28;break}throw Error;case 28:ae.api.setVar(s.sessionKey,"PWD",h.join("/"));case 29:i.next=35;break;case 31:throw i.prev=31,i.t1=i.catch(9),ae.api.setVar(s.sessionKey,"OLDPWD",u),new I.nl("".concat(n[0]," not found"),1);case 35:return i.abrupt("break",284);case 36:f=ae.api.getFuncs(s.sessionKey),m=M(f),i.prev=38,m.s();case 40:if((v=m.n()).done){i.next=64;break}y=v.value,b=y.key,w=y.src,S="".concat(E.Sv).concat(b).concat(E.Dx," () ").concat(w).split(/\r?\n/),Z=M(S),i.prev=44,Z.s();case 46:if((O=Z.n()).done){i.next=52;break}return j=O.value,i.next=50,j;case 50:i.next=46;break;case 52:i.next=57;break;case 54:i.prev=54,i.t2=i.catch(44),Z.e(i.t2);case 57:return i.prev=57,Z.f(),i.finish(57);case 60:return i.next=62,"";case 62:i.next=40;break;case 64:i.next=69;break;case 66:i.prev=66,i.t3=i.catch(38),m.e(i.t3);case 69:return i.prev=69,m.f(),i.finish(69);case 72:return i.abrupt("break",284);case 73:if(_=(0,k.v8)(n,{boolean:["a","n"]}),T=_.opts,A=_.operands,!T.a){i.next=79;break}return i.next=77,T.n?A.map(Number):A;case 77:i.next=101;break;case 79:if(!T.n){i.next=99;break}D=M(A),i.prev=81,D.s();case 83:if((L=D.n()).done){i.next=89;break}return K=L.value,i.next=87,Number(K);case 87:i.next=83;break;case 89:i.next=94;break;case 91:i.prev=91,i.t4=i.catch(81),D.e(i.t4);case 94:return i.prev=94,D.f(),i.finish(94);case 97:i.next=101;break;case 99:return i.next=101,A.join(" ");case 101:return i.abrupt("break",284);case 102:return e.exitCode=1,i.abrupt("break",284);case 104:return i.delegateYield((0,P.Z)((0,g.Z)(r.get(e,n)),C.Z),"t5",105);case 105:return i.abrupt("break",284);case 106:return B=ae.api.getSession(s.sessionKey),V=B.ttyShell,i.next=109,"The following commands are supported:";case 109:G=R()(Object.keys(N),{width:V.xterm.xterm.cols}).split(/\r?\n/),W=M(G),i.prev=111,W.s();case 113:if((z=W.n()).done){i.next=119;break}return F=z.value,i.next=117,"".concat(E.Sv).concat(F);case 117:i.next=113;break;case 119:i.next=124;break;case 121:i.prev=121,i.t6=i.catch(111),W.e(i.t6);case 124:return i.prev=124,W.f(),i.finish(124);case 127:return i.next=129,"View shell functions via ".concat(E.Sv,"declare").concat(E.Dx,".");case 129:return i.abrupt("break",284);case 130:J=ae.api.getSession(s.sessionKey),q=J.ttyShell,$=q.getHistory(),H=M($),i.prev=133,H.s();case 135:if((U=H.n()).done){i.next=141;break}return Y=U.value,i.next=139,Y;case 139:i.next=135;break;case 141:i.next=146;break;case 143:i.prev=143,i.t7=i.catch(133),H.e(i.t7);case 146:return i.prev=146,H.f(),i.finish(146);case 149:return i.abrupt("break",284);case 150:if("break"!==function(){var e,t=(0,k.v8)(n,{boolean:["STOP","CONT"]}),a=t.opts,i=M(t.operands.map((function(e){return r.parseJsonArg(e)})).filter((function(e){return Number.isFinite(e)})));try{for(i.s();!(e=i.n()).done;){var o=e.value;ae.api.getProcesses(s.sessionKey,o).reverse().forEach((function(e){var t;if(a.STOP)null===(t=e.onSuspend)||void 0===t||t.call(e),e.onSuspend=null,e.status=X.Suspended;else if(a.CONT){var n;null===(n=e.onResume)||void 0===n||n.call(e),e.onResume=null,e.status=X.Running}else{var r;e.status=X.Killed,null===(r=e.onResume)||void 0===r||r.call(e),e.onSuspend=e.onResume=null,setTimeout((function(){e.cleanups.forEach((function(e){return e()})),e.cleanups.length=0}))}}))}}catch(c){i.e(c)}finally{i.f()}return"break"}()){i.next=153;break}return i.abrupt("break",284);case 153:Q=(0,k.v8)(n,{boolean:["1","l","r","a"]}),ee=Q.opts,te=Q.operands,ne=ae.api.getVar(s.sessionKey,"PWD"),re=te.length?te.slice():[""],ie=r.provideProcessCtxt(s),se=re.map((function(e){return(0,I.i3)(e,ie,ne)})),oe=ae.api.getSession(e.meta.sessionKey),ce=oe.ttyShell,ue=M(se.entries()),i.prev=160,pe=x().mark((function e(){var t,n,r,i,c,u,l,p,h,f;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,d.Z)(le.value,2),n=t[0],void 0!==(r=t[1])){e.next=4;break}return ae.api.warn(s.sessionKey,'ls: "'.concat(re[n],'" is not defined')),e.abrupt("return","continue");case 4:if(!(se.length>1)){e.next=7;break}return e.next=7,"".concat(E.Sv).concat(re[n],":");case 7:i=(ee.r?(0,o.RT)(r):Object.keys(r)).sort(),c=[],"home"!==ne||ee.a||(i=i.filter((function(e){return e.toUpperCase()!==e||/^[0-9]/.test(e)}))),ee.l?("function"===typeof r&&(i=i.filter((function(e){return!["caller","callee","arguments"].includes(e)}))),u=i.map((function(e){var t,n;return(null===(t=r[e])||void 0===t||null===(n=t.constructor)||void 0===n?void 0:n.name)||(null===r[e]?"null":"undefined")})),l=Math.max.apply(Math,(0,a.Z)(u.map((function(e){return e.length})))),c=i.map((function(e,t){return"".concat(E.D2).concat(u[t].padEnd(l)).concat(E.Dx," ").concat(e)}))):c=ee[1]?i:R()(i,{width:ce.xterm.xterm.cols}).split(/\r?\n/),p=M(c),e.prev=12,p.s();case 14:if((h=p.n()).done){e.next=20;break}return f=h.value,e.next=18,f;case 18:e.next=14;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(12),p.e(e.t0);case 25:return e.prev=25,p.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[12,22,25,28]])})),ue.s();case 163:if((le=ue.n()).done){i.next=170;break}return i.delegateYield(pe(),"t8",165);case 165:if("continue"!==i.t8){i.next=168;break}return i.abrupt("continue",168);case 168:i.next=163;break;case 170:i.next=175;break;case 172:i.prev=172,i.t9=i.catch(160),ue.e(i.t9);case 175:return i.prev=175,ue.f(),i.finish(175);case 178:return i.abrupt("break",284);case 179:if(he=(0,k.v8)(n,{boolean:["a","s"]}),fe=he.opts,de=Object.values(ae.api.getProcesses(s.sessionKey)).filter(fe.a?function(e){return e}:function(e){return e.key===e.pgid}),me=["pid","ppid","pgid"].map((function(e){return e.padEnd(5)})).join(" "),!fe.s){i.next=208;break}ve=M(de),i.prev=184,ve.s();case 186:if((ye=ve.n()).done){i.next=198;break}return ge=ye.value,be=ge.key,xe=ge.ppid,ke=ge.pgid,we=ge.status,Se=ge.src,Ze=(0,c.us)(we),Ce=[be,xe,ke].map(String).map((function(e){return e.padEnd(5)})).join(" "),i.next=192,"".concat(E.Sv).concat(me).concat(E.eI);case 192:return i.next=194,"".concat(Ce).concat(Ze);case 194:return i.next=196,Se+"\n";case 196:i.next=186;break;case 198:i.next=203;break;case 200:i.prev=200,i.t10=i.catch(184),ve.e(i.t10);case 203:return i.prev=203,ve.f(),i.finish(203);case 206:i.next=229;break;case 208:return i.next=210,"".concat(E.Sv).concat(me).concat(E.eI);case 210:Pe=M(de),i.prev=211,Pe.s();case 213:if((Oe=Pe.n()).done){i.next=221;break}return je=Oe.value,_e=je.key,Ie=je.ppid,Te=je.pgid,Re=je.status,Ee=je.src,Ae=(0,c.us)(Re),De=[_e,Ie,Te].map(String).map((function(e){return e.padEnd(5)})).join(" "),i.next=219,"".concat(De).concat(Ae,"  ").concat((0,o.$G)(Ee,30));case 219:i.next=213;break;case 221:i.next=226;break;case 223:i.prev=223,i.t11=i.catch(211),Pe.e(i.t11);case 226:return i.prev=226,Pe.f(),i.finish(226);case 229:return i.abrupt("break",284);case 230:return i.next=232,"/"+ae.api.getVar(s.sessionKey,"PWD");case 232:return i.abrupt("break",284);case 233:return(Le=ae.api.getProcess(s)).status=X.Killed,null===(Me=Le.onResume)||void 0===Me||Me.call(Le),Le.onSuspend=Le.onResume=null,i.abrupt("break",284);case 238:Ne=r.provideProcessCtxt(s),Ke=ae.api.getVar(s.sessionKey,"PWD"),Be=M(n),i.prev=241,Be.s();case 243:if((Ve=Be.n()).done){i.next=254;break}if(Ge=Ve.value,!("home"===(We=(0,I.$R)(Ge,Ne,Ke))[0]&&We.length>1)){i.next=251;break}ze=We.pop(),delete(0,I.Hn)(We,Ne)[ze],i.next=252;break;case 251:throw new I.nl("cannot delete ".concat(Ge),1);case 252:i.next=243;break;case 254:i.next=259;break;case 256:i.prev=256,i.t12=i.catch(241),Be.e(i.t12);case 259:return i.prev=259,Be.f(),i.finish(259);case 262:return i.abrupt("break",284);case 263:return Fe=Function("_","return async function *generator ".concat(n[0])),i.delegateYield((0,P.Z)((0,g.Z)(Fe()(r.provideProcessCtxt(s,n.slice(1)))),C.Z),"t13",265);case 265:return i.abrupt("break",284);case 266:return i.next=268,s.sessionKey;case 268:return i.abrupt("break",284);case 269:return Je=r.provideProcessCtxt(s),qe=r.parseJsArg(n[1]),"/"===n[0][0]?Function("__1","__2","return __1.".concat(n[0].slice(1)," = __2"))(Je,qe):($e=r.computeCwd(s,Je),Function("__1","__2","return __1.".concat(n[0]," = __2"))($e,qe)),i.abrupt("break",284);case 273:return i.delegateYield(x().mark((function e(){var t,a,i;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ae.api.getProcess(s),a=1e3*(n.length?parseFloat(r.parseJsonArg(n[0]))||0:1),i=-1;case 3:return e.next=5,(0,C.Z)(new Promise((function(e,n){t.onSuspend=function(){a=i+a-Date.now(),e()},ae.api.addCleanup(s,(function(){return n((0,I.mq)(s))})),(i=Date.now())&&setTimeout(e,a)})));case 5:return void(e.next=7);case 7:if(Date.now()<i+a-1){e.next=3;break}case 8:return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)}))(),"t14",274);case 274:if("break"!==i.t14){i.next=277;break}return i.abrupt("break",284);case 277:return e.exitCode=0,i.abrupt("break",284);case 279:He=ae.api.getSession(s.sessionKey),Xe=He.var,Ue=He.func,Ye=M(n);try{for(Ye.s();!(Qe=Ye.n()).done;)et=Qe.value,delete Xe[et],delete Ue[et]}catch(tt){Ye.e(tt)}finally{Ye.f()}return i.abrupt("break",284);case 283:throw(0,o.Ql)(t);case 284:case"end":return i.stop()}}),i,null,[[9,31],[38,66,69,72],[44,54,57,60],[81,91,94,97],[111,121,124,127],[133,143,146,149],[160,172,175,178],[184,200,203,206],[211,223,226,229],[241,256,259,262]])})))()}},{key:"get",value:function(e,t){var n=this.provideProcessCtxt(e.meta),r=ae.api.getVar(e.meta.sessionKey,"PWD"),a=t.map((function(e){return(0,I.i3)(e,n,r)}));return e.exitCode=a.length&&a.every((function(e){return void 0===e}))?1:0,a}},{key:"computeCwd",value:function(e,t){var n=ae.api.getVar(e.sessionKey,"PWD");return(0,I.Hn)(n.split("/"),t)}},{key:"launchFunc",value:function(){var e=(0,m.Z)(x().mark((function e(t,n,r){var a,i,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,k.VN)(n.node),i=ae.api.getSession(t.meta.sessionKey),s=i.ttyShell,Object.assign(a.meta,D(D({},t.meta),{},{ppid:t.meta.pid,stack:t.meta.stack.concat(n.key)})),e.next=5,s.spawn(a,{posPositionals:r.slice()});case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"provideProcessApi",value:function(e){var t=this;return{read:function(){var n=(0,m.Z)(x().mark((function n(){var r;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.readOnce(e);case 2:return r=n.sent,n.abrupt("return",null!==r&&void 0!==r&&r.eof?null:r.data);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),sleep:function(t){return new Promise((function(n,r){setTimeout(n,1e3*t),ae.api.addCleanup(e,(function(){return r((0,I.mq)(e))}))}))},provideCtxt:function(n){return t.provideProcessCtxt(e,n)},parseJsArg:this.parseJsArg,poll:function(){var t=(0,Z.Z)(x().mark((function t(n){var r,a,i,s;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=n.length&&parseFloat(K.parseJsonArg(n[0]))||1,a=1e3*Math.max(r,.5),i=new o.BH,ae.api.addCleanup(e,(function(){return i.resolve()})),s=1;case 4:return t.next=7,s++;case 7:return t.next=9,(0,C.Z)(Promise.race([(0,o.wO)(a),i.promise]));case 9:t.next=4;break;case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),pretty:function(e){return(0,o.IC)(JSON.parse((0,o.or)(e)))}}}},{key:"provideProcessCtxt",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=ae.api.getSession(e.sessionKey);return new Proxy({home:r.var},{get:function(r,a){return"api"===a?t.provideProcessApi(e):"args"===a?n:r[a]},deleteProperty:function(e,t){return!1}})}},{key:"readLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,Z.Z)(x().mark((function n(){var r,a,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=ae.api.getProcess(e),void 0!==(a=ae.api.resolve(0,e))){n.next=6;break}return n.abrupt("return");case 6:if(!(a instanceof q&&0!==r.pgid)){n.next=8;break}throw new I.nl("background process tried to read tty",1);case 8:i={};case 9:return n.next=11,(0,C.Z)(a.readData(t));case 11:if((i=n.sent).eof){n.next=21;break}if(void 0===i.data){n.next=17;break}return n.next=15,i;case 15:if(!t){n.next=17;break}return n.abrupt("break",21);case 17:return n.next=19,(0,C.Z)((0,c.g0)(r,a));case 19:n.next=9;break;case 21:case"end":return n.stop()}}),n)})))()}},{key:"readOnce",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n,r,a,i,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!1,r=!1,e.prev=2,i=(0,g.Z)(this.readLoop(t,!0));case 4:return e.next=6,i.next();case 6:if(!(n=!(s=e.sent).done)){e.next=12;break}return o=s.value,e.abrupt("return",o);case 9:n=!1,e.next=4;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(2),r=!0,a=e.t0;case 18:if(e.prev=18,e.prev=19,!n||null==i.return){e.next=23;break}return e.next=23,i.return();case 23:if(e.prev=23,!r){e.next=26;break}throw a;case 26:return e.finish(23);case 27:return e.finish(18);case 28:return e.abrupt("return",{eof:!0});case 29:case"end":return e.stop()}}),e,this,[[2,14,18,28],[19,,23,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseJsonArg",value:function(e){try{return void 0===e?void 0:JSON.parse(e)}catch(t){return e}}},{key:"parseJsArg",value:function(e){try{return Function("return ".concat(e))()}catch(t){return e}}}]),e}());function B(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return V(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){o=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw i}}}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var G,W=new(function(){function e(){(0,v.Z)(this,e)}return(0,y.Z)(e,[{key:"assignVars",value:function(e){var t=this;return(0,Z.Z)(x().mark((function n(){var r,a,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=B(e.Assigns),n.prev=1,r.s();case 3:if((a=r.n()).done){n.next=8;break}return i=a.value,n.delegateYield((0,P.Z)((0,g.Z)(t.Assign(i)),C.Z),"t0",6);case 6:n.next=3;break;case 8:n.next=13;break;case 10:n.prev=10,n.t1=n.catch(1),r.e(n.t1);case 13:return n.prev=13,r.f(),n.finish(13);case 16:case"end":return n.stop()}}),n,null,[[1,10,13,16]])})))()}},{key:"applyRedirects",value:function(){var e=(0,m.Z)(x().mark((function e(t,n){var r,a,i,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=B(n),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=11;break}return(i=a.value).exitCode=0,e.next=9,this.Redirect(i);case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:e.next=25;break;case 21:throw e.prev=21,e.t1=e.catch(0),t.exitCode=null!==(s=null===(o=n.find((function(e){return e.exitCode})))||void 0===o?void 0:o.exitCode)&&void 0!==s?s:1,e.t1;case 25:case"end":return e.stop()}}),e,this,[[0,21],[2,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"expandParameter",value:function(e,t){if(/^\d+$/.test(t))return ae.api.getPositional(e.pid,e.sessionKey,Number(t));var n=ae.api.getVar(e.sessionKey,t);return void 0===n||"string"===typeof n?n||"":_()(n)}},{key:"handleShError",value:function(e,t,n){if(t instanceof I.lw)throw t;if(t instanceof I.nl){var r=[n,t.message].filter(Boolean).join(": ");ae.api.warn(e.meta.sessionKey,r),console.error("ShError: ".concat(e.meta.sessionKey,": ").concat(r)),e.exitCode=t.exitCode}else{var a=[n,null===t||void 0===t?void 0:t.message].filter(Boolean).join(": ");ae.api.warn(e.meta.sessionKey,a),console.error("Internal ShError: ".concat(e.meta.sessionKey,": ").concat(a)),console.error(t),e.exitCode=2}}},{key:"handleTopLevelProcessError",value:function(e){if(e.code===c.KI.SIGKILL){var t=ae.api.getProcess({pid:e.pid,sessionKey:e.sessionKey});if(t)ae.api.getProcesses(e.sessionKey,t.pgid).forEach((function(e){e.status=X.Killed,e.cleanups.forEach((function(e){return e()})),e.cleanups.length=0}))}}},{key:"lastExpanded",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n,r,a,i,s,o,c;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0,r=!1,a=!1,e.prev=3,s=(0,g.Z)(t);case 5:return e.next=7,s.next();case 7:if(!(r=!(o=e.sent).done)){e.next=13;break}c=o.value,n=c;case 10:r=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),a=!0,i=e.t0;case 19:if(e.prev=19,e.prev=20,!r||null==s.return){e.next=24;break}return e.next=24,s.return();case 24:if(e.prev=24,!a){e.next=27;break}throw i;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",n);case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])})));return function(t){return e.apply(this,arguments)}}()},{key:"stmts",value:function(e,t){return(0,Z.Z)(x().mark((function n(){var r,a,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=B(t),n.prev=1,r.s();case 3:if((a=r.n()).done){n.next=9;break}return i=a.value,n.delegateYield((0,P.Z)((0,g.Z)(z.Stmt(i)),C.Z),"t0",6);case 6:e.exitCode=i.exitCode;case 7:n.next=3;break;case 9:n.next=14;break;case 11:n.prev=11,n.t1=n.catch(1),r.e(n.t1);case 14:return n.prev=14,r.f(),n.finish(14);case 17:case"end":return n.stop()}}),n,null,[[1,11,14,17]])})))()}},{key:"performShellExpansion",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n,r,a,i,s,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=B(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=17;break}return i=a.value,e.next=8,this.lastExpanded(this.Expand(i));case 8:if(s=e.sent,o=1===i.Parts.length?i.Parts[0]:null,!i.exitCode){e.next=14;break}throw new I.nl("failed to expand word",i.exitCode);case 14:"SglQuoted"===(null===o||void 0===o?void 0:o.type)?n.push(s.value):"ParamExp"===(null===o||void 0===o?void 0:o.type)||"CmdSubst"===(null===o||void 0===o?void 0:o.type)?(0,I.qz)(s.value).forEach((function(e){return n.push(e)})):s.values.forEach((function(e){return n.push(e)}));case 15:e.next=4;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),r.e(e.t0);case 22:return e.prev=22,r.f(),e.finish(22);case 25:return e.abrupt("return",n);case 26:case"end":return e.stop()}}),e,this,[[2,19,22,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"Assign",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=this,n=e.meta,r=e.Name,a=e.Value,i=e.Naked;return(0,Z.Z)(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=ae.api,e.t1=n.sessionKey,e.t2=r.Value,i||!a){e.next=9;break}return e.next=6,(0,C.Z)(t.lastExpanded(z.Expand(a)));case 6:e.t3=e.sent.value,e.next=10;break;case 9:e.t3="";case 10:e.t4=e.t3,e.t0.setVar.call(e.t0,e.t1,e.t2,e.t4);case 12:case"end":return e.stop()}}),e)})))()}))},{key:"BinaryCmd",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return(0,Z.Z)(x().mark((function t(){var n,r,a,i,s,o,c,u,l,p,h,f,v,y,b,S,Z,O,j;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=w.binaryCmds(e),r=[n[0].X].concat(n.map((function(e){return e.Y}))),t.t0=e.Op,t.next="&&"===t.t0?5:"||"===t.t0?24:"|"===t.t0?43:62;break;case 5:a=B(r),t.prev=6,a.s();case 8:if((i=a.n()).done){t.next=15;break}return s=i.value,t.delegateYield((0,P.Z)((0,g.Z)(z.Stmt(s)),C.Z),"t1",11);case 11:if(!(e.exitCode=s.exitCode)){t.next=13;break}return t.abrupt("break",15);case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t2=t.catch(6),a.e(t.t2);case 20:return t.prev=20,a.f(),t.finish(20);case 23:return t.abrupt("break",63);case 24:o=B(r),t.prev=25,o.s();case 27:if((c=o.n()).done){t.next=34;break}return u=c.value,t.delegateYield((0,P.Z)((0,g.Z)(z.Stmt(u)),C.Z),"t3",30);case 30:if(e.exitCode=u.exitCode){t.next=32;break}return t.abrupt("break",34);case 32:t.next=27;break;case 34:t.next=39;break;case 36:t.prev=36,t.t4=t.catch(25),o.e(t.t4);case 39:return t.prev=39,o.f(),t.finish(39);case 42:return t.abrupt("break",63);case 43:l=[],p=r.map((function(t){var n=(0,k.nL)((0,k.VN)(t));return n.meta.ppid=e.meta.pid,n})),t.prev=45,h=ae.api.getSession(e.meta.sessionKey),f=h.ttyShell,v=B(p.slice(0,-1).entries());try{for(v.s();!(y=v.n()).done;)b=(0,d.Z)(y.value,2),S=b[0],Z=b[1],O="/dev/fifo-".concat(Z.meta.pid,"-").concat(S),l.push(ae.api.createFifo(O)),p[S+1].meta.fd[0]=Z.meta.fd[1]=O}catch(_){v.e(_)}finally{v.f()}return j=p.map((function(e){var t=e.meta;return ae.api.resolve(1,t)})),t.next=52,(0,C.Z)(Promise.all(p.map((function(t,n){return new Promise(function(){var r=(0,m.Z)(x().mark((function r(a,i){var s;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,f.spawn(t);case 3:if(j[n].finishedWriting(),null===(s=j[n-1])||void 0===s||s.finishedReading(),!(e.exitCode=t.exitCode)){r.next=7;break}throw new I.nl("pipe ".concat(n),e.exitCode);case 7:a(),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),i(r.t0);case 13:case"end":return r.stop()}}),r,null,[[0,10]])})));return function(e,t){return r.apply(this,arguments)}}())}))));case 52:t.next=58;break;case 54:throw t.prev=54,t.t5=t.catch(45),p.map((function(e){var t=e.meta;return ae.api.getProcess(t)})).forEach((function(e){return e&&(e.status=X.Killed)})),(0,I.mq)(e.meta);case 58:return t.prev=58,l.forEach((function(e){e.finishedWriting(),ae.api.removeDevice(e.key)})),t.finish(58);case 61:return t.abrupt("break",63);case 62:throw new I.nl("binary command ".concat(e.Op," unsupported"),2);case 63:case"end":return t.stop()}}),t,null,[[6,17,20,23],[25,36,39,42],[45,54,58,61]])})))()}))},{key:"Block",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return this.stmts(e,e.Stmts)}))},{key:"CallExpr",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return(0,Z.Z)(x().mark((function t(){var n,r,a,i,s,o,c,u,l;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.exitCode=0,t.next=3,(0,C.Z)(z.performShellExpansion(e.Args));case 3:if(n=t.sent,r=(0,S.Z)(n),a=r[0],i=r.slice(1),e.meta.verbose&&console.log("simple command",n),!n.length){t.next=49;break}if(!K.isCmd(a)){t.next=11;break}return t.delegateYield((0,P.Z)((0,g.Z)(K.runCmd(e,a,i)),C.Z),"t0",9);case 9:t.next=47;break;case 11:if(!(s=ae.api.getFunc(e.meta.sessionKey,a))){t.next=16;break}return t.next=14,(0,C.Z)(K.launchFunc(e,s,i));case 14:t.next=47;break;case 16:t.prev=16,o=B(n),t.prev=18,o.s();case 20:if((c=o.n()).done){t.next=34;break}if(!(u=c.value).includes("(")){t.next=26;break}return t.delegateYield((0,P.Z)((0,g.Z)(K.get(e,[u])),C.Z),"t1",24);case 24:t.next=32;break;case 26:if(void 0===(l=K.get(e,[u]))[0]){t.next=31;break}return t.delegateYield((0,P.Z)((0,g.Z)(l),C.Z),"t2",29);case 29:t.next=32;break;case 31:throw Error();case 32:t.next=20;break;case 34:t.next=39;break;case 36:t.prev=36,t.t3=t.catch(18),o.e(t.t3);case 39:return t.prev=39,o.f(),t.finish(39);case 42:t.next=47;break;case 44:throw t.prev=44,t.t4=t.catch(16),new I.nl("not found",127);case 47:t.next=50;break;case 49:return t.delegateYield((0,P.Z)((0,g.Z)(z.assignVars(e)),C.Z),"t5",50);case 50:case"end":return t.stop()}}),t,null,[[16,44],[18,36,39,42]])})))()}))},{key:"Command",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){var n=this;return(0,Z.Z)(x().mark((function r(){var a,i,s,o,u,l,p,h,f,d;return x().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,(0,C.Z)(z.applyRedirects(e,t));case 3:if("CallExpr"!==e.type){r.next=7;break}a=n.CallExpr(e),r.next=25;break;case 7:r.t0=e.type,r.next="Block"===r.t0?10:"BinaryCmd"===r.t0?12:"DeclClause"===r.t0?14:"FuncDecl"===r.t0?16:"IfClause"===r.t0?18:"TimeClause"===r.t0?20:"Subshell"===r.t0?22:24;break;case 10:return a=n.Block(e),r.abrupt("break",25);case 12:return a=n.BinaryCmd(e),r.abrupt("break",25);case 14:return a=n.DeclClause(e),r.abrupt("break",25);case 16:return a=n.FuncDecl(e),r.abrupt("break",25);case 18:return a=n.IfClause(e),r.abrupt("break",25);case 20:return a=n.TimeClause(e),r.abrupt("break",25);case 22:return a=n.Subshell(e),r.abrupt("break",25);case 24:throw new I.nl("not implemented",2);case 25:if(i=ae.api.getProcess(e.meta),s=ae.api.resolve(1,e.meta)){r.next=29;break}throw(0,I.mq)(e.meta);case 29:o=!1,u=!1,r.prev=31,p=(0,g.Z)(a);case 33:return r.next=35,(0,C.Z)(p.next());case 35:if(!(o=!(h=r.sent).done)){r.next=44;break}return f=h.value,r.next=39,(0,C.Z)((0,c.pm)(i,s));case 39:return r.next=41,(0,C.Z)(s.writeData(f));case 41:o=!1,r.next=33;break;case 44:r.next=50;break;case 46:r.prev=46,r.t1=r.catch(31),u=!0,l=r.t1;case 50:if(r.prev=50,r.prev=51,!o||null==p.return){r.next=55;break}return r.next=55,(0,C.Z)(p.return());case 55:if(r.prev=55,!u){r.next=58;break}throw l;case 58:return r.finish(55);case 59:return r.finish(50);case 60:r.next=68;break;case 62:r.prev=62,r.t2=r.catch(0),d="CallExpr"===e.type?e.Args[0].string||"unknown CallExpr":e.type,(r.t2 instanceof I.nl?r.t2:new I.nl("",1,r.t2)).message="".concat(e.meta.stack.concat(d).join(": "),": ").concat(r.t2.message||r.t2),z.handleShError(e,r.t2);case 68:case"end":return r.stop()}}),r,null,[[0,62],[31,46,50,60],[51,,55,59]])})))()}))},{key:"DeclClause",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=this;return(0,Z.Z)(x().mark((function n(){var r,a,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("declare"!==e.Variant.Value){n.next=24;break}if(!e.Args.length){n.next=20;break}r=B(e.Args),n.prev=3,r.s();case 5:if((a=r.n()).done){n.next=10;break}return i=a.value,n.delegateYield((0,P.Z)((0,g.Z)(t.Assign(i)),C.Z),"t0",8);case 8:n.next=5;break;case 10:n.next=15;break;case 12:n.prev=12,n.t1=n.catch(3),r.e(n.t1);case 15:return n.prev=15,r.f(),n.finish(15);case 18:n.next=22;break;case 20:return e.exitCode=0,n.delegateYield((0,P.Z)((0,g.Z)(K.runCmd(e,"declare",[])),C.Z),"t2",22);case 22:n.next=25;break;case 24:throw new I.nl("Commmand: DeclClause: ".concat(e.Variant.Value," unsupported"),2);case 25:case"end":return n.stop()}}),n,null,[[3,12,15,18]])})))()}))},{key:"Expand",value:function(e){var t=this;return(0,Z.Z)(x().mark((function n(){var r,i,s,c,u,l,p,h,f,d,m,v,y,b,k;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.Parts.length>1)){n.next=45;break}r=B(e.Parts),n.prev=2,r.s();case 4:if((i=r.n()).done){n.next=11;break}return s=i.value,n.next=8,(0,C.Z)(t.lastExpanded(z.ExpandPart(s)));case 8:s.string=n.sent.value;case 9:n.next=4;break;case 11:n.next=16;break;case 13:n.prev=13,n.t0=n.catch(2),r.e(n.t0);case 16:return n.prev=16,r.f(),n.finish(16);case 19:c=!1,u=[],l=B(e.Parts),n.prev=22,h=function(){var e=p.value,t=e.string,n="Lit"===e.type&&e.braceExp;if("ParamExp"===e.type||"CmdSubst"===e.type){var r=(0,I.qz)(t,!1);if(!r.length)return"continue";!u.length||c||r[0].startsWith(" ")?u.push.apply(u,(0,a.Z)(r.map((function(e){return e.trim()})))):(0,o.Z$)(u)instanceof Array?(u.push(u.pop().map((function(e){return"".concat(e).concat(r[0].trim())}))),u.push.apply(u,(0,a.Z)(r.slice(1).map((function(e){return e.trim()}))))):(u.push(u.pop()+r[0].trim()),u.push.apply(u,(0,a.Z)(r.slice(1).map((function(e){return e.trim()}))))),c=(0,o.Z$)(r).endsWith(" ")}else if(!u.length||c)u.push(n?t.split(" "):t),c=!1;else if((0,o.Z$)(u)instanceof Array)u.push(n?u.pop().flatMap((function(e){return t.split(" ").map((function(t){return"".concat(e).concat(t)}))})):u.pop().map((function(e){return"".concat(e).concat(t)}))),c=!1;else if(n){var i=u.pop();u.push(t.split(" ").map((function(e){return"".concat(i).concat(e)}))),c=!1}else u.push(u.pop()+t),c=!1},l.s();case 25:if((p=l.n()).done){n.next=31;break}if("continue"!==h()){n.next=29;break}return n.abrupt("continue",29);case 29:n.next=25;break;case 31:n.next=36;break;case 33:n.prev=33,n.t1=n.catch(22),l.e(n.t1);case 36:return n.prev=36,l.f(),n.finish(36);case 39:return f=u.flatMap((function(e){return e})),e.string=f.join(" "),n.next=43,(0,I.jn)(f);case 43:n.next=75;break;case 45:d=!1,m=!1,n.prev=47,y=(0,g.Z)(t.ExpandPart(e.Parts[0]));case 49:return n.next=51,(0,C.Z)(y.next());case 51:if(!(d=!(b=n.sent).done)){n.next=59;break}return k=b.value,e.string=k.value,n.next=56,k;case 56:d=!1,n.next=49;break;case 59:n.next=65;break;case 61:n.prev=61,n.t2=n.catch(47),m=!0,v=n.t2;case 65:if(n.prev=65,n.prev=66,!d||null==y.return){n.next=70;break}return n.next=70,(0,C.Z)(y.return());case 70:if(n.prev=70,!m){n.next=73;break}throw v;case 73:return n.finish(70);case 74:return n.finish(65);case 75:case"end":return n.stop()}}),n,null,[[2,13,16,19],[22,33,36,39],[47,61,65,75],[66,,70,74]])})))()}},{key:"ExpandPart",value:function(e){var t=this;return(0,Z.Z)(x().mark((function n(){var r,i,s,o,c,u,l,p,h,f,d;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e.type,n.next="DblQuoted"===n.t0?3:"Lit"===n.t0?26:"SglQuoted"===n.t0?31:"CmdSubst"===n.t0?34:"ParamExp"===n.t0?48:("ArithmExp"===n.t0||"ExtGlob"===n.t0||n.t0,50);break;case 3:r=[],i=B(e.Parts),n.prev=5,i.s();case 7:if((s=i.n()).done){n.next=15;break}return o=s.value,n.next=11,(0,C.Z)(t.lastExpanded(z.ExpandPart(o)));case 11:c=n.sent,"ParamExp"===o.type&&"@"===o.Param.Value?r.push.apply(r,["".concat(r.pop()||"").concat(c.values[0]||"")].concat((0,a.Z)(c.values.slice(1)))):r.push("".concat(r.pop()||"").concat(c.value||""));case 13:n.next=7;break;case 15:n.next=20;break;case 17:n.prev=17,n.t1=n.catch(5),i.e(n.t1);case 20:return n.prev=20,i.f(),n.finish(20);case 23:return n.next=25,(0,I.jn)(r);case 25:return n.abrupt("return");case 26:return(u=(0,I.i0)(e)).length>1&&Object.assign(e,{braceExp:!0}),n.next=30,(0,I.jn)(u);case 30:return n.abrupt("break",51);case 31:return n.next=33,(0,I.jn)((0,I.Rk)(e));case 33:return n.abrupt("break",51);case 34:return l=(0,k.nL)((0,k.VN)(e)),p="/dev/fifo-cmd-".concat((0,O.x0)()),h=ae.api.createFifo(p),l.meta.fd[1]=h.key,f=ae.api.getSession(e.meta.sessionKey),d=f.ttyShell,n.next=41,(0,C.Z)(d.spawn(l));case 41:return n.prev=41,n.next=44,(0,I.jn)(h.readAll().map((function(e){return"string"===typeof e?e:_()(e)})).join("\n").replace(/\n*$/,""));case 44:return n.prev=44,ae.api.removeDevice(h.key),n.finish(44);case 47:return n.abrupt("break",51);case 48:return n.delegateYield((0,P.Z)((0,g.Z)(t.ParamExp(e)),C.Z),"t2",49);case 49:return n.abrupt("return");case 50:throw Error("".concat(e.type," unimplemented"));case 51:case"end":return n.stop()}}),n,null,[[5,17,20,23],[41,,44,47]])})))()}},{key:"File",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return z.stmts(e,e.Stmts)}))},{key:"FuncDecl",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return(0,Z.Z)(x().mark((function t(){var n,r;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(0,k.VN)(e.Body),r=(0,k.nL)(n),ae.api.addFunc(e.meta.sessionKey,e.Name.Value,r);case 3:case"end":return t.stop()}}),t)})))()}))},{key:"IfClause",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return(0,Z.Z)(x().mark((function t(){var n,r,a,i,s,c,u;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=B((0,k.Wc)(e)),t.prev=1,n.s();case 3:if((r=n.n()).done){t.next=18;break}if(a=r.value,i=a.Cond,s=a.Then,!i.length){t.next=13;break}return t.delegateYield((0,P.Z)((0,g.Z)(z.stmts(e,i)),C.Z),"t0",7);case 7:if(0!==(0,o.Z$)(i).exitCode){t.next=11;break}return t.delegateYield((0,P.Z)((0,g.Z)(z.stmts(e,s)),C.Z),"t1",9);case 9:return e.exitCode=(null===(c=(0,o.Z$)(s))||void 0===c?void 0:c.exitCode)||0,t.abrupt("return");case 11:t.next=16;break;case 13:return t.delegateYield((0,P.Z)((0,g.Z)(z.stmts(e,s)),C.Z),"t2",14);case 14:return e.exitCode=(null===(u=(0,o.Z$)(s))||void 0===u?void 0:u.exitCode)||0,t.abrupt("return");case 16:t.next=3;break;case 18:t.next=23;break;case 20:t.prev=20,t.t3=t.catch(1),n.e(t.t3);case 23:return t.prev=23,n.f(),t.finish(23);case 26:case"end":return t.stop()}}),t,null,[[1,20,23,26]])})))()}))},{key:"ParamExp",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=this,n=e.meta,r=e.Param,a=e.Slice,i=e.Repl,s=e.Length,o=e.Excl,c=e.Exp;return(0,Z.Z)(x().mark((function e(){var u;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o||s||i||a)){e.next=4;break}throw new I.nl("ParamExp: ".concat(r.Value,": unsupported operation"),2);case 4:if(!c){e.next=22;break}e.t0=c.Op,e.next=":-"===e.t0?8:19;break;case 8:if(""!==(u=t.expandParameter(n,r.Value))||!c.Word){e.next=15;break}return e.next=12,(0,C.Z)(t.lastExpanded(t.Expand(c.Word)));case 12:e.t1=e.sent,e.next=16;break;case 15:e.t1=(0,I.jn)(u);case 16:return e.next=18,e.t1;case 18:return e.abrupt("break",20);case 19:throw new I.nl("ParamExp: ".concat(r.Value,": unsupported operation"),2);case 20:e.next=29;break;case 22:if("@"!==r.Value){e.next=27;break}return e.next=25,(0,I.jn)(ae.api.getProcess(n).positionals.slice(1));case 25:e.next=29;break;case 27:return e.next=29,(0,I.jn)(t.expandParameter(n,r.Value));case 29:case"end":return e.stop()}}),e)})))()}))},{key:"Redirect",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=(0,m.Z)(x().mark((function e(t){var n,r,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(">"!==t.Op&&">>"!==t.Op){e.next=11;break}return e.next=3,this.lastExpanded(z.Expand(t.Word));case 3:if(n=e.sent,"/dev/null"!==(r=n.value)){e.next=9;break}return e.abrupt("return",(0,c.z)(t.parent,{1:"/dev/null"}));case 9:return a=ae.api.createVarDevice(t.meta.sessionKey,r,">"===t.Op?"last":"array"),e.abrupt("return",(0,c.z)(t.parent,{1:a.key}));case 11:throw new I.nl("".concat(t.Op,": unsupported redirect"),127);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}())},{key:"Stmt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=this;return(0,Z.Z)(x().mark((function n(){var r,a,i;return x().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.Cmd){n.next=4;break}throw new I.nl("pure redirects are unsupported",2);case 4:if(!e.Background||0!==e.meta.pgid){n.next=13;break}r=ae.api.getSession(e.meta.sessionKey),a=r.ttyShell,(i=(0,k.nL)((0,k.VN)(e))).meta.ppid=e.meta.pid,i.meta.pgid=ae.api.getSession(e.meta.sessionKey).nextPid,a.spawn(i).catch((function(e){e instanceof I.lw?t.handleTopLevelProcessError(e):console.error("background process error",e)})),e.exitCode=e.Negated?1:0,n.next=16;break;case 13:return n.delegateYield((0,P.Z)((0,g.Z)(z.Command(e.Cmd,e.Redirs)),C.Z),"t0",14);case 14:e.exitCode=e.Cmd.exitCode,e.Negated&&(e.exitCode=1-Number(!!e.Cmd.exitCode));case 16:case"end":return n.stop()}}),n)})))()}))},{key:"Subshell",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return(0,Z.Z)(x().mark((function t(){var n,r,a;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,k.nL)((0,k.VN)(e)),r=ae.api.getSession(e.meta.sessionKey),a=r.ttyShell,t.next=4,(0,C.Z)(a.spawn(n));case 4:case"end":return t.stop()}}),t)})))()}))},{key:"TimeClause",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return(0,Z.Z)(x().mark((function t(){var n;return x().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Date.now(),!e.Stmt){t.next=3;break}return t.delegateYield((0,P.Z)((0,g.Z)(z.Stmt(e.Stmt)),C.Z),"t0",3);case 3:ae.api.resolve(1,e.meta).writeData("real\t".concat(Date.now()-n,"ms"));case 4:case"end":return t.stop()}}),t)})))()}))}]),e}()),z=W,F={expr:'run \'({ api, args }) {\n  const input = args.join(" ")\n  yield api.parseJsArg(input)\n}\' "$@"',call:"run '({ args, api }) {\n  const func = Function(`return ${args[0]}`)()\n  yield await func(api.provideCtxt(args.slice(1)))\n}' \"$@\"",filter:"run '(ctxt) {\n  let { api, args, datum } = ctxt\n  const func = Function(`return ${args[0]}`)()\n  while ((datum = await api.read()) !== null)\n    if (func(datum, ctxt)) yield datum\n}' \"$@\"",map:"run '(ctxt) {\n  let { api, args, datum } = ctxt\n  const func = Function(`return ${args[0]}`)()\n  while ((datum = await api.read()) !== null)\n    yield func(datum, ctxt)\n}' \"$@\"",poll:"run '({ api, args }) {\n  yield* api.poll(args)\n}' \"$@\"",reduce:"run '({ api, args }) {\n    const inputs = []\n    const reducer = Function(`return ${args[0]}`)()\n    while ((datum = await api.read()) !== null)\n      inputs.push(datum)\n    yield args[1]\n      ? inputs.reduce(reducer, api.parseJsArg(args[1]))\n      : inputs.reduce(reducer)\n  }' \"$@\"",split:'run \'({ api, args }) {\n    const arg = args[0] || ""\n    while ((datum = await api.read()) !== null) {\n      if (datum instanceof Array) {\n        // yield* datum\n        yield { __chunk__: true, items: datum };\n      } else if (typeof datum === "string") {\n        // yield* datum.split(arg)\n        yield { __chunk__: true, items: datum.split(arg) };\n      }\n    }\n  }\' "$@"',sponge:"run '({ api }) {\n    const outputs = []\n    while ((datum = await api.read()) !== null)\n      outputs.push(datum)\n    yield outputs\n  }'",range:"{\ncall '({args}) =>\n  [...Array(Number(args[0]))].map((_, i) => i)\n' \"$1\"\n}",seq:'{\n  range "$1" | split\n}',pretty:"{\n  map '(x, { api }) => api.pretty(x)'\n}",keys:"{\n  map Object.keys\n}",log:"{\n  map 'x => console.log(x)'\n}"},J={},q=("\n\n".concat("\nfoo | bar | baz &\n".trim(),"\n\n").trim(),function(){function e(t,n,a){(0,v.Z)(this,e),this.sessionKey=t,this.io=n,this.history=a,(0,r.Z)(this,"key",void 0),(0,r.Z)(this,"xterm",void 0),(0,r.Z)(this,"inputs",[]),(0,r.Z)(this,"input",null),(0,r.Z)(this,"buffer",[]),(0,r.Z)(this,"maxLines",500),(0,r.Z)(this,"process",void 0),(0,r.Z)(this,"oneTimeReaders",[]),this.key="/dev/tty-".concat(t)}return(0,y.Z)(e,[{key:"initialise",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n,r,a,i,s;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.xterm=t,this.io.read(this.onMessage.bind(this)),ae.api.createProcess({sessionKey:this.sessionKey,ppid:0,pgid:0,src:""}),this.process=ae.api.getSession(this.sessionKey).process[0],$.parse){e.next=7;break}return e.next=7,new Promise((function(e){return H.push(e)}));case 7:for(this.loadShellFuncs(F),n=0,r=Object.entries(J);n<r.length;n++)a=(0,d.Z)(r[n],2),i=a[0],s=a[1],ae.api.setVar(this.sessionKey,i,s);return e.next=11,this.runProfile();case 11:this.prompt("$");case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onMessage",value:function(e){var t=this;switch(e.key){case"req-history-line":var n=this.getHistoryLine(e.historyIndex),r=n.line,a=n.nextIndex;this.io.write({key:"send-history-line",line:r,nextIndex:a});break;case"send-line":this.oneTimeReaders.length?(this.oneTimeReaders.shift().resolve(e.line),this.io.write({key:"tty-received-line"})):(this.inputs.push({line:e.line,resolve:function(){return t.io.write({key:"tty-received-line"})}}),this.tryParse());break;case"send-kill-sig":this.buffer.length=0,this.oneTimeReaders.forEach((function(e){return(0,e.reject)()})),this.oneTimeReaders.length=0,this.process.status!==X.Running?this.prompt("$"):W.handleTopLevelProcessError(new I.lw(c.KI.SIGKILL,0,this.sessionKey));break;default:throw(0,o.Ql)(e)}}},{key:"spawn",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n,r,a,i,s,o,c,u,l,p,h,f,d=arguments;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=d.length>1&&void 0!==d[1]?d[1]:{},r=t.meta,n.leading?(this.process.status=X.Running,this.process.onResume=null):(a=r.ppid,i=r.pgid,s=ae.api.getProcess(r),o=s.positionals,c=ae.api.createProcess({ppid:a,pgid:i,sessionKey:r.sessionKey,src:w.src(t),posPositionals:n.posPositionals||o.slice(1)}),r.pid=c.key),e.prev=3,u=!1,l=!1,e.prev=6,h=(0,g.Z)(W.File(t));case 8:return e.next=10,h.next();case 10:if(!(u=!(f=e.sent).done)){e.next=16;break}f.value;case 13:u=!1,e.next=8;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(6),l=!0,p=e.t0;case 22:if(e.prev=22,e.prev=23,!u||null==h.return){e.next=27;break}return e.next=27,h.return();case 27:if(e.prev=27,!l){e.next=30;break}throw p;case 30:return e.finish(27);case 31:return e.finish(22);case 32:t.meta.verbose&&console.warn("".concat(r.sessionKey).concat(r.pgid?" (background)":"",": ").concat(r.pid,": exit ").concat(t.exitCode)),e.next=39;break;case 35:throw e.prev=35,e.t1=e.catch(3),e.t1 instanceof I.lw&&console.error("".concat(r.sessionKey).concat(r.pgid?" (background)":"",": ").concat(r.pid,": ").concat(e.t1.code)),e.t1;case 39:return e.prev=39,!n.leading&&ae.api.removeProcess(r.pid,this.sessionKey),e.finish(39);case 42:case"end":return e.stop()}}),e,this,[[3,35,39,42],[6,18,22,32],[23,,27,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"tryParse",value:function(){var e=(0,m.Z)(x().mark((function e(){var t,n,r,a;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.input=this.inputs.pop()||null,this.input){e.next=3;break}return e.abrupt("return");case 3:e.prev=3,this.buffer.push(this.input.line),t=$.tryParseBuffer(this.buffer.slice()),e.t0=t.key,e.next="failed"===e.t0?9:"complete"===e.t0?15:"incomplete"===e.t0?24:26;break;case 9:return n="mvdan-sh: ".concat(t.error.replace(/^src\.sh:/,"")),console.error(n),this.io.write({key:"error",msg:n}),this.buffer.length=0,this.prompt("$"),e.abrupt("break",26);case 15:return this.buffer.length=0,(r=w.src(t.parsed))&&this.storeSrcLine(r),this.process.src=r,this.provideContextToParsed(t.parsed),e.next=22,this.spawn(t.parsed,{leading:!0});case 22:return this.prompt("$"),e.abrupt("break",26);case 24:return this.prompt(">"),e.abrupt("break",26);case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(3),e.t1 instanceof I.lw?W.handleTopLevelProcessError(e.t1):console.error("unexpected error propagated to tty.shell",e.t1),this.prompt("$");case 32:return e.prev=32,null===(a=this.input)||void 0===a||a.resolve(),this.input=null,this.process.status=X.Suspended,e.finish(32);case 37:case"end":return e.stop()}}),e,this,[[3,28,32,37]])})));return function(){return e.apply(this,arguments)}}()},{key:"prompt",value:function(e){this.io.write({key:"send-xterm-prompt",prompt:"".concat(e," ")})}},{key:"loadShellFuncs",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=(0,d.Z)(n[t],2),a=r[0],i=r[1];try{var s=$.parse("".concat(a," () ").concat(i.trim())).Stmts[0].Cmd.Body,o=(0,k.nL)(s);ae.api.addFunc(this.sessionKey,a,o)}catch(c){console.error("Failed to load function: ".concat(a)),console.error(c)}}}},{key:"runProfile",value:function(){var e=(0,m.Z)(x().mark((function e(){var t,n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=ae.api.getVar(this.sessionKey,"PROFILE")||"",n=$.parse(t),this.provideContextToParsed(n),e.next=5,this.spawn(n,{leading:!0});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"provideContextToParsed",value:function(e){Object.assign(e.meta,{sessionKey:this.sessionKey,pid:0,ppid:0,pgid:0,fd:{0:this.key,1:this.key,2:this.key},stack:[],verbose:!1})}},{key:"getHistoryLine",value:function(e){var t=this.history.length-1;return{line:this.history[t-e]||"",nextIndex:e<0?0:e>t?t:e}}},{key:"getHistory",value:function(){return this.history.slice()}},{key:"storeSrcLine",value:function(e){var t=this.history.pop();if(t&&this.history.push(t),t!==e){for(this.history.push(e);this.history.length>this.maxLines;)this.history.shift();ae.api.persist(this.sessionKey)}}},{key:"readData",value:function(){var e=(0,m.Z)(x().mark((function e(){var t=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,n){var r;t.oneTimeReaders.push({resolve:function(t){return e({data:t})},reject:n}),null===(r=t.input)||void 0===r||r.resolve(),t.input=null}));case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",{eof:!0});case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeData",value:function(){var e=(0,m.Z)(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.io.write(t);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finishedWriting",value:function(){}},{key:"finishedReading",value:function(){}}]),e}()),$={tryParseBuffer:function(e){return{key:"failed",error:"not ready"}}},H=[];Promise.all([n.e(763),n.e(474)]).then(n.bind(n,80557)).then((function(e){$=e.parseService,H.forEach((function(e){return e()})),H.length=0})),function(e){e[e.Initial=0]="Initial",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected"}(G||(G={}));var X,U=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;(0,v.Z)(this,e),this.key=t,this.size=n,(0,r.Z)(this,"buffer",void 0),(0,r.Z)(this,"readerStatus",G.Initial),(0,r.Z)(this,"writerStatus",G.Initial),(0,r.Z)(this,"readerResolver",null),(0,r.Z)(this,"writerResolver",null),this.buffer=[]}return(0,y.Z)(e,[{key:"readData",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n,r=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.readerStatus=this.readerStatus||G.Connected,!this.buffer.length){e.next=17;break}if(null===(n=this.writerResolver)||void 0===n||n.call(this),this.writerResolver=null,!t){e.next=14;break}if((0,c.jO)(this.buffer[0])){e.next=9;break}return e.abrupt("return",{data:this.buffer.shift()});case 9:if(1!==this.buffer[0].items.length){e.next=11;break}return e.abrupt("return",{data:this.buffer.shift().items[0]});case 11:return e.abrupt("return",{data:this.buffer[0].items.shift()});case 14:return e.abrupt("return",{data:this.buffer.shift()});case 15:e.next=19;break;case 17:if(this.writerStatus!==G.Disconnected){e.next=19;break}return e.abrupt("return",{eof:!0});case 19:return e.abrupt("return",new Promise((function(e){r.readerResolver=e})).then((function(){return{data:void 0}})));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeData",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n,r=this;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.writerStatus=G.Connected,this.readerStatus!==G.Disconnected){e.next=4;break}return this.buffer.length=0,e.abrupt("return");case 4:if(this.buffer.push(t),null===(n=this.readerResolver)||void 0===n||n.call(this),this.readerResolver=null,!(this.buffer.length>=this.size)){e.next=9;break}return e.abrupt("return",new Promise((function(e){r.writerResolver=e})));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finishedReading",value:function(e){var t;if(e)return this.readerStatus===G.Disconnected;this.readerStatus=G.Disconnected,null===(t=this.writerResolver)||void 0===t||t.call(this),this.writerResolver=null}},{key:"finishedWriting",value:function(e){var t;if(e)return this.writerStatus===G.Disconnected;this.writerStatus=G.Disconnected,null===(t=this.readerResolver)||void 0===t||t.call(this),this.readerResolver=null}},{key:"readAll",value:function(){var e=[];return this.buffer.forEach((function(t){(0,c.jO)(t)?t.items.forEach((function(t){return e.push(t)})):e.push(t)})),this.buffer.length=0,e}}]),e}(),Y=function(){function e(t,n,a){(0,v.Z)(this,e),this.sessionKey=t,this.varPath=n,this.mode=a,(0,r.Z)(this,"key",void 0),(0,r.Z)(this,"buffer",void 0),this.key="".concat(n,"@").concat(t),this.buffer=null}return(0,y.Z)(e,[{key:"writeData",value:function(){var e=(0,m.Z)(x().mark((function e(t){var n;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("array"!==this.mode){e.next=9;break}if(this.buffer||(this.buffer=ae.api.getVarDeep(this.sessionKey,this.varPath),Array.isArray(this.buffer)||ae.api.setVarDeep(this.sessionKey,this.varPath,this.buffer=[])),void 0!==t){e.next=6;break}return e.abrupt("return");case 6:(0,c.jO)(t)?(n=this.buffer).push.apply(n,(0,a.Z)(t.items)):this.buffer.push(t);case 7:e.next=14;break;case 9:if(void 0!==t){e.next=13;break}return e.abrupt("return");case 13:(0,c.jO)(t)?ae.api.setVarDeep(this.sessionKey,this.varPath,(0,o.Z$)(t.items)):ae.api.setVarDeep(this.sessionKey,this.varPath,t);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readData",value:function(){var e=(0,m.Z)(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{eof:!0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"finishedReading",value:function(){}},{key:"finishedWriting",value:function(){}}]),e}(),Q=function(){function e(t){(0,v.Z)(this,e),this.key=t}return(0,y.Z)(e,[{key:"writeData",value:function(){var e=(0,m.Z)(x().mark((function e(t){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"readData",value:function(){var e=(0,m.Z)(x().mark((function e(){return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{eof:!0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"finishedReading",value:function(){}},{key:"finishedWriting",value:function(){}}]),e}();function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){(0,r.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e[e.Suspended=0]="Suspended",e[e.Running=1]="Running",e[e.Killed=2]="Killed"}(X||(X={}));var ne=(0,i.Z)((0,s.mW)((function(e,t){return{device:{},session:{},persist:{},rehydrated:!1,api:{addCleanup:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=re.getProcess(e).cleanups).push.apply(t,r)},addFunc:function(e,t,n){re.getSession(e).func[t]={key:t,node:n,src:w.multilineSrc(n)}},createFifo:function(e,n){var r=new U(e,n);return t().device[r.key]=r},createProcess:function(e){var n=e.sessionKey,r=e.ppid,i=e.pgid,s=e.src,o=e.posPositionals,c=t().api.getNextPid(n),u=t().api.getSession(n).process;return u[c]={key:c,ppid:r,pgid:i,sessionKey:n,status:X.Running,src:s,positionals:["jsh"].concat((0,a.Z)(o||[])),cleanups:[],onSuspend:null,onResume:null},u[c]},createSession:function(n,a){var i=re.rehydrate(n),s=(0,c.OF)(),u=new q(n,s,i.history||[]);return t().device[u.key]=u,t().device["/dev/null"]=new Q("/dev/null"),e((function(e){var t,c,l=e.session;return{session:(t={key:n,func:{},nextPid:0,process:{},ttyIo:s,ttyShell:u,var:te(te({PWD:"",OLDPWD:""},i.var),(0,o.I8)(a))},c=l,h(h({},c),{},(0,r.Z)({},t.key,t)))}})),t().session[n]},createVarDevice:function(e,n,r){var a=new Y(e,n,r);return t().device[a.key]=a},ensureSession:function(e,n){var r=t().session;return r[e]=r[e]||t().api.createSession(e,n)},getFunc:function(e,n){return t().session[e].func[n]||void 0},getFuncs:function(e){return Object.values(t().session[e].func)},getNextPid:function(e){return t().session[e].nextPid++},getPositional:function(e,n,r){return t().session[n].process[e].positionals[r]||""},getProcess:function(e){var n=e.pid,r=e.sessionKey;return t().session[r].process[n]},getProcesses:function(e,n){var r=Object.values(t().session[e].process);return void 0===n?r:r.filter((function(e){return e.pgid===n}))},getVar:function(e,n){return t().session[e].var[n]},getVarDeep:function(e,n){var r=t().session[e].var;return Function("__","return __.".concat(n))(r)},getSession:function(e){return t().session[e]},persist:function(e){var t=re.getSession(e),n=t.ttyShell,r=t.var;localStorage.setItem("history@session-".concat(e),JSON.stringify(n.getHistory())),localStorage.setItem("var@session-".concat(e),JSON.stringify((0,o.Q8)(r,(function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){}}))))},rehydrate:function(e){return{history:JSON.parse(localStorage.getItem("history@session-".concat(e))||"null"),var:JSON.parse(localStorage.getItem("var@session-".concat(e))||"null")}},removeDevice:function(e){delete t().device[e]},removeProcess:function(e,n){delete t().session[n].process[e]},removeSession:function(n){for(var r=t().session[n],a=r.process,i=r.ttyShell,s=0,o=Object.values(a);s<o.length;s++){var c=o[s].cleanups;c.forEach((function(e){return e()})),c.length=0}delete t().device[i.key],e((function(e){var t=e.session;return{session:f(n,t)}}))},resolve:function(e,n){return t().device[n.fd[e]]},setVar:function(e,t,n){re.getSession(e).var[t]=n},setVarDeep:function(e,t,n){var r={home:re.getSession(e).var},a=re.getVar(e,"PWD"),i=(0,I.$R)(t,r,a);if(!("home"===i[0]&&i.length>1))throw new I.nl("only the home directory is writable",1);var s=i.pop();try{(0,I.Hn)(i,r)[s]=n}catch(o){throw new I.nl("cannot resolve /".concat(i.join("/")),1)}},warn:function(e,t){re.getSession(e).ttyIo.write({key:"error",msg:t})}}}}),"session")),re=ne.getState().api,ae=Object.assign(ne,{api:re})},11455:function(e,t,n){var r=n(14671),a=n(38597),i=(0,r.Z)((0,a.mW)((function(e,t){return{articleKey:null,lastNavKey:null,articles:{},tabs:{},api:{updateArticleKey:function(){var n=Object.values(t().articles).find((function(e){return window.scrollY<e.rect.bottom}));n&&n.key!==t().articleKey&&e({articleKey:n.key})}}}}),"site")),s=i.getState().api,o=Object.assign(i,{api:s});t.Z=o}}]);