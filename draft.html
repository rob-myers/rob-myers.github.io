<!DOCTYPE html><html lang="en"><head><meta name="description" content="A Game AI focused roguelike, built blog by blog." /><link rel="icon" href="/favicon.ico" /><style id="_goober"> .go3698606907{font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;}@media(max-width: 800px){.go3698606907{padding-left:8px;margin-top:16px;border-bottom:2px solid #999;}}.go3698606907 h1{font-size:6rem;font-weight:300;cursor:pointer;color:#333;margin:0;}@media(max-width: 800px){.go3698606907 h1{font-size:5rem;}}@media(max-width: 600px){.go3698606907 h1{font-size:3rem;}}.go3698606907 p{color:#444;letter-spacing:2px;font-size:1.4rem;margin:0;padding:40px 0 48px;font-weight:300;}@media(max-width: 800px){.go3698606907 p{font-size:1rem;padding:20px 0 20px;color:#222;}}.go3169236000{padding:48px 64px;}@media(max-width: 1024px){.go3169236000{padding:32px 64px;margin:0;}}@media(max-width: 800px){.go3169236000{padding:0;}}.go396156490{margin:0;border-color:var(--focus-bg);}@media(min-width: 800px){.go396156490{padding-bottom:64px;border:0;}}.go3973914776{font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;}.go3973914776 > .top-right{position:absolute;right:0;top:2px;z-index:10;padding:2px 8px;cursor:pointer;background:#333;color:#fff;border-radius:4px 4px 0 0;font-size:1rem;}.go3973914776 > .central{position:absolute;z-index:10;left:calc(50% - 56px);top:calc(50% - 20px);cursor:pointer;color:#ddd;background:#000;padding:12px 32px;border-radius:4px;border:1px solid #ddd;font-size:1.2rem;opacity:1;transition:300ms opacity ease;}.go3973914776 > .central.enabled{opacity:0;}.go118039706{position:absolute;z-index:5;width:inherit;height:inherit;background:#000;font-family:sans-serif;opacity:1;transition:opacity 1s ease-in;}.go118039706:not(.faded){pointer-events:none;}.go118039706.clear{opacity:0;transition:opacity 0.5s ease-in;}.go118039706.faded{opacity:0.5;transition:opacity 0.5s ease-in;}.go3065236821{line-height:1.55;font-size:1.2rem;background:var(--focus-bg);padding:48px 96px 96px 96px;border:var(--blog-border-width) solid var(--border-bg);position:relative;}@media(max-width: 800px){.go3065236821{padding:8px 12px;font-size:1.1rem;border:none;}}.go3065236821 aside{margin:32px 0;padding:0 32px;border-radius:8px;border:2px dashed #ccc;font-size:1.1rem;}@media(max-width: 800px){.go3065236821 aside{margin:8px 0;padding:16px 16px;}}.go3065236821 aside > figure.tabs{padding:8px 0 24px;}@media(max-width: 800px){.go3065236821 aside > figure.tabs{padding:8px 0 12px;}}.go3065236821 figure{margin:0;}.go3065236821 > figure.tabs{border:10px solid #333;border-radius:8px 8px 0 0;margin:48px 24px 48px 0;}@media(max-width: 800px){.go3065236821 > figure.tabs{margin:32px 0;border:5px solid #333;}}.go3065236821 > time{position:absolute;right:-10px;top:-50px;background:var(--border-bg);color:#555;border-radius:6px 6px 0 0;padding:12px;font-size:1rem;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;}@media(max-width: 800px){.go3065236821 > time{top:16px;right:0;border-radius:0 0 0 4px;background:none;font-size:1.1rem;}}.go3065236821 h1,.go3065236821  h2,.go3065236821  h3,.go3065236821  h4{font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;font-weight:400;}.go3065236821 h2{font-size:2.4rem;}@media(max-width: 800px){.go3065236821 h2{margin:16px 0 0 0;font-size:1.8rem;}}.go3065236821 h3{font-size:1.6rem;}@media(max-width: 800px){.go3065236821 h3{font-size:1.3em;}}.go3065236821 a code{color:unset;}.go3065236821 blockquote{margin:32px 40px;}@media(max-width: 800px){.go3065236821 blockquote{margin:20px 0 20px 16px;}}.go3065236821 code{font-family:sans-serif;letter-spacing:1px;color:#444;}.go3065236821 table{padding:8px;border:1px solid #bbb;width:100%;}@media(min-width: 800px){.go3065236821 table{margin:32px 0;}}.go3065236821 table th,.go3065236821 table  td{text-align:left;vertical-align:top;padding:8px;}@media(max-width: 540px){.go3065236821 table th,.go3065236821 table  td{padding:4px 2px;}}@media(max-width: 800px){.go3065236821 ul,.go3065236821  ol{padding-left:20px;}}.go3065236821 ul + p,.go3065236821  ol + p{padding-top:6px;}.go3065236821 ul li,.go3065236821  ol li{margin:4px 0;}.go1506804081{background:var(--focus-bg);}@keyframes fadein{from{opacity:0;}to{opacity:1;}}.go1506804081 .flexlayout__tabset{animation:fadein 1s;}.go1506804081 .flexlayout__tabset,.go1506804081  .flexlayout__tab{background:white;}.go1506804081 > .flexlayout__layout{background:#444;position:relative;height:400px;}.go1506804081 .flexlayout__tab{border-top:6px solid #444;position:relative;overflow:hidden;}.go1506804081 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go1506804081 .flexlayout__tab_button--selected,.go1506804081  .flexlayout__tab_button:hover{background:#444;}.go1506804081 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go1506804081 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go1506804081 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go1506804081 .flexlayout__splitter_vert,.go1506804081  .flexlayout__splitter_horz{background:#827575;}.go3574057674{width:100%;height:400px;position:relative;}.go4204185124{background:var(--focus-bg);}@keyframes fadein{from{opacity:0;}to{opacity:1;}}.go4204185124 .flexlayout__tabset{animation:fadein 1s;}.go4204185124 .flexlayout__tabset,.go4204185124  .flexlayout__tab{background:white;}.go4204185124 > .flexlayout__layout{background:#444;position:relative;height:300px;}.go4204185124 .flexlayout__tab{border-top:6px solid #444;position:relative;overflow:hidden;}.go4204185124 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go4204185124 .flexlayout__tab_button--selected,.go4204185124  .flexlayout__tab_button:hover{background:#444;}.go4204185124 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go4204185124 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go4204185124 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go4204185124 .flexlayout__splitter_vert,.go4204185124  .flexlayout__splitter_horz{background:#827575;}.go3944991801{width:100%;height:300px;position:relative;}.go4097358152{background:var(--focus-bg);}@keyframes fadein{from{opacity:0;}to{opacity:1;}}.go4097358152 .flexlayout__tabset{animation:fadein 1s;}.go4097358152 .flexlayout__tabset,.go4097358152  .flexlayout__tab{background:white;}.go4097358152 > .flexlayout__layout{background:#444;position:relative;height:340px;}.go4097358152 .flexlayout__tab{border-top:6px solid #444;position:relative;overflow:hidden;}.go4097358152 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go4097358152 .flexlayout__tab_button--selected,.go4097358152  .flexlayout__tab_button:hover{background:#444;}.go4097358152 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go4097358152 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go4097358152 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go4097358152 .flexlayout__splitter_vert,.go4097358152  .flexlayout__splitter_horz{background:#827575;}.go2697092909{width:100%;height:340px;position:relative;}.go4043944666{background:var(--focus-bg);}@keyframes fadein{from{opacity:0;}to{opacity:1;}}.go4043944666 .flexlayout__tabset{animation:fadein 1s;}.go4043944666 .flexlayout__tabset,.go4043944666  .flexlayout__tab{background:white;}.go4043944666 > .flexlayout__layout{background:#444;position:relative;height:360px;}.go4043944666 .flexlayout__tab{border-top:6px solid #444;position:relative;overflow:hidden;}.go4043944666 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go4043944666 .flexlayout__tab_button--selected,.go4043944666  .flexlayout__tab_button:hover{background:#444;}.go4043944666 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go4043944666 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go4043944666 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go4043944666 .flexlayout__splitter_vert,.go4043944666  .flexlayout__splitter_horz{background:#827575;}.go4220627111{width:100%;height:360px;position:relative;}</style><meta name="next-font-preconnect" /><meta name="viewport" content="width=device-width" /><meta charSet="utf-8" /><title>Rogue Markup</title><meta name="next-head-count" content="3" /><link rel="preload" href="/_next/static/css/2e4acd40e3c2aac356ef.css" as="style" /><link rel="stylesheet" href="/_next/static/css/2e4acd40e3c2aac356ef.css" data-n-g /><noscript data-n-css></noscript><script defer noModule src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-696d3d87454268029efd.js" defer></script><script src="/_next/static/chunks/framework-571220e3661128bb4007.js" defer></script><script src="/_next/static/chunks/main-aba050664ec743567e3e.js" defer></script><script src="/_next/static/chunks/pages/_app-b2b30124c6ff6f246dc0.js" defer></script><script src="/_next/static/chunks/238-51dde47b38e0fd525acf.js" defer></script><script src="/_next/static/chunks/612-78f619de7346ab175d8d.js" defer></script><script src="/_next/static/chunks/pages/draft-30b347082203324f5df8.js" defer></script><script src="/_next/static/MyMfpalQRbYlseLZOcqFd/_buildManifest.js" defer></script><script src="/_next/static/MyMfpalQRbYlseLZOcqFd/_ssgManifest.js" defer></script></head><body><div id="__next"><main class="go3169236000"><header class="title go3698606907"><h1 level="1" node="[object Object]">Rogue Markup</h1>
<p>$( game ai | roguelike | web dev )</p></header><article class="blog go3065236821"><time dateTime="2021-07-19">19th July 2021</time><h2>Objective</h2>
<p>We'll create a <em>Game AI focused</em> roguelike, set in the <a href="https://travellermap.com/?p=-1.329!-23.768!3">Traveller universe</a>.</p>
<p><em>Why?</em></p>
<p>Because NPC behaviour is more interesting than any particular game.
An environment is needed to make it meaningful, fixed narratives/missions are not.</p>
<p>We'll focus on combining navigation-based behaviours in a flexible manner.
Game AI should be compositional, not forced into a narrative straight-jacket.
The environment will be driven by thousands of Traveller-based assets.</p>
<figure class="tabs scrollable go1506804081"><div class="go3574057674"><div class="go3973914776"><div class="central">interact</div></div><div class="go118039706"></div></div></figure>
<p>Above we've recreated Geomorph 301 (a.k.a. <em>Bridge</em>) from <a href="http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html">Starship Geomorphs 2.0</a>,
using 8 assets from <a href="http://travellerrpgblog.blogspot.com/2020/08/starship-symbols-book.html">Starship Symbols</a>.
A larger version is <a href="/pics/g-301--bridge.debug.x2.png" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">available</a>.
Roughly speaking, a &quot;Starship Geomorph&quot; is a rectangular slice of a starship designed to be cut out and glued to others.
They were created by Robert Pearce, and distributed as PDFs on his <a href="http://travellerrpgblog.blogspot.com/">blog</a>.
Their 2nd version was released in 2020, and soon afterwards Eric B. Smith transformed them into <a href="http://gurpsland.no-ip.org/geomorphs/">transparent PNGs</a>.
The latter 2000+ symbols will form the underlying basis of <em>Rogue Markup</em>.</p></article><hr class="go396156490" /><article class="blog go3065236821"><time dateTime="2021-07-19">19th July 2021</time><h2>Constraints</h2>
<p>This project needs a backbone.
We've chosen the underlying technology, low-level game mechanics, and where events take place.</p>
<h3>Technology</h3>
<ul>
<li>Use CSS/SVG/PNGs, not HTMLCanvas/WebGL.</li>
<li>Use <a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components">React function components</a> and CSS-in-JS.</li>
<li>Use <a href="https://www.npmjs.com/package/preact">Preact</a> (like React), and <a href="https://www.npmjs.com/package/goober">Goober</a> (like <a href="https://www.npmjs.com/package/@emotion/styled">Emotion</a>).</li>
<li>Use <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components">Web Components</a> to avoid React renders.</li>
<li>Use <a href="https://nextjs.org/">NextJS</a> as our dev env.</li>
<li>Use <a href="https://codesandbox.io">CodeSandbox</a> to share editable code.</li>
<li>Support mobile/desktop devices.</li>
</ul>
<aside>
<p>Here's our first <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">CodeSandbox</a>.
Perusing the files, you'll find the rectangle class <em>Rect</em> and a Geomorph PNG.
Our CodeSandboxes use React, whereas this site uses <em>Preact</em>.
More on that later.</p>
</aside>
<h3>Game mechanics</h3>
<ul>
<li>Use <a href="http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html">Starship Geomorphs 2.0</a> for graphics.</li>
<li>Use a realtime birdseye camera.</li>
<li>Use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API/Using_the_Web_Animations_API">Web Animations API</a>.</li>
<li>Use navigation &amp; raycasting algorithms.</li>
<li>Use an in-browser terminal.</li>
<li>Do not use a Physics engine.</li>
</ul>
<aside>
<p>Building user interfaces is <em>hard</em>.
We'll avoid many difficulties by using an in-browser terminal.</p>
  <figure class="tabs scrollable go4204185124"><div class="go3944991801"><div class="go3973914776"><div class="central">interact</div></div><div class="go118039706"></div></div></figure>
</aside>
<h3>Setting</h3>
<ul>
<li>The <a href="https://travellermap.com/?p=-1.329!-23.768!3">Traveller Universe</a>.</li>
<li>Space vehicles, stations, and docks.</li>
<li>Buddhist backdrop via <a href="https://en.wikipedia.org/wiki/Bardo_Thodol">Bardo Thodol</a>.</li>
<li>Horror backdrop via <a href="https://en.wikipedia.org/wiki/The_Night_Land">The Night Land</a>.</li>
</ul>
<aside>
<p>Traveller is a Futuristic pen-and-paper Roleplaying Game, created in the late 70s.
It permits faster than light travel, but ≤ 6 parsecs per week.
You can learn more on the <a href="https://wiki.travellerrpg.com/Jump_Drive">wiki</a>, the <a href="https://www.farfuture.net/">official site</a> or explore <a href="https://travellermap.com/">Traveller Map</a>.
It directly motivated Robert Pearce's Starship Geomorphs, and provides considerable depth.</p>
  <div style="font-size: smaller;" node="[object Object]">
<p><em>The Traveller game in all forms is owned by <a href="https://www.farfuture.net/">Far Future Enterprises</a>. Copyright © 1977 – 2021 Far Future Enterprises.</em></p>
  </div>
</aside>
<p>Over time we'll clarify the above constraints, but first we emphasise:</p>
<blockquote>
<p><em>creating a video game is really fucking hard</em>.</p>
</blockquote>
<p>Spelunky's creator suggested <a href="https://makegames.tumblr.com/post/1136623767/finishing-a-game">three important requirements</a>.
We'll address them.</p>
<h3>1. Fun to develop</h3>
<p><em>Games I want to make</em>. My underlying motivation is the lack of Game AI resources available on the web.
It is hard to discuss the subject without actually building a game, so I chose a setting and game mechanics which felt fun for me.
I am particularly interested in navigation i.e. combining the movement of many characters in a flexible manner.</p>

<h3>2. The Result</h3>
<p><em>Games I want to have made</em>. As an end result I want a highly replayable tactical/action game sandbox.
Procedurally generated missions will involve going from A to B and doing C (ever was it so).
Monotony will be overcome via encountered NPC behaviours and e.g. ship building.
Functionally, think <a href="https://www.youtube.com/results?search_query=Teleglitch">Teleglitch</a> with richer NPCs and the ability to <em>place</em> <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=175359117">room modules</a> when upgrading/docking.
Graphically, see Starship Geomorphs 2.0.</p>
<p>Rogue Markup will be easy to extend.
We'll achieve this via compositional code, escape hatches to CodeSandbox, clear explanations, and <a href="https://github.com/">GitHub</a> comments.</p>
<h3>3. Experience</h3>
<p><em>Games I’m good at making</em>. I work as a web developer, using React and CSS-in-JS on a daily basis.
I have a <a href="https://dblp.org/pid/81/8748.html">strong background</a> in Theoretical Computer Science,
so won't confuse Game AI with AI, nor fall prey to the Deep Learning hype.
I have also created similar game mechanics <em>many</em> times over the years.
Here's hoping my chain of unfinished projects is coming to a close!</p></article><hr class="go396156490" /><article class="blog go3065236821"><time dateTime="2021-07-19">19th July 2021</time><h2>Technology</h2>
<p>So, we're building a roguelike, directly on this website.
It will start to get fun once things are moving about.
Let us describe the underlying technologies.</p>





















































<table><thead><tr><th>Concept</th><th>Technology</th></tr></thead><tbody><tr><td>Component</td><td><a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components">React function components</a>, and <a href="https://reactjs.org/docs/web-components.html">Web Components</a>.</td></tr><tr><td>Styles</td><td>CSS-in-JS via <a href="https://www.npmjs.com/package/goober">Goober</a>.</td></tr><tr><td>Component framework</td><td><a href="https://preactjs.com/">Preact</a>, a DOM-diffing alternative to React.</td></tr><tr><td>Pathfinding</td><td>Based on <a href="https://www.npmjs.com/package/three-pathfinding">three-pathfinding</a>.</td></tr><tr><td>Raycasting</td><td>Geometry/Partitioning</td></tr><tr><td>Static analysis</td><td>TypeScript via <a href="https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html">JSDoc</a>; also <a href="https://www.npmjs.com/package/eslint">ESLint</a>.</td></tr><tr><td>Live analysis</td><td>In-browser terminal, via <a href="https://www.npmjs.com/package/xterm">xterm.js</a> and <a href="https://www.npmjs.com/package/mvdan-sh">mvdan-sh</a>.</td></tr><tr><td>Scripting</td><td><a href="https://www.npmjs.com/package/ts-node">TS Node</a> i.e. Node.js with types.</td></tr><tr><td>Code viewing</td><td><a href="https://codemirror.net/">CodeMirror</a> to view JS.</td></tr><tr><td>Code editing</td><td>External <a href="https://codesandbox.io/">CodeSandbox</a> links, using React.</td></tr><tr><td>Code sharing</td><td>Show <a href="https://github.com/">GitHub</a> comments, provide GitHub <a href="https://github.com/rob-myers/rob-myers.github.io">repo</a>.</td></tr></tbody></table>

<p>The early 90s brought three pillars: HTML, CSS and JavaScript.
Whenever we visit a website we receive an HTML response, referencing or embedding CSS and JS.
Our web browser renders the HTML and CSS immediately, and runs the JS to provide interactivity (beyond links, hovers and CSS animations).
More precisely, all subsequent DOM mutations are performed by JavaScript.
It is now common to generate the initial HTML using JS too,
either during a build-step or on a Node.js server.
In particular, JavaScript has become the central web technology.</p>
<blockquote>
<p>ℹ️ <em>We'll spend the next two sections describing how we use JS.</em>
<em>The discussion is full of jargon, but the details can be picked up later on.</em></p>
</blockquote>
<h3>React and Preact</h3>
<p>Competing JavaScript frameworks exist, often with their own notion of component.
One popular approach uses <em>React function components</em>, which are just JavaScript functions with constraints on their parameters and return value.</p>
<ul>
<li>
<p>They have a single parameter, conventionally called <em>props</em>.</p>
<p>It is a JavaScript object defining the component's named inputs,
and possibly special properties like <em>children</em>, <em>key</em> and <em>ref</em>.</p>
</li>
<li>
<p>They must return either null or a virtual <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node">DOM node</a>.</p>
<p>This returned value amounts to an HTML fragment to be rendered,
and may depend on the component's props and internal state (via <a href="https://reactjs.org/docs/hooks-intro.html">hooks</a>).</p>
</li>
</ul>
<p>React developers use a grammatical extension of JavaScript called JSX.
It permits composing components using an XML-like syntax, to obtain the desired dynamic DOM tree.
Let's consider an example, a pannable and zoomable grid.</p>
<figure class="tabs scrollable go1506804081"><div class="go3574057674"><div class="go3973914776"><div class="central">interact</div></div><div class="go118039706"></div></div></figure>
<p>The file <em>panzoom/PanZoom.jsx</em> (see <a href="#command" title="open-tab panzoom code--panzoom/PanZoom.jsx">tab above</a>) defines two React function components, <em>PanZoom</em> and <em>Grid</em>.
Behaviourally:</p>
<ul>
<li>
<p><em>PanZoom</em> renders an SVG consisting of its children (the Geomorph image provided in <em>PanZoomDemo</em>) and <em>Grid</em>. It adjusts the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox">SVG viewBox</a> in response to mouse/pointer events.</p>
</li>
<li>
<p><em>Grid</em> renders part of an SVG i.e. two grid patterns.
They repeat squares of size 10x10 and 60x60 in abstract <a href="https://www.w3.org/TR/SVG2/coords.html#TermUserUnits">SVG user units</a>.</p>
</li>
</ul>
<p>They are JS functions with a single parameter, returning something which looks like HTML (but isn't).
Notice <em>PanZoom</em> renders <em>Grid</em> by using the XML tag <code>&lt;Grid/&gt;</code>.
Then although React function components are functions, syntactically they are not invoked like functions.
You can also view the demo code <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">on CodeSandbox</a>, which permits code editing.</p>
<p>Here's a whirlwind overview of React (and Preact).</p>
<ul>
<li>
<p>React devs use a grammatical extension of JS with XML called <a href="https://en.wikipedia.org/wiki/JSX_(JavaScript)">JSX</a>.</p>
</li>
<li>
<p>React applications are often built by composing React function components, using the XML syntax for their return value.</p>
</li>
<li>
<p>Dev tools convert JSX into JS, by replacing XML tags with invocations of the function `React.createElement`.
See <a href="#command" title="open-tab jsx-to-js">example/jsx-to-js.jsx</a> below.</p>
</li>
<li>
<p>Actually, this website uses Preact, a React alternative with the same API.
Then <code>React.createElement</code> is <a href="https://github.com/preactjs/preact/blob/master/src/create-element.js">this function</a>,
and makes Preact virtual DOM nodes.</p>
</li>
<li>
<p>The root component is usually called <em>App</em>.
Running a React application means <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/index.js" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">invoking <code>ReactDOM.render</code></a>
with 2 arguments: <code>&lt;App/&gt;</code> and a DOM node <em>el</em>.</p>
</li>
<li>
<p><a href="https://github.com/preactjs/preact/blob/master/src/render.js"><code>ReactDOM.render</code></a> initially converts `<app>` into a DOM node mounted at <em>el</em>.
A subcomponent may subsequently re-render, recursively recreating a virtual DOM node.
It is then <a href="https://github.com/preactjs/preact/blob/master/src/diff/index.js">diffed</a>, and only the difference is applied to the DOM.</app></p>
</li>
</ul>

<figure class="tabs scrollable go4097358152"><div class="go2697092909"><div class="go3973914776"><div class="central">interact</div></div><div class="go118039706"></div></div></figure>

<h3>React Renders and Web Components</h3>

<p>When React renders a component, it computes a rooted subtree of the virtual DOM,
compares the previous one, and patches the DOM.
If many components change in a small amount of time, <a href="https://github.com/preactjs/preact/blob/ebd87f3005d9558bfd3c5f38e0496a5d19553441/src/component.js#L221">some renders are automatically avoided</a> via the ancestral relationship.
Developers can also avoid recreating an entire rooted subtree using <a href="https://github.com/preactjs/preact/blob/master/compat/src/memo.js"><code>React.memo</code></a>.
But for many websites, the virtual DOM manipulations are neither too large nor too frequent, and React developers may simply ignore their overhead.</p>
<p>However, we are making a realtime video game.
We want to control the rendering as much as possible, to ensure good performance and aid debugging e.g. when many objects are onscreen.
If we allowed React (actually, Preact) to render in response to user interaction, we'd lose this control.
Take another look at <em>panzoom/PanZoom.jsx</em>.</p>
<figure class="tabs scrollable go4043944666"><div class="go4220627111"><div class="go3973914776"><div class="central">interact</div></div><div class="go118039706"></div></div></figure>
<p><em>PanZoom</em> returns an <code>&lt;svg/&gt;</code> with a viewBox attribute determined by <em>state.viewBox</em>.
When a user zooms via mousewheel, the event handler <em>state.onWheel</em> updates <em>state.viewBox</em>.
But updating this variable does not automatically update the virtual DOM.
The canonical React approach would be to re-render, so that <em>PanZoom</em> returns <code>&lt;svg/&gt;</code> with the updated viewBox, and the DOM-diffing algorithm does the update.
But how do we trigger a re-render?</p>
<p>A React function component is rendered whenever an ancestor is (modulo React.memo), or if its internal state changes. Internal state is represented using the <a href="https://reactjs.org/docs/hooks-state.html">React.useState hook</a> e.g.</p>
<blockquote>
<p><code>const [data, setData] = React.useState(() =&gt; initialState)</code>.</p>
</blockquote>
<p>These declarations cannot be nested, must occur at the &quot;top-level&quot; of the React function component, and must always execute in the same order.
This induces a <a href="https://github.com/preactjs/preact/blob/98f130ee8695c2b4f7535205ddf02168192cdcac/hooks/src/index.js#L109">well-defined association</a> with their enclosing component.
To change state we execute <em>setData(nextData)</em> e.g. in response to a click. If <em>nextData</em> differs from <em>data</em>, the function <em>setData</em> causes the component to re-render relative to the new data.</p>
<p>In <em>panzoom/PanZoom.jsx</em> the variable <em>state</em> corresponds to <em>data</em>, but there is no correspondent of <em>setData</em>.</p>
<p><strong>TODO</strong> <em>we'll control the rendering i.e. React should only render initially or during fast refresh. We'll manipulate the DOM directly using Web Components. By keeping the initial virtual DOM mostly constant, the DOM diffing won't interfere.</em></p>
<p><strong>TODO</strong> Server-side rendering cannot handle DOM mutations, so we don't use SSR.</p>
<h3>CSS inside JS</h3>
<p>Traditionally, CSS is provided in separate files,
linked in the <code>&lt;head/&gt;</code> and referenced by DOM elements via their space-separated attribute <code>class</code>.
Both <em>PanZoom</em> and <em>PanZoomDemo</em> above are styled using CSS-in-JS.
This means the CSS is written inside JS or JSX files, often together with the React component it applies to.
The npm module <a href="https://www.npmjs.com/package/goober">Goober</a> handles this for us.</p></article><hr class="go396156490" /><article class="blog go3065236821"><time dateTime="2021-07-19">19th July 2021</time><h2>Technology (2)</h2>
<h3>Navigation</h3>
<p>Pathfinding is central to Game AI.
Our NPCs need to move realistically e.g. they cannot move through walls, windows or locked doors.</p>
<figure class="tabs scrollable go1506804081"><div class="go3574057674"><div class="go3973914776"><div class="top-right">disable</div></div><div class="go118039706"></div></div></figure>
<h3>Raycasting</h3>
<p>...</p></article><hr class="go396156490" /><article class="blog go3065236821"><time dateTime="2021-07-19">19th July 2021</time><h2>Technology (3)</h2>
<h3>Static Analysis</h3>
<ul>
<li>Typescript via JSDoc, referring to CodeSandbox.</li>
</ul>
<h3>Runtime Analysis</h3>
<ul>
<li>Terminal + Game AI</li>
</ul>
<h3>Comments</h3>
<ul>
<li>Display GitHub comments from Issue (build-time)</li>
<li>Can use anonymous credits to get recent</li>
</ul></article><hr class="go396156490" /><article class="blog go3065236821"><time dateTime="2021-07-19">19th July 2021</time><h2>Geomorphs</h2>
<h3>Filesystem structure</h3>
<p>media</p>
<ul>
<li>Starship Geomorphs 2.0.pdf (Original source)</li>
<li>Starship Symbols.pdf (Original source)</li>
<li>Geomorphs.zip (Transparent PNGs obtained from Starship Geomorphs 2.0)</li>
<li>SymbolsHighRes.zip (Transparent PNGs obtained from Starship Symbols)</li>
</ul>
<p>media/Geomorph</p>
<ul>
<li>PNGs of lower quality (relatively).</li>
<li>Extracted from &quot;Starship Geomorphs 2.0.pdf&quot; by ...</li>
</ul>
<p>media/Symbols</p>
<ul>
<li>PNGs of higher quality.</li>
<li>Extracted from &quot;Starship Symbols.pdf&quot; by ...</li>
</ul>
<p>media/scripts</p>
<ul>
<li>ts-node scripts launched via npm scripts</li>
<li>Directories generated by scripts</li>
<li>media/geomorph-edge (Edge Geomorphs)</li>
<li>media/symbol-bridge</li>
<li>media/symbol-dock-small-craft</li>
<li>media/symbol-staterooms</li>
<li>media/symbol-lounge</li>
<li>media/symbol-root</li>
</ul>
<p>public/png</p>
<ul>
<li>PNGs from media/symbol-* with labels removed</li>
</ul>
<p>public/svg</p>
<ul>
<li>Enriched symbols</li>
<li>Geomorph hulls</li>
</ul>
<figure class="tabs scrollable go1506804081"><div class="go3574057674"><div class="go3973914776"><div class="top-right">disable</div></div><div class="go118039706"></div></div></figure></article><hr class="go396156490" /></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/draft","query":{},"buildId":"MyMfpalQRbYlseLZOcqFd","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>