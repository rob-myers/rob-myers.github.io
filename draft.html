<!DOCTYPE html><html><head><link rel="icon" href="/favicon.ico" /><style id="_goober"> .go204978210{font-size:1.2rem;}@media(max-width: 540px){.go204978210{font-size:1.1rem;}}.go204978210 p{line-height:1.5;}.go204978210 code{font-size:12pt;font-family:Courier, monospace;color:#444;background:#eee;}.go204978210 ul,.go204978210  ol{margin:20px 0;line-height:1.4;padding-left:var(--list-indent);}.go204978210 ul li,.go204978210  ol li{margin:8px 0;}.go204978210 ul li ul,.go204978210 ul li  ol,.go204978210  ol li ul,.go204978210  ol li  ol{line-height:1.2;}.go204978210 ul.contains-task-list{padding-left:12px;}.go204978210 ul.contains-task-list li.task-list-item{list-style:none;}.go204978210 span.float{float:right;color:#555;}@media(max-width: 480px){.go204978210 span.float{float:unset;display:block;margin-top:8px;}}.go204978210 table{border:1px solid #ccc;border-left:4px solid #999;}.go204978210 table th,.go204978210 table  td{text-align:left;vertical-align:top;padding:8px;}@media(max-width: 540px){.go204978210 table th,.go204978210 table  td{padding:4px 2px;}}.go204978210 hr{margin:32px 0 24px;height:4px;background:#ddd;border-color:#ddd;}.go2691382864 h1{margin:48px 0 24px;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;font-size:7.5rem;font-weight:300;cursor:pointer;}@media(max-width: 1024px){.go2691382864 h1{margin:12px 0 24px;font-size:6rem;}}@media(max-width: 800px){.go2691382864 h1{font-size:5rem;}}@media(max-width: 400px){.go2691382864 h1{font-size:3.3rem;}}.go2691382864 p{-site:subtitlecolor: #444;margin:0 0 32px 0;padding-top:16px;letter-spacing:1px;font-size:1rem;font-family:monospace;}@media(max-width: 800px){.go2691382864 p{padding-top:0;}}@media(max-width: 400px){.go2691382864 p{font-size:0.8rem;}}.go4015313500{display:flex;flex-direction:column;height:100%;border:2px solid #000;}.go4015313500 > p{padding:12px 8px;margin:0;font-family:monospace;font-size:16px;background:#eee;}.go4182173990{border:1px solid #555555;height:300px;}.go4182173990 path.walls{fill:#000;}.go4182173990 path.floor{cursor:crosshair;fill:white;stroke:none;}.go4182173990 g.dots circle{cursor:crosshair;fill:#ddd;stroke:black;stroke-width:0.5;}.go4182173990 g.dots circle.selected{fill:red;}.go4182173990 polygon.triangle{fill:none;stroke:#bbb;stroke-width:0.5;}.go4182173990 polyline.navpath{fill:none;stroke:#800;stroke-width:1;stroke-dasharray:4 4;}.go3126312333{border:1px solid #555;width:100%;height:400px;position:relative;}.go18914072{height:100%;width:100%;border:1px solid rgba(0, 0, 0, 0.3);border-top:6px solid #444;position:relative;}.go354283825{pointer-events:none;position:absolute;z-index:5;width:inherit;height:inherit;background:#000;display:flex;justify-content:center;opacity:1;transition:opacity 0.5s linear;}.go354283825 > div{display:flex;align-items:center;}.go354283825 .message{color:#ccc;background:#444;border-radius:4px;padding:8px;font-size:14px;}.go354283825.fade-out{opacity:0;}.go1063076544{margin:auto;padding:0 0 16px;}.go1063076544 > div{position:relative;height:400px;padding:16px 0;}.go1063076544 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go1063076544 .flexlayout__tab_button--selected,.go1063076544  .flexlayout__tab_button:hover{background:#444;}.go1063076544 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go1063076544 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go1063076544 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go1063076544 .flexlayout__splitter_vert,.go1063076544  .flexlayout__splitter_horz{background:#827575;}.go2284329725{margin:0 0 0 var(--list-indent);padding:0 0 16px;}.go2284329725 > div{position:relative;height:300px;padding:16px 0;}.go2284329725 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go2284329725 .flexlayout__tab_button--selected,.go2284329725  .flexlayout__tab_button:hover{background:#444;}.go2284329725 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go2284329725 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go2284329725 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go2284329725 .flexlayout__splitter_vert,.go2284329725  .flexlayout__splitter_horz{background:#827575;}.go2993874107{margin:auto;padding:0 0 16px;}.go2993874107 > div{position:relative;height:300px;padding:16px 0;}.go2993874107 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go2993874107 .flexlayout__tab_button--selected,.go2993874107  .flexlayout__tab_button:hover{background:#444;}.go2993874107 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go2993874107 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go2993874107 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go2993874107 .flexlayout__splitter_vert,.go2993874107  .flexlayout__splitter_horz{background:#827575;}.go2682357938{grid-area:terminal;background:black;height:100%;}</style><meta name="next-font-preconnect" /><meta name="viewport" content="width=device-width" /><meta charSet="utf-8" /><title>Rogue Markup</title><meta name="next-head-count" content="3" /><link rel="preload" href="/_next/static/css/ad3993754da61acc412c.css" as="style" /><link rel="stylesheet" href="/_next/static/css/ad3993754da61acc412c.css" data-n-g /><noscript data-n-css></noscript><script defer noModule src="/_next/static/chunks/polyfills-e7a279300235e161e32a.js"></script><script src="/_next/static/chunks/webpack-a5d37a5ef87e682d5866.js" defer></script><script src="/_next/static/chunks/framework-ce28bee0f919fc5033fb.js" defer></script><script src="/_next/static/chunks/main-02334c3b8bcbdfdef7fa.js" defer></script><script src="/_next/static/chunks/pages/_app-915694e1bc89c8ef229b.js" defer></script><script src="/_next/static/chunks/488-2b37ed4adb6f73b1ccd5.js" defer></script><script src="/_next/static/chunks/203-ab8ea49f76be46dfacfc.js" defer></script><script src="/_next/static/chunks/pages/draft-ebc29e99f8302952a432.js" defer></script><script src="/_next/static/_ntV8Oh2CO_X4n57FVkIr/_buildManifest.js" defer></script><script src="/_next/static/_ntV8Oh2CO_X4n57FVkIr/_ssgManifest.js" defer></script></head><body><div id="__next"><div class="main"><section><div class="go2691382864"><h1 level="1" node="[object Object]">Rogue Markup</h1>
<p>$( roguelike | built online | game ai )</p>
<hr /></div><div class="go204978210"><h2>Objective <span rem="1.2" node="[object Object]" style="font-size: 1.2rem;" class="float">19th July 2021</span></h2>
<p>We are going to build a video game step-by-step on this website.
It will be a realtime <a href="https://en.wikipedia.org/wiki/Roguelike">roguelike</a>, set in space. We'll assume the role of Captain of the starship <em>Gehennom</em>.</p>
<p>As an important side-effect, a popular approach to frontend development will be presented. The underlying technology is the Markup language HTML, brought to life via CSS, SVG and JavaScript.</p>
<hr />
<h2>Constraints <span rem="1.2" node="[object Object]" style="font-size: 1.2rem;" class="float">19th July 2021</span></h2>
<p>I've necessarily made a large number of decisions. Here are the important ones, from low-level to high-level.</p>
<h3>Concerning technology</h3>
<ul>
<li>We'll make a browser-based game.</li>
<li>Support mobile devices but with restricted interfaces.</li>
<li>Use CSS/SVG/PNGs instead of HTMLCanvas/WebGL.</li>
<li>Use <a href="https://developer.mozilla.org/en-US/docs/WebAssembly">WebAssembly</a> for simulating physics.</li>
<li>Use React <a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components">function components</a> and CSS-in-JS.</li>
<li>Use <a href="https://www.npmjs.com/package/preact">Preact</a> instead of React, and <a href="https://www.npmjs.com/package/goober">Goober</a> instead of <a href="https://www.npmjs.com/package/@emotion/styled">Emotion</a>.</li>
<li>Use <a href="https://nextjs.org/">NextJS</a> as our development environment.</li>
<li>Use <a href="https://codesandbox.io">CodeSandbox</a> to share editable code.</li>
</ul>
<h3>Concerning game mechanics</h3>
<ul>
<li>Use a realtime birdseye camera, like <a href="https://en.wikipedia.org/wiki/Teleglitch">Teleglitch</a>.</li>
<li>Use <a href="https://www.npmjs.com/package/box2d-wasm">a recent port</a> of the pathfinding tool <a href="https://github.com/recastnavigation/recastnavigation">Recast &amp; Detour</a>.</li>
<li>Use <a href="https://www.npmjs.com/package/recast-detour">a recent port</a> of the physics engine <a href="https://github.com/erincatto/box2d">Box2D</a>.</li>
<li>Use procedural generation e.g. spaceship building/docking.</li>
<li>Use explicitly illustrated NPC decisions as a game mechanic.</li>
</ul>
<h3>Concerning the setting</h3>
<ul>
<li>The title of the game is <em>Rogue Markup</em>.</li>
<li>The player character is the Captain of the starship <em>Gehennom</em>.
They work for <em>Unified Transport</em>, providing personnel transport, cargo transport, and hauling services.</li>
<li>The graphical style is based on <a href="http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html">Starship Geomorphs 2.0</a>.</li>
</ul>
<p>Over time we'll clarify these constraints.
But first we emphasise:</p>
<blockquote>
<p><em>finishing a game is really fucking hard</em>.</p>
</blockquote>
<p>Spelunky's creator suggested <a href="https://makegames.tumblr.com/post/1136623767/finishing-a-game">three important requirements</a>. We'll now address them.</p>
<h3>1. Fun to develop (Games I want to make)</h3>
<p><em>Rogue Markup</em> will be fun to develop because I enjoy experimenting with NPC behaviour.
One of our underlying motivations is the lack of Game AI resources available on the web.
It is hard to discuss Game AI without actually building a game, so I chose a setting and game mechanics which felt fun for me.</p>

<h3>2. The Result (Games I want to have made)</h3>
<p>As an end result I want a <em>highly replayable space travel game</em>.
The underlying missions amount to going from A to B (ever was it so).
Monotony will be overcome via mission specifics, encountered NPC behaviours, procedural generation, and ship building.
Functionally, think <a href="https://en.wikipedia.org/wiki/Teleglitch">Teleglitch</a> where you can <em>place</em> <a href="https://steamcommunity.com/sharedfiles/filedetails/?id=175359117">room modules</a> when upgrading or docking.
Graphically, see <a href="http://travellerrpgblog.blogspot.com/2018/10/the-starship-geomorphs-book-if-finally.html">Starship Geomorphs 2.0</a>.</p>
<p>Importantly, it should be easy for other people to extend this game.
We'll achieve this by providing source code, escape hatches to CodeSandbox, and clear explanations.
Comments will be shown so that <a href="https://github.com/">GitHub</a> users can share ideas and links.</p>


<h3>3. Experience (Games I’m good at making)</h3>
<p>I work as a web developer, using React &amp; Emotion on a daily basis.
I have a <a href="https://dblp.org/pid/81/8748.html">strong background</a> in Theoretical Computer Science,
so won't confuse Game AI with AI, nor fall prey to the Deep Learning hype.
I have also created similar game mechanics <em>many</em> times over the years.
Here's hoping my chain of unfinished projects is coming to a close!</p>
<hr />
<h2>Technology  <span rem="1.2" node="[object Object]" style="font-size: 1.2rem;" class="float">19th July 2021</span></h2>
<p>We will build the game using the following technologies.</p>

















































<table><thead><tr><th>Concept</th><th>Browser Technology</th></tr></thead><tbody><tr><td>Component</td><td>React <a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components">function components</a>.</td></tr><tr><td>Styles</td><td>CSS-in-JS via <a href="https://www.npmjs.com/package/goober">Goober</a>.</td></tr><tr><td>Component framework</td><td><a href="https://preactjs.com/">Preact</a>, a DOM-diffing alternative to React.</td></tr><tr><td>Pathfinding</td><td><a href="https://www.npmjs.com/package/recast-detour">Emscripten port</a> of <a href="https://github.com/recastnavigation/recastnavigation">Recast &amp; Detour</a>.</td></tr><tr><td>Physics engine</td><td><a href="https://www.npmjs.com/package/box2d-wasm">WebAssembly port</a> of <a href="https://github.com/erincatto/box2d">Box2D</a>.</td></tr><tr><td>Static analysis</td><td>TypeScript via <a href="https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html">JSDoc</a>, and also <a href="https://www.npmjs.com/package/eslint">ESLint</a>.</td></tr><tr><td>Live analysis</td><td><a href="https://preactjs.com/guide/v10/options/">Preact option hooks</a> and <em>our own in-browser terminal</em>.</td></tr><tr><td>Code viewing</td><td><a href="https://codemirror.net/">CodeMirror</a> to view JS. <a href="https://github.com/caplin/FlexLayout">FlexLayout</a> provides draggable tabs.</td></tr><tr><td>Code editing</td><td>External <a href="https://codesandbox.io/">CodeSandbox</a> links, using React.</td></tr><tr><td>Code sharing</td><td><a href="https://github.com/">GitHub</a> comments shown on site; GitHub <a href="https://github.com/rob-myers/rob-myers.github.io">repo</a> for this site.</td></tr></tbody></table>


<p>We want to create a video game explicitly, exposing the code and underlying thought process.
Then it is worth explaining these technologies before using them.</p>
<h3>React, Styles and Preact</h3>
<p>Competing web frameworks exist in the wild, often with their own notion of component.
One popular approach uses <em>React function components</em>, which are just JavaScript functions with constraints on their parameters and return values.</p>
<ul>
<li>
<p>They have a single parameter, conventionally called <em>props</em>.</p>
<p>It is a JavaScript object defining the component's named inputs, and possibly special properties like <em>children</em>, <em>key</em> and <em>ref</em>.</p>
</li>
<li>
<p>They must return either null or a virtual <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node">DOM node</a>.</p>
<p>The returned value amounts to an HTML fragment to be rendered,
and may depend on the component's props and internal state (via <a href="https://reactjs.org/docs/hooks-intro.html">hooks</a>).</p>
</li>
</ul>
<p>React developers compose components using an XML-like syntax, in order to obtain the desired dynamic DOM tree.
Let's consider an example and some source code.</p></div><div height="400px" class="go1063076544"><div class="flexlayout__layout"><div style="visibility: hidden;" class="flexlayout__tabset_header_sizer">FindHeaderBarSize</div><div style="visibility: hidden;" class="flexlayout__tabset_sizer">FindTabBarSize</div><div style="visibility: hidden;" class="flexlayout__border_sizer">FindBorderBarSize</div></div></div><div class="go204978210"><p>The file <em>panzoom/PanZoom.jsx</em> defines two React function components, namely <em>PanZoom</em> and <em>Grid</em>.
They are JavaScript functions with a single parameter, returning something which looks like HTML (but isn't).
<em>PanZoom</em> defines a pannable and zoomable grid.
To see it in action click the other tabs above, or view <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx" target="_blank" title="@new-tab" class="new-tab-link">this CodeSandbox</a>.
Behaviourally:</p>
<ul>
<li><em>PanZoom</em> renders an SVG consisting of its children (the red square in the demo) and <em>Grid</em>. It adjusts the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox">SVG viewBox</a> in response to mouse/pointer events.</li>
<li><em>Grid</em> renders part of an SVG i.e. a grid obtained by repeating a 10x10 unit pattern.</li>
</ul>
<p>Notice <em>PanZoomDemo</em> renders <em>PanZoom</em> by using the XML tag <em>&lt;PanZoom&gt;</em>.
Then although React function components are functions, they are not invoked like functions.
We now provide more details of a general nature.</p>
<ul>
<li>React developers use a grammatical extension of JS called <a href="https://en.wikipedia.org/wiki/JSX_(JavaScript)">JSX</a>, naturally combining JavaScript and XML syntax.</li>
<li>Dev tools convert JSX into JS, by replacing XML tags with invocations of the function <em>React.createElement</em>.</li>
</ul></div><div height="300px" margin="0 0 0 var(--list-indent)" class="go2284329725"><div class="flexlayout__layout"><div style="visibility: hidden;" class="flexlayout__tabset_header_sizer">FindHeaderBarSize</div><div style="visibility: hidden;" class="flexlayout__tabset_sizer">FindTabBarSize</div><div style="visibility: hidden;" class="flexlayout__border_sizer">FindBorderBarSize</div></div></div><div class="go204978210"><ul>
<li>This website uses Preact instead of React. Technically, <em>react</em> and <em>react-dom</em> are aliases for the npm module <a href="https://www.npmjs.com/package/@preact/compat">@preact/compat</a>.
As a result, React.createElement corresponds to <a href="https://github.com/preactjs/preact/blob/master/src/create-element.js">this function</a>,
and constructs Preact VNode's (virtual DOM nodes).</li>
<li>The root component is conventionally called <em>App</em>.
Running a React application amounts to <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/index.js" target="_blank" title="@new-tab" class="new-tab-link">invoking <em>ReactDOM.render</em></a>
with two arguments: <em>&lt;App/&gt;</em> and an extant DOM node <em>el</em>.
The <a href="https://github.com/preactjs/preact/blob/master/src/render.js">render function</a> initially converts the virtual DOM tree into an actual DOM tree mounted at <em>el</em>.
Subsequent changes are <a href="https://github.com/preactjs/preact/blob/master/src/diff/index.js">diffed</a>, and only the difference is applied to the DOM.</li>
</ul>

<p>So, React function components are JavaScript functions.
They are written using XML syntax via JSX, and are composed together in the same way as HTML.
There's more to say e.g. how they represent internal state,
but we've said more than enough for now.
We'll close this subsection with two related remarks.</p>
<p><em>Preact vs React</em>. This website is built using Preact, a popular alternative to React with the same API.
It has a much smaller codebase (easier to understand),
and a reputation for being faster.
However, React has a <em>much</em> wider scope via <a href="https://github.com/chentsulin/awesome-react-renderer">custom renderers</a>.</p>
<p><em>CSS in JavaScript</em>. Traditionally, CSS is provided in separate files,
linked in the <em>&lt;head&gt;</em> and referenced by DOM elements via their class attribute.
Both PanZoom and PanZoomDemo are styled using CSS-in-JS.
This means the CSS is written inside JS or JSX files, often with the React component it applies to.
The npm module <a href="https://www.npmjs.com/package/goober">Goober</a> handles this.</p>
<h3>Navigation</h3>
<p>Pathfinding is central to Game AI.
Our NPCs need to move realistically e.g. they cannot move through walls, windows or locked doors.</p></div><div height="300px" class="go2993874107"><div class="flexlayout__layout"><div style="visibility: hidden;" class="flexlayout__tabset_header_sizer">FindHeaderBarSize</div><div style="visibility: hidden;" class="flexlayout__tabset_sizer">FindTabBarSize</div><div style="visibility: hidden;" class="flexlayout__border_sizer">FindBorderBarSize</div></div></div><div class="go204978210"><h3>Physics engine</h3>
<p>Why do we need a Physics engine?</p>
<blockquote>
<p>Raycasting, triggers, and collision detection.</p>
</blockquote>
<p><strong>TODO</strong> from here</p></div><div class="go204978210"><ul>
<li>Raycast test</li>
<li>Dynamic collison test</li>
</ul>
<h3>Static and Runtime Analysis</h3>
<ul>
<li>Typescript via JSDoc, refering to CodeSandbox.</li>
<li>Terminal + Preact hooks</li>
<li>Terminal + Game AI</li>
</ul>
<h3>Comments</h3>
<ul>
<li>Display GitHub comments from Issue (build-time)</li>
<li>Can use anonymous credits to get recent</li>
</ul>
<hr />
<h2>Starship Geomorphs <span rem="1.2" node="[object Object]" style="font-size: 1.2rem;" class="float">19th July 2021</span></h2>
<p><strong>TODO</strong></p>
<ul>
<li>
<p>GeomorphDemo</p>
</li>
<li>
<p>prepare CodeSandbox links for GeomorphDemo</p>
</li>
</ul></div><div height="300px" class="go2993874107"><div class="flexlayout__layout"><div style="visibility: hidden;" class="flexlayout__tabset_header_sizer">FindHeaderBarSize</div><div style="visibility: hidden;" class="flexlayout__tabset_sizer">FindTabBarSize</div><div style="visibility: hidden;" class="flexlayout__border_sizer">FindBorderBarSize</div></div></div><div class="go204978210"><hr />
<h2>Movement <span rem="1.2" node="[object Object]" style="font-size: 1.2rem;" class="float">19th July 2021</span></h2>
<ul>
<li>
<p>Navigation</p>
</li>
<li>
<p>Follow camera</p>
</li>
<li>
<p>Map view</p>
</li>
<li>
<p>Support mobile too</p>
</li>
<li>
<p>CodeSandbox</p>
</li>
</ul></div><br /><section style="height: 200px;"><section class="go2682357938"></section></section><br /><div class="go204978210"><p>This is an example of a <a href="#command" title="@test echo foo">command link</a>.</p></div></section></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/draft","query":{},"buildId":"_ntV8Oh2CO_X4n57FVkIr","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>