<!DOCTYPE html><html lang="en"><head><meta name="description" content="A Game AI focused roguelike, built blog by blog." /><link rel="icon" href="/favicon.ico" /><style id="_goober"> .go1654252976{padding:0;color:#aaa;}.go1654252976 h3{padding:20px 12px;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;font-size:1.8rem;font-weight:300;margin:0;border:0 solid #aaa;border-width:0 0 2px;}.go1654252976 h3 a{color:#ddd;}.go1654252976 ul{font-size:1.1rem;padding:6px 0;margin:0;border:0 solid #aaa;border-width:0 0 2px;}.go1654252976 ul li{list-style:none;list-style-position:inside;display:flex;}.go1654252976 ul li.current a{color:white;}.go1654252976 ul a{padding:10px 12px;width:100%;color:#888;}.go1654252976 ul a:hover{color:#ccc;}.go2525494448{position:fixed;z-index:11;height:calc(100% + 200px);width:256px;font-weight:300;font-family:sans-serif;background-color:#222;color:white;cursor:pointer;opacity:0.975;-webkit-tap-highlight-color:transparent;transition:left 500ms ease;}.go2525494448.open{left:0;}.go2525494448.closed{left:-256px;}.go2525494448 > .article-overlay{position:absolute;top:0;left:256px;width:100vw;height:40px;background:rgba(0, 0, 0, .1);}@media(max-width: 1280px){.go2525494448.open > .article-overlay{height:100%;background:rgba(0, 0, 0, .25);}}.go2525494448 > .handle{position:absolute;top:-1px;right:-40px;width:40px;height:41px;display:flex;justify-content:center;align-items:center;user-select:none;}.go2525494448 > .handle .icon{display:flex;justify-content:center;align-items:center;background:#900;color:#fff;width:inherit;height:inherit;padding:0 0 2px 0;}.go1352374015{position:fixed;z-index:1;left:0;width:calc(100vw + 256px);height:40px;background:black;}.go4227718824{min-width:256px;transition:min-width 500ms ease;}.go4227718824.closed{min-width:0;}@media(max-width: 1280px){.go4227718824{display:none;}}.go741482717{position:absolute;z-index:10;right:140px;top:-48px;font-size:1rem;}@media(max-width: 1024px){.go741482717{top:-32px;}}@media(max-width: 600px){.go741482717{top:0;}}.go741482717 > ul{position:fixed;width:140px;height:40px;display:flex;justify-content:center;align-items:center;padding:0;margin:0;}.go741482717 > ul li{list-style:none;list-style-position:inside;padding:0 5px;}.go741482717 > ul a{color:#ccc;}.go741482717 > ul a.primary{color:#fff;}.go405958682{font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;position:relative;padding-top:40px;}@media(max-width: 600px){.go405958682{padding-left:8px;border-bottom:2px solid #999;border:0 solid #000;padding-top:64px;}}.go405958682 h1{margin:0;font-size:6rem;font-weight:300;cursor:pointer;color:#333;display:inline-block;}@media(max-width: 800px){.go405958682 h1{font-size:5rem;}}@media(max-width: 600px){.go405958682 h1{font-size:3rem;}}.go405958682 p{color:#444;letter-spacing:2px;font-size:1.4rem;margin:0;padding:40px 0 48px;font-weight:300;}@media(max-width: 600px){.go405958682 p{font-size:1rem;padding:20px 0 20px 4px;color:#222;}}.go4140030{max-width:1024px;width:100%;padding:48px 64px;}@media(max-width: 1024px){.go4140030{padding:32px 64px;margin:0;}}@media(max-width: 600px){.go4140030{padding:0;}}.go1763247448{margin:0;border-color:var(--focus-bg);}@media(min-width: 800px){.go1763247448{padding-bottom:80px;border:0;}}.go239274143{font-family:Roboto, Arial, sans-serif;}.go239274143 > .top-right{position:absolute;right:-10px;top:calc(-32px + 6px);z-index:2;border-radius:4px 4px 0 0;padding:2px 16px;cursor:pointer;background:#333;color:#777;font-size:14px;font-weight:300;}.go239274143 > .top-right.enabled{color:#fff;}.go239274143 > .central{position:absolute;z-index:5;left:calc(50% - (128px / 2));top:calc(50% - 20px);cursor:pointer;color:#ddd;background:#000;padding:12px 32px;border-radius:4px;border:1px solid #ddd;font-size:1.2rem;opacity:1;transition:300ms opacity ease;}.go239274143 > .central.enabled{opacity:0;}.go1048461253{position:absolute;z-index:4;width:inherit;height:inherit;background:#000;font-family:sans-serif;opacity:1;transition:opacity 1s ease-in;}.go1048461253:not(.faded){pointer-events:none;}.go1048461253.clear{opacity:0;transition:opacity 0.5s ease-in;}.go1048461253.faded{opacity:0.5;transition:opacity 0.5s ease-in;}.go1964420585{line-height:1.6;background:var(--focus-bg);border:var(--blog-border-width) solid var(--border-bg);font-size:1.1rem;padding:64px 128px 96px 128px;position:relative;}@media(max-width: 800px){.go1964420585{padding:32px 64px 48px 64px;}}@media(max-width: 600px){.go1964420585{padding:8px 12px;font-size:1.1rem;border:none;line-height:1.7;}}.go1964420585 a{position:relative;}.go1964420585 a code{color:unset;}.go1964420585 a > span.anchor{position:absolute;top:-96px;}.go1964420585 a.new-tab-link::after{display:inline-block;content:'';background-image:url('/icon/ext-link-icon.svg');background-size:13px 13px;height:13px;width:13px;margin-left:2px;}.go1964420585 a.anchor-link::after{display:inline-block;content:'';background-image:url('/icon/anchor-icon.svg');background-size:13px 13px;height:13px;width:13px;margin:0 2px 0 4px;}.go1964420585 span.cmd{color:#555;background:#ddd;font-family:monospace;letter-spacing:1px;font-size:smaller;padding:2px 4px;}@media(max-width: 600px){.go1964420585 span.cmd{user-select:all;}}.go1964420585 > span.anchor{position:absolute;top:-48px;}.go1964420585 aside{margin:32px 0;padding:8px 32px;border-radius:8px;border:2px dashed #ccc;font-size:1.1rem;}@media(max-width: 600px){.go1964420585 aside{font-size:1rem;margin:8px 0;padding:0 16px;}}.go1964420585 aside > figure.tabs{padding:8px 0;}@media(max-width: 600px){.go1964420585 aside > figure.tabs{padding:8px 0 12px;}}.go1964420585 blockquote{margin:32px 0;border-left:10px solid #ddd;padding-left:30px;}@media(max-width: 600px){.go1964420585 blockquote{margin:20px 0;padding-left:20px;}}.go1964420585 code{font-family:sans-serif;letter-spacing:2px;color:#444;font-size:smaller;padding:0 2px;}.go1964420585 figure{margin:0;}.go1964420585 figure.tabs{border:10px solid #333;border-radius:8px;margin:48px 0;position:relative;}@media(max-width: 600px){.go1964420585 figure.tabs{margin:32px 0;}}.go1964420585 figure.tabs > span.anchor{position:absolute;top:-96px;}.go1964420585 h1,.go1964420585  h2,.go1964420585  h3,.go1964420585  h4{font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;font-weight:400;}.go1964420585 h1 a,.go1964420585  h2 a,.go1964420585  h3 a,.go1964420585  h4 a{color:#008;}.go1964420585 h2{font-size:2.7rem;}@media(max-width: 600px){.go1964420585 h2{margin:16px 0 24px;font-size:2rem;}}@media(max-width: 800px){.go1964420585 h2{font-size:2.2rem;}}.go1964420585 h3{font-size:1.8rem;position:relative;}@media(max-width: 600px){.go1964420585 h3{font-size:1.3em;}}@media(max-width: 800px){.go1964420585 h3{font-size:1.4em;}}.go1964420585 h3 > span.anchor{position:absolute;top:-48px;}.go1964420585 p{margin:32px 0;}@media(max-width: 600px){.go1964420585 p{margin:16px 0;}}.go1964420585 table{padding:8px;border:1px solid #bbb;width:100%;margin:40px 0;}@media(max-width: 600px){.go1964420585 table{margin:20px 0;}}.go1964420585 table th,.go1964420585 table  td{padding:3px;text-align:left;vertical-align:top;font-size:1.1rem;}@media(max-width: 600px){.go1964420585 table th,.go1964420585 table  td{font-size:1rem;padding:4px 2px;}}.go1964420585 > time{position:absolute;right:-10px;top:-50px;width:136px;background:var(--border-bg);text-align:center;color:#555;border-radius:6px 6px 0 0;padding:12px;font-size:1rem;font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;}@media(max-width: 600px){.go1964420585 > time{top:16px;right:0;border-radius:0 0 0 4px;background:none;font-size:1.1rem;width:unset;margin-top:8px;}}@media(max-width: 600px){.go1964420585 ul,.go1964420585  ol{padding-left:20px;}}.go1964420585 ul + p,.go1964420585  ol + p{padding-top:6px;}.go1964420585 ul li,.go1964420585  ol li{margin:4px 0;}.go2193861445{padding:0;margin:0;list-style:none;}.go3599503544{cursor:pointer;font-family:sans-serif;letter-spacing:4px;height:64px;display:flex;margin-top:-64px;font-size:1.3rem;}@media(max-width: 800px){.go3599503544{font-size:1.1rem;margin-top:0px;}}.go3599503544 a{color:#555;width:100%;height:100%;text-align:center;display:flex;flex-direction:column;justify-content:center;}.go1506804081{background:var(--focus-bg);}@keyframes fadein{from{opacity:0;}to{opacity:1;}}.go1506804081 .flexlayout__tabset{animation:fadein 1s;}.go1506804081 .flexlayout__tabset,.go1506804081  .flexlayout__tab{background:white;}.go1506804081 > .flexlayout__layout{background:#444;position:relative;height:400px;}.go1506804081 .flexlayout__tab{border-top:6px solid #444;position:relative;overflow:hidden;}.go1506804081 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go1506804081 .flexlayout__tab_button--selected,.go1506804081  .flexlayout__tab_button:hover{background:#444;}.go1506804081 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go1506804081 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go1506804081 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go1506804081 .flexlayout__splitter_vert,.go1506804081  .flexlayout__splitter_horz{background:#827575;}.go3574057674{width:100%;height:400px;position:relative;}.go4097358152{background:var(--focus-bg);}@keyframes fadein{from{opacity:0;}to{opacity:1;}}.go4097358152 .flexlayout__tabset{animation:fadein 1s;}.go4097358152 .flexlayout__tabset,.go4097358152  .flexlayout__tab{background:white;}.go4097358152 > .flexlayout__layout{background:#444;position:relative;height:340px;}.go4097358152 .flexlayout__tab{border-top:6px solid #444;position:relative;overflow:hidden;}.go4097358152 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go4097358152 .flexlayout__tab_button--selected,.go4097358152  .flexlayout__tab_button:hover{background:#444;}.go4097358152 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go4097358152 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go4097358152 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go4097358152 .flexlayout__splitter_vert,.go4097358152  .flexlayout__splitter_horz{background:#827575;}.go2697092909{width:100%;height:340px;position:relative;}.go4043944666{background:var(--focus-bg);}@keyframes fadein{from{opacity:0;}to{opacity:1;}}.go4043944666 .flexlayout__tabset{animation:fadein 1s;}.go4043944666 .flexlayout__tabset,.go4043944666  .flexlayout__tab{background:white;}.go4043944666 > .flexlayout__layout{background:#444;position:relative;height:360px;}.go4043944666 .flexlayout__tab{border-top:6px solid #444;position:relative;overflow:hidden;}.go4043944666 .flexlayout__tabset_tabbar_outer{background:#222;border-bottom:1px solid #555;}.go4043944666 .flexlayout__tab_button--selected,.go4043944666  .flexlayout__tab_button:hover{background:#444;}.go4043944666 .flexlayout__tab_button_content{user-select:none;font-size:13px;color:#aaa;}.go4043944666 .flexlayout__tab_button--selected .flexlayout__tab_button_content{color:#fff;}.go4043944666 .flexlayout__tab_button:hover:not(.flexlayout__tab_button--selected) .flexlayout__tab_button_content{color:#ddd;}.go4043944666 .flexlayout__splitter_vert,.go4043944666  .flexlayout__splitter_horz{background:#827575;}.go4220627111{width:100%;height:360px;position:relative;}</style><meta name="next-font-preconnect" /><meta name="viewport" content="width=device-width" /><meta charSet="utf-8" /><title>Rogue Markup</title><meta name="next-head-count" content="3" /><link rel="preload" href="/_next/static/css/1d4855e76d9008a12256.css" as="style" /><link rel="stylesheet" href="/_next/static/css/1d4855e76d9008a12256.css" data-n-g /><noscript data-n-css></noscript><script defer noModule src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-57866d0628a24a991b06.js" defer></script><script src="/_next/static/chunks/framework-571220e3661128bb4007.js" defer></script><script src="/_next/static/chunks/main-aba050664ec743567e3e.js" defer></script><script src="/_next/static/chunks/pages/_app-9d2905a38b18202828a5.js" defer></script><script src="/_next/static/chunks/106-4fad0ab9ee60e77226ad.js" defer></script><script src="/_next/static/chunks/732-574f7fa349ca40add23e.js" defer></script><script src="/_next/static/chunks/13-30c9aa76223d508f8c99.js" defer></script><script src="/_next/static/chunks/pages/part/2-f8c93e4a5fa075b8f2f4.js" defer></script><script src="/_next/static/5lW0kNlvMVOcRhnc58Pu7/_buildManifest.js" defer></script><script src="/_next/static/5lW0kNlvMVOcRhnc58Pu7/_ssgManifest.js" defer></script></head><body><div id="__next"><nav class="go2525494448 closed"><div class="article-overlay"></div><div class="handle"><div class="icon">&gt;</div></div><section class="go1654252976"><h3><a href="/">Rogue Markup</a></h3><ul><li><a href="/part/1#article-objective" title="Our overall objective">1a objective</a></li><li><a href="/part/1#article-constraints" title="Constraints: tech, game mechanics, setting">1b constraints</a></li><li><a href="/part/1#article-finishing" title="Finishing as a skill">1c finishing</a></li></ul><ul><li><a href="/part/2#article-technology" title="The tech we'll use">2a technology</a></li><li><a href="/part/2#article-tech1" title="JavaScript components">2b tech: js</a></li><li><a href="/part/2#article-tech2" title="Tech related to gameplay">2c tech: ai</a></li><li><a href="/part/2#article-tech3" title="Dev env and in-browser terminal">2d tech: dev</a></li></ul><ul><li><a href="/part/3#article-geomorphs" title="How we use Starship Geomorphs">3a geomorphs</a></li></ul></section></nav><div class="go1352374015"></div><div class="go4227718824 closed"></div><section class="go4140030"><header class="title go405958682"><h1 level="1" node="[object Object]">Rogue Markup</h1>
<p>$( game ai | roguelike | web dev )</p></header><main><ol class="go2193861445"><li><article class="go1964420585"><span id="article-technology" class="anchor"></span><time dateTime="2021-07-19">19th July 2021</time><h2 level="2"><a href="#article-technology"><a>Technology</a></a></h2>
<p>So, we're building a roguelike, directly on this website.
It will start to get fun once things are moving about.
Let us list the underlying technologies.</p>





















































<table><thead><tr><th>Concept</th><th>Technology</th></tr></thead><tbody><tr><td>Component</td><td><a href="https://reactjs.org/docs/components-and-props.html#function-and-class-components"><span id="technology--link-react-function-components" class="anchor"></span>React function components</a>, and <a href="https://reactjs.org/docs/web-components.html"><span id="technology--link-web-components" class="anchor"></span>Web Components</a>.</td></tr><tr><td>Styles</td><td>CSS-in-JS via <a href="https://www.npmjs.com/package/goober"><span id="technology--link-goober" class="anchor"></span>Goober</a>.</td></tr><tr><td>Component framework</td><td><a href="https://preactjs.com/"><span id="technology--link-preact" class="anchor"></span>Preact</a>, a DOM-diffing alternative to React.</td></tr><tr><td>Pathfinding</td><td>Based on <a href="https://www.npmjs.com/package/three-pathfinding"><span id="technology--link-three-pathfinding" class="anchor"></span>three-pathfinding</a>.</td></tr><tr><td>Raycasting</td><td>Basic geometry and spacial partitions.</td></tr><tr><td>Static analysis</td><td>TypeScript via <a href="https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html"><span id="technology--link-jsdoc" class="anchor"></span>JSDoc</a>; also <a href="https://www.npmjs.com/package/eslint"><span id="technology--link-eslint" class="anchor"></span>ESLint</a>.</td></tr><tr><td>Live analysis</td><td>In-browser terminal, via <a href="https://www.npmjs.com/package/xterm"><span id="technology--link-xterm.js" class="anchor"></span>xterm.js</a> and <a href="https://www.npmjs.com/package/mvdan-sh"><span id="technology--link-mvdan-sh" class="anchor"></span>mvdan-sh</a>.</td></tr><tr><td>Scripting</td><td><a href="https://www.npmjs.com/package/ts-node"><span id="technology--link-ts-node" class="anchor"></span>TS Node</a> i.e. Node.js with types.</td></tr><tr><td>Code viewing</td><td><a href="https://codemirror.net/"><span id="technology--link-codemirror" class="anchor"></span>CodeMirror</a> to view JS.</td></tr><tr><td>Code editing</td><td>External <a href="https://codesandbox.io/"><span id="technology--link-codesandbox" class="anchor"></span>CodeSandbox</a> links, using React.</td></tr><tr><td>Code sharing</td><td>Show <a href="https://github.com/"><span id="technology--link-github" class="anchor"></span>GitHub</a> comments, provide GitHub <a href="https://github.com/rob-myers/rob-myers.github.io"><span id="technology--link-repo" class="anchor"></span>repo</a>.</td></tr></tbody></table>

<p>We'll spend the next few articles clarifying the above table.</p></article><hr class="go1763247448" /></li><li><article class="go1964420585"><span id="article-tech1" class="anchor"></span><time dateTime="2021-07-19">19th July 2021</time><h2 level="2"><a href="#article-tech1"><a>Tech (js)</a></a></h2>
<p>We'll now discuss our chosen JavaScript component framework.</p>
<blockquote>
<p>Please excuse the jargon, the details can be picked up later on.</p>
</blockquote>
<h3 level="3"><span id="tech1--javascript" class="anchor"></span><a href="#tech1--javascript"><a>JavaScript</a></a></h3>
<p>The early 90s brought three pillars: HTML, CSS and JavaScript (JS).
Whenever we visit a website we receive an HTML response, referencing or embedding CSS and JS.
Our web browser renders the HTML and CSS immediately, and runs the JS to provide interactivity.
More precisely, all subsequent DOM mutations are performed by JavaScript.
It is now common to generate the initial HTML using JS too,
either during a build-step or on a Node.js server.
In particular, JavaScript has become the central web technology.</p>
<h3 level="3"><span id="tech1--react-function-components" class="anchor"></span><a href="#tech1--react-function-components"><a>React Function Components</a></a></h3>
<p>Competing JavaScript frameworks exist, often with their own notion of component.
One popular approach uses <em>React function components</em>, which are just JavaScript functions with constraints on their parameters and return value.</p>
<ul>
<li>
<p>They have a single parameter, conventionally called <em>props</em>.</p>
<p>It is a JavaScript object defining the component's named inputs,
and possibly special properties like <em>children</em>, <em>key</em> and <em>ref</em>.</p>
</li>
<li>
<p>They must return either null or a virtual <a href="https://developer.mozilla.org/en-US/docs/Web/API/Node"><span id="tech1--link-dom-node" class="anchor"></span>DOM node</a>.</p>
<p>This returned value ultimately amounts to an HTML fragment to be rendered,
and may depend on the component's props and internal state (via <a href="https://reactjs.org/docs/hooks-intro.html"><span id="tech1--link-hooks" class="anchor"></span>hooks</a>).</p>
</li>
</ul>
<p>React developers use a grammatical extension of JavaScript called JSX.
It freely combines JS with XML, so JavaScript values can be passed to arbitrary attributes, and XML can be passed around as a JavaScript value. The grammar is particularly suitable for specifying dynamic DOM trees.
Let's consider an example, a pannable and zoomable grid (also <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/panzoom/PanZoom.jsx" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">on CodeSandbox</a>).</p>
<figure class="tabs scrollable go1506804081"><span id="tabs-panzoom" class="anchor"></span><div class="go3574057674"><div class="go239274143"><div class="top-right">disable</div><div class="central">interact</div></div><div class="go1048461253"></div></div></figure>
<p>The file <em>panzoom/PanZoom.jsx</em> (see <a href="#command" title="open-tab tabs-panzoom code--panzoom/PanZoom.jsx">tab above</a>) defines two React function components, <em>PanZoom</em> and <em>Grid</em>.
Behaviourally:</p>
<ul>
<li>
<p><em>PanZoom</em> renders an SVG consisting of its children (the Geomorph image provided in <em>PanZoomDemo</em>) and <em>Grid</em>. It adjusts the <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/viewBox"><span id="tech1--link-svg-viewbox" class="anchor"></span>SVG viewBox</a> in response to mouse/pointer events.</p>
</li>
<li>
<p><em>Grid</em> renders part of an SVG i.e. two grid patterns.
They repeat squares of size 10x10 and 60x60 in abstract <a href="https://www.w3.org/TR/SVG2/coords.html#TermUserUnits" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">SVG user units</a>.</p>
<aside>
<p>SVG user units become concrete via the <code>&lt;svg&gt;</code>'s viewBox attribute and its width/height within the DOM.
We'll follow a convention based on the work of Robert Pearce and Eric B. Smith. That is, 60 abstract user units (one large grid square) correspond to 1.5 meters.</p>
</aside>
</li>
</ul>
<h3 level="3"><span id="tech1--react-and-preact" class="anchor"></span><a href="#tech1--react-and-preact"><a>React and Preact</a></a></h3>
<p>The above two JS functions each have a single parameter <code>props</code>, and return something which looks like HTML (but isn't).
For example, <em>PanZoom</em> renders <em>Grid</em> by using the XML tag <code>&lt;Grid/&gt;</code>.
Then although React function components are functions, syntactically they are not invoked like functions (we don't write <code>Grid(props)</code>).
Then what does this XML syntax mean?
That is, what are React function components actually returning?
Here's a whirlwind overview.</p>
<ul>
<li>
<p>React devs use a grammatical extension <a href="https://en.wikipedia.org/wiki/JSX_(JavaScript)" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">JSX</a> of JS by XML.</p>
</li>
<li>
<p>React applications are built by composing React function components, using the XML syntax for their return value.</p>
</li>
<li>
<p>Dev tools convert JSX into JS by replacing XML tags with invocations of <code>React.createElement</code> (see <a href="#command" title="open-tab tabs-jsx-to-js">example below</a>).</p>
</li>
<li>
<p>This website actually uses <em>Preact</em>, a React alternative with the same API.
Then <code>React.createElement</code> is <a href="https://github.com/preactjs/preact/blob/master/src/create-element.js" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">this function</a>,
and creates Preact virtual DOM nodes.</p>
</li>
<li>
<p>The root component is usually called <em>App</em>.
Running a React application means <a href="https://codesandbox.io/s/rogue-markup-panzoom-yq060?file=/src/index.js" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">invoking <code>ReactDOM.render</code></a>
with 2 arguments: <code>&lt;App/&gt;</code> and a DOM node <em>el</em>.</p>
</li>
<li>
<p><a href="https://github.com/preactjs/preact/blob/master/src/render.js" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link"><code>ReactDOM.render</code></a> initially converts <code>&lt;App/&gt;</code> into a DOM node mounted at <em>el</em>.
A subcomponent may re-render, recursively recreating a virtual DOM node.
It is <a href="https://github.com/preactjs/preact/blob/master/src/diff/index.js" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">diffed</a> and only the difference is applied to the DOM.</p>
</li>
</ul>
<figure class="tabs scrollable go4097358152"><span id="tabs-jsx-to-js" class="anchor"></span><div class="go2697092909"><div class="go239274143"><div class="top-right">disable</div><div class="central">interact</div></div><div class="go1048461253"></div></div></figure>
<h3 level="3"><span id="tech1--react-renders" class="anchor"></span><a href="#tech1--react-renders"><a>React Renders</a></a></h3>

<p>When React renders a component, it computes a rooted subtree of the virtual DOM,
compares the previous one, and patches the DOM.
If many components change in a small amount of time, <a href="https://github.com/preactjs/preact/blob/ebd87f3005d9558bfd3c5f38e0496a5d19553441/src/component.js#L221" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">some renders are automatically avoided</a> via the ancestral relationship.
Developers can also avoid recreating an entire rooted subtree using <a href="https://github.com/preactjs/preact/blob/master/compat/src/memo.js" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link"><code>React.memo</code></a>.
But for many websites, the virtual DOM manipulations are neither too large nor too frequent, and React developers may simply ignore their overhead.</p>
<p>However, we are making a realtime video game.
We want to control the rendering as much as possible, to ensure good performance and aid debugging e.g. when many objects are onscreen.
If we allowed React (actually, Preact) to render in response to user interaction, we'd lose this control.
Take another look at <em>panzoom/PanZoom.jsx</em>.</p>
<figure class="tabs scrollable go4043944666"><span id="tabs-panzoom-again" class="anchor"></span><div class="go4220627111"><div class="go239274143"><div class="top-right">disable</div><div class="central">interact</div></div><div class="go1048461253"></div></div></figure>
<p><em>PanZoom</em> returns an <code>&lt;svg/&gt;</code> with a viewBox attribute determined by <code>state.viewBox</code>.
When a user zooms via mousewheel, the event handler <code>state.onWheel</code> updates <code>state.viewBox</code>.
But updating this variable does not automatically update the virtual DOM.
Usually one would <em>trigger a re-render</em>, so that <em>PanZoom</em> returns <code>&lt;svg/&gt;</code> with the updated viewBox, and the DOM-diffing algorithm does the update.
But how do we trigger a re-render?</p>
<h3 level="3"><span id="tech1--internal-state-via-" class="anchor"></span><a href="#tech1--internal-state-via-"><a>Internal state via <code>useState</code></a></a></h3>
<p>A React function component is rendered whenever an ancestor is (modulo React.memo), or if its internal state changes. Internal state is represented using the <a href="https://reactjs.org/docs/hooks-state.html"><span id="tech1--link-react.usestate-hook" class="anchor"></span>React.useState hook</a> e.g.</p>
<blockquote>
<p><code>const [value, setValue] = React.useState(() =&gt; initialValue);</code></p>
</blockquote>
<p>These declarations cannot be nested, must occur at the &quot;top-level&quot; of the React function component, and must always execute in the same order.
This induces a <a href="https://github.com/preactjs/preact/blob/98f130ee8695c2b4f7535205ddf02168192cdcac/hooks/src/index.js#L109" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">well-defined association</a> with their enclosing component.
To change state we execute <code>setValue(nextValue)</code> e.g. in response to a click. If <code>nextValue</code> differs from <code>value</code>, the function <code>setValue</code> causes the component to re-render where now <code>React.setState(...)[0]</code> has the new value.
This propagation of internal state is possible because a component's hooks must always execute in the same order.</p>
<h3 level="3"><span id="tech1--avoiding-react-renders" class="anchor"></span><a href="#tech1--avoiding-react-renders"><a>Avoiding React Renders</a></a></h3>
<p>In <em>panzoom/PanZoom.jsx</em>, <code>value</code> corresponds to <code>state</code> but there is no correspondent of <code>setValue</code>.
Why?
Because we never inform React we've changed <code>state</code>, despite mutating it on mouse and pointer events.
Instead we directly mutate the DOM via:</p>
<blockquote>
<p><code>state.root.setAttribute( 'viewBox', `${state.viewBox}` );</code></p>
</blockquote>

<p>As far as React is concerned, nothing has changed.
Furthermore if React renders the component for another reason, it'll use the mutated <code>state</code> to set the viewBox attribute (no change).
Why don't we use <code>setState</code>?
To avoid needlessly recomputing <code>&lt;Grid /&gt;</code> and <code>children</code> whenever we pan or zoom.
Our game may contain many elements, and we'd rather not recompute their virtual DOM tens of times per second.</p>
<p>The above situation is handled by a single DOM mutation.
In more complex situations we'll integrate <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components"><span id="tech1--link-web-components" class="anchor"></span>Web Components</a>.
More on that later.</p>
</article><hr class="go1763247448" /></li><li><article class="go1964420585"><span id="article-tech2" class="anchor"></span><time dateTime="2021-07-19">19th July 2021</time><h2 level="2"><a href="#article-tech2"><a>Tech (ai)</a></a></h2>
<p>So far we've described our objective, constrained our approach, and listed the technologies we'll use.
Having discussed <a href="2#tech1--react-and-preact" title="@anchor" class="anchor-link"><span id="tech2--link-javascript-components" class="anchor"></span>JavaScript components</a>,
we turn to Game AI.</p>
<h3 level="3"><span id="tech2--overview" class="anchor"></span><a href="#tech2--overview"><a>Overview</a></a></h3>
<p><em>Rogue Markup</em> will present a birdseye viewpoint of the interior of starships.
The <a href="https://wiki.travellerrpg.com/Crew" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">crew</a> will have tasks e.g. manning the bridge, patrolling the decks, monitoring <a href="https://wiki.travellerrpg.com/Low_Passage" title="@new-tab" target="_blank" rel="noopener" class="new-tab-link">low berths</a>.
These behaviours will be constrained by e.g. sleep patterns, the behaviour of others, and hardware failures.
So how do video games implement these behaviours?</p>
<p>There are three standard systems:</p>
<blockquote>
<p><strong>Navigation</strong>: <em>planning e.g. route from A to B.</em></p>
<p><strong>Animation</strong>: <em>realism (e.g. limb movement) and visual cues.</em></p>
<p><strong>Physics</strong>: collision detection, force-driven rigid bodies, raycasting.</p>
</blockquote>
<p>Navigation is of central importance and will be discussed shortly.
Concerning animation, we're definitely not going to obsess over realism.
Nevertheless we'll need visual cues to indicate NPC actions,
and a <em>sense of flow</em> via interdependent concurrent animations.
As for a physics engine, we <a href="1#constraints--game-mechanics" title="@anchor" class="anchor-link"><span id="tech2--link-already-mentioned" class="anchor"></span>already mentioned</a> we won't be using one. Instead:</p>
<ul>
<li>Collision detection will be handled at a higher level (navigation).</li>
<li>The Web Animations API will replace force-driven movement.</li>
<li>We'll write our own raycaster e.g. for line-of-sight detection.</li>
</ul>
<p>It is worth discussing Navigation and Raycasting in more detail.</p>
<h3 level="3"><span id="tech2--navigation" class="anchor"></span><a href="#tech2--navigation"><a>Navigation</a></a></h3>


<figure class="tabs scrollable go1506804081"><span id="tabs-nav-demo" class="anchor"></span><div class="go3574057674"><div class="go239274143"><div class="top-right">disable</div><div class="central">interact</div></div><div class="go1048461253"></div></div></figure>
<h3 level="3"><span id="tech2--raycasting" class="anchor"></span><a href="#tech2--raycasting"><a>Raycasting</a></a></h3>
<p>...</p></article><hr class="go1763247448" /></li><li><article class="go1964420585"><span id="article-tech3" class="anchor"></span><time dateTime="2021-07-19">19th July 2021</time><h2 level="2"><a href="#article-tech3"><a>Tech (dev)</a></a></h2>
<h3 level="3"><span id="tech3--static-analysis" class="anchor"></span><a href="#tech3--static-analysis"><a>Static Analysis</a></a></h3>
<ul>
<li>Typescript via JSDoc, referring to CodeSandbox.</li>
</ul>
<h3 level="3"><span id="tech3--runtime-analysis" class="anchor"></span><a href="#tech3--runtime-analysis"><a>Runtime Analysis</a></a></h3>
<ul>
<li>Terminal + Game AI</li>
</ul>
<h3 level="3"><span id="tech3--comments" class="anchor"></span><a href="#tech3--comments"><a>Comments</a></a></h3>
<ul>
<li>Display GitHub comments from Issue (build-time)</li>
<li>Can use anonymous credits to get recent</li>
</ul>
<br />
<br />
</article><hr class="go1763247448" /></li></ol><div class="go3599503544"><a href="/part/3#article-geomorphs">continue</a></div></main></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/part/2","query":{},"buildId":"5lW0kNlvMVOcRhnc58Pu7","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>